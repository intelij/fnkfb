YUI.add("_shared_module_search_empty_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_search_empty_rollup={base:'<div class="content search glass no-result {{showDD1}}" id="msg-list-no-result"> {{showDD}} <div class="inner {{hasMON_a}}"> <div class="empty-title"> <h2 class="empty-search-title">{{str_srch_nothing}}</h2> {{showDesc}} </div> <div class="empty-search-split"></div> <div class="help"> <p class="help_title">{{str_srch_nothing_help}}</p> <ul> <li class="tip">{{str_srch_nothing_tip1}}</li> <li class="tip">{{str_srch_nothing_tip2}}</li> <li class="tip">{{str_srch_nothing_tip3}}</li> </ul> </div> </div></div>',showDD1:"with-right-rail",showDD:'<div id="dd_search_background_helper_overlay"></div> <div id="dd_search_results_container"></div> <div id="dd_search_results_container_top"></div> ',showDesc:'<p class="empty-search-desc">{{str_srch_nothing_desc}}</p> '};},"1.0.0");YUI.add("_shared_module_search_empty_tae_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_search_empty_tae_rollup={base:'<div class="content search glass no-result {{showDD1}}" id="msg-list-no-result"> {{showDD}} <div class="inner {{hasMON_a}}"> <div class="empty-title"> <h2 class="empty-search-title">{{str_search_temporarily_unavailable}}</h2> </div> <div class="empty-search-split"></div> <div class="help"> <p class="help_title">{{str_search_temporarily_unavailable_explaination}}</p> </div> </div></div>',showDD1:"with-right-rail",showDD:'<div id="dd_search_results_container"></div> <div id="dd_search_results_container_top"></div> '};},"1.0.0");YUI.add("_shared_module_search_empty_contact_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_search_empty_contact_rollup={base:'<div class="content search glass no-result {{showDD1}}" id="msg-list-no-result"> {{showDD}} <div class="inner {{hasMON_a}}"> <div class="empty-title"> <h2 class="empty-search-title">{{str_srch_nothing}}</h2> </div>  <div class="help"> <span class="default" data-action="searchToInstead" role="button"> <a href="#" {{isToQuery}} {{isFromQuery}} </a> </span> </div> </div></div>',showDD1:"with-right-rail",showDD:'<div id="dd_search_background_helper_overlay"></div> <div id="dd_search_results_container"></div> <div id="dd_search_results_container_top"></div> ',isToQuery:'title="{{str_srch_contacts_search_from_instead_title}}" class="contactdetails-search contactdetails-search-from"> {{str_srch_contacts_search_from_instead}} ',isFromQuery:'title="{{str_srch_contacts_search_to_instead_title}}" class="contactdetails-search contactdetails-search-to"> {{str_srch_contacts_search_to_instead}} '};},"1.0.0");YUI.add("mail-ui-advancedSearchView",function(E){var C=E.common.Utils,A=C.substitute,B=[];var D=function(F){var H=this,G={rootNode:{writeOnce:true},template:{setter:function(){H.TEMPLATE=H.get("searchingContact")?E.ui.Templates._shared_module_search_empty_contact_rollup:E.ui.Templates._shared_module_search_empty_rollup;}},searchingContact:{},data:{},query:{},responseCode:{}};E.augment(H,E.Attribute);H.addAttrs(G,F||{});E.augment(H,E.EventTarget);};D.prototype={TEMPLATE:E.ui.Templates._shared_module_search_empty_rollup,render:function(){var J=this,I=J.get("query.keyword"),H=J.get("data")||{},F,G;H.responseCode=J.get("responseCode"),H.queryString=C.escapeHtml(I);J.TEMPLATE=H.showDD?E.ui.Templates._shared_module_search_empty_contact_rollup:E.ui.Templates._shared_module_search_empty_rollup;F={showDD:function(K){if(K.showDD){return J.TEMPLATE.showDD;}return"";},showDD1:function(K){if(K.showDD){return J.TEMPLATE.showDD1;}return"";},showDesc:function(L){var K=L&&L.query&&L.query.keyword;return K?A(J.TEMPLATE.showDesc,L,null,0,strings):"";},isToQuery:function(L){var K;if(L&&L.queryString){if(L.queryString.indexOf("toaddress")!==-1||L.queryString.indexOf("recipient")!==-1){K={str_srch_contacts_search_from_instead_title:strings.str_srch_contacts_search_from_instead_title.replace("{{searchingContact}}",J.get("searchingContact")),str_srch_contacts_search_from_instead:strings.str_srch_contacts_search_from_instead.replace("{{searchingContact}}",J.get("searchingContact"))};return A(J.TEMPLATE.isToQuery,E.merge(strings,K));}}return"";},isFromQuery:function(L){var K;if(L.queryString.indexOf("fromaddress")!==-1){K={str_srch_contacts_search_to_instead:strings.str_srch_contacts_search_to_instead.replace("{{searchingContact}}",J.get("searchingContact")),str_srch_contacts_search_to_instead_title:strings.str_srch_contacts_search_to_instead_title.replace("{{searchingContact}}",J.get("searchingContact"))};return A(J.TEMPLATE.isFromQuery,E.merge(strings,K));}return"";}};H.searchingContact=J.get("searchingContact");H.search_no_results="{{str_srch_no_results}}";if(H.responseCode===500){G=E.ui.Templates._shared_module_search_empty_tae_rollup;}else{G=H.showDD?E.ui.Templates._shared_module_search_empty_contact_rollup:E.ui.Templates._shared_module_search_empty_rollup;}J.get("rootNode").appendChild(E.Node.create(A(G.base,H,F,0,strings)));J.bindUI();},bindUI:function(){var F,H=this,G=E.one('*[data-action="searchToInstead"]>a');for(F in B){E.detach(B[F]);}if(H.get("searchingContact")&&G){B.push(G.on("click",function(J){if(J.currentTarget.hasClass("contactdetails-search")){}else{var I=this.get("data").queryString,K="from";if(I&&(I.substring(0,I.indexOf(":")).indexOf("toaddress")!==-1||I.substring(0,I.indexOf(":")).indexOf("recipient")!==-1)){K="to";}E.fire("fireSearch",K+':"'+this.get("searchingContact")+'"');J.halt();}return false;},H));}},close:function(){var H=this,G,F=H.get("rootNode").all("div.content.search");for(G in B){E.detach(B[G]);}B=[];F&&F.remove();}};E.namespace("mail.ui");E.mail.ui.AdvancedSearchView=D;},"1.0.0",{requires:["common-utils","_shared_module_search_empty_rollup","_shared_module_search_empty_tae_rollup","_shared_module_search_empty_contact_rollup","attribute-base","event-base"]});YUI.add("mail-ui-advancedSearchController",function(B){var A=function(C){var E=this,D={data:{},rootNode:{writeOnce:true,setter:function(){E.get("widget")&&E.get("widget").render();}},searchingContact:{},responseCode:{},query:{},widget:{setter:function(F){E.get("rootNode")&&F.render();}}};B.augment(E,B.Attribute);E.addAttrs(D,C||{});B.augment(E,B.EventTarget);};A.prototype={process:function(){var D=this,C;D.set("widget",new B.mail.ui.AdvancedSearchView({rootNode:D.get("rootNode"),data:D.get("data"),searchingContact:D.get("searchingContact"),query:D.get("query"),responseCode:D.get("responseCode")}));C=D.get("widget");},close:function(){var C=this;C.get("widget").close();}};B.namespace("mail.ui");B.mail.ui.AdvancedSearchController=A;},"1.0.0",{requires:["common-utils","mail-ui-advancedSearchView","plugin","ac-widget","filter-contacts","forms_css","autocomplete_css","_shared_module_offscreen_bin_compose","comms-utils"]});YUI.add("_shared_module_shell_navigation_search_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_shell_navigation_search_rollup={base:'<div class="search-nav {{global_refined_search}}"><div class="alert"> <p class="num-results">{{multiple_search_result}} {{single_search_result}}</p></div> {{folder_is_empty_else}} {{sender_refinements}} {{attachment_refinements}} {{folder_refinements}} {{date_refinements}} {{status_refinements}}  <div class="clear"></div></div>',global_refined_search:"search-narrowed",multiple_search_result:"{{str_srch_status}}",single_search_result:"{{str_srch_status_single}}",global_refined_search1:'<div class="search-title">{{str_srch_refined_by}}</div>',global_refined_search_else:'<div class="search-title">{{str_srch_refinements}}</div>',show_sender_profile:'<img src="{{refined_img_url}}" alt="{{refined_val}}"/> ',is_user:"{{show_sender_profile}} ",global_refined_by:'<div class="items-nav filters"><ul class="{{refined_type}} med"> <li class="{{refined_subtype}} refine-item"> <span class="left"><a class="s-tp" href="#" title="{{title}}"><i> {{is_user}}{{refined_val}}</i></a></span> <span class="filterremove right"><a href="{{url}}" class="cancel-ref btn" title="{{str_srch_title_remove_refinement_attr}}" data-action="cancel-refinement"> <i class="icon-small-close"></i></a></span> </li></ul></div> ',global_refined_search2:'</div><div class="search-nav"> <div class="search-title">{{str_srch_add_filters}}</div> ',folder_is_empty_else:"{{global_refined_search1}} {{global_refined_search_else}} {{global_refined_by}} {{global_refined_search2}} ",global_refined_search_else1:'<span class="label"><i class="icon icon-chevron-down"></i>{{str_srch_refineby_sender}}</span></h2>',global_refined_search3:'<span class="label"><i class="icon icon-chevron-down"></i>{{str_srch_refineby_sender_details}}</span></h2>',show_sender_profile1:'<img src="{{url_img}}" alt="{{detail_attr}}" /> ',sender_details:'<li><a class="s-tp" href="{{url}}" data-action="search-refine" title="{{detail_attr}}"><i> {{show_sender_profile1}} {{detail}}</i><span class="rht">{{count}}</span></a></li> ',has_sender_refinements:'<ul class="users med"> {{sender_details}} </ul> ',show_sender_profile2:'<img src="{{url_img}}" alt="{{detail_attr}}" /> ',sender_details_extra:'<li><a class="s-tp" href="{{url}}" data-action="search-refine" title="{{detail_attr}}"><i> {{show_sender_profile2}} {{detail}}</i><span class="rht">{{count}}</span></a></li> ',has_sender_refinements_extra:'<div class="show-hide"><a data-action="show-refinements" href="#" title="{{str_srch_view_all_sender_attr}}">{{str_srch_view_all}}</a></div> <ul class="users med hidden"> {{sender_details_extra}} </ul> <div class="hidden show-hide"><a data-action="hide-refinements" href="#" title="{{str_srch_view_less_sender_attr}}">{{str_srch_view_less}}</a></div> ',sender_refinements:'<div class="items expanded refine sender" data-action="collapsable"> <h2 class="legend"> {{global_refined_search_else1}} {{global_refined_search3}} {{has_sender_refinements}} {{has_sender_refinements_extra}}</div>',attachment_details:'<li class="{{file_type}}"><a class="s-tp" href="{{url}}" data-action="search-refine" title="{{detail_attr}}"><i>{{detail}}</i><span class="rht">{{count}}</span></a></li> ',has_attachment_refinements:'<ul class="attachments"> {{attachment_details}} </ul> ',attachment_details_extra:'<li class="{{file_type}}"><a class="s-tp" href="{{url}}" data-action="search-refine" title="{{detail_attr}}"><i>{{detail}}</i><span class="rht">{{count}}</span></a></li> ',has_attachment_refinements_extra:'<div class="show-hide"><a data-action="show-refinements" href="#" title="{{str_srch_view_all_attachment_attr}}">{{str_srch_view_all}}</a></div> <ul class="hidden attachments"> {{attachment_details_extra}} </ul> <div class="hidden show-hide"><a data-action="hide-refinements" href="#" title="{{str_srch_view_less_attachment_attr}}">{{str_srch_view_less}}</a></div> ',attachment_refinements:'<div class="items expanded refine file" data-action="collapsable"> <h2 class="legend"><span class="label"><i class="icon icon-chevron-down"></i>{{str_srch_refineby_attachment}}</span></h2> {{has_attachment_refinements}} {{has_attachment_refinements_extra}}</div>',is_in:"in",is_chats:"chats",is_drafts:"drafts",is_folder:"folder",is_sent:"sent",is_trash:"trash",folder_details:'<li class="{{is_in}}{{is_chats}}{{is_drafts}}{{is_folder}}{{is_sent}}{{is_trash}}"> <a class="s-tp" href="{{url}}" data-action="search-refine" title="{{detail_attr}}"><i>{{detail}}</i><span class="rht">{{count}}</span></a> </li> ',has_folder_refinements:'<ul class="folders"> {{folder_details}} </ul> ',is_in1:"in",is_chats1:"chats",is_drafts1:"drafts",is_folder1:"folder",is_sent1:"sent",is_trash1:"trash",folder_details_extra:'<li class="{{is_in1}}{{is_chats1}}{{is_drafts1}}{{is_folder1}}{{is_sent1}}{{is_trash1}}"> <a class="s-tp" href="{{url}}" data-action="search-refine" title="{{detail_attr}}"><i>{{detail}}</i><span class="rht">{{count}}</span></a> </li> ',has_folder_refinements_extra:'<div class="show-hide"><a data-action="show-refinements" href="#" title="{{str_srch_view_all_folder_attr}}">{{str_srch_view_all}}</a></div> <ul class="folders hidden"> {{folder_details_extra}} </ul> <div class="hidden show-hide"><a data-action="hide-refinements" href="#" title="{{str_srch_view_less}}">{{str_srch_view_less}}</a></div> ',folder_refinements:'<div class="items expanded refine folder" data-action="collapsable"> <h2 class="legend"><span class="label"><i class="icon icon-chevron-down"></i>{{str_srch_refineby_folder}}</span></h2> {{has_folder_refinements}} {{has_folder_refinements_extra}}</div>',date_details:'<li><a href="{{url}}" class="s-tp" data-action="search-refine" title="{{detail_attr}}"><i>{{detail}}</i><span class="rht">{{count}}</span></a></li> ',has_date_refinements:'<h3 class="offscreen">{{str_srch_refineby_date}}</h3> <ul class="calendars"> {{date_details}} </ul> ',date_details_extra:'<li><a href="{{url}}" class="s-tp" data-action="search-refine" title="{{detail_attr}}"><i>{{detail}}</i><span class="rht">{{count}}</span></a></li> ',has_date_refinements_extra:'<div class="show-hide"><a data-action="show-refinements" href="#" title="{{str_srch_view_all_date_attr}}">{{str_srch_view_all}}</a></div> <ul class="calendars hidden"> {{date_details_extra}} </ul> <div class="hidden show-hide"><a data-action="hide-refinements" href="#" title="{{str_srch_view_less}}">{{str_srch_view_less}}</a></div> ',date_refinements:'<div class="items refine date {{is_collapsed}}" data-action="collapsable"> <h2 class="legend"><span class="label"><i class="icon icon-chevron-right"></i>{{str_srch_refineby_date}}</span></h2> {{has_date_refinements}} {{has_date_refinements_extra}} </div>',is_flagged:"flagged",is_unread:"unread",is_replied:"replied",is_forwarded:"forwarded",status_details:'<li class="{{is_flagged}}{{is_unread}}{{is_replied}}{{is_forwarded}}"><a class="s-tp" href="{{url}}" data-action="search-refine" title="{{detail_attr}}"><i>{{detail}}</i><span class="rht">{{count}}</span></a></li> ',status_refinements:'<div class="items {{is_collapsed}} refine status item-last" data-action="collapsable"> <h2 class="legend"><span class="label"><i class="icon icon-chevron-right"></i>{{str_srch_refineby_status}}</span></h2> <ul class="status"> {{status_details}} </ul></div>'};
},"1.0.0");YUI.add("mail-ui-searchGroupsView",function(C){var I=C.common.Utils,N=C.mail.ui.common.StringUtils,E=I.escapeHtml,D=I.unescapeHtml,F=I.substitute,H=["month_abbr_january","month_abbr_february","month_abbr_march","month_abbr_april","month_abbr_may","month_abbr_june","month_abbr_july","month_abbr_august","month_abbr_september","month_abbr_october","month_abbr_november","month_abbr_december"],G=(NeoConfig.isSSL?"https://s.yimg.com":"http://mail.yimg.com")+"/ok/u/assets/img/display-img/",K=["profile_16a.png","profile_16b.png","profile_16c.png","profile_16d.png","profile_16e.png"],M=[],B=I.ymmastats,J=NeoConfig.refineTop,L=J?4:5;var A=function(O){var Q=this,P={rootNode:{writeOnce:true},template:{setter:function(R){Q.TEMPLATE=C.ui.Templates._shared_module_shell_navigation_search_rollup;}},data:{}};C.augment(Q,C.Attribute);Q.addAttrs(P,O||{});C.augment(Q,C.EventTarget);};A.prototype={TEMPLATE:C.ui.Templates._shared_module_shell_navigation_search_rollup,formatters:{is_collapsed:function(Q,O,P){return J?"":"collapsed";},single_search_result:function(R,O,P){var S=P,Q=R.total;if(Q>1){return"";}return F(S.TEMPLATE.single_search_result,{search_results_count:Q},0,0,strings,null,S);},multiple_search_result:function(R,O,P){var S=P,Q=R.total;if(Q===1){return"";}return F(S.TEMPLATE.multiple_search_result,{search_results_count:Q},0,0,strings,null,S);},global_refined_search:function(Q,O,P){var R=P;return C.Object.size(Q.refinedby)?F(R.TEMPLATE.global_refined_search,0):"";},folder_is_empty_else:function(R,O,P){var S=P,Q={};if(C.Object.size(R.refinedby)){Q.global_refined_search1=F(S.TEMPLATE.global_refined_search1,R,S.formatters,R,strings,null,S);Q.global_refined_search2=F(S.TEMPLATE.global_refined_search2,R,S.formatters,R,strings,null,S);}else{Q.global_refined_search_else=F(S.TEMPLATE.global_refined_search_else,R,S.formatters,R,strings,null,S);}return F(S.TEMPLATE.folder_is_empty_else,Q,S.formatters,R,strings,null,S);},global_refined_by:function(S,O,Q){var T=Q,P=[],R;S=O;if(!C.Object.size(S.refinedby)){return;}for(R in S.refinedby){if(T.formatters["undo_"+R]){P.push(T.formatters["undo_"+R].call(T,O,O,T));}}return P.join("");},count:function(Q,O,P){return Q.count;},undo_attachmenttype:function(S,P,Q){var T=Q,O=E(D(S.refinedby.attachmenttype.type)),R={refined_type:"attachments",refined_subtype:S.refinedby.attachmenttype.icon,refined_val:O,title:F(strings.str_srch_undo_attachtype_attr,{refineattachcat:O}),url:"#refiner=attachmenttype"};return F(T.TEMPLATE.global_refined_by,R,T.formatters,S,strings,null,T);},undo_fnums:function(T,Q,R){var U=R,O={"Inbox":"in","Sent":"sent","@C@Chats":"chats","Trash":"trash","Draft":"drafts"},P=N.getSystemFolderName(encodeURIComponent(T.refinedby.fnums[0]),E(D(T.refinedby.fnums[0]))),S={refined_type:"folders",refined_subtype:O[T.refinedby.fnums[0]]||"folder",refined_val:P,title:F(strings.str_srch_undo_folder_attr,{folder:P}),url:"#refiner=folder"};return F(U.TEMPLATE.global_refined_by,S,U.formatters,T,strings,null,U);},undo_from:function(S,P,Q){var T=Q,O=E(D(S.refinedby.from)),R={refined_type:"users",refined_val:O,title:F(strings.str_srch_undo_sender_attr,{recipient:O}),is_user:F(T.TEMPLATE.is_user,{refined_img_url:G+K[Math.floor(Math.random()*5)]}),url:"#refiner=from"};return F(T.TEMPLATE.global_refined_by,R,T.formatters,S,strings,null,T);},undo_date:function(T,Q,R){var U=R,P=T.refinedby.date.month?"-"+strings["str_mail_"+H[T.refinedby.date.month-1]]:"",O=E(T.refinedby.date.year+P),S={refined_type:"calendars",refined_val:O,title:F(strings.str_srch_undo_date_attr,{refinedate:O}),url:"#refiner=date"};return F(U.TEMPLATE.global_refined_by,S,U.formatters,T,strings,null,U);},undo_flags:function(U,Q,S){var V=S,P=U.refinedby.flags,T,R=[];for(var O in P){T={refined_type:"status",refined_subtype:O,refined_val:strings["str_srch_"+O],title:F(strings.str_srch_undo_flag_attr,{refineflag:strings["str_srch_"+O]}),url:"#refiner=status&flags="+O};R.push(F(V.TEMPLATE.global_refined_by,T,V.formatters,U,strings,null,V));}return R.join("");},sender_refinements:function(R,O,P){var S=P,Q={};if(!R.grouplist.from||!R.grouplist.from.length||R.refinedby.from){return"";}if(R.query.from){Q.global_refined_search3=F(S.TEMPLATE.global_refined_search3,R,S.formatters,R,strings,null,S);}else{Q.global_refined_search_else1=F(S.TEMPLATE.global_refined_search_else1,R,S.formatters,R,strings,null,S);}Q.has_sender_refinements=F(S.TEMPLATE.has_sender_refinements,R,S.formatters,R,strings,null,S);if(R.grouplist.from.length>L){Q.has_sender_refinements_extra=F(S.TEMPLATE.has_sender_refinements_extra,R,S.formatters,R,strings,null,S);}return F(S.TEMPLATE.sender_refinements,Q,S.formatters,R,strings,null,S);},sender_detail_utils:function(Q,X,O){var V=O,T,W=Q.length,Y=X.startIdx,Z=X.template,S,R,U=[],b,a,P="";for(T=0;T<W;T++){R=Y?K[Math.floor(Math.random()*5)]:K[T];a=E(D(Q[T].id));b=Q[T].count;P=b>9999?"(9999+)":"("+b+")";S={count:P,detail:a,detail_attr:F(strings.str_srch_sender_attr,{recipient:a},0,0,0)+" ("+b+")",url:"#refiner=from&index="+(T+Y),url_img:G+R};U.push(F(Z,S,V.formatters,Q,strings,null,V));}return U.join("");},sender_details:function(Q,O,P){var R=P;return R.formatters.sender_detail_utils(Q.grouplist.from.slice(0,L),{startIdx:0,template:R.TEMPLATE.sender_details},R);},sender_details_extra:function(Q,O,P){var R=P;return R.formatters.sender_detail_utils(Q.grouplist.from.slice(L),{startIdx:L,template:R.TEMPLATE.sender_details_extra},R);},show_sender_profile:function(Q,O,P){return"";},show_sender_profile1:function(Q,O,P){return"";},show_sender_profile2:function(Q,O,P){return"";},attachment_refinements:function(R,O,P){var S=P,Q={};if(!R.grouplist.attachmenttype||!R.grouplist.attachmenttype.length||R.refinedby.attachmenttype){return"";}Q.has_attachment_refinements=F(S.TEMPLATE.has_attachment_refinements,R,S.formatters,R,strings,null,S);if(R.grouplist.attachmenttype.length>L){Q.has_attachment_refinements_extra=F(S.TEMPLATE.has_attachment_refinements_extra,R,S.formatters,R,strings,null,S);}return F(S.TEMPLATE.attachment_refinements,Q,S.formatters,R,strings,null,S);
},attachment_detail_utils:function(Q,X,O){var U=O,S,V=Q.length,Y=X.startIdx,Z=X.template,R,T=[],W,a,P="";for(S=0;S<V;S++){W=E(D(Q[S].type));a=Q[S].count;P=a>9999?"(9999+)":"("+a+")";R={count:P,detail:W,detail_attr:F(strings.str_srch_attachtype_attr,{refineattachcat:W},0,0,0)+" ("+a+")",url:"#refiner=attachmenttype&index="+(S+Y),file_type:Q[S].icon};T.push(F(Z,R,U.formatters,Q,strings,null,U));}return T.join("");},attachment_details:function(Q,O,P){var R=P;return R.formatters.attachment_detail_utils(Q.grouplist.attachmenttype.slice(0,L),{startIdx:0,template:R.TEMPLATE.attachment_details},R);},attachment_details_extra:function(Q,O,P){var R=P;return R.formatters.attachment_detail_utils(Q.grouplist.attachmenttype.slice(L),{startIdx:L,template:R.TEMPLATE.attachment_details_extra},R);},date_refinements:function(R,O,P){var S=P,Q={};if(!R.grouplist.date||!R.grouplist.date.length||(R.refinedby.date&&R.refinedby.date.month)){return"";}Q.has_date_refinements=F(S.TEMPLATE.has_date_refinements,R,S.formatters,R,strings,null,S);if(R.grouplist.date.length>L){Q.has_date_refinements_extra=F(S.TEMPLATE.has_date_refinements_extra,R,S.formatters,R,strings,null,S);}Q.expanded=F(S.TEMPLATE.expanded,0,0,0,strings);return F(S.TEMPLATE.date_refinements,Q,S.formatters,R,strings,null,S);},date_detail_utils:function(Q,W,O){var U=O,S,V=Q.length,X=W.startIdx,Z=W.template,R,T=[],Y,a,P="";for(S=0;S<V;S++){Y=E(W.refinedby.date&&W.refinedby.date.year?strings["str_mail_"+H[Q[S].id-1]]:Q[S].id);a=Q[S].count;P=a>9999?"(9999+)":"("+a+")";R={count:P,detail:Y,detail_attr:F(strings.str_srch_date_attr,{refinedate:Y},0,0,0)+" ("+a+")",url:"#refiner=date&index="+(S+X)};T.push(F(Z,R,U.formatters,Q,strings,null,U));}return T.join("");},date_details:function(Q,O,P){var R=P;return R.formatters.date_detail_utils(Q.grouplist.date.slice(0,L),{startIdx:0,template:R.TEMPLATE.date_details,refinedby:Q.refinedby},R);},date_details_extra:function(Q,O,P){var R=P;return R.formatters.date_detail_utils(Q.grouplist.date.slice(L),{startIdx:L,template:R.TEMPLATE.date_details_extra,refinedby:Q.refinedby},R);},folder_refinements:function(R,O,P){var S=P,Q={};if(!R.grouplist.folder||!R.grouplist.folder.length||R.refinedby.fnums){return"";}Q.has_folder_refinements=F(S.TEMPLATE.has_folder_refinements,R,S.formatters,R,strings,null,S);if(J&&R.grouplist.folder.length>L){Q.has_folder_refinements_extra=F(S.TEMPLATE.has_folder_refinements_extra,R,S.formatters,R,strings,null,S);}return F(S.TEMPLATE.folder_refinements,Q,S.formatters,R,strings,null,S);},folder_detail_utils:function(Y,W,O){var U=O,S,V=Y.length,X=W.startIdx,Z=W.template,R,T=[],Q,a,P="";for(S=0;S<V;S++){Q=N.getSystemFolderName(encodeURIComponent(Y[S].folder),E(D(Y[S].folder)));a=Y[S].count;P=a>9999?"(9999+)":"("+a+")";R={count:P,detail:Q,detail_attr:F(strings.str_srch_folder_attr,{folder:Q},0,0,0)+" ("+a+")",url:"#refiner=folder&index="+(S+X)};switch(Y[S].folder){case"Inbox":R.is_in="in";break;case"Sent":R.is_sent="sent";break;case"@C@Chats":R.is_chats="chats";break;case"Draft":R.is_drafts="drafts";break;case"Trash":R.is_trash="trash";break;default:R.is_folder="folder";break;}T.push(F(Z,R,U.formatters,Y,strings,null,U));}return T.join("");},folder_details:function(Q,O,P){var R=P;if(J){return R.formatters.folder_detail_utils(Q.grouplist.folder.slice(0,L),{startIdx:0,template:R.TEMPLATE.folder_details},R);}else{return R.formatters.folder_detail_utils(Q.grouplist.folder,{startIdx:0,template:R.TEMPLATE.folder_details},R);}},folder_details_extra:function(Q,O,P){var R=P;return R.formatters.folder_detail_utils(Q.grouplist.folder.slice(L),{startIdx:L,template:R.TEMPLATE.folder_details_extra},R);},status_refinements:function(Q,O,P){var R=P;if(!Q.grouplist.flags||!Q.grouplist.flags.length){return"";}return F(R.TEMPLATE.status_refinements,Q.grouplist.flags,R.formatters,Q.grouplist.flags,strings,null,R);},status_details:function(O,X,P){var V=P,T,W=O.length,S,U=[],R,Y,Q="";for(T=0;T<W;T++){R=E(strings["str_srch_"+O[T].id]);Y=O[T].count;Q=Y>9999?"(9999+)":"("+Y+")";S={count:Q,detail:R,detail_attr:F(strings.str_srch_flag_attr,{refineflag:R},0,0,0)+" ("+Y+")",url:"#refiner=status&index="+T};switch(O[T].id){case"flagged":S.is_flagged=F(V.TEMPLATE.is_flagged,0,0,0,strings);break;case"unread":S.is_unread=F(V.TEMPLATE.is_unread,0,0,0,strings);break;case"replied":S.is_replied=F(V.TEMPLATE.is_replied,0,0,0,strings);break;case"forwarded":S.is_forwarded=F(V.TEMPLATE.is_forwarded,0,0,0,strings);break;}U.push(F(V.TEMPLATE.status_details,S,V.formatters,O,strings,null,V));}return U.join("");}},render:function(){var S=this,Q,O=S.get("rootNode"),R=S.get("data"),P=O.one(".refinements");if(!NeoConfig.backButtonFull){C.fire("initPage");}Q=C.Node.create(F(S.TEMPLATE.base,R,S.formatters,R,strings,S.TEMPLATE,S));if(Q.one(".search-nav")){Q.all(".search-nav").each(function(T){T.addClass("fresh");});}else{Q.addClass("fresh");}if(J){if(P){P.appendChild(Q);}}else{O.one("#searchNav .listnav-container").appendChild(Q);}S.bindUI();},bindUI:function(){var Q=this,O=Q.get("rootNode"),P;for(P in M){C.detach(M[P]);}M=[];if(!J){M.push(O.delegate("click",function(R){B.stat("search_toggle_refinement");R.preventDefault();R.refinementNode=R.target;Q.fire("toggleRefinement",R);},"div.search-nav h2.legend span",Q));}M.push(O.delegate("click",function(R){B.stat("search_view_all_refinement");R.viewAllNode=R.target;R.preventDefault();Q.fire("viewAllRefinement",R);},"div.search-nav div.show-hide a",Q));M.push(O.delegate("click",function(R){B.stat("search_refine_by");R.preventDefault();R.refineByNode=R.currentTarget;Q.fire("refineBy",R);},"div.search-nav div.refine li a",Q));M.push(O.delegate("click",function(R){B.stat("search_undo_refinement");R.preventDefault();R.undoRefinementNode=R.currentTarget;Q.fire("undoRefinement",R);},"div.search-narrowed li a",Q));M.push(O.delegate("click",function(R){B.stat("search_close_search");R.preventDefault();R.refineByNode=R.currentTarget;Q.fire("closeSearch",R);},"div.search-nav span.btn-remove-item",Q));},toggleRefinement:function(Q){var O=Q.refinementNode.ancestor("div.refine"),P="";
if(O){P=O.one("ul");}Q.preventDefault();Q.stopPropagation();if(O&&P){O.toggleClass("collapsed");O.toggleClass("expanded");O.one("i.icon").toggleClass("icon-chevron-down");O.one("i.icon").toggleClass("icon-chevron-right");}},viewAllRefinement:function(Q){var S=this,P=Q.viewAllNode.ancestor("div.refine"),O=Q.viewAllNode.get("parentNode"),R=Q.viewAllNode.getAttribute("data-action");if(R==="show-refinements"){P.all(".hidden").replaceClass("hidden","_hide");O.addClass("hidden _x");}if(R==="hide-refinements"){P.all("._hide").replaceClass("_hide","hidden");P.all(".hidden._x").removeClass("hidden _x");S.get("rootNode").set("scrollTop","0");}},show:function(){var P=this,O=P.get("rootNode");O.all(".items").addClass("hidden");O.all("div.search-nav").removeClass("hidden");O.all("div.search-nav div.items").removeClass("hidden");},hide:function(){var P=this,O=P.get("rootNode");O.all(".items").removeClass("hidden");O.all("div.search-nav").addClass("hidden");},close:function(){var P=this,O=P.get("rootNode").all("div.search-nav");O&&O.remove();}};C.namespace("mail.ui");C.mail.ui.SearchGroupsView=A;},"1.0.0",{requires:["common-utils","_shared_module_shell_navigation_search_rollup","mail-ui-common-string-utils","ymma-stats"]});YUI.add("mail-ui-searchGroupsController",function(C){var A=C.common.Utils,D=A.ymmastats;var B=function(E){var G=this,F={searchingContact:{},data:{},query:{},rootNode:{writeOnce:true,setter:function(){G.get("widget")&&G.get("widget").render();}},widget:{setter:function(H){G.get("rootNode")&&H.render();}}};C.augment(G,C.Attribute);G.addAttrs(F,E||{});C.augment(G,C.EventTarget);G.after("activeChange",G.afterActiveChangeHandler,G);};B.prototype={process:function(){var F=this,E;F.set("widget",new C.mail.ui.SearchGroupsView({rootNode:F.get("rootNode"),data:F.get("data")}));E=F.get("widget");E.on("toggleRefinement",F.toggleRefinementHandler,F);E.on("viewAllRefinement",F.viewAllRefinementHandler,F);E.on("refineBy",F.refineByHandler,F);E.on("undoRefinement",F.undoRefinementHandler,F);E.on("closeSearch",F.closeSearchHandler,F);},toggleRefinementHandler:function(E){var F=this;F.get("widget").toggleRefinement(E);C.fire("mt:click",{action:"srch_tgl"});},viewAllRefinementHandler:function(E){var F=this;F.get("widget").viewAllRefinement(E);},refineByHandler:function(J){var I=this,N=A.parseQueryString(J.refineByNode.get("hash").substring(1)),H=I.get("data"),E=I.get("query"),O,M,F,K,L,G;K=L=C.mail.Tabs.getActiveTab();if(L.label!=="SEARCH"){F=C.mail.Tabs.tabs.length;for(G=F-1;G>=0;G--){if(C.mail.Tabs.tabs[G].label==="SEARCH"){K=C.mail.Tabs.tabs[G];break;}}C.mail.Tabs.switchToTab(K);}switch(N.refiner){case"from":E.from=H.grouplist.from[N.index].id;break;case"attachmenttype":E.attachmenttypes=H.grouplist.attachmenttype[N.index].refineBy;break;case"date":M=parseInt(H.grouplist.date[N.index].id,10);if(M>0&&M<13&&E.date&&E.date.year){E.date.month=M;}else{E.date={year:M};}break;case"folder":E.fnums=[parseInt(H.grouplist.folder[N.index].id,10)];break;case"status":E.flags=E.flags||{};O=H.grouplist.flags[N.index].id;if(O==="unread"){E.flags.read=0;}else{E.flags[O]=1;}break;default:return;}D.stat("search","refinement=>"+N.refiner);D.setKey({refinement_applied:"search_refinement_"+N.refiner});C.fire("mt:click",{action:"srch_flt",append:{ltxt:N.refiner+":add"}});I.fire("doMailSearch",{query:E});},undoRefinementHandler:function(G){var H=this,E=A.parseQueryString(G.undoRefinementNode.get("hash").substring(1)),F=H.get("query");switch(E.refiner){case"from":delete F.from;break;case"attachmenttype":delete F.attachmenttypes;break;case"date":if(F.date.month){delete F.date.month;delete F.date.day;}else{delete F.date;}break;case"folder":delete F.fnums;break;case"status":delete F.flags[(E.flags==="unread")?"read":E.flags];if(!C.Object.size(F.flags)){delete F.flags;}break;default:return;}C.fire("mt:click",{action:"srch_flt",append:{ltxt:E.refiner+":remove"}});H.fire("doMailSearch",{query:F});},afterActiveChangeHandler:function(E){var F=this;(E.newVal)?F.get("widget").show():F.get("widget").hide();},close:function(){var E=this;E.get("widget").close();},closeSearchHandler:function(){var F=this,E=C.mail.Tabs.tabs[0];F.close();C.mail.ui.searchTab.widget.close();C.one("#searchNav").removeClass("selected");if(C.one("body").getAttribute("data-open")==="searchNav"){C.fire("navigation:switch",{"type":"none"});}C.mail.Tabs.switchToTab(E);}};C.namespace("mail.ui");C.mail.ui.SearchGroupsController=B;},"1.0.0",{requires:["common-utils","mail-ui-searchGroupsView","ymma-stats"]});YUI.add("mail-ui-attachment-filetype",function(B){var A=function(){};A.prototype={getType:function(C){var D=C?C.substr(C.lastIndexOf(".")+1):"";switch(D.toLowerCase()){case"xls":case"xlsx":case"xlsb":case"xlsm":case"xlt":case"xltx":D="xls";break;case"doc":case"docx":case"dot":case"dotx":case"rtf":D="doc";break;case"pdf":D="pdf";break;case"zip":D="zip";break;case"mp3":case"m4a":case"wma":case"wav":D="music";break;case"ppt":case"pptx":case"pot":case"potx":case"pps":D="ppt";break;case"mpeg":case"mpg":case"mov":case"wmv":case"avi":case"flv":D="video";break;case"html":case"htm":case"eml":D="eml";break;default:D="eml";break;}return D;}};B.namespace("mail.ui").AttachFileType=new A();},"1.0.0");YUI.add("_shared_module_search_didyoumean_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_search_didyoumean_rollup={base:"{{did_you_mean_list}}",did_you_mean_list:'<li class="didyoumean-contact yui3-aclist-item" role="option" title="{{name}}" data-id="{{id}}"> <div class="xobniPersonResult has-name"> <div class="xobniPersonPic" style="background-image:url(\'{{imageUrl}}\');" alt="thumbnail"></div> <div class="textHolder"> <div class="ac-value" role="option"> {{name}} </div> </div> </div> </li>'};},"1.0.0");YUI.add("mail-ui-searchListView",function(C){var L=C.common.Utils,I=L.escapeHtml,E=L.unescapeHtml,J=L.substitute,D=C.common.persist.UserData,P=D.get("userUIPref.imageBlocking"),Q=C.mail.ui.common.StringUtils,A=NeoConfig.bidi&&C.Intl.detectDirection,K=C.mail.ui.SearchUtils,F="userUIPref.msgListDensity",O,H=(strings.str_cfg_tog_hkr_siu===true?"hkr_siu":"cg_siu"),G=strings.str_cfg_tog_hkr_siu===true,N={"http://mail.yimg.com/a/i/cal/bell4.gif":"bell","http://mail.yimg.com/a/i/us/pim/ybang_16x16_1.gif":"certified"},M=NeoConfig.refineTop;var B=function(R){var T=this,S={rootNode:{writeOnce:true},fid:{setter:function(U){T.fid=U||"%40S%40Search";}},template:{setter:function(U){T.TEMPLATE=U;}},rawData:{},data:{},sortInfo:{getter:function(){return T.get("controller").get("sortInfo");}},controller:{},page:{getter:function(){return T.get("controller").get("page");}},pageCount:{getter:function(){return T.get("controller").get("pageCount");}},view:{getter:function(){return T.get("controller");}}};C.augment(T,C.Attribute);T.addAttrs(S,R||{});C.augment(T,C.EventTarget);};B.prototype={NAME:"SearchList",TEMPLATE:C.ui.Templates._shared_module_search_with_snippet_rollup,TEMPLATE_didYouMean:C.ui.Templates._shared_module_search_didyoumean_rollup,highlightSearchTerm:function(R){var T=R.split("^_");if(strings.str_cfg_tog_snippet_highlight){for(var S=1;S<T.length;S+=2){T[S]="<span class='found'>"+T[S]+"</span>";}}return T.join("");},getInboxService:function(V){var U=V.srvmap,S,R,T="";if(!U){R=V.inboxservices||[];V.srvmap=U={};for(S=R.length-1;S>=0;S--){U[R[S].name]=R[S].value;}}if(!strings.str_cfg_tog_certified_icon&&U.crt){delete U.crt;}if((G||!U.crt)&&(U[H]||U.siu||V.msgicon)){if(U&&U[H]){T=N[U[H]]||"";}else{if(V.msgicon){T=V.msgicon;}}}U.inboxService=T;return T;},calculateFrom:function(V){if(!V.contactInfo){var U=strings.str_cfg_tog_show_contact_name&&C.contacts&&C.contacts.utils,S=V.from?V.from[0]:null,R=S?S.displayname:null,T;T=U?(S&&C.contacts.utils.getShownContactName({email:S.address}))||R:R;V.contactInfo={};V.contactInfo.dir="";if(T&&A){V.contactInfo.dir=C.Intl.detectDirection(T);}V.contactInfo.text=T?I(E(T)):"&nbsp;";}return V;},formatters:{top_refinements:function(T,R,S){var W=S,V=false,U=S.get("rawData");if(M){if(U&&U.grouplist&&C.Object.size(U.grouplist)){V=true;}}return V?W.TEMPLATE.top_refinements:"";},refinementWithoutDD:function(V,T,U){var S,R;var Y=U,X=false,W=U.get("rawData");if(M){if(W&&W.grouplist&&C.Object.size(W.grouplist)){X=true;}}if(!V.showDD&&M){if(V&&V.query&&V.query.keyword){R=U.get("data")&&U.get("data").query&&U.get("data").query.keyword;S={str_srch_search_result_for:strings.str_srch_search_result_for.replace("{{searchTerm}}",R),didYouMean:J(U.TEMPLATE.didYouMean,strings)};}else{S={str_srch_search_result_for:strings.str_conv_title_conversation_history,didYouMean:""};}if(X){S.refinementOn=J(U.TEMPLATE.refinementOn,strings);}return J(U.TEMPLATE.refinementWithoutDD,C.merge(V,S),U.formatters,V,strings,null,U);}return"";},from:function(T,R,S){var U=S;U.calculateFrom(T);return T.contactInfo.text;},fromDir:function(T,R,S){var U=S;U.calculateFrom(T);return T.contactInfo.dir;},fromTitle:function(R){return R.from?(R.from[0].address?R.from[0].address:""):"";},from_header:function(T,R,S){switch(S.fid){case"%40C%40Chats":return strings.str_msg_list_participant;case"Draft":case"Sent":return strings.str_msg_list_to;}return strings.str_msg_list_from;},forceDS:function(T,R,S){var U=S;return J(U.TEMPLATE.forceDS,T,U.formatters,T,strings,null,U);},forceDS_else:function(T,R,S){return NeoConfig.forceDS?"":J(S.TEMPLATE.forceDS_else,0,0,0,strings);},with_me:function(T,R,S){var U=S;if(!T.to){return"";}return J(U.TEMPLATE.with_me_else,{recipient:I(E(T.to[0].displayname||T.to[0].address))},U.formatters,T,strings,null,U);},folder:function(T,R,S){var U=S;if(U.get("data").type==="search"){return Q.getSystemFolderName(encodeURIComponent(T.folder),I(E(T.folder)));}},sender:function(R){return R.from&&I(E(R.from[0].displayname));},receivedDate:function(S){var R=S.date*1000;return C.common.Utils.dateFormatter(new Date(R),Neo.getDateFormat(R,true));},subject:function(T,R,S){var U=S;return T.subject?U.highlightSearchTerm(I(E(T.subject))):strings["str_msg-view_no_subject"];},subjectDir:function(S){var R="";if(S.subject&&A){R=C.Intl.detectDirection(S.subject);}return R;},size:function(R){return Math.ceil(R.size/1000);},flags:function(T,R,S){var U=S;return[((T.selected==="checked")?"selected":""),(T.flags.read?"":"unread "),(T.flags.flagged?"flagged":""),((T.fid==="Trash"&&S.get("data").type==="search")?"deleted":""),U.getInboxService(T)].join(" ");},flag_info:function(T){var R="",S=T.srvmap.inboxService||"";if(!T.flags&&!S){return"";}if(S){R=S;}else{if(!T.flags.read){R="unread";}else{if(T.flags.replied){R="replied";}else{if(T.flags.forwarded){R="forwarded";}}}}return"info-"+R;},hasAttachment:function(T,R,S){var U=S;return J((T.attachments&&T.attachments.length)?U.TEMPLATE.hasAttachment:U.TEMPLATE.hasAttachment_else,0,0,0,strings,null,U);},isFlagged2:function(T,R,S){var U=S;return(T.flags&&T.flags.flagged)?"":J(U.TEMPLATE.isFlagged2,T,U.formatters,T,strings,null,U);},isFlagged_else1:function(T,R,S){var U=S;return(T.flags&&T.flags.flagged)?J(U.TEMPLATE.isFlagged_else1,T,U.formatters,T,strings,null,U):"";},hellip:function(){return strings.str_tog_snippet_hellip?"&hellip;":"";},snippet:function(T,R,S){var U=S;return(T.snippet)?U.highlightSearchTerm(I(E(T.snippet))):"";},is_flagged1:function(T,R,S){var U=S;return(T.flags&&T.flags.flagged)?J(U.TEMPLATE.is_flagged1,T,U.formatters,T,strings,null,U):"";},is_flagged_else:function(T,R,S){var U=S;return(T.flags&&T.flags.flagged)?"":J(U.TEMPLATE.is_flagged_else,T,U.formatters,T,strings,null,U);},attachment_previews:function(T,Z,S){var Y=S,a=[],X,R,U;if(Y.get("data").type==="list"){return"";}if(T.attachments){for(var W=0,V=T.attachments.length;W<V;W++){if(P!=0){X="img";U="";}else{X="image";U=T.attachments[W].thumbnailurl;}if(/image/.test(T.attachments[W].type)==false){R=T.attachments[W].name;
X=C.mail.ui.AttachFileType.getType(R);}if(NeoConfig.isSSL&&U){U=U.replace("http:","https:");}a.push(J(Y.TEMPLATE.attachment_previews,{image_url:U,attachment_type:X},Y.formatters,T,null,null,Y));}return a.join("");}},contains_attachment1:function(T,R,S){var U=S;if(T.attachments){return J(U.TEMPLATE.contains_attachment1,T,U.formatters,T,null,null,U);}},showDD:function(T,R,S){if(T.showDD){return S.TEMPLATE.showDD;}return"";},showDD1:function(T,R,S){if(T.showDD){return S.TEMPLATE.showDD1;}return"";},search_msg_list:function(X,S,V){var Y=V,U=X.list||[],W=U.length,T=0,R=[];for(;T<W;T++){U[T]&&R.push(J(Y.TEMPLATE.search_msg_list,U[T],Y.formatters,U[T],strings,null,Y));}return R.join("");},single_search_result:function(T,R,S){var U=S;if(T.serverTotal>1){return"";}return J(U.TEMPLATE.single_search_result,{search_results_count:T.serverTotal},0,0,strings,null,U);},searchView:function(T,R,S){var U=S;if(U.get("data").type==="search"){return J(U.TEMPLATE.searchView,T,U.formatters,T,strings,null,U);}return"";},searchView1:function(T,R,S){var U=S;if(U.get("data").type==="search"){return J(U.TEMPLATE.searchView1,T,U.formatters,T,strings,null,U);}return"";},multiple_search_result:function(T,R,S){var U=S;if(T.serverTotal===1){return"";}return J(U.TEMPLATE.multiple_search_result,{search_results_count:T.serverTotal},0,0,strings,null,U);},has_pagination:function(T,R,S){return K.getPaginationControls(T,S.TEMPLATE);},message_list_density:function(){return["ml-regular","ml-compact","ml-open"][D.get(F)||0];},inbox:function(T,R,S){if(S.get("data").type==="list"){return"inbox";}}},_renderDidYouMeanContacts:function(R,T){var V=this;var U=T.ancestor(".didyoumean-cont");var S=T.ancestor(".refinement-top-bar");C.mail.ui.XobniContactsSearch.getDataFetcher().fetch(R,function(W){var Y=W.xobniContactSearch;var X="";C.Array.each(Y.slice(0,3),function(Z){var a=yui.mail.ui.XobniContactsSearch.getDataFetcher();Z.imageUrl=a._imageUrlTmpl.replace("{contactId}",Z.id);X+=J(V.TEMPLATE_didYouMean.did_you_mean_list,Z);});if(X){T.append(X);U.removeClass("hidden");S.addClass("tall");T.delegate("click",function(c){var a=c.currentTarget;var Z=a.getAttribute("title");var d=a.getAttribute("data-id");var b=C.mail.ui.EntitySearch.findExactMatch(Z);if(b){C.fire("searchSuggestion:start",{type:"entity",id:b.id});}else{C.fire("searchSuggestion:start",{type:"xContact",contactId:d});}},".didyoumean-contact",V);}else{S.removeClass("tall");}});},render:function(){var Y=this,S=Y.get("rootNode"),U=S.all(".content"),V=Y.get("data"),W,X,R,T;if(!V.rendered){U&&U.remove();X=Y.get("sortInfo").action.toUpperCase();switch(X){case"SUBJECT":V.sorted_by=strings.str_msg_list_subject;break;case"SENDER":V.sorted_by=strings.str_menu_sort_sender_up;break;case"ATTACHMENTS":V.sorted_by=strings.str_menu_sort_attachment_up;break;default:V.sorted_by=strings.str_msg_list_date;}S.appendChild(C.Node.create(J(Y.TEMPLATE.base,V,Y.formatters,V,strings,Y.TEMPLATE,Y)));U=S.one(".result.content");U.setStyle("overflow","hidden");R=U.one(".didyoumean");if(NeoConfig.searchSuggestions&&R&&C.xobniContacts&&C.xobniContacts.isXobnified){C.xobniContacts.isXobnified(function(a){var Z=V&&V.query&&V.query.keyword;if(a&&Z){Y._renderDidYouMeanContacts(Z,R);}});}}S.one(".alert")&&S.one(".alert").delegate("click",function(Z){Z.preventDefault();Y.fire("toggleSearchViewClick",Z);},"#btn-toggle-searchview",Y);T=S.one("div.list-view-items");T.set("unselectable","on");T.addClass("unselectable");T.on("scroll",function(Z){W&&W.cancel();W=C.Lang.later(500,Y,function(){Z.scrollNode=Z.currentTarget;Y.fire("scrollEnd",Z);});});if(strings.str_cfg_tog_open_by_dblclick||Y.get("data").type==="list"){T.delegate("dblclick",function(Z){if(Z.target.get("nodeName").toLowerCase()!=="a"){Z.listItemsNode=Z.currentTarget;Z.listItemsTarget=Z.target;Y.fire("listItemsClick",Z);}},"div.list-view-item",Y);}T.delegate("click",function(b){var a=b.target,c=a.get("nodeName");if(c.toLowerCase()==="a"&&!a.ancestor(".action-toolbar")){b.preventDefault();b.listItemsMoreNode=b.currentTarget;b.listItemsMoreTarget=a;Y.fire("listItemsMoreClick",b);}else{if(a.hasClass("cbox")||a.get("parentNode").hasClass("cbox")){var Z=a.ancestor(".list-view-item").one("input");b.listItemsSelectNode=Z;Y.fire("listItemsSelect",b);b.stopPropagation();}else{b.listItemsNode=b.currentTarget;b.listItemsTarget=a;Y.fire("listItemsClick",b);}}},"div.list-view-item",Y);T.delegate("click",function(Z){if(!T.one("div.refinements")){Z.currentTarget.remove(true);}else{Z.currentTarget.toggleClass("active");T.one("div.refinements").toggleClass("hidden");}},"div.refinement-btn",Y);T.delegate("keydown",function(Z){if(Z.keyCode===77){C.fire("checkmail:pressed",Z.shiftKey);}},"div.list-view-item",Y);T.delegate("contextmenu",function(Z){Z.preventDefault();Z.listItemsNode=Z.currentTarget;Z.listItemsTarget=Z.target;Y.fire("listItemsContextMenu",Z);},"div.list-view-item",Y);if(!Y.paginationCntrls){Y.paginationCntrls=new C.mail.ui.ListViewControls(S.one(".pagination"),Y,"pagination");Y.paginationCntrls.setup(Y.get("template"));}Y.fire("renderComplete");},updateSortLabel:function(R){var T=this,S=C.mail.ui.ListViewControls;if(!T.sortMenu){T.sortMenu=new S(R,T,"sortoptions");}T.sortMenu.updateSortInViewMenu(R);},setFocus:function(){var T=this,R=T.get("rootNode"),S=R.one("#btn-toggle-searchview a");S&&S.focus();},setFocusNode:function(U,T,V,Y){var X=this,S=X.get("rootNode"),W=S.one('div.list-view-items div.list-view-item[data-key="'+U+'"]'),R=W.one("input[type=checkbox]");!V&&R.set("checked",true);W.addClass("selected");O&&O.cancel();O=C.Lang.later(70,null,function(){!Y&&R.focus();});X.fire("itemFocus",{focus:1,node:W});},clearFocusNode:function(S){var U=this,R=U.get("rootNode"),T=R.one('div.list-view-items div.list-view-item[data-key="'+S+'"]');T.one("input[type=checkbox]").set("checked",false);T.removeClass("selected");U.fire("itemFocus",{focus:0,node:T});},appendItems:function(S){var T=this,R=T.get("rootNode");R.one("div.list-view-items").append(T.formatters.search_msg_list(S,S,T));
},pruneItems:function(){var S=this,R=S.get("rootNode").one("div.list-view-items");if(R){R.set("innerHTML","");}},updateItemSubject:function(S,T,U){var W=this,R=W.get("rootNode"),V=R.one('div.list-view-items div[data-key="'+S+'"] '+(U?".subj":".nssubj"));if(V){V.set("innerHTML",W.highlightSearchTerm(I(E(T.subject))));}},updateItemFolder:function(S,T){var V=this,R=V.get("rootNode"),U=R.one('div.list-view-items div[data-key="'+S+'"] a[data-action="refineby-folder"]');if(U){U.set("innerHTML",J(strings.str_srch_folder,{folder:V.formatters.folder(T,null,V)},0,0,0));}else{U=R.one('div.list-view-items div[data-key="'+S+'"] div.'+"fldr"+" span");U&&U.set("innerHTML",V.formatters.folder(T,null,V));}},updateTitle:function(T){var U=this,R=U.get("rootNode"),S=R.one("div.alert p");S&&S.set("innerHTML",U.formatters.single_search_result(T,T,U)||U.formatters.multiple_search_result(T,T,U));},selectItem:function(S,T){var V=this,R=V.get("rootNode"),U=R.one('div.list-view-items div[data-key="'+S+'"]');if(U){U.one("input[type=checkbox]").set("checked",T);T?U.addClass("selected"):U.removeClass("selected");}},selectItems:function(T){var U=this,S=U.get("rootNode"),R=U.get("rootNode").all("div.list-view-items div.list-view-item");if(R){R.each(function(V){V.one("input[type=checkbox]").set("checked",T);T?V.addClass("selected"):V.removeClass("selected");});}},getItem:function(S){var T=this,R=T.get("rootNode");return R.one('div.list-view-items div[data-key="'+S+'"]');},removeItem:function(T){var U=this,S=U.get("rootNode"),R=S.one('div.list-view-items div[data-key="'+T+'"]');R&&R.remove().destroy(true);},addItemClass:function(S,T){var V=this,R=V.get("rootNode"),U=R.one('div.list-view-items div[data-key="'+S+'"]');U&&U.addClass(T);(T==="flagged")&&U&&U.one(".flag").set("title",strings.str_msg_list_flagged_attr);(T==="unread")&&U&&U.one("div.start div.icon")&&U.one("div.start div.icon").addClass("info-unread");},removeItemClass:function(S,T){var V=this,R=V.get("rootNode"),U=R.one('div.list-view-items div[data-key="'+S+'"]');U&&U.removeClass(T);(T==="flagged")&&U&&U.one(".flag").set("title",strings.str_msg_list_flag_attr);(T==="unread")&&U&&U.one("div.start div.icon")&&U.one("div.start div.icon").removeClass("info-unread");},setStatus:function(){var T=this,R=T.get("rootNode"),S=R.one("div.list-view-items");S.addClass("loading");},clearStatus:function(){var T=this,S,R=T.get("rootNode");S=R.one("div.list-view-items");S.removeClass("loading");S.setStyles({height:"auto"});},setLoadingStatus:function(){var T=this,R=T.get("rootNode"),S=R.one("div.list-view-items");!NeoConfig.pagedResults&&!S.one("div.items-loading")&&S.append(C.Node.create('<div class="items-loading s-loader"></div>'));},clearLoadingStatus:function(){var T=this,S=T.get("rootNode"),R=S.one("div.items-loading");R&&R.remove().destroy(true);},close:function(){var S=this,R=S.get("rootNode").all("div.content.result");R&&R.remove();}};C.namespace("mail.ui");C.mail.ui.SearchListView=B;},"1.0.0",{requires:["stylesheet","datatype-date","mail-controller-folders","mail-controller-messages","mail-ui-common-string-utils","mail-ui-attachment-filetype","mail-ui-searchutils","_shared_module_search_didyoumean_rollup","ac-entity-search"]});YUI.add("mail-ui-searchListController",function(D){var A=D.common.Utils,C=D.mail.ui.SearchUtils;var B=function(E){var G=this,F={fid:{setter:function(H){G.fid=H||"%40S%40Search";}},listMgr:{setter:function(H){G.listMgr=H;}},makeRequest:{setter:function(H){G.makeRequest=H;}},freezed:{setter:function(H){G.freezed=H;},getter:function(){return(G.freezed)?true:false;},validator:function(H){return(G.freezed!==H);}},rootNode:{writeOnce:true,setter:function(){G.get("widget")&&G.get("widget").render();}},widget:{setter:function(H){G.get("rootNode")&&H.render();}},isSnippet:{},focusNode:{},firstSelectedMid:{},data:{},query:{},rawData:{},sortInfo:{getter:function(){var H=G.listMgr.getSortInfo(),J={"from":"sender","attachmentcount":"attachment"},I=J[H.sortKey]||H.sortKey;return{action:I,sortOrder:H.sortOrder};}},page:{getter:function(){var H=G.listMgr.getCacheInfo().cacheIndex;return G.listMgr.getCacheInfo().cacheIndex;}},pageCount:{getter:function(){var H=G.listMgr.getCacheInfo();return Math.ceil(H.serverTotal/H.cacheSize);}}};D.augment(G,D.Attribute);G.addAttrs(F,E||{});D.augment(G,D.EventTarget);G.after("activeChange",G.afterActiveChangeHandler,G);};B.prototype={process:function(){var J=this,H=J.get("data"),G="_shared_module_search_with_snippet_rollup",E=J.listMgr.getSortInfo(),I=J.listMgr.getSelectedItems(),F;D.mix(H,{selectAll:I.all&&I.allCacheSelected,sortby_sender:"",sortorder_sender_desc:"",sortby_subject:"",sortorder_subject_desc:"",sortby_fldr:"",sortorder_fldr_desc:"",sortby_date:"",sortorder_date_desc:"",sortby_flag:"",sortorder_flagged_desc:""},true);H.query=J.get("query");H["sortby_"+E.sortKey]="sortby";H["sortorder_"+E.sortKey+"_desc"]=(E.sortOrder==="down")?"desc":"asc";J.set("widget",new D.mail.ui.SearchListView({rootNode:J.get("rootNode"),template:D.ui.Templates[G],data:H,rawData:J.get("rawData"),fid:J.get("fid"),controller:J}));F=J.get("widget");F.on("scrollEnd",J.scrollHandler,J);F.on("listHeaderClick",J.listHeaderClickHandler,J);F.on("listHeaderSelectClick",J.listHeaderSelectClickHandler,J);F.on("listItemsSelect",J.listItemsSelectHandler,J);F.on("listItemsClick",J.listItemsClickHandler,J);F.on("listItemsMoreClick",J.listItemsMoreClickHandler,J);F.on("listItemsContextMenu",J.listItemsContextMenuHandler,J);F.on("unselectAllList",J.unselectAllList,J);F.on("itemFocus",J.focusNodeHandler,J);F.on("pageAction",J.pageActionHandler,J);F.on("sortList",J.sortList,J);F.on("toggleSearchViewClick",function(){J.fire("toggleSearchView");},J);if(NeoConfig.pagedResults){F.on("paginationClick",J.actionHandler,J);}F.setFocus();if(!NeoConfig.pagedResults){J.appendPageData(J.listMgr.getNextPage());}},resetDates:function(){var I=this,G=new Date(),H=G.getTime(),F=G.setHours(23,59,59,999),E=F-H+1;I.dateResetHandle.cancel();I.dateResetHandle=D.Lang.later(E,I,I.resetDates);I.refresh();},refresh:function(){var I=this,G=I.get("widget"),H,E,F=I.listMgr.getCurrentPage();G.pruneItems();G.setStatus(strings.str_msg_list_loading);H={query:I.get("query"),startMid:F.cacheIndex+1};E=function(L){var J=L.response,K;I.listMgr.store(J);K=I.listMgr.getCurrentPage();I.appendPageData(K);};if(typeof I.get("data").type==="undefined"){I.makeRequest("search",H,E);}else{I.makeRequest("list",H);}},appendPageData:function(F){var H=this,G,E;if(F.list.length===0&&F.cacheIndex*F.cacheSize<F.serverTotal){G={query:H.get("query"),startMid:F.serverIndex};E=function(J){var I=J.response;if(J.response){H.listMgr.store(I);H.appendItems(H.listMgr.getCurrentPage());}};if(H.get("data").type==="search"){H.makeRequest("search",G,E);}else{H.makeRequest("list",G);}}else{if(F.list.length){H.appendItems(F);}else{if(F.list.length===0&&F.serverTotal&&NeoConfig.pagedResults){H.appendItems(H.listMgr.getPrevPage());}}}},appendItems:function(H){var J=this,F=J.get("rootNode"),I=F.one(".list-view-items"),G=J.get("widget"),E=J.listMgr.getCacheInfo();G.clearStatus();G.clearLoadingStatus();J.get("widget").appendItems(H);if(NeoConfig.pagedResults){J.fire("updatePagination",{pageData:H});}else{((E.cacheIndex+1)*E.cacheSize<E.serverTotal)&&J.get("widget").setLoadingStatus();if(I.get("offsetHeight")*1.2>I.get("scrollHeight")){J.appendPageData(J.listMgr.getNextPage());}G.clearLoadingStatus();}J.set("freezed",false);},setFocusNode:function(F,E,G,I){var H=this;H.get("widget").setFocusNode(F,E,G,I);},selectItems:function(E){var F=this;F.get("widget").selectItems(E);},selectItem:function(E,F){var G=this;G.get("widget").selectItem(E,F);},selectItemRange:function(E,K){var I=this,M=I.listMgr.getSelectedItems(),F,L,H,G,J;if(M.total){for(L in M.hash){F=I.listMgr.getItemIndex(L);if((F<E&&F<K)||(F>E&&F>K)){I.selectItem(I.listMgr.generateKey(L),false);}}I.listMgr.selectAll(false);}if(E>K){for(H=E;H>=K;H--){G=I.listMgr.getItemFromIndex(H);if(!M.hash[I.listMgr.generateKey(G.mid)]){J=I.listMgr.select(G.mid,true);I.setFocusNode(I.listMgr.generateKey(G.mid));}}}else{if(E<K){for(H=E;H<=K;H++){G=I.listMgr.getItemFromIndex(H);if(!M.hash[I.listMgr.generateKey(G.mid)]){J=I.listMgr.select(G.mid,true);I.setFocusNode(I.listMgr.generateKey(G.mid));}}}else{G=I.listMgr.getItemFromIndex(K);J=I.listMgr.select(G.mid,true);I.setFocusNode(I.listMgr.generateKey(G.mid));}}},createSelectMenu:function(F){var G=this,E=G.get("widget");if(!E.selectMenu){E.selectMenu=new D.mail.ui.ListViewControls(F,G,"selectoptions");G.on("selectMessages",function(S){var O=G.listMgr,H=D.one(".cbox input"),I=O.generateKey,P=O.select,K=NeoConfig.infiniteScroll?O.getAllLoadedPages():O.getCurrentPage(),J=S.action,L;var R={"Read":"read","Flagged":"flagged","unRead":"read","unFlagged":"flagged"};switch(J){case"all":O.selectPage(true);G.selectItems(true);H.set("checked",true);break;case"none":O.selectPage(false);G.selectItems(false);H.set("checked",false);break;default:O.selectAll(false);G.selectItems(false);H.set("checked",false);for(var N=0,M=K.list.length;N<M;N++){var T=K.list[N],Q;if(T){Q=T.mid;if(J==="Read"||J==="Flagged"){L=(T.flags[R[J]]===1);}else{if(J==="unRead"||J==="unFlagged"){L=!(T.flags[R[J]]);}}T&&P(I(Q),L);G.selectItem(I(Q),L);
}}break;}});}E.selectMenu.setup(E.get("template"));},removeItem:function(F){var G=this,E=G.get("focusNode")&&G.get("focusNode").getAttribute("data-key");G.get("widget").removeItem(F);E===F&&G.set("focusNode",null);},pruneItems:function(E){var F=this;F.get("widget").pruneItems(E);},setStatus:function(E){var F=this;F.get("widget").setStatus(E);},clearLoadingStatus:function(){var E=this;E.get("widget").clearLoadingStatus();},updateTitle:function(E){var F=this;F.get("widget").updateTitle(E);},isChat:function(H){var G,E=this.listMgr.getSelectedItems().hash,F=["addcontact","delete","open","print","fullheader","flagged","unflagged","select-all","next-page","previous-page","previous","next","home","end"];if(D.Array.indexOf(F,H)>=0){return false;}for(G in E){if(E[G].fid==="%40C%40Chats"){return true;}}return false;},updateItemSubject:function(E,F){var G=this;G.get("widget").updateItemSubject(E,F,G.get("isSnippet"));},updateItemFolder:function(E,F){var G=this;G.get("widget").updateItemFolder(E,F);},updateItemClass:function(F,G){var H=this,E;switch(G){case"Trash-move":E="deleted";break;case"flagged":case"isFlagged-1":E="flagged";break;case"unread":case"isRead-0":E="unread";break;}if(E){H.get("widget").addItemClass(H.listMgr.generateKey(F),E);return;}switch(G){case"move":E="deleted";break;case"unflagged":case"isFlagged-0":E="flagged";break;case"read":case"isRead-1":E="unread";break;default:return;}H.get("widget").removeItemClass(H.listMgr.generateKey(F),E);},scrollHandler:function(G){var I=this,F=G.scrollNode||G.currentTarget,H=((F.get("scrollTop")+F.get("offsetHeight"))/F.get("scrollHeight"))*100,E;if(I.get("freezed")||NeoConfig.pagedResults){return;}if((NeoConfig.adOpt&&H>50)||H>65){I.set("freezed",true);E=I.listMgr.getNextPage();I.appendPageData(E);if(NeoConfig.infiniteScroll){D.fire("darlaEvent",{action:"search_results"});}}},sortList:function(I){var K=this,Q=K.listMgr.getSortInfo(),E={},H=I.sortType,M=I.targetNode,O=I.currentSortedColumn,J=K.get("widget"),L=D.one("#pagetoolbar .cbox input"),G,P,N;if(K.get("data").type==="search"&&D.Array.indexOf(["unRead","folder","flagged"],H)!==-1){return;}H=(H==="sender")?"from":H;H=(H==="attachment")?"attachmentcount":H;K.set("freezed",true);K.set("focusNode",null);K.set("firstSelectedMid",null);K.listMgr.selectAll(false);L&&L.set("checked",false);J.pruneItems();J.setStatus(strings.str_msg_list_sorting);if(H!==Q.sortKey){O&&O.removeClass("sortby "+((Q.sortOrder==="down")?"desc":"asc"))&&O.one("i").removeClass("icon-checkmark")&&O.one("b").removeClass("icon-chevron-up").removeClass("icon-chevron-down");if(H==="date"||H==="attachmentcount"){M.addClass("sortby desc");N="icon-chevron-up";E.sortOrder="down";}else{M.addClass("sortby asc");N="icon-chevron-down";E.sortOrder="up";}M.one("i").addClass("icon-checkmark");M.one("b").addClass(N);E.sortKey=H;}else{E.sortKey=H;if(Q.sortOrder==="down"){M.removeClass("desc");M.addClass("asc");M.one("b").removeClass("icon-chevron-up");M.one("b").addClass("icon-chevron-down");E.sortOrder="up";}else{M.removeClass("asc");M.addClass("desc");M.one("b").addClass("icon-chevron-up");M.one("b").removeClass("icon-chevron-down");E.sortOrder="down";}}if(!K.listMgr.sort(E)){G={query:K.get("query")};P=function(T){var R=T.response,S;K.listMgr.store(R);S=K.listMgr.getCurrentPage();K.appendPageData(S);};if(K.get("data").type==="search"){K.makeRequest("search",G,P);}else{K.makeRequest("list",G);}}else{var F=K.listMgr.getCurrentPage();K.appendPageData(F);}},listHeaderClickHandler:function(G){var I=this,F=G.currentTarget.ancestor("li"),H=G.dataAction,E=F.ancestor("ul.sortby-group").one("li.sortby");I.sortList({sortType:H,targetNode:F,currentSortedColumn:E});},viewClickHandler:function(E){var F=this;F.listHeaderClickHandler(E);},listHeaderSelectClickHandler:function(F){var G=this,E=F.listHeaderSelectNode.get("checked");NeoConfig.pagedResults?G.listMgr.selectPage(E):G.listMgr.selectAll(E);G.selectItems(E);},unselectAllList:function(){var E=this;NeoConfig.pagedResults?E.listMgr.selectPage(false):E.listMgr.selectAll(false);E.selectItems(false);},listItemsSelectHandler:function(J){var K=this,G,E=K.get("rootNode"),I=J.listItemsSelectNode||J.currentTarget,F=I.ancestor("div.list-view-item").getAttribute("data-key"),H=D.one(".cbox input");G=K.listMgr.select(F,I.get("checked"));E.all("div.list-view-item.selected").each(function(L){if(!L.one("input[type=checkbox]").get("checked")){L.removeClass("selected");K.listMgr.select(L.getAttribute("data-key"),false);}});if(!J.shiftKey||!K.get("firstSelectedMid")){K.set("firstSelectedMid",(G.total)?F:null);}if(G.all&&G.allCacheSelected){H&&H.set("checked",true);K.setFocusNode(K.listMgr.generateKey(F));}else{if(!I.get("checked")){H.set("checked",false);}else{K.setFocusNode(K.listMgr.generateKey(F));}}if(J.shiftKey&&K.get("firstSelectedMid")){K.selectItemRange(K.listMgr.getItemIndex(K.get("firstSelectedMid")),K.listMgr.getItemIndex(F));}},listItemsClickHandler:function(N){var M=this,H=M.get("rootNode"),G=N.listItemsNode||N.currentTarget,O=N.listItemsTarget||N.target,E=O.get("type"),I,F=G.getAttribute("data-key"),K,J;if(O.hasClass("flag")||O.hasClass("btn-flag")){K={fid:M.get("fid"),selectedItems:{hash:[M.listMgr.getItem(F)],total:1,singleOp:1}};J=G.hasClass("flagged")?"unflagged":"flagged";M.fire("messageAction",{action:J,params:K});M.ultFlag((J==="flagged"?"flag":"unflag"));return;}if(O.hasClass("info-unread")){M.fire("messageAction",{action:"read",params:{fid:M.get("fid"),selectedItems:{hash:[M.listMgr.getItem(F)],total:1,singleOp:1}}});return;}if(O.hasClass("delete-msg")){K={fid:M.get("fid"),selectedItems:{hash:[M.listMgr.getItem(F)],total:1,singleOp:1}};M.fire("messageAction",{action:"delete",params:K});return;}if(O.hasClass("msg-lst-srch")){switch(O.getAttribute("data-action")){case"msg-frm-srch":if(NeoConfig.searchSuggestions){D.mail.ui.XobniContactsSearch.doPeopleSearch(M.listMgr.getItem(F).from[0].address,function(){D.fire("fireSearch",'from:"'+M.listMgr.getItem(F).from[0].address+'"');});}else{D.fire("fireSearch",'from:"'+M.listMgr.getItem(F).from[0].address+'"');
}D.fire("mt:click",{action:"mas_frm_srch"});NeoGV.masStarted=true;A.rocketstats.stat("massearch","clickedsearch");break;case"msg-sbj-srch":var Q=new RegExp("^(\\b("+strings.str_comp_reply_spRE+"|"+strings.str_comp_reply_spFWD+")(\\s*)?)*","i");D.fire("fireSearch",'subject:"'+M.listMgr.getItem(F).subject.replace(/\^_/g,"").replace(Q,"")+'"');D.fire("mt:click",{action:"mas_sbj_srch"});NeoGV.masStarted=true;A.rocketstats.stat("massearch","clickedsearch");break;}return;}M.set("focusNode",G);if(E==="checkbox"){G.removeClass("selected");if(O.get("checked")){G.addClass("selected");M.listMgr.select(F,O.get("checked"));}return;}if(!N.shiftKey&&(O.hasClass("cbox")||O.hasClass("info"))){var L=G.one("input[type=checkbox]");if(L.get("checked")){L.set("checked",false);G.removeClass("selected");M.listMgr.select(F,L.get("checked"));}else{L.set("checked",true);G.addClass("selected");M.listMgr.select(F,L.get("checked"));}return;}H.all("div.list-view-item.selected").each(function(R){R.removeClass("selected");if(R===G){return;}R.one("input[type=checkbox]").set("checked",false);M.listMgr.select(F,false);});M.listMgr.selectAll(false);!G.hasClass("selected")&&G.addClass("selected");M.listMgr.select(G.getAttribute("data-key"),true);I=M.listMgr.getItem(F);if(!N.shiftKey){M.set("firstSelectedMid",F);}if(N.shiftKey&&M.get("firstSelectedMid")){M.selectItemRange(M.listMgr.getItemIndex(M.get("firstSelectedMid")),M.listMgr.getItemIndex(F));}else{if(!N.ctrlKey){var P=G.one("input[type=checkbox]");if(P.get("checked")){P.set("checked",false);}if(!strings.str_cfg_tog_open_by_dblclick||N.type==="dblclick"){M.ultOpen();M.fire("messageAction",{action:(NeoConfig.pageMode==0&&N.type==="click"&&M.get("data").type==="list")?"openInPane":"open",params:{selectedItems:M.listMgr.getSelectedItems(),msg:I,fid:(I&&I.fid)||M.get("fid")}});}}}},setSelectAllNode:function(F){var G=this,E=D.one(".cbox input");D.Lang.later(0,G,function(){E.set("checked",F);});},listItemsMoreClickHandler:function(J){var K=this,I=J.listItemsMoreTarget||J.target,H=J.listItemsMoreNode||J.currentTarget,G={},E,F=D.mix({},K.get("query"));E=K.listMgr.getItem(H.getAttribute("data-key"));switch(I.getAttribute("data-action")){case"refineby-recipient":if(F.from||/ from:/.test(F.keyword)||/^from:/.test(F.keyword)){C.showAlert("MultiFromRefinement");return;}else{F.from=E.to[0].displayname||E.to[0].address;}break;case"refineby-sender":G.keyword=" ";G.from=E.from[0].displayname||E.from[0].address;break;case"refineby-folder":if(F.fnums||/ folder:/.test(F.keyword)||/^folder:/.test(F.keyword)){C.showAlert("MultiFolderRefinement");return;}else{F.fnums=[E.fnum];}break;default:break;}K.fire("doMailSearch",{query:(G.keyword)?G:F});},listItemsContextMenuHandler:function(I){var L=this,K=I.listItemsNode||I.currentTarget,F=K.getAttribute("data-key"),G=L.get("rootNode"),E=K.one("input[type=checkbox]"),H,J;if(!E.get("checked")){G.all("div.list-view-item.selected").each(function(M){M.one("input[type=checkbox]").set("checked",false);M.removeClass("selected");L.listMgr.select(M.getAttribute("data-key"),false);});L.listMgr.selectAll(false);L.set("firstSelectedMid",F);E.set("checked",true);}L.setFocusNode(L.listMgr.generateKey(F),false,true,true);H=L.listMgr.select(F,true);if(H.total===1){J=H.hash[F].sourceFolderInfo.fid;}else{J=L.fid;}D.use("mail-ui-inboxmenu-base","common-ui-menu-helper",function(M){M.mail.ui.InboxMenu.insert("menu-msglist",function(){var N=M.one("#menu-msglist");M.common.ui.MenuHelper.create(I.listItemsTarget,{menu:N,isContext:true,xy:[I.clientX,I.clientY],enterAccel:function(O){O(M.mail.ui.InboxMenu.getEnterAccel());},keys:function(O){O(M.mail.ui.InboxMenu.getValidKeys(N));}},function(){N.on("menuSelected",L.actionHandler,L);});L.setMenuContext();},J,{isContext:true,enableAddContact:function(N){N(C.isEnableAddToContacts(L.listMgr.getSelectedItems()));}});});I.halt();},setMenuContext:function(){var E=D.mail.ui.ContextButton;if(NeoConfig.grayoutEnabled&&E){E.setNodeMessageListMenu();}},focusNodeHandler:function(E){var F=this;(E.focus)&&F.set("focusNode",E.node);},keydownHandler:function(T){var P=this,H=T.keyCode,Q,W,O,J,L=T.metaKey,R=T.shiftKey,I=T.ctrlKey,X=T.altKey,N=T.metaKey||T.ctrlKey,S=false,G=P.get("focusNode"),K,U,F,M=D.UA,V=P.get("rootNode");switch(H){case 13:Q=T.target.ancestor("div .list-view")?"open":null;break;case 37:case 39:return;case 188:if(T.metaKey){return;}case 33:case 38:case 34:case 40:case 190:if(!G){K=D.one(".result .list-view-items .list-view-item");if(R){P.setFocusNode(K.getAttribute("data-key"));P.set("firstSelectedMid",K.getAttribute("data-key"));}else{P.setFocusNode(K.getAttribute("data-key"),true,true);P.listMgr.select(K.getAttribute("data-key"),true);}T.halt();break;}F=P.listMgr.getItemIndex(G.getAttribute("data-key"));if((H===188||H===190)&&!N){return;}if(H===188||H===33||H===38){K=P.listMgr.getPrevItem(G.getAttribute("data-key"));}else{K=P.listMgr.getNextItem(G.getAttribute("data-key"));}U=P.listMgr.getCurrentPage();F=P.listMgr.getItemIndex(K.mid);if(NeoConfig.pagedResults&&F>0&&((F+1===(U.cacheIndex*U.cacheSize))||F===((U.cacheIndex*U.cacheSize)+U.list.length))){return;}if(R){P.selectItemRange(P.listMgr.getItemIndex(P.get("firstSelectedMid")),P.listMgr.getItemIndex(K.mid));}else{P.set("firstSelectedMid",K.mid);P.listMgr.selectAll(false);P.selectItems(false);P.listMgr.select(K.mid,true);P.setFocusNode(P.listMgr.generateKey(K.mid),true,true);if(P.get("data").type==="list"&&NeoConfig.pageMode==0){P.fire("openInPreviewPane",{message:P.listMgr.getSelectedItems(),mid:K.mid});}}T.halt();break;case 46:case 8:Q="delete";break;case 75:Q=R?"unread":"read";break;case 76:Q=R?"unflagged":"flagged";break;case 65:if(R){Q=C.isEnableAddToContacts(P.listMgr.getSelectedItems())?"addcontact":null;}else{if(I||L){var E=!P.listMgr.getSelectedItems().all;NeoConfig.pagedResults?P.listMgr.selectPage(E):P.listMgr.selectAll(E);P.selectItems(E);T.halt();P.setSelectAllNode(E);}else{Q="reply_all";}}break;case 82:if(!R){Q="reply_sender";}break;case 70:if(!X&&!R&&!N){Q="forward";
}else{if(R&&X){S=true;Q="forward";X=false;}}if((!(M.gecko&&M.os==="macintosh")&&!R&&!L)&&(R||!N)){T.preventDefault();}break;case 80:Q="print";break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if(L||I||X||R){break;}D.mail.Controller.Folders.get(null,{success:function(b){var Z,c=[],a,Y;Y=b?b.length:0;for(a=0;a<Y;a++){if(!b[a].isSystem){c.push(b[a]);}}Z=H===48?"Inbox":c[H-49];Z=(D.Lang.isString(Z))?Z:(Z?Z.folderInfo.fid:0);if(P.get("fid")===Z){return;}if(Z){W={fid:Z,selectedItems:P.listMgr.getSelectedItems()};P.fire("messageAction",{action:"move",params:W});}}});return true;default:break;}if(Q&&!L&&!I&&!X){J=P.listMgr.getSelectedItems();W={fid:P.get("fid"),forwardAsAttachment:S};if(!J.total){G=P.get("focusNode");O=G&&G.hasClass("selected");J={total:0};if(O){P.listMgr.selectAll(false);J={hash:[P.listMgr.getItem(G.getAttribute("data-key"))],total:1};}}W.selectedItems=J;P.fire("messageAction",{action:Q,params:W});return true;}return false;},switchSize:function(E){D.fire("update:density",{density:E});},actionHandler:function(L){var K=this,I=L?(L.dataAction||A.getDataAction(L).action):0,N=L?L.item:0,J=K.get("widget"),H,F,E=false,M,G;if(K.isChat(I)){C.showAlert("searchNoChat");return;}if(NeoConfig.pagedResults){if(I==="next-page"){I="next";}else{if(I==="previous-page"){I="previous";}}}switch(I){case"select-all":break;case"density-compact":case"density-regular":case"density-open":K.switchSize(I);break;case"menu":break;case"home":case"end":case"previous":case"next":case"goto":A.rocketstats&&A.rocketstats.stat("search","pagination:clicked");if(K.get("freezed")){return;}K.set("freezed",true);if(I==="home"){F=K.listMgr.getFirstPage();E=(F.cacheIndex<0);}else{if(I==="previous"){F=K.listMgr.getPrevPage();E=(F.cacheIndex<0);}else{if(I==="next"){F=K.listMgr.getNextPage();E=(F.cacheIndex>=F.serverTotal/F.cacheSize);}else{if(I==="end"){F=K.listMgr.getLastPage();E=(F.cacheIndex>=F.serverTotal/F.cacheSize);}else{if(I==="goto"){F=K.listMgr.getPage((L.page+1));}}}}}if(F&&!E){K.ultNav(N,I,L.position==="bottom");}if(E){K.set("freezed",false);return;}K.set("focusNode",null);K.set("firstSelectedMid",null);K.listMgr.selectAll(false);K.selectItems(false);J.pruneItems();J.setStatus(strings.str_msg_list_loading);K.appendPageData(F);break;case"redirectmsg":M={success:function(){C.showAlert("redirectMsgSuccess");},failure:function(){C.showAlert("redirectMsgFailure");}};C.showConfirm("redirectMsg",function(){G={fid:N&&N.getAttribute("data-fid")?N.getAttribute("data-fid"):K.fid,selectedItems:K.listMgr.getSelectedItems(),cbk:M};K.fire("messageAction",{action:I,params:G});});break;case"folder-new":D.use("mail-ui-folderevents","mail-controller-folders",function(O){O.mail.ui.FolderEvents.createFolder(function(P){G={fid:P.fid,selectedItems:K.listMgr.getSelectedItems(),cbk:M};K.fire("messageAction",{action:I,params:G});},"move");});break;case"fullheader":M={success:function(O){C.showAlert("fullHeader",{bd:['<textarea readonly="true" style="width:100%;height:25em;" class="default">',O?D.common.Utils.escapeHtml(O.rawheaders[0]):strings.str_error_no_body_returned,"</textarea>"].join("")});},failure:function(){C.showAlert("fullHeaderError");}};break;case"themes":D.use("mail-ui-themes",function(O){O.mail.ui.Themes.showThemesDialog();});break;default:if(K.listMgr.getSelectedItems().total===0){H=K.get("focusNode");if(H&&H.hasClass("selected")){K.listMgr.select(H.getAttribute("data-key"),true);}}G={fid:N&&N.getAttribute("data-fid")?N.getAttribute("data-fid"):K.fid,selectedItems:K.listMgr.getSelectedItems(),cbk:M};K.ultToolbar(N,I,G,L.position==="bottom");K.fire("messageAction",{action:I,params:G});break;}},ultOpen:function(){D.fire("mt:click",{action:"open_msg",append:{rspns:"new"}});},ultFlag:function(E){D.fire("mt:click",{action:(E==="flag"?"flag_message":"unflag_message")});},ultToolbar:function(G,H,J,K){if(!G){return;}if(-1===D.Array.indexOf(["delete","reply_sender","forward","spam"],H)){return;}var F={action:"tlbr_"+H},I=J.selectedItems.total,E=(H!=="delete"&&I!==1);if(H==="delete"&&J.numSelected===0){E=true;}if(K){F.action+="_btm";}if(E){F.append={rspns:"pop"};}else{if(H!=="delete"){F.append={rspns:"new"};}else{F.append={rspns:"upd"};}}D.fire("mt:click",F);},ultNav:function(F,G,H){if(!F||!G){return;}var E={action:"nav_"+G};if(H){E.action+="_btm";}E.append={rspns:"new",ltxt:G};D.fire("mt:click",E);},pageActionHandler:function(E){var F=this;if(E.args&&E.args.action){E.dataAction=E.args.action;if(E.dataAction==="page"){E.dataAction="goto";E.page=E.args.val;}F.actionHandler(E);}},afterActiveChangeHandler:function(E){var F=this;if(!E.newVal&&NeoConfig.pagedResults){F.listMgr.selectAll(false);F.set("focusNode",null);F.set("firstSelectedMid",null);F.get("widget").selectItems(false);}if(D.UA.ie&&F.get("focusNode")){F.get("focusNode").scrollIntoView(true);}},close:function(){var E=this;E.get("widget")&&E.get("widget").close();}};D.namespace("mail.ui");D.mail.ui.SearchListController=B;},"1.0.0",{requires:["common-utils","mail-ui-searchListView","mail-ui-listview-controls","xobni-contacts-search"]});YUI.add("mail-ui-toolbarController",function(F){var C=F.common.Utils,A=C.substitute,E=F.mail.ui.SearchUtils,B=[];var D=function(G){var I=this,H={data:{},rootNode:{},widget:{},listMgr:{},fid:{},template:{setter:function(J){I.TEMPLATE=J;}},position:{}};F.augment(I,F.Attribute);I.addAttrs(H,G||{});F.augment(I,F.EventTarget);};D.prototype={TEMPLATE:F.ui.Templates.minty_module_toolbar_inbox_search_rollup,process:function(){var K=this,H,J=K.get("data"),G=K.get("position"),I;K.set("widget",K.createToolbar());I=K.get("widget");I.on("itemSelected",function(L){if(L.dataAction==="relevance"){L.dataAction="sender";}L.position=G;K.fire("itemSelected",L);},K);K.get("rootNode")&&K.get("rootNode").detach("dblclick");K.get("rootNode").delegate("dblclick",function(L){K.setUpInlineEdit(L,this);},".pagination-count");},createToolbar:function(){var J=this,H,I=J.get("data"),G={folder_is_empty:function(N,K,L){var O=L,M=O.get("data");return(M.total)?"":"disabled";},new_search:function(){return"";},reply_group:function(N,L,M){var O=M,K={"Draft":true,"%40C%40Chats":true};if(O.get("data").type==="list"&&!K[O.get("fid")]){return A(O.TEMPLATE.reply_group,{},0,0,strings,null,O);}},show_spam:function(N,K,L){var M={"%40B%40Bulk":true,"Sent":true,"Draft":true,"%40C%40Chats":true};if(!M[L.get("fid")]){return A(J.TEMPLATE.show_spam,{},G,0,strings,null,J);}},show_not_spam:function(M,K,L){if(L.get("fid")==="%40B%40Bulk"){return A(J.TEMPLATE.show_not_spam,{},0,0,strings,null,J);}},show_move:function(M,K,L){if(L.get("fid")!=="%40C%40Chats"&&L.get("fid")!=="Draft"){return A(J.TEMPLATE.show_move,{},0,0,strings,null,J);}},edit_draft:function(M,K,L){if(L.get("fid")==="Draft"){return A(J.TEMPLATE.edit_draft,{},0,0,strings,null,J);}},reply_conv:function(M,K,L){if(L.get("fid")==="%40C%40Chats"){return A(J.TEMPLATE.reply_conv,{},0,0,strings,null,J);}},spam_menu:function(M,K,L){return A(J.TEMPLATE.spam_menu,{},0,0,strings,null,J);},spam_menu_else:function(M,K,L){return"";},has_pagination:function(M,K,L){var N=L;return E.getPaginationControls(N.get("listMgr").getCacheInfo(),N.TEMPLATE);},has_switch_view:function(M,K,L){var N=L;if(N.get("data").type==="search"){return;}return A(N.TEMPLATE.has_switch_view,{},0,0,strings,null,N);},msgliststate:function(M,K,L){return NeoConfig.grayoutEnabled?"hasnomsg":"";}};H=new F.mail.ui.Toolbar({template:C.substitute(J.TEMPLATE.base,null,G,0,strings,J.TEMPLATE,J),menu:{template:function(L,K){F.use("mail-ui-inboxmenu-base",function(N,M){N.mail.ui.InboxMenu.insert(L,K,J.get("fid"),{enableAddContact:function(O){O(E.isEnableAddToContacts(J.get("listMgr").getSelectedItems()));}});});},keys:function(L,K){F.use("mail-ui-inboxmenu-base",function(N,M){K(N.mail.ui.InboxMenu.getValidKeys(L));});},enterAccel:function(K){F.use("mail-ui-inboxmenu-base",function(M,L){K(M.mail.ui.InboxMenu.getEnterAccel());});}}});return H;},setUpInlineEdit:function(H){var I=this,G=F.one("#toolbar .pagination");F.use("mail-common-inline-edit",function(K){var J=new K.mail.common.EditablePaginationControl(G,{setPage:function(L){I.fire("itemSelected",{dataAction:"goto",page:L});},getPageTotal:function(){var M=I.get("listMgr").getCacheInfo(),L=Math.ceil(M.serverTotal/M.cacheSize);return L;},getCurrentPage:function(){return I.get("listMgr").getCurrentPage();}});J.enableEditablePagination(H);});},updatePaginationStatus:function(H){var I=this,G=I.get("rootNode").one(".pagination");if(G){G.replace(E.getPaginationControls(H,I.TEMPLATE));}},close:function(){var G=this;G.fire("close");}};F.namespace("mail.ui");F.mail.ui.ToolbarController=D;},"1.0.0",{requires:["common-utils","contacts-api","contacts-api-utils"]});YUI.add("mail-ui-messageaction",function(C){C.namespace("mail.ui");var J=C.mail.Controller.Messages,B=C.common.Utils.ymmastats;function F(M,L,K){return J.remove({fid:M,mid:L},K);}function E(N,L,M,K){return J.move({sourceFid:N,destinationFid:L,mid:M},K);}function D(M,O,L,K){var N={};switch(M){case"unread":N.read=0;break;case"unflagged":N.flagged=0;break;case"notspam":N.ham=1;break;case"spam":N.spam=1;if(strings.str_cfg_tog_set_spam_read_flag){N.read=1;}C.fire("darlaEvent",{action:"mark_spam"});break;case"sendercompromised":N.sendercompromised=1;if(strings.str_cfg_tog_set_spam_read_flag){N.read=1;}C.fire("darlaEvent",{action:"mark_spam"});break;case"phished":N.phished=1;if(strings.str_cfg_tog_set_spam_read_flag){N.read=1;}C.fire("darlaEvent",{action:"mark_spam"});break;default:N[M]=1;break;}if(K){K.suppressCodes=["Client.MessageIdsNotFound"];}return J.flag({fid:O,mid:L,setFlags:N},K);}function I(M,L,K){return J.fullHeader({fid:M,mid:L},K);}function H(R,P,Q,K){var M=C.common.persist.UserData;var O=M.get("userSendPref");var L={name:"",email:""};if(O){L.name=O.defaultFromName;L.email=O.defaultFromAddress;}var N=[];N.push({email:Q});J.redirectMsg({fid:R,mid:P,resentFrom:L,resentTo:N},K);}function A(L,K){C.use("mail-ui-print",function(){C.mail.ui.print({fid:K,msg:L});});}function G(O,P,N){var K,L=P.fid,R=P.msgs,M=P.msgInfo[0];function T(){P.fid=(P.oMsg&&P.oMsg.fid)||P.fid;C.fire("newMessage",P);}P.oMsg=M;switch(O){case"delete":K=F(L,R,N);break;case"open":B.stat((C.mail.Tabs.getActiveTab().widgetType?C.mail.Tabs.getActiveTab().widgetType:"")+"_open_message");C.common.Utils.rocketstats.stat("msearch","messageopened");if(NeoConfig.intl!=="us"){C.common.Utils.rocketstats.stat("msearch","messageopened_intls");}var S=B.getKey("refinement_applied");if(S!==undefined){B.stat((C.mail.Tabs.getActiveTab().widgetType?C.mail.Tabs.getActiveTab().widgetType:"")+S+"_open_message");B.setKey("refinement_applied",undefined);}if(NeoConfig.hasConvView){if("%40C%40Chats"===L){C.use("mail-ui-messagesview-base","_shared_module_message_display_fresh_rollup","_shared_module_message_pane_fresh",function(U){U.fire("openMessage",U.mix({msg:M,fid:L},P));N.success(O);});}else{C.fire("openMessage",C.mix({msg:M,fid:L},P));N.success(O);}}else{C.fire("openMessage",C.mix({msg:M,fid:L},P));N.success(O);}break;case"forward":T();C.fire("darlaEvent",{action:"compose_fwd"});N.success(O);break;case"reply_sender":T();C.fire("darlaEvent",{action:"compose_reply"});N.success(O);break;case"reply_all":T();C.fire("darlaEvent",{action:"compose_reply_all"});N.success(O);break;case"edit":C.fire("editMessage",P);N.success(O);break;case"spam":case"sendercompromised":case"phished":case"notspam":case"read":case"unread":case"flagged":case"unflagged":K=D(O,L,P.msgInfo,N);break;case"trash":K=E(L,"Trash",R,N);break;case"inbox-move":K=E(L,"Inbox",R,N);break;case"folder-new":case"move":K=E(L,P.destinationFid,R,N);break;case"fullheader":K=I(L,M,N);break;case"addcontact":if(M.from.name){C.fire("addContact",M.from.name,M.from.email);}else{C.fire("addContact",M.from[0].displayname||"",M.from[0].address||"");}break;case"set_encodings":C.use("mail-ui-message-encodings",function(U){U.mail.ui.MessageEncodings.setMessageEncoding(P.msgInfo,M.fid||L);});break;case"redirectmsg":K=H(L,P.msgInfo,P.redirectToEmail,N);break;case"print":A(M,L);N.success(O);break;case"quick_filter":C.use("mail-ui-messagesview-quickfilter",function(U){if(R&&R[0]&&R[0].header){U.mail.ui.QuickFilter.createDialog({msgHeader:R[0].header});}});N.success(O);break;}if(-1!==C.Array.indexOf(["delete","reply_sender","forward","spam"]),O){var Q={action:"tlbr_"+O};if(O!=="delete"){Q.append={rspns:"new"};}C.fire("mt:click",Q);}if(O==="menu"){C.fire("darlaEvent",{action:"inbox_action_menu"});}}C.mail.ui.MessageAction={handle:G};},"1.0.0",{requires:["mail-controller-messages","mail-controller-messages-ops","common-utils","mail-model-datastore","ymma-stats","common-ui-tabs-base","rocket-stats"]});YUI.add("mail-ui-inboxmenu-base",function(G){var F=G.common.Utils,A=F.substitute,E=G.ui.Templates,H=NeoConfig.emptyFolders,D=G.mail.FoldersView,C=NeoConfig.mnuTmplMap;G.namespace("mail.ui");var B=function(){var X;var K=strings.str_cfg_tog_hasSMS,f=strings.str_tog_use_num_accel,P=null,N=(G.one("#rail-resize-vert"))?1:0,d={leftpane_pane_folders:function(h){return A(h.leftpane_pane_folders,0,0,0,strings);},fid:function(h){return h.fid;},folderName:function(h){return h.name;},accel_prefix:function(){if(f){return strings.str_menu_accel_d_number+" ";}return"";},is_inbox_folder_else:function(i){var h={};h.is_accel1=(f?i.is_accel1:"");return A(i.is_inbox_folder_else,h,0,0,strings);},NOT_V1:function(){return"";},NOT_V11:function(){return"";},has_IM:function(h){return(NeoConfig.isBizmail!="1")?A(h.has_IM,null,null,null,strings):"";},has_sms:function(h){return(K&&NeoConfig.isBizmail!="1")?A(h.has_sms,null,null,null,strings):"";},global_url_base:function(){return NeoConfig.global_url_base;},showRedirectMsg:function(h){return NeoConfig.isInternal?A(h.showRedirectMsg,0,0,0,strings):"";},sender_not_in_contacts:function(h){return A(h.sender_not_in_contacts,0,0,0,strings);},fwd_as_attacht:function(h){return strings.str_cfg_tog_fwd_as_attacht?A(h.fwd_as_attacht,0,0,0,strings):"";},enable_previewpane_mode_switch:function(h){return NeoConfig.infiniteScroll?"":A(h.enable_previewpane_mode_switch,0,0,0,strings);},forceDS:function(h){return NeoConfig.forceDS?A(h.forceDS,0,0,0,strings):"";},show_empty_trash:function(h){return H?"":A(h.show_empty_trash,0,0,0,strings);},show_empty_spam:function(h){return H?"":A(h.show_empty_spam,0,0,0,strings);},show_empty_folder:function(h){return H?A(h.show_empty_folder,0,0,0,strings):"";},show_empty_folder_else:function(h){return H?"":A(h.show_empty_folder_else,0,0,0,strings);},quickFilter:function(h){return NeoConfig.quickFilter==1?A(h.quickFilter,0,0,0,strings):"";},delete_thread_in_menu:function(h){return(NeoConfig.hasConvView||NeoConfig.hasConv)?A(h.delete_thread_in_menu,0,0,0,strings):"";},msgListDensity:function(h){return A(h.msgListDensity,0,0,0,strings);},infScroll:function(h){return NeoConfig.infiniteScroll?A(h.infScroll,0,0,0,strings):"";},tabs:function(h){return NeoConfig.tabsInMenu?A(h.tabs,0,0,0,strings):"";},show_reply_items:function(h){return NeoConfig.hasConvView?"":A(h.show_reply_items,0,0,0,strings);}};function I(h,n,j,i){function k(){switch(m){case"menu-actions":case"menu-conv-view":case"menu-msg-actions":case"menu-msglist":case"menu-bubble-actions":case"menu-thread-list-actions":case"menu-view":J(h,m,i);if(h=="menu-msglist"){a(j);}if(m=="menu-msg-actions"){this.fire("darlaEvent",{action:"inbox_action_menu"});}break;case"menu-move":V(p,j);return;case"menu-new":break;case"menu-conv-reply":g(m);break;case"menu-ml-preview":case"menu-ml-preview-fresh":U(h,m);break;case"menu-reply-modes":e(m,i);break;default:break;}p();}var q,m=h.replace("btn-","menu-"),l=G.one("#"+m);if(!l){var o=C[m]||C["menu-inbox"];G.use(o,function(s){var r=E[o];q=A(r.base,r,d,0,strings);s.one("body").appendChild(s.Node.create(q));k();});}else{k();}function p(){if(n){n();}}}function U(k,j){var i=G.one("#"+j),h=G.one("#"+k);if(i){i.all("ul li").set("role","menuitemradio");}R(j);h.before("mousedown",function(){R(j);});}G.on("verticalPreview",function(h){N=h.verticalPreview;});function R(n){var h=NeoConfig.previewPanePref?true:false,j=G.one("#"+n),o=j&&j.one("[data-action=scroll-view-prev]"),i=j&&j.one("[data-action=scroll-view-prev-beside]"),k=j&&j.one("[data-action=scroll-view-noprev]"),m=document.getElementById("shellcontent"),l,p="checked";if(NeoConfig.verticalPreview){m=m?m.offsetWidth:10000;l=m<900;if(l){i.addClass("disabled");i.setAttribute("title",strings["str_msg-view_scroll_pvw_too_narrow"]);}else{i.removeClass("disabled");i.removeAttribute("title");}if(h&&N&&!l){i.addClass(p);i.one("i.icon").addClass("icon-checkmark");i.set("aria-checked","true");}else{i.removeClass(p);i.one("i.icon").removeClass("icon-checkmark");i.set("aria-checked","false");}}else{i.setStyle("display","none");}if(h&&!N){o.one("i.icon").addClass("icon-checkmark");o.addClass(p);o.set("aria-checked","true");}else{o.one("i.icon").removeClass("icon-checkmark");o.removeClass(p);o.set("aria-checked","false");}if(!h){k.addClass(p);k.set("aria-checked","true");k.one("i.icon").addClass("icon-checkmark");}else{k.removeClass(p);k.set("aria-checked","false");k.one("i.icon").removeClass("icon-checkmark");}}function g(k){var j=G.one("#"+k),h=j&&j.one("[data-action=reply-im]"),i=j&&j.one("[data-action=reply-sms]");if(h){h[(NeoConfig.tog_hasIM?"remove":"add")+"Class"]("hidden");}if(i){i[(NeoConfig.tog_hasSMS?"remove":"add")+"Class"]("hidden");}}function e(k,i){var j=G.one("#"+k),h=i.origin;j.removeClass("reply_sender_mode");j.removeClass("reply_all_mode");j.removeClass("forward_mode");j.addClass(h.action+"_mode");if(h.fid==="Sent"){j.one("[data-action=reply_sender]").addClass("hidden");}else{j.one("[data-action=reply_sender]").removeClass("hidden");}if(i.isFullHeader){j.addClass("full_header_mode");}else{j.removeClass("full_header_mode");}if(i.isQuickReply){j.one(".edit_subject").removeClass("hidden");}else{j.one(".edit_subject").addClass("hidden");}}function J(m,l,h){var i=G.one("#"+l),k=G.all("#"+m),j;Q(G.one("#menu-actions [data-action=none]"),false);Z(l,h);k.each(function(n){n.before("mousedown",function(){Z(l,h);});});j=i.one(".togglePreview");if(j){Y(true,j);if(X&&X.detach){X.detach();X=null;}X=G.on("ws:previewChange",Y,this,j);}}function Y(i,h){if(NeoConfig.vertPane){i&&NeoConfig.previewPanePref?h.addClass("checked").setAttribute("data-action","scroll-view-noprev"):h.removeClass("checked").setAttribute("data-action","scroll-view-prev-beside");return;}if(i&&NeoConfig.previewPanePref){if(NeoConfig.forceTriPane){h.addClass("checked").setAttribute("data-action","scroll-view-noprev");}else{h.addClass("checked").setAttribute("data-action","fullpage-view");}}else{h.removeClass("checked").setAttribute("data-action","scroll-view-prev");
}}function Z(u,AL){var AO,AF,q,k=G.one("#"+u),x=k&&k.get("children"),AD,AI,AC=x&&x.size()||0,n,o,p,m,AH,s,v,AG,j,AB,AN,r,AA,z,h,y,AJ,w=NeoConfig.previewPanePref?true:false,AK,AE,AM=NeoConfig.tabs;if(u==="menu-conv-view"){if(!(NeoConfig.vertPane&&w)){q=G.one("#msg-list");if(q.hasClass("ml-compact")){AI=k.one("[data-action=density-compact]");}else{if(q.hasClass("ml-open")){AI=k.one("[data-action=density-open]");}else{AI=k.one("[data-action=density-regular]");}}if(AI){AI.get("parentNode").removeClass("hidden");AI.get("parentNode").get("parentNode").removeClass("hidden");k.all("[data-action=density-compact], [data-action=density-regular], [data-action=density-open]").removeClass("hidden").removeClass("checked");AI.get("parentNode").all("i.icon").removeClass("icon-checkmark");AI.addClass("checked");AI.one("i.icon").addClass("icon-checkmark");}else{clearTimeout(Z.timeout);Z.timeout=setTimeout(function(){Z(u,AL);},100);}}else{if(NeoConfig.vertPane&&w){k.one("[data-action=density-open]").get("parentNode").get("parentNode").addClass("hidden");k.all("[data-action=density-compact], [data-action=density-regular], [data-action=density-open]").addClass("hidden");}}n=G.mail.Tabs.getActiveTab();p=n&&n.widget;o=p&&p.type;j=p&&p.fid;if(o==="messagelist"||o==="convlist"){k.all(".msglistonly").removeClass("hidden");if(o==="messagelist"){if(j=="Sent"||j=="Draft"){k.one("[data-action=sender]").get("parentNode").addClass("hidden");k.one("[data-action=recipient]").get("parentNode").removeClass("hidden");}else{k.one("[data-action=sender]").get("parentNode").removeClass("hidden");k.one("[data-action=recipient]").get("parentNode").addClass("hidden");}}p&&p.msgList&&p.msgList.updateSortDropDown(k);}else{if(o==="search"){k.all(".msglistonly").addClass("hidden");if(k.one(".sortby-group")){if(NeoConfig.forceDS){AN=["sender","recipient","subject","unRead","attachment","sort-flagged","conv"];}else{AN=["recipient","unRead","sort-flagged","conv","relevance"];}r=k.all(".sortby-group a");r.each(function(l){var i=l.get("parentNode"),AP=l.getAttribute("data-action");G.Array.indexOf(AN,AP)>=0?i.hide():i.show();});AA=p.listMgr.getSortInfo().sortKey;z=p.listMgr.getSortInfo().sortOrder==="down"?"desc":"asc";h=z=="desc"?"icon-chevron-up":"icon-chevron-down";AA=(AA==="from")?"sender":AA;AA=(AA==="attachmentcount")?"attachment":AA;if(!k.one(".sortby-group .icon-checkmark")){AB=k.one(".sortby-group a[data-action="+AA+"]").get("parentNode");AB.one("i").addClass("icon-checkmark");AB.one("b").addClass(h);AB.addClass("sortby "+z);}else{y=k.one(".sortby-group .icon-checkmark").get("parentNode");AJ=y.one("a").getAttribute("data-action");if(AA==="date"&&AA!==AJ){y.removeClass("sortby").removeClass("asc").removeClass("desc");y.one(".icon-checkmark").removeClass("icon-checkmark");y.one("b").removeClass("icon-chevron-up").removeClass("icon-chevron-down");AB=k.one(".sortby-group a[data-action=date]").get("parentNode");AB.one("i").addClass("icon-checkmark");AB.one("b").addClass(h);AB.addClass("sortby "+z);}}}}else{if(o=="convlist"){p&&p.msgList&&p.msgList.updateSortDropDown(k);}}}var t=k.one("[data-action=density-open]").get("parentNode").get("parentNode");if(o==="search"){t.hide();}else{t.show();}if(NeoConfig.tabsInMenu){AK=k.one('[data-action="tab"]').get("parentNode").one("i");AE=k.one('[data-action="recent"]').get("parentNode").one("i");AK[AM?"addClass":"removeClass"]("icon-checkmark");AE[AM?"removeClass":"addClass"]("icon-checkmark");}}if(u==="menu-actions"){n=G.mail.Tabs.getActiveTab();p=n&&n.widget;o=p&&p.type;if(o==="search"){k.one("[data-action=fullheader]")&&k.one("[data-action=fullheader]").addClass("hidden");}else{k.one("[data-action=fullheader]")&&k.one("[data-action=fullheader]").removeClass("hidden");}}if(u==="menu-conv-actions"){AO=NeoConfig.msgrData;AF=AO&&AO.spam;for(AD=0;AD<AC;AD++){AI=x.item(AD).one("li");if(AI&&(/yimapp:report_spam$/).test(AI.getAttribute("data-action"))){if(AD==AC-1){k.insert(AI.get("parentNode"),x.item(AD-1));Z.moved=true;}Q(AI,AF&&AF.spammerId);}}if(!Z.moved){clearTimeout(Z.timeout);Z.timeout=setTimeout(function(){Z(u,AL);},100);}}if(u=="menu-bubble-actions"){s={spam:0,notspam:1,sendercompromised:0,phished:0,notmymail:0};AG=(AL.fid=="Sent"||AL.fid=="Draft");k.one(".spamactions")[(AG?"add":"remove")+"Class"]("hidden");if(!AG){AH=(AL.fid=="%40B%40Bulk")?1:0;for(v in s){m=k.one("[data-action='"+v+"']");m&&m[((AH!==s[v])?"add":"remove")+"Class"]("hidden");}}}if(NeoConfig.infiniteScroll&&u==="menu-conv-view"){R(u);}}function W(i,h){var j=i.get("id"),k=i.one("[data-action='addcontact']");if(j==="menu-actions"||j==="menu-msg-actions"||j==="menu-conv-actions"){Q(k,h);}else{b(k,h);}i.fire("menu:changed");}function b(i,h){if(!i){return;}if(h){i.removeClass("hidden");i.ancestor("ul").removeClass("hidden");}else{i.addClass("hidden");if(i.siblings().size()==0){i.ancestor("ul").addClass("hidden");}}}function Q(j,i){if(!j){return;}var h=j.one("a");if(i){j.removeClass("disabled");h.removeAttribute("aria-disabled");}else{j.addClass("disabled");h.set("aria-disabled",true);}}function O(h){var i=[];h.all("li em").each(function(l){var j=l.get("text").replace(/^\s+|\s+$/g,"");var m=j.indexOf(strings.str_menu_accel_d_number);if(m!=-1){j=G.Lang.trim(j.replace(strings.str_menu_accel_d_number,""));}j=j.split("+");for(var k=0;k<j.length;k++){if(j[k].length==1){j[k]=j[k].charCodeAt(0);}}j=(j.length==1)?j[0]:j.join("+");i.push(j);});return i;}function c(h){var i=[],j,k;for(k in h){j=h[k];if(!j.isSystem&&j.folderInfo){if(j.folderInfo.fid.indexOf("Sync%20Trap")==0){continue;}i.push(j);}}return i;}function S(j){var n=0,m=[],l,p=G.one("#menu-move-folder"),o=E[C["menu-inbox"]];if(p){for(;n<j.length;n++){l={fid:j[n].folderInfo.fid,name:j[n].folderInfo.name,name_dir:NeoConfig.bidi?j[n].folderInfo.dir:""};if(f&&n+1<=9){l.accel=strings.str_menu_accel_d_number+" "+(n+1);}else{l.is_accel="";}m.push(A(o.folders,l,d,0,strings,o));}p.setContent(m.join(""));if(G.UA.ie>0){var h=parseInt(p.getStyle("maxHeight"),10);var k=p.get("winHeight");h=Math.max(50,Math.min(h,parseInt(k/4,10)));
p.setStyle("maxHeight",h+"px");}}}function L(i){var h=null;switch(i){case"%40B%40Bulk":h=G.one("#menu-move [data-action='spam']");break;case"Trash":h=G.one("#menu-move [data-action='trash']");break;case"Inbox":h=G.one("#menu-move [data-action='inbox-move']");break;default:h=G.one("#menu-move-folder [data-fid='"+i+"']");}return h;}function M(j){G.all("#menu-move li").setStyle("display","block");var h=L(j),i;if(!h){return;}h.setStyle("display","none");i=G.one("#menu-move-folder");if(G.Array.indexOf(i.all("li").getStyle("display"),"block")!=-1){i.setStyle("display","block");}else{i.setStyle("display","none");}}function a(n){var m=G.one("#menu-msglist"),k,h,i,j,l={"%40B%40Bulk":1,"Draft":1,"Sent":1};if(m){k=m.one("[data-action='spam']");h=m.one("[data-action='notspam']");i=m.one("[data-action='reply_sender']");j=m.one("[data-action='fullheader']");m[(n=="%40C%40Chats"?"add":"remove")+"Class"]("hidden");}if(!k||!h){return;}b(k.ancestor("li"),l[n]!==1);b(h.ancestor("li"),n==="%40B%40Bulk");if(n=="Draft"){b(i);}else{b(i,true);}if(j){b(j,(n&&n!=="%40S%40Search"));}}function V(h,i){var j=i||D.get("fid").fid;if(G.one("#menu-move-folder li")){M(j);h();}else{G.mail.Controller.Folders.get(null,{success:function(l){var k=c(l);S(k);M(j);h();}});}}function T(){if(!P){P=A("{{str_menu_accel_enter}}",null,null,0,strings);}return P;}G.mix(this,{insert:I,getValidKeys:O,getEnterAccel:T,updateAddContactsMenu:W});D.on("fidChange",function(i){var h=i.newVal.fid;a(h);M(h);});G.on("ds:folder:change",function(j,i,k){if(!k){var h=c(i);S(h);}});};G.mail.ui.InboxMenu=new B();},"1.0.0",{requires:["common-utils","menus_css","mail-ui-foldersview-base"]});YUI.add("mail-common-inline-edit",function(B){var A=function(C,K){var E=null,L="<input type='text' class='page-number'/>",O=this,P={when:"keydown",avoid:[37,39],esc:27,done:13},I=false,F=null,H=K;E=(H.getNodeClassName)?H.getNodeClassName():"pagination-count";F=(C.hasClass(E)?C:C.one("."+E));var N=function(Q){if(I){return true;}if(Q){G(Q);}else{F.on("dblclick",G);}return true;};var G=function(U){U.stopPropagation();I=true;var T=U.target,V=T.get("parentNode"),R={border:"3px solid #954A8F",display:"none",fontSize:"11px",fontStyle:"normal",height:"12px",width:"35px",textAlign:"center"},Q=T.get("text"),S=V.one("input");if(V.hasClass(E)&&B.Lang.isNull(S)){S=B.Node.create(L);S.set("title",V.get("title"));S.setStyles(R);V.appendChild(S);S.on(P.when,function(W){if(W.charCode===P.done){J(parseInt(S.get("value"),10));M(V,false);}else{if(W.charCode===P.esc){M(V,false);}else{if(P.avoid.toString().indexOf(W.charCode.toString())!==-1){W.stopPropagation();}}}});S.on("blur",function(){M(V,false);});}S.set("value",Q);M(V,true);};var D=function(){F.detach("dblclick");I=false;};var J=function(R){var Q=H.getPageTotal();if(B.Lang.isNumber(R)){if(R<=0){return false;}else{if(R>Q){R=Q;}}H.setPage(R-1);}return true;};var M=function(T,Q){var S=T.one("input"),R=T.one("i");if(Q){S.setStyle("border","3px solid "+B.one("#dock").getStyle("backgroundColor"));S.setStyle("display","block");R.setStyle("display","none");S.focus();S.select();}else{S.setStyle("display","none");R.setStyle("display","block");}};O.disableEditablePagination=D;O.enableEditablePagination=N;};B.namespace("mail.common.EditablePaginationControl");B.mail.common.EditablePaginationControl=A;},"1.0.0");YUI.add("_shared_module_search_with_snippet_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_search_with_snippet_rollup={base:'<div id="msg-list" class="result content fresh glass {{message_list_density}} {{inbox}} {{showDD1}}"> <div class="list-view"> {{search_results}} </div> {{has_pagination}} </div> ',showDD1:"with-right-rail",showDD:'<div id="dd_search_background_helper_overlay"></div> <div id="dd_search_results_container"></div> <div id="dd_search_results_container_top"></div> ',didYouMean:'<div class="didyoumean-cont search-ac hidden"> <div class="didyoumean-header">{{str_srch_contacts_search_did_you_mean}}</div> <ul class="didyoumean yui3-aclist-content yui3-aclist-list"></ul> </div> ',multiple_search_result:"{{str_srch_status}}",single_search_result:"{{str_srch_status_single}}",forceDS:'<div class="srp-from-force"> <p class="num-results">{{multiple_search_result}} {{single_search_result}}</p> </div> ',forceDS_else:'<div class="refinement-btn">{{str_srch_refine}}</div> ',refinementWithoutDD:'<div class="refinement-top-bar"> <div class="refinement-top-bar-text">{{str_srch_search_result_for}}</div> {{didYouMean}} {{forceDS}} {{forceDS_else}} </div> ',top_refinements:'<div class="refinements hidden"></div> ',is_flagged:"{{str_msg_list_flagged_attr}}",is_flagged_else:"{{str_msg_list_flag_attr}}",searchView1:'<div class="fldr" role="gridcell"><span>{{folder}}</span></div> ',hasAttachment:'<div class="file icon" title="{{str_msg_list_attachments}}" role="gridcell">&nbsp;</div> ',hasAttachment_else:" ",search_msg_list:'<div class="list-view-item {{flags}}" data-key="{{hashKey}}" data-mid="{{permMid}}" data-action="select-result"> <div class="fixed start"> <label class="cbox"> <input type="checkbox" data-action="selectable" title="{{str_srch_select_this_msg}}" {{selected}}/><span class="icon"></span> </label> <div class="icon info {{flag_info}}"><span></span></div> </div> <div class="flex"> <div class="from" role="gridcell" title="{{fromTitle}}" data-fromObj="{{fromObj}}" {{data-inboxServices}} {{data-size}}> <span class="txt" dir="{{fromDir}}">{{from}}</span> <div class="action-toolbar"> <a class="icon icon-small-search msg-lst-srch" data-action="msg-frm-srch" title="{{str_mas_frm_srch_attr}}"></a> <a class="icon icon-small-delete delete-msg" data-action="delete" title="{{str_delete_single_email_attr}}"></a> <a class="icon flag" tabindex="-1" data-action="msg-flag" role="button" title="{{is_flagged}}{{is_flagged_else}}" aria-label="{{is_flagged}}{{is_flagged_else}}"> </a> </div> </div> <div class="subj" role="gridcell"> <span class="txt" dir="{{subjectDir}}">{{subject}}</span> <div class="action-toolbar"> <a class="icon icon-small-search msg-lst-srch" data-action="msg-sbj-srch" title="{{str_mas_sbjct_srch_attr}}"></a> </div> </div> {{searchView1}} {{hasAttachment}} {{hasAttachment_else}} </div> <div class="fixed end" role="presentation"> <div class="date" role="gridcell" data-rawdate="{{rawDate}}"><span>{{receivedDate}}</span></div> </div> <div class="snippet search-snippet"><div class="snippet-inner">{{snippet}}</div></div> </div> ',search_results:'<div class="list-view-items"> {{showDD}} {{refinementWithoutDD}} {{top_refinements}} {{search_msg_list}} </div> ',has_pagination:'<div class="list-view-footer fresh-toolbar hidden" role="toolbar"> <div class="commontasks shaded"></div> </div>  '};},"1.0.0");