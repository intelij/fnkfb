YUI.add("minty_module_list_view_ad_search",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_list_view_ad_search={base:'<div id="searchAd">{{dmcontent}}</div>',dmfavicon:'<img class="favicon" src="{{ad_favicon_url}}">',dmcontent:'<div id="searchAdFrame"><a href="{{ad_url}}" target="_blank"><span class="title">{{ad_title}}</span><span class="description">{{ad_description}}</span>{{dmfavicon}}<span class="link">{{ad_pretty_url}}</span></a></div><div id="searchAdNote">{{ad_note}}</div>'};},"1.0.0");YUI.add("minty_module_list_view_ad_skysearch",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_list_view_ad_skysearch={base:'<div id="sponsoredAd"><div id="searchAdNote">{{str_dm_note}}</div>{{dmskycontent}}</div>',dmfavicon:'<img class="favicon" src="{{ad_favicon_url}}" />',dmskycontent:'<div class="searchAdFrame"> <a href="{{ad_url}}" target="_blank" title="{{ad_pretty_url}}"> <span class="title">{{ad_title}}</span> </a><br /> <a href="{{ad_url}}" target="_blank" title="{{ad_pretty_url}}"> <span class="description">{{ad_description}}</span> </a><br /> <a href="{{ad_url}}" target="_blank" title="{{ad_pretty_url}}"> {{dmfavicon}} <span class="link">{{ad_pretty_url}}</span> </a></div>'};},"1.0.0");YUI.add("minty_module_list_view_ad_mas_search",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_list_view_ad_mas_search={base:'<div id="masSearchAd" class="result {{ad_class}}">{{dmcontent}}</div>',mas_ad_lbl:'<div class="ad-lbl">{{str_srch_ad_abbr}}</div>',mas_fvicn:'<div class="favicon" style="background-image:url({{ad_favicon_url}});"></div>',dmcontent:'<a class="ad-bar" href="{{ad_url}}" target="_blank"><div class="fixed start">{{mas_ad_lbl}}</div><div class="flex"><div class="title" title="{{ad_pretty_url}}">{{ad_title}}{{mas_fvicn}}</div><div class="description">{{ad_description}}</div><div class="link">{{ad_pretty_url}}</div></div><div class="fixed end"><div class="note">{{ad_note}}</div></div></a>'};},"1.0.0");YUI.add("minty_module_shell_ad_searchads",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_shell_ad_searchads={base:"{{hasSearchAds}}",sAds_detail:'<li> <a href="{{ad_url}}" target="_blank"> <p class="title" >{{ad_title}}</p> <p class="description">{{ad_description}}</p> <p class="source">{{ad_pretty_url}}</p> </a> </li> ',hasSearchAds:'<div class="right-rail-ad hidden" id="searchAds"> <h2 class="sAds-title right-rail-ad-header hidden"><a target="_blank" href="http://info.yahoo.com/privacy/us/yahoo/adinfo_contextual.html">{{str_search_ads_title}}</a></h2> <ul> {{sAds_detail}} </ul></div>'};},"1.0.0");YUI.add("mail-ui-dmsearch-view",function(C){var A=C.common.Utils;var B=function(D){var F=this,E={rootNode:{writeOnce:true},response:{},template:{value:C.ui.Templates.minty_module_list_view_ad_mas_search},skytemplate:{value:C.ui.Templates.minty_module_list_view_ad_skysearch},sAdstemplate:{value:C.ui.Templates.minty_module_shell_ad_searchads}};C.augment(F,C.Attribute);F.addAttrs(E,D||{});};B.prototype={formatters:{ad_class:function(){return NeoConfig.favicOnHover?"icon-hover":"";},mas_ad_lbl:function(D,E,F){var G=F;return A.substitute(G.get("template").mas_ad_lbl,D,G.formatters,D,strings,null,G);},mas_fvicn:function(D,E,F){var G=F;return A.substitute(G.get("template").mas_fvicn,D,G.formatters,D,strings,null,G);},dmfavicon:function(){return"";},dmcontent:function(D,E,F){var G=F;return A.substitute(G.get("template").dmcontent,D,G.formatters,D,strings,null,G);},dmskycontent:function(D,E,G){var I=G,H="";for(var F in D){H+=A.substitute(I.get("skytemplate").dmskycontent,D[F],I.formatters,D[F],strings,null,I);}return H;}},render:function(){var E=this,D=E.get("response");if(C.mail.Tabs.getActiveTab()===C.mail.ui.searchTab){E.renderNorthAd("#masSearchAd",D[0]);}E.renderSearchAd(D);},renderNorthAd:function(E,I){var J=this,F=J.get("rootNode"),D=F.one(E),G=F.one("div.list-view-items"),H;if(!I){return;}H=C.Node.create(A.substitute(J.get("template").base,I,J.formatters,I,strings,J.get("template"),J));D&&D.remove(true);J.applyBucketLogic(H);if(G){G.insertBefore(H,G.one(".list-view-item")||G.get("firstChild"));}else{F.insertBefore(H,F.get("firstChild"));}},applyBucketLogic:function(H){var D=[],G,I,F,E=H.one(".ad-lbl");if(NeoConfig.theme&&NeoConfig.theme.id==="purple"){switch(NeoConfig.expBucketId){case"CMUSGRSS01":H.addClass("original-bg");return;case"CMUSGRSS02":H.one(".description").prepend(H.one(".favicon"));return;case"CMUSGRSS03":E.replace('<div class="icn lnk"></div>');return;case"CMUSGRSS04":E.replace(H.one(".favicon"));return;case"CMUSGRSS05":H.addClass("pattern-bg");return;case"CMUSGRSS06":H.addClass("search-ad-thin");return;case"CMUSGRSS07":G=H.one(".link");I=H.one(".title");F=H.one(".description");H.addClass("merged").one(".ad-lbl").replace(H.one(".favicon"));D.push("<strong>"+I.get("text")+"</strong>");D.push(F.get("text"));D.push("<strong>"+G.get("text")+"</strong>");I.remove();G.remove();F.set("innerHTML",D.join(" &mdash; "));return;case"CMUSGRSSC1":return;}}E.replace('<div class="icn lnk"></div>');if(NeoConfig.dmSrcTag==="yahoo_mail_mailbox_search_4"){H.addClass("mbStyle");}},renderSponsoredAd:function(D,H){var L=this,E=C.one(D),M=C.one("#theAd"),J,I;if(!H){return;}J=A.substitute(L.get("skytemplate").base,H,L.formatters,H,strings,L.get("skytemplate"),L);I=C.Node.create(J);E.appendChild(I);M.addClass("withSponsoredAd");var K=C.one("body");var G=K.hasClass("wide-right-rail")?"#sb_rel_tgtWSKY":"#sb_rel_tgtSKY";var F=C.one(G);if(F){F.hide();}},cleanUpSponsoredAd:function(){var G=C.one("#sponsoredAd"),H=C.one("#theAd");G&&G.remove(true);if(H.hasClass("withSponsoredAd")){H.removeClass("withSponsoredAd");var D=C.one("body");var E=D.hasClass("wide-right-rail")?"#sb_rel_tgtWSKY":"#sb_rel_tgtSKY";var F=C.one(E);if(F){F.show();}}},renderSearchAd:function(E){var J=this,I=C.one("body"),D=C.one("#theAd #searchAds"),M=D&&D.one("ul"),K,F,H,G,L;if(!E||!E.length||!M){return;}M.get("childNodes").remove();D.one("h2").removeClass("hidden");K=E.length;for(H=0;H<K;H++){G=E[H];F=A.substitute(J.get("sAdstemplate").sAds_detail,G,J.formatters,G,strings,J.get("sAdstemplate").sAds_detail,J);L=C.Node.create(F);if(G&&G.ad_favicon_url==="http://l.yimg.com/pp/favicons-new/default.png"||G.ad_favicon_url==="https://s.yimg.com/pp/favicons-new/default.png"||!G.ad_favicon_url){L.addClass("nofav");}M.appendChild(L);}}};C.namespace("mail.ui");C.mail.ui.dmsearchView=B;},"1.0.0",{requires:["node-base","node-event-delegate","attribute-base","event-base","minty_module_list_view_ad_search","minty_module_list_view_ad_skysearch","minty_module_list_view_ad_mas_search","minty_module_shell_ad_searchads"]});YUI.add("mail-ui-sponsoredsearch-model",function(A){var H=A.common.Utils,G=H.escapeHtml,B=H.unescapeHtml,F=A.common.net.SessionMgr,I=/(((to|from|folder|subject|size|attachmentcount|attachmentname|attachmentsize|attachment|is|on|has|links)\:)|((before|after)\:)((\(.*?\))|(\d{4}\/\d{2}\/\d{2}))?|(\')|(\"))/gi,D=NeoConfig.intl+(NeoConfig.partnerType?"_"+NeoConfig.partnerType:""),E=(NeoConfig.enableCategorySearch&&NeoConfig.dmSrcTag==="yahoo_mail_mailbox_search_3")?1:0;var C=function(J){var L=this,K={seedTerm:{},partner:{},response:{setter:function(M){L.response=M;}},path:{},proxyPrefix:{}};A.augment(L,A.Attribute);L.addAttrs(K,J||{});A.augment(L,A.EventTarget);};A.mix(C.prototype,{req:null,prepareMultiResponse:function(P){var Q=this,N,T,K,J,L,V,S,W=true,U=/(<([bui(strong)]|[^>]|[\/bui(strong)]*)>)/gi,R,O,M=[];if(P.length){for(O=0;O<P.length;O++){R=P[O];N=R.getElementsByTagName("ClickUrl")[0].childNodes[0].nodeValue;T=B(R.getAttribute("title"));K=B(R.getAttribute("description"));J=R.getAttribute("siteHost");L=R.getAttribute("faviconUrl");W=T.match(/<.*>/)||K.match(/<.*>/);if(W){V=T.replace(U,"");S=K.replace(U,"");W=V.match(/<.*>/)||S.match(/<.*>/);}W&&Q.stat("sponsoredsearch","failure:badtags");if(!W){Q.stat("sponsoredsearch","success:displayed");M.push({ad_url:N,ad_title:T,ad_description:K,ad_pretty_url:J,ad_note:strings.str_srch_sponsored,ad_seedTerm:G(this.get("seedTerm")),ad_favicon_url:L});}}return M;}Q.stat("sponsoredsearch","failure:noads");},cleanSeedTerm:function(K){var J=/^(subject)\:"|^(subject)\:|("$)/gi;if(E){return K.replace(I,"");}else{return K.replace(J,"");}},execute:function(M,K){var O=this,P,Q=[],L=NeoConfig.expBucketId,J=O.get("partner"),R=function(T,W){var U=null,S=null,V=(W)?W.status:"";switch(V){case 200:try{U=A.XML.parse(W.responseText);S=U.getElementsByTagName("Listing");break;}catch(Y){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-sponsoredsearch-sponsoredSearchModel:1",Y,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-sponsoredsearch-sponsoredSearchModel:1");}break;default:O.stat("sponsoredsearch","failure:netfailure");}var X=O.prepareMultiResponse(S);M&&M.call(K,X);};if(!O.get("seedTerm")||!O.get("partner")){return;}if(O.get("seedTerm")){var N=O.get("seedTerm");if(E){N=B(G(N));}else{if(N.match(/subject:.*/)){N=B(G(N));}}O.set("seedTerm",N.replace(/([\#|\%|\&])/g," "));}Q.push("outputCharEnc=utf8");Q.push("keywordCharEnc=utf8");Q.push("mkt=us");Q.push("adultFilter=any");Q.push("Partner=yahoo_mail_search");Q.push("bolding=true");Q.push("maxCount="+NeoConfig.dmMaxListings);Q.push("enableFavicon=1");Q.push("Keywords="+encodeURIComponent(O.cleanSeedTerm(O.get("seedTerm"))));Q.push("serveUrl="+NeoConfig.launch_protocol+document.location.host);Q.push("affilData="+encodeURIComponent("ip="+NeoConfig.ipAddress+"&ua="+navigator.userAgent));if(L!=="0"){Q.push("type="+L);}P=NeoConfig.ssEndPoint+Q.join("&");O.req=F.requestProxy(P,{on:{success:R,failure:R},method:"GET",service:"sponsoredsearch",serviceCredType:"strict",timeout:2000});},stat:function(K,J){H.rocketstats.stat(K,J);H.rocketstats.stat(K,J+":"+this.get("partner"));H.rocketstats.stat(K,J+"_"+D);}},true);A.namespace("mail.ui");A.mail.ui.sponsoredsearchRequest=C;},"1.0.0",{requires:["common-net-sessionmgr"]});YUI.add("mail-ui-dmsearch-model",function(A){var H=A.common.Utils,G=H.escapeHtml,B=H.unescapeHtml,F=A.common.net.SessionMgr,I=/(((to|from|folder|subject|size|attachmentcount|attachmentname|attachmentsize|attachment|is|on|has|links)\:)|((before|after)\:)((\(.*?\))|(\d{4}\/\d{2}\/\d{2}))?|(\')|(\"))/gi,D=NeoConfig.intl+(NeoConfig.partnerType?"_"+NeoConfig.partnerType:""),E=(NeoConfig.enableCategorySearch&&NeoConfig.dmSrcTag==="yahoo_mail_mailbox_search_3")?1:0;var C=function(J){var L=this,K={seedTerm:{},partner:{},response:{setter:function(M){L.response=M;}},path:{},proxyPrefix:{}};A.augment(L,A.Attribute);L.addAttrs(K,J||{});A.augment(L,A.EventTarget);};A.mix(C.prototype,{req:null,prepareResponse:function(L){var O=this,N,Q,K,J,M,S,P,T=true,R=/(<([bui(strong)]|[^>]|[\/bui(strong)]*)>)/gi;if(L.Results&&L.Results.ResultSet&&L.Results.ResultSet[0]&&L.Results.ResultSet[0].Listing&&L.Results.ResultSet[0].Listing[0]){N=L.Results.ResultSet[0].Listing[0].ClickUrl.v_data;Q=B(L.Results.ResultSet[0].Listing[0].a_title);K=B(L.Results.ResultSet[0].Listing[0].a_description);J=L.Results.ResultSet[0].Listing[0].a_siteHost;M=L.Results.ResultSet[0].Listing[0].a_faviconUrl?L.Results.ResultSet[0].Listing[0].a_faviconUrl.replace("http://l.yimg.com","https://s.yimg.com"):"";T=Q.match(/<.*>/)||K.match(/<.*>/);if(T){S=Q.replace(R,"");P=K.replace(R,"");T=S.match(/<.*>/)||P.match(/<.*>/);}T&&O.stat("dmsearch","failure:badtags");if(!T){O.stat("dmsearch","success:displayed");return{ad_url:N,ad_title:Q,ad_description:K,ad_pretty_url:J,ad_note:strings.str_srch_sponsored,ad_seedTerm:G(this.get("seedTerm")),ad_favicon_url:M};}}O.stat("dmsearch","failure:noads");},prepareMultiResponse:function(L){var Q=this,O,T,K,J,M,V,S,W=true,U=/(<([bui(strong)]|[^>]|[\/bui(strong)]*)>)/gi,R,N=[];if(L.Results&&L.Results.ResultSet&&L.Results.ResultSet[0]&&L.Results.ResultSet[0].Listing){for(var P in L.Results.ResultSet[0].Listing){R=L.Results.ResultSet[0].Listing[P];O=R.ClickUrl.v_data;T=B(R.a_title);K=B(R.a_description);J=R.a_siteHost;M=R.a_faviconUrl?R.a_faviconUrl.replace("http://l.yimg.com","https://s.yimg.com"):"";W=T.match(/<.*>/)||K.match(/<.*>/);if(W){V=T.replace(U,"");S=K.replace(U,"");W=V.match(/<.*>/)||S.match(/<.*>/);}W&&Q.stat("dmsearch","failure:badtags");if(!W){Q.stat("dmsearch","success:displayed");N.push({ad_url:O,ad_title:T,ad_description:K,ad_pretty_url:J,ad_note:strings.str_srch_sponsored,ad_seedTerm:G(this.get("seedTerm")),ad_favicon_url:M});}}return N;}Q.stat("dmsearch","failure:noads");},cleanSeedTerm:function(K){var J=/^(subject)\:"|^(subject)\:|("$)/gi;if(E){return K.replace(I,"");}else{return K.replace(J,"");}},execute:function(M,K){var O=this,P,Q=[],L=NeoConfig.expBucketId,J=O.get("partner"),R=function(S,U){var V={},T=(U)?U.status:"";switch(T){case 200:try{V=A.JSON.parse(U.responseText);break;}catch(W){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-dmsearch-dmsearchModel:1",W,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-dmsearch-dmsearchModel:1");}break;default:O.stat("dmsearch","failure:netfailure");}V=O.prepareMultiResponse(V);M&&M.call(K,V);};if(!O.get("seedTerm")||!O.get("partner")){return;}if(O.get("seedTerm")){var N=O.get("seedTerm");if(E){N=B(G(N));}else{if(N.match(/subject:.*/)){N=B(G(N));}}O.set("seedTerm",N.replace(/([\#|\%|\&])/g," "));}P=O.get("proxyPrefix")+O.get("path")+"?";Q.push("partner="+J);Q.push("url="+document.location.host);Q.push("serveUrl="+document.location.host);Q.push("affilData="+encodeURIComponent("ur=&ip="+NeoConfig.ipAddress+"&ua="+navigator.userAgent));Q.push("seedTerm="+encodeURIComponent(O.cleanSeedTerm(O.get("seedTerm"))));Q.push("adultFilter=clean");if(J==="yahoo_mail_https_ctxt"||J==="yahoo_mail_https_2_ctxt"||J==="yahoo_mail_https_3_ctxt"){Q.push("cmSourceTag="+J);Q.push("maxRT=0");Q.push("maxCM=5");}else{Q.push("maxListings="+NeoConfig.dmMaxListings);Q.push("cookie="+encodeURIComponent(A.Cookie.get("B")));if(L!=="0"){Q.push("type="+L);}if(L!=="CMUSGRSM04"){Q.push("enableFavicon=1");}}P=P+Q.join("&");O.req=F.requestProxy(P,{on:{success:R,failure:R},method:"GET",service:"dmsearch",serviceCredType:"strict",timeout:5000});},stat:function(K,J){H.rocketstats.stat(K,J);H.rocketstats.stat(K,J+":"+this.get("partner"));H.rocketstats.stat(K,J+"_"+D);}},true);A.namespace("mail.ui");A.mail.ui.dmsearchRequest=C;},"1.0.0",{requires:["common-net-sessionmgr"]});YUI.add("mail-ui-dmsearch-controller",function(C){var A=C.common.Utils;var B=function(D){var F=this,E={rootNode:{},seedTerm:{},partner:{},response:{setter:function(G){F.response=G;}},responseTime:{value:0},path:{value:strings.str_cfg_dm_feed_path},proxyPrefix:{value:strings.str_cfg_dm_proxy_prefix}};C.augment(F,C.Attribute);F.addAttrs(E,D||{});C.augment(F,C.EventTarget);};B.prototype={sponsoredsearchRequest:null,process:function(H){var K=this,M=(new Date()).getTime(),E=function(P){var O=(new Date()).getTime()-M,N;K.set("responseTime",O);if(P){K.set("response",P);if(P.length>0){N={"keyword":P[0].ad_seedTerm,"response":P};NeoGV.searchAds.push(N);NeoGV.searchAds.currentKeyword=P[0].ad_seedTerm;}}else{if(K.get("rootNode")){A.rocketstats.stat("dmsearch","staticad");K.set("response",K.getStaticAd());C.fire("mbEvent",{action:"show",source:"search"});A.rocketstats.stat("dmsearch","mbbackfill");}}if(H){H(P);}A.rocketstats.stat("dmsearch","responsetime",O);},J,I,G,F,D,L;if(NeoConfig.ssOpt){K.sponsoredsearchRequest=new C.mail.ui.sponsoredsearchRequest({seedTerm:K.get("seedTerm"),partner:K.get("partner"),path:K.get("path"),proxyPrefix:K.get("proxyPrefix")});}else{K.sponsoredsearchRequest=new C.mail.ui.dmsearchRequest({seedTerm:K.get("seedTerm"),partner:K.get("partner"),path:K.get("path"),proxyPrefix:K.get("proxyPrefix")});}J=K.get("seedTerm");if(NeoGV.searchAds){F=NeoGV.searchAds;D=F.length;L=false;for(I=0;I<D;I++){G=F[I];if(G.keyword===J){K.set("response",G.response);K.set("responseTime",1);L=true;break;}}if(!L){K.sponsoredsearchRequest.execute(E,K);}}else{NeoGV.searchAds=[];K.sponsoredsearchRequest.execute(E,K);}},getStaticAd:function(){var D=window.strings;return{ad_url:A.substitute(D.str_cfg_url_dm_static_content_mail_search_tip,D),ad_title:D.str_dm_title,ad_description:D.str_dm_description,ad_pretty_url:D.str_dm_pretty_url,ad_note:""};},render:function(){var G=this,E=NeoConfig.intl+(NeoConfig.partnerType?"_"+NeoConfig.partnerType:""),D=new C.mail.ui.dmsearchView({rootNode:G.get("rootNode"),response:G.get("response")||{}});if(G.get("responseTime")&&!G.get("response")){C.fire("mbEvent",{action:"show",source:"search"});A.rocketstats.stat("dmsearch","mbbackfill");return;}else{if(G.get("responseTime")&&G.get("response")){var F=G.get("partner");if(F!=="yahoo_mail_websearch_ssl"&&F!=="yahoo_mail_https_ctxt"){C.fire("darlaEvent",{action:"search_results"});A.rocketstats.stat("dmsearch","darlafire");A.rocketstats.stat("dmsearch","darlafire"+"_"+E);}}}D.render();if(!G.get("responseTime")&&!G.get("response")){G.after("responseChange",function(){G.render();});}}};C.namespace("mail.ui");C.mail.ui.dmsearchController=B;},"1.0.0",{requires:["event-base","mail-ui-dmsearch-view","mail-ui-sponsoredsearch-model","mail-ui-dmsearch-model"]});