YUI.add("mail-ui-mailevents",function(B){B.namespace("mail.ui");var G=B.common.Utils,E=G.substitute,I=B.common.ui,A,F=NeoConfig.grayoutEnabled,H=[],C=G.log;var D=function(){};B.mix(D.prototype,{remove:function(){},move:function(){},flag:function(){},spamAct:function(){},showNotification:function(){},getAllHandleCallback:function(){},print:function(){},quickFilter:function(){},addContact:function(){},send:function(){},getBulkOperations:function(){},handleOpenDraft:function(){},handleAction:function(){},buttonEnabled:function(K){var J=B.mail.ui.ContextButton;return J?J.buttonEnabled(K):1;},removeMails:function(M,K,J){var L=this;J=J||{};J.header=strings.str_delete;J.dlgHandle=J.dlgHandle||{};B.fire("mailEvents:removeMails",M,K,J);J.dlgHandle.abortHandle=L.remove(K,M,J);},moveMails:function(L,K,N,J){var M=this;if(L==="%40C%40Chats"){return;}J=J||{};J.header=strings.str_move;J.dlgHandle=J.dlgHandle||{};J.dlgHandle.abortHandle=M.move(L,K,N,J);},setFlagSelected:function(L,K,M,O){var N=this,Q={},J,R,P=false;O=O||{};O.header=N.getDataActionInfo(L).name;O.dlgHandle=O.dlgHandle||{};if(!O.hasMsgList&&M){if(M[0]){R=M[0].cid?"cid":"mid";J=M[0][R];if(B.Array.indexOf(H,J)>=0){return;}O[R]=J;O.key=R;H.push(J);}}switch(L){case"unread":Q.read=0;break;case"unflagged":Q.flagged=0;break;case"notspam":Q.ham=1;break;case"spam":Q.spam=1;if(strings.str_cfg_tog_set_spam_read_flag){Q.read=1;}B.fire("darlaEvent",{action:"mark_spam"});break;case"sendercompromised":Q.sendercompromised=1;if(strings.str_cfg_tog_set_spam_read_flag){Q.read=1;}P=true;B.fire("darlaEvent",{action:"mark_spam"});break;case"phished":Q.phished=1;if(strings.str_cfg_tog_set_spam_read_flag){Q.read=1;}P=true;B.fire("darlaEvent",{action:"mark_spam"});break;case"notmymail":Q.notmymail=1;Q.spam=1;P=true;B.fire("darlaEvent",{action:"mark_spam"});break;default:Q[L]=1;break;}O.dlgHandle.abortHandle=P?N.spamAct(K,M,Q,O):N.flag(K,M,Q,O);},createBulkOpCallback:function(J){var K=this;return{suppressCodes:["Client.MessageIdsNotFound"],success:function(){if(J.mids){B.fire("MailLog",{m:"Message "+J.mids.join(",")+" marked as "+J.action+" successfully"});}K.showNotification(J);if(!J.hasMsgList){H.splice(B.Array.indexOf(H,J[J.key]),1);}if(!NeoConfig.infiniteScroll){if(J.widget&&J.widget.vlist){J.widget.vlist.clear();}}if(J.dlgHandle&&J.dlgHandle.destroy){J.dlgHandle.destroy();}if(strings.str_cfg_tog_timed_alert_dialog){B.use("mail-ui-message-timedalertdialog",function(L){L.mail.ui.messageTimedAlertDialogRender(J);});}},failure:function(){if(J.mids){B.fire("MailLog",{m:"Marking message "+J.mids.join(",")+" as "+J.action+" failed"});}if(!J.hasMsgList){H.splice(B.Array.indexOf(H,J[J.key]),1);}if(J.dlgHandle&&J.dlgHandle.destroy){J.dlgHandle.destroy();}},progress:function(M){var N,L;if(M.processed===0&&!(J.dlgHandle&&J.dlgHandle.destroy)){K.createProgressDialog(J);}else{if(J.dlgHandle&&J.dlgHandle.get){N=J.dlgHandle.get("contentBox");if(N){L=N.one("div.prog-indicator div.progress");if(L){L.setStyle("width",Math.floor((M.processed*100)/M.total)+"%");}}}}}};},createProgressDialog:function(K,J){B.use("common-ui-dialog-helper","_shared_module_offscreen_bin_progress_bar",function(P){var M=P.ui.Templates,L=P.common.ui.DialogHelper,N={cancel:{handler:function(){var Q=K.dlgHandle||{};if(Q.abortHandle&&Q.abortHandle.abort){Q.abortHandle.abort();}K.aborted=1;}}},O={};O.hd=K.header;O.bd="<br /><br />"+E(M._shared_module_offscreen_bin_progress_bar.base,0,0,0,{progress:"1"});L.cancelDialog(O,N,function(Q){if(K.dlgHandle&&K.dlgHandle.abortHandle){Q.abortHandle=K.dlgHandle.abortHandle;}K.dlgHandle=Q;K.aborted=0;if(J){J(Q);}});});},confirmRemove:function(K,J,L){var N=this,M=K&&K.get&&K.get("selectCount");N.confirmRemoveBase("str_modal_message_delete_title",(typeof M!=="number"||M===1)?"str_modal_message_delete_single_question":"str_modal_message_delete_question",J,L);},confirmRemoveAll:function(M,J,L,N){var T=B.ui.Templates,S=J.get("selectCount"),R="",K="",P="",O=strings.str_modal_message_delete_num_question,Q;if(M==="%40B%40Bulk"){K="default";O=strings.str_empty_spam_conf;}else{if(M==="Trash"){O=strings.str_empty_trash_conf;}P="default";}if(S){R=S.toString();}Q=E(O,0,0,0,{num_selected:R});B.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_generic",function(Z){var a=E(T._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"ok","default":K,btnLabel:strings.str_ok}),V=E(T._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"cancel","default":P,btnLabel:strings.str_btn_cancel}),X={hd:strings.str_modal_message_delete_all_title,bd:Q,ft:a+V,hasfetchAdsInCbk:false},W={ok:{handler:function(){L();}},cancel:{handler:function(){if(N){N();}}}},U=function(Y){if(Y.set){Y.set("adAction","disableRetriggerOnOk");}};Z.common.ui.DialogHelper.createCommon(X,W,U);});},confirmRemoveBase:function(M,L,J,K){B.use("common-ui-dialog-helper",function(){I.DialogHelper.confirm({hd:strings[M],bd:strings[L]},{ok:{handler:function(){J();}},cancel:{handler:function(){if(K){K();}}}});});},alertInvalidSelection:function(O,L,K,R){var Q=this,S=["density-compact","density-regular","density-open"],N=["open","forward","reply_sender","reply_all","edit","fullheader","addcontact","set_encodings","print","reply-im","reply-sms","quick_filter"],J=B.Array.indexOf(S,L)!==-1,M=B.Array.indexOf(N,L)!==-1,P=K==="%40C%40Chats";if(J||O===1||(O>1&&!M)){return 0;}if(F&&R){return !Q.buttonEnabled(R);}B.use("common-ui-dialog-helper",function(){if(O===0){I.DialogHelper.alert({hd:strings.str_modal_no_msg_title,bd:strings[P?"str_modal_zero_selected_conv":"str_modal_zero_selected"]});}else{if(O>1){I.DialogHelper.alert({hd:strings.str_modal_too_many_msgs_title,bd:strings[P?"str_modal_select_single_message_conv":"str_modal_select_single_message"]});}}});return 1;},showSpamNotification:function(){var K,J=B.ui.Templates._shared_module_offscreen_bin_notification_notifications.spam_success;K=new B.common.ui.Notification({type:"fade",className:"top",parent:"shellcontent",parentType:"id"});K.notify(E(J,null,null,null,strings));
},getDataActionInfo:function(L){var J=strings.str_move,K={"delete":{op:"remove",name:strings.str_delete},spam:{op:"spam",name:strings.str_spam},sendercompromised:{op:"spam",name:strings.str_spam},phished:{op:"spam",name:strings.str_spam},notmymail:{op:"spam",name:strings.str_spam},notspam:{op:"spam",name:strings.str_not_spam},read:{op:"flag",name:strings.str_menu_mark_read},unread:{op:"flag",name:strings.str_menu_mark_unread},flagged:{op:"flag",name:strings.str_menu_flag},unflagged:{op:"flag",name:strings.str_menu_clear_flag},trash:{op:"move",name:J},"inbox-move":{op:"move",name:J},"folder-new":{op:"move",name:J},move:{op:"move",name:J}};return K[L];},getSelectedHandleCallback:function(L,N,K,P){var O=this;if(P){O.handle(L,P,N);}else{if(K){var J=O.getDataActionInfo(L.action),M=K.get("selectCount");if(O.shouldShowProgressDialog(J,M,K)){B.mix(L,{dlgHandle:null,header:J.name});L.widget=K;O.createProgressDialog(L,function(){K.getSelected(function(Q){O.handle(L,Q,N);});});}else{K.getSelected(function(Q){O.handle(L,Q,N,K);});}}}if(L.afterHandle){L.afterHandle(L.afterHandleParams);}},redirectMessages:function(J){B.use("common-ui-dialog-helper",function(){I.DialogHelper.confirm({hd:"Redirect messages",bd:'Redirect to: &nbsp; <input id="redirectMsg" class="field-name " type="text" size="30" value="buggy_messages@yahoo.com" name="redirectMsg">'},{ok:{handler:function(L,K){J();K.destroy();},stopDestroy:true}});});},shouldShowProgressDialog:function(K,M,J){var O=this,L=O.getBulkOperations(K&&K.op,J),N;if(K&&L){N=L.fixed;if(N){return M>=N*2.5;}else{return 2*L.bs<=M;}}},handleUI:function(Q,K,J,O){var P=this,L,N,R;A=A||B.one("#pagetoolbar");Q=Q||{};L=Q.action;Q.root=A;Q.cancelCbk=Q.cancelCbk||0;if(L==="delete"&&(N=B.mail.model.DataStore.Folders.get(K))&&N.total===0&&!N.isSystem&&!F){B.use("mail-ui-folderevents",function(V){V.mail.ui.FolderEvents.handle({dataAction:"folder-remove"},K);});return;}if((L!=="menu"&&L!=="move-menu")&&(!O&&J&&P.alertInvalidSelection(J.get("selectCount"),L,K,Q))){return;}switch(L){case"thread-toggle":var U=Q.msgPane,S=U.message,M;if(!U){return;}M=(S.toggleState==="expanded")?"collapse":"expandall";U.handleToggleAllMessageCards(Q.item,M,S,U.getMsgFid(S));break;case"sbjSrch":var T=new RegExp("^(\\b("+strings.str_comp_reply_spRE+"|"+strings.str_comp_reply_spFWD+")(\\s*)?)*","i");B.fire("fireSearch",'subject:"'+O[0].header.subject.replace(T,"")+'"');B.fire("mt:click",{action:"mas_sbj_srch"});break;case"delete":case"trash":P.handleOpenDraft();if(J&&J.selectAllNode.get("checked")&&J.get("selectCount")!==1){P.confirmRemoveAll(K,J,function(){P.getSelectedHandleCallback(Q,K,J,O);});}else{if((L==="delete")&&((K==="Trash")||(K==="%40B%40Bulk")||(K==="%40C%40Chats"))){P.confirmRemove(J,function(){P.getSelectedHandleCallback(Q,K,J,O);},Q.cancelCbk);}else{P.getSelectedHandleCallback(Q,K,J,O);}}break;case"folder-new":B.use("mail-ui-folderevents","mail-controller-folders",function(V){V.mail.ui.FolderEvents.createFolder(function(W){W.action=W.action||"folder-new";R=function(){P.getSelectedHandleCallback(W,K,J,O);};if(Q.preHandle){Q.preHandle(R);}else{R();}},"move");});break;case"redirectmsg":P.redirectMessages(function(){P.getSelectedHandleCallback(Q,K,J,O);});break;case"debugmsg":P.getSelectedHandleCallback(Q,K,J,O);break;case"folder-allread":Q.action="read";Q.filterBy={"filterBy-isRead":0};Q.selection={isRead:0};P.getAllHandleCallback(Q,K);break;default:P.getSelectedHandleCallback(Q,K,J,O);break;}},handle:function(L,P,N,K){L=L||{};var O=this,M=L.action,J;if(L.aborted){return;}if(strings.str_cfg_tog_edit_draft_from_search&&M==="open"&&P[0].sourceFolderInfo.fid==="Draft"){L.action=M="edit";}if(L.tbAction){L.noScroll=true;}if(M==="move"&&strings.str_cfg_tog_flag_spam_on_move){if(L.fid==="%40B%40Bulk"){L.action=M="spam";}else{if(N==="%40B%40Bulk"){L.action=M="notspam";}}}C({m:"Initiate Action from Mail Events",action:M});switch(M){case"delete":O.removeMails(P,N,L);break;case"spam":case"sendercompromised":case"phished":case"notspam":case"read":case"unread":case"flagged":case"unflagged":case"notmymail":O.setFlagSelected(M,N,P,L);break;case"trash":O.moveMails(N,"Trash",P,L);break;case"inbox-move":O.moveMails(N,"Inbox",P,L);break;case"folder-new":O.moveMails(N,L.fid,P,L);break;case"move":O.moveMails(N,L.fid,P,L);break;case"move-menu":B.fire("toolbar:ui-automation","menu","move");break;case"print":O.print(P[0],N,K);break;case"frmSrch":B.fire("mt:click",{action:"mas_frm_srch"});O.fromSearch(P[0],N);break;case"debugmsg":J=NeoConfig.hasConvView?P[0].msgs[0].mid.split("_")[5]:P[0].mid.split("_")[5];window.open("http://cascade004.mail.ne1.yahoo.com/ws/admin/debug/message?yid="+NeoConfig.loginId+"&ymumid="+encodeURIComponent(J));break;default:O.handleAction(L,P,N,K);}}});B.mail.ui.MailEvents=D;},"1.0.0",{requires:["mail-controller-messages","mail-controller-messages-ops","common-utils","common-ui-tabs-base","mail-model-datastore","comms-utils","_shared_module_offscreen_bin_notification_notifications","common-ui-notification"]});YUI.add("mail-ui-messageevents",function(F){var B=F.mail.Controller.Messages,A=F.common.Utils.escapeHtml,D=F.comms&&F.comms.Utils,C=F.common.ui;var E=function(G){var H=this;H.KEY="mid";E.superclass.constructor.call(H,G);};F.extend(E,F.mail.ui.MailEvents,{fromSearch:function(K,J){var G=K.header,H,I;if(J==="Sent"||J==="Draft"){H=G?G.to:K.to;I=H&&H[0]?H[0].name:(K.toEmail||"");if(NeoConfig.searchSuggestions){F.mail.ui.XobniContactsSearch.doPeopleSearch(I,function(){F.fire("fireSearch",'to:"'+I+'"');});}else{F.fire("fireSearch",'to:"'+I+'"');}}else{I=G?G.from.name:K.from.name;if(NeoConfig.searchSuggestions){F.mail.ui.XobniContactsSearch.doPeopleSearch(I,function(){F.fire("fireSearch",'from:"'+I+'"');});}else{F.fire("fireSearch",'from:"'+I+'"');}}},remove:function(I,H,G){var J=this;return B.remove({fid:I,mid:H},J.createBulkOpCallback(G));},move:function(J,H,I,G){var K=this;G.totalMsgs=(I)?I.length:0;if(NeoConfig.hasConv&&G.hasMsgList&&G.totalMsgs){F.fire("mt:click",{action:"move_thrd_msg",append:{count:G.totalMsgs}});}return B.move({sourceFid:J,destinationFid:H,mid:I},K.createBulkOpCallback(G));},flag:function(J,O,P,M,K){var L=this,I,H,N,G=strings.str_cfg_tog_flag_spam_on_move;M.totalMsgs=(O)?O.length:0;I={fid:J,mid:O,setFlags:P};if(K){I.fromConv=true;}if(P.ham&&M.fid!=="%40B%40Bulk"&&G){I.destFid=M.fid;}H=M.selection;if(H){I.selection=H;}if(O!==null){N=F.Array.map(O,function(Q){return Q.mid;});if(N&&N.length){M.mids=N;F.fire("MailLog",{m:"About to mark "+N.join(",")+" messages(s) in "+J+" as "+(P.read===1?"read":"unread")});}}return B.flag(I,L.createBulkOpCallback(M));},spamAct:function(K,H,J,G,I){var L=this;L.flag(K,H,J,G,G&&G.fromConv);},showNotification:function(G){var H=this;if(G&&G.action){switch(G.action){case"phished":case"sendercompromised":case"spam":case"notmymail":H.showSpamNotification();break;default:break;}}if(0){F.use("common-ui-notification",function(J){if(!H.notification){H.notification=new J.common.ui.Notification();}var I=H.notification.getMsg({action:G.action,totalMsgs:G.totalMsgs,fid:G.fid});setTimeout(function(){if(I&&I.length>0){H.notification.notify('<div class="nf-text">'+I+"</div>");}},0);});}},getAllHandleCallback:function(I,K){var L=this,G=L.getDataActionInfo(I.action),H=I.numMid||0,J;if(H===0){return;}if(L.shouldShowProgressDialog(G,H)){J={fid:K,numMid:H};if(I.filterBy){F.mix(J,I.filterBy);}F.mix(I,{dlgHandle:null,header:G.name});L.createProgressDialog(I,function(){var P=0,O=[],N=999;P=H;function M(){if(P===0){L.handle(I,O,K);return;}if(P>N){J.numMid=N;P=P-N;}else{J.numMid=P;P=0;}if(O.length>0){J.startMid=O.length;}B.list(J,{success:function(Q){O=O.concat(Q.mid);M();}});}M();});}else{L.handle(I,null,K);}if(I.afterHandle){I.afterHandle();}},print:function(H,G){if(H.msgs){H=H.msgs[0];}F.use("mail-ui-print",function(){F.mail.ui.print({fid:G,msg:H});});},quickFilter:function(G){F.use("mail-ui-messagesview-quickfilter",function(I){var H=G.header?G.header:{from:G.from};I.mail.ui.QuickFilter.createDialog({msgHeader:H});});},addContact:function(H,J,M){var L,G,N,K,I,O=/[\s\S]+"cloud_id":(\d+)[\s\S]+/;if(J==="%40C%40Chats"){N=H.clickedAddress||H.header.from.email||"";G=H.clickedName||H.header.from.name||"";L=[];if(N==="mailbot@yahoo.com"&&(/^\d+$/).test(G)){L.push({type:"phone",value:G,flags:["MOBILE"]});}else{L.push({type:"name",value:D&&D.splitName&&D.splitName(G)});L.push({type:"email",value:N});K=H.body?O.exec(H.body.display):(NeoConfig.msgrData&&NeoConfig.msgrData.reply&&["",NeoConfig.msgrData.reply.cloud_id]);I={1:"LCS",2:"MSN",9:"IBM"};if(K&&K[1]&&I[K[1]]){L.push({type:"otherid",value:N,flags:[I[K[1]]]});}else{L.push({type:"yahooid",value:N.replace(/@yahoo\.(.+)/,function(Q,P){return(P==="cn")?Q:"";})});}}}else{if("msg"===M.context){N=(H.header)?H.header.from.email:((H.from)?H.from.email:"");G=(H.header)?H.header.from.name:((H.from)?H.from.name:"");}else{N=H.clickedAddress||"";G=H.clickedName||"";}}F.fire("addContact",G,N,L);},send:function(H,J){var I=J,M=I.header||I,L=M.from||{},K=L.email||"",G=NeoConfig.msgrData.reply||{};if(K==="mailbot@yahoo.com"){K=L.name;G.id=K;G.network="sms";G.cloud_id=undefined;NeoConfig.msgrData.reply=G;}if(K){F.fire("chats:send"+H,{id:K});}},getBulkOperations:function(G){return G&&B.bulkOps[G];},handleOpenDraft:function(J,G,L){var K,H,N,M=false,I=function(){F.use("common-ui-dialog-helper",function(){C.DialogHelper.alert({hd:strings.str_branding_mail,bd:strings.str_modal_delete_open_draft});});};if(L==="Draft"){G.getSelected(function(O){for(H=0;H<O.length;H++){K=O[H];N=F.mail.ui.Workspace.composeFindOrigin({oMsg:K,fid:L,action:"delete"});if(N){I();M=true;return;}}});if(M){return;}}},handleAction:function(H,M,K,G){var L=this,J=H.action,I;switch(J){case"open":if(G&&G.sortedColumn&&(I=G.vlist)&&I.arrItems){F.fire("openMessage",{msg:M[0],fid:K,noScroll:H.tbAction,sortCol:G.sortedColumn,arrMsgSeq:I.arrItems,index:(I.rootSelect&&I.rootSelect.index)||null});}else{F.fire("openMessage",{msg:M[0],fid:K,noScroll:H.tbAction});}break;case"forward":F.fire("newMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"forward_as_attachment":H.action="forward";H.forwardAsAttachment=true;F.fire("newMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"reply_sender":F.fire("newMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"reply_all":F.fire("newMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"reply-im":L.send("IM",M[0]);break;case"reply-sms":if(NeoConfig.tog_hasSMS){L.send("Sms",M[0]);}break;case"edit":F.fire("editMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"fullheader":L.fullHeader(M,K);break;case"addcontact":L.addContact(M[0],K,H);break;case"set_encodings":L.setEncoding(M,K);break;case"redirectmsg":L.doRedirect(M,K,document.getElementById("redirectMsg").value);break;case"quick_filter":L.quickFilter(M[0]);break;}},doRedirect:function(G,I,H){F.use("common-ui-dialog-helper","modal_css",function(P){var L=P.common.persist.UserData;var N=L.get("userSendPref");var K={name:"",email:""};if(N){K.name=N.defaultFromName;K.email=N.defaultFromAddress;}var O=[];for(var J=0;J<G.length;
J++){O.push(G[J].mid);}var M=[];M.push({email:H});B.redirectMsg({fid:I,mid:O,resentFrom:K,resentTo:M},{success:function(){C.DialogHelper.alert({hd:"Redirect Messages",bd:"Message redirection <b>successful.</b>"});},failure:function(){C.DialogHelper.alert({hd:"Redirect Messages",bd:"Message redirection <b>failed.</b>"});}});});},redirectMessages:function(G){F.use("common-ui-dialog-helper",function(){C.DialogHelper.confirm({hd:"Redirect messages",bd:'Redirect to: &nbsp; <input id="redirectMsg" class="field-name " type="text" size="30" value="buggy_messages@yahoo.com" name="redirectMsg">'},{ok:{handler:function(I,H){G();H.destroy();},stopDestroy:true}});});},setEncoding:function(H,G){F.use("mail-ui-message-encodings",function(I){I.mail.ui.MessageEncodings.setMessageEncoding(H,G);});},fullHeader:function(G,H){F.use("common-ui-dialog-helper",function(){B.fullHeader({fid:H,mid:G[0].mid},{success:function(I){C.DialogHelper.alert({modal_classes:"lg",hd:strings.str_modal_full_header,bd:['<textarea readonly="true" style="width:100%;height:25em;" class="default">',I?A(I.rawheaders[0]):strings.str_error_no_body_returned,"</textarea>"].join(""),focusedNode:".default"});},failure:function(){C.DialogHelper.alert({hd:strings.str_modal_full_header,bd:strings.str_error_no_body_returned});}});});}});F.mail.ui.MessageEvents=new E();},"1.0.0",{requires:["mail-controller-messages","mail-controller-messages-ops","mail-model-datastore","mail-ui-mailevents"]});YUI.add("xobni-contacts-search-api",function(B){function A(C){try{return B.JSON.parse(C);}catch(D){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-comms-shared-src-xobniContacts-xobni-contacts-search-api:1",D,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-comms-shared-src-xobniContacts-xobni-contacts-search-api:1");D;}}B.namespace("xobniContacts").searchAPI={fetch:function(E,J,D){var P="https",L=E.timeout||2000,H=("limit" in E)?E.limit:5,O=("useCors" in E)?!!E.useCors:false,F=E.host||(NeoConfig.isCorpmail?"dev1data":"proddata"),K,M,I,G,N,C=B.common.Utils.ymmastats;if(O){M=P+"://"+F+".xobni.yahoo.com/v4/contacts/s?";}else{K=(F==="dev1data")?"smartcontacts-dev1":"smartcontacts";M="/ws/comms/"+K+"/v4/contacts/s?";}I={q:E.query,l:H};G=B.QueryString.stringify(I);if(M.indexOf("?")===-1){M=M+"?";}N={on:{success:function(Q,S){var R=S.responseText&&S.responseText.length&&A(S.responseText),T=(R&&B.Lang.isArray(R.r))?R.r:[];if(J){J(T);}},failure:function(R,Q){if(Q.statusText!=="abort"){if(Q.statusText==="timeout"){}if(D){D();}}}},timeout:L};if(O){N.xdr={use:"native",credentials:true};}if(E.origin){C.stat("search_xobnicontact","type=>searchsuggestion");}else{C.stat("search_xobnicontact","type=>normal");}return B.io(M+G,N);}};},"1.0.0",{requires:["io-base","json","ymma-stats"]});YUI.add("_shared_module_xobni_contact_search_results_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_xobni_contact_search_results_rollup={base:"<div class='xobniPersonResult {{hasname}}' title=\"{{title}}\"> <div class='xobniPersonPic' style='background-image:url({{imageUrl}});' alt='thumbnail'></div> <div class='textHolder'> <span class='ac-value' role='option'> {{nameHighlightChunks}} <em> <div class=\"ac-value-email\"> {{emailHighlightChunks}} </div> <div class=\"ac-value-more\"> {{hasMoreThanOneEmail}} </div> </em> </span> </div></div>",hasname:"has-name",title:"str",highlight:"<b>{{str}}</b>",highlight_else:"{{str}}",nameHighlightChunks:"{{highlight}}{{highlight_else}} ",highlight1:"<b>{{str}}</b>",highlight_else1:"{{str}}",emailHighlightChunks:"({{highlight1}}{{highlight_else1}})</em> ",hasMoreThanOneEmail:"{{str}} "};},"1.0.0");/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("querystring-parse",function(e,t){var n=e.namespace("QueryString"),r=function(t){return function r(i,s){var o,u,a,f,l;return arguments.length!==2?(i=i.split(t),r(n.unescape(i.shift()),n.unescape(i.join(t)))):(i=i.replace(/^\s+|\s+$/g,""),e.Lang.isString(s)&&(s=s.replace(/^\s+|\s+$/g,""),isNaN(s)||(u=+s,s===u.toString(10)&&(s=u))),o=/(.*)\[([^\]]*)\]$/.exec(i),o?(f=o[2],a=o[1],f?(l={},l[f]=s,r(a,l)):r(a,[s])):(l={},i&&(l[i]=s),l))}},i=function(t,n){return t?e.Lang.isArray(t)?t.concat(n):!e.Lang.isObject(t)||!e.Lang.isObject(n)?[t].concat(n):s(t,n):n},s=function(e,t){for(var n in t)n&&t.hasOwnProperty(n)&&(e[n]=i(e[n],t[n]));return e};n.parse=function(t,n,s){return e.Array.reduce(e.Array.map(t.split(n||"&"),r(s||"=")),{},i)},n.unescape=function(e){return decodeURIComponent(e.replace(/\+/g," "))}},"3.13.0",{requires:["yui-base","array-extras"]});
YUI.add("isXobnifiedCheck",function getIsXobnified(A){var F=A.common.Utils,I=F.parseQueryString(),J=NeoConfig.isCorpmail,C="withCredentials" in (new XMLHttpRequest()),L,D,K,H,G,B,E='"ready"';if(NeoConfig.isXobniOverride==="yes"){getIsXobnified.isXobnified=true;}else{if(NeoConfig.isXobniOverride==="no"){getIsXobnified.isXobnified=false;}}L=I.xServer;if(A.Lang.isUndefined(getIsXobnified.isXobnified)){G={};if(J){G.onboard="true";}if(!L){L=J?"dev1data":"proddata";}if(C){K="https://"+L+".xobni.yahoo.com/pachinko/v2/xobnified?";}else{D=(L==="dev1data")?"smartcontacts-dev1":"smartcontacts";K="/ws/comms/"+D+"/pachinko/v2/xobnified?";}H={on:{complete:function(M,N){if(N.status!==200){getIsXobnified.isXobnified=false;}else{getIsXobnified.isXobnified=(N.responseText===E);}A.fire("xobni:xobnifiedDetermined",getIsXobnified.isXobnified);}}};if(C){H.xdr={use:"native",credentials:true};}B=A.QueryString.stringify(G);A.io(K+B,H);}else{A.fire("xobni:xobnifiedDetermined",getIsXobnified.isXobnified);}A.namespace("xobniContacts").isXobnified=function(M){if(typeof M==="function"){if(getIsXobnified.isXobnified===undefined){A.once("xobni:xobnifiedDetermined",function(){M(getIsXobnified.isXobnified);});}else{M(getIsXobnified.isXobnified);}}return getIsXobnified.isXobnified;};},"1.0.0",{requires:["io-base","querystring","common-utils"]});YUI.add("xobni-contacts-search",function(B){var K=B.xobniContacts.searchAPI,C=B.common.Utils,T=C.substitute,A=C.parseQueryString(),E=B.ui.Templates,R,V,M="xobniContactSearch",I="aclist-separator",P="{contactId}",a=0,U=B.common.Utils.ymmastats,N;function S(){return M;}function c(j){var h=E._shared_module_xobni_contact_search_results_rollup,g=0,Y=j.length,e,d,k=[],f;f={nameHighlightChunks:function(i){var l=[];B.Array.forEach(i.nameHighlightChunks,function(m){m.str=C.escapeHtml(C.unescapeHtml(m.str));if(m.highlight){l.push(T(h.highlight,m));}else{l.push(T(h.highlight_else,m));}});return l.join("");},emailHighlightChunks:function(i){var l=[];B.Array.forEach(i.emailHighlightChunks,function(m){m.str=C.escapeHtml(C.unescapeHtml(m.str));if(m.highlight){l.push(T(h.highlight1,m));}else{l.push(T(h.highlight_else1,m));}});return l.join("");},hasMoreThanOneEmail:function(i){if(i.original&&B.Array.test(i.original.a_e)){var l=i.original.a_e.length;if(l>0){return T(strings.str_xobni_search_suggestion_email_and_more,{num:l});}}return false;},hasname:function(i){return i.name&&i.name.length?h.hasname:"";},title:function(l){var i=[l.email];if(l.original&&B.Array.test(l.original.a_e)){B.Array.each(l.original.a_e,function(m){i.push(m);});}return i.join("&#013;");}};for(g=0;g<Y;++g){e=j[g];d=T(h.base,e,f,null,strings,E);k.push(d);}return k;}function Z(){return I;}function J(Y){if(a++===Number.MAX_VALUE){a=1;}return"xobni-contact-search_"+Y+a;}function L(Y){B.fire("search:input",{query:{keyword:Y},displayQueryInSearchBar:false,prefilterRefinements:false,showDDWithSearchResults:true,searchRequestId:J(Y),addToRecentSearches:false});}function Q(k,h,g,j,f,Y){var i=B.mail.ui.EntitySearch.findExactMatch(g.name),d=i?i.id:g.id;if(B.Tictac.contactdetails){if(i){B.fire("searchSuggestion:start",{type:"entity",id:i.id});}else{B.fire("searchSuggestion:start",{type:"xContact",contactId:g.id});}}else{L(d);}U.stat("searchsuggestions_contact","index=>"+(f+1));Y("");}R={getType:S,render:c,activateIfFirstItem:false,getSeparatorClass:Z};V={getType:S,handleSelection:Q};function F(f,d){if(!f){return[];}var e=[],Y=0;B.Array.each(d,function(i){var h=i.s,g=i.l;if(h<Y){e.push({highlight:false,str:f.substring(Y,h-1)});Y=h;}else{if(h>Y){e.push({highlight:false,str:f.substring(Y,h)});Y=h;}}if(h===Y){e.push({highlight:true,str:f.substr(h,g)});Y=h+g;}});if(Y<=f.length-1){e.push({highlight:false,str:f.substr(Y)});}return e;}function G(d,f){var e=d.e||"",Y=d.f,g=(Y&&Y.email)||[];if(f){return F(e,g);}else{return e;}}function W(d,f){var e=d.n||"",Y=d.f,g=(Y&&Y.name)||[];if(f){return F(e,g);}else{return e;}}function D(Y,d){return B.Array.map(Y,function(e){var g=d.contactIdStrToReplace,f=d.imageUrlTmpl.replace(g,e.i);return{id:e.i,name:W(e,false),email:G(e,false),nameHighlightChunks:W(e,true),emailHighlightChunks:G(e,true),imageUrl:f,original:e};});}function H(f,d){var e,Y={};if(N&&f.length>0){U.stat("searchsuggestions_xobni_roundtrip","","milliseconds","duration",new Date().getTime()-N);}this._resetPendingIO();this._prevResultsLen=f.length;if(d){e=D(f,{imageUrlTmpl:this._imageUrlTmpl,contactIdStrToReplace:P});Y[M]=e;d(Y);}}function X(d){var Y={};this._resetPendingIO();if(d){Y[M]=[];d(Y);}}function O(Y){if(!Y){Y={};}this._pendingIO=null;this._prevQuery=null;this._prevResultsLen=undefined;this._limit=("limit" in Y)?Y.limit:5;this._useCors=Y.useCors||("withCredentials" in (new XMLHttpRequest()));this._protocol="https";this._host=A.xServer;if(!this._host){this._host=NeoConfig.isCorpmail?"dev1data":"proddata";}this._timeout=("timeout" in Y)?Y.timeout:5000;this._imageUrlTmpl=this._protocol+"://"+this._host+".xobni.yahoo.com/v4/contacts/"+P+"/photo?fallback_url="+encodeURIComponent("https://s1.yimg.com/dh/ap/social/profile/profile_a48.png");}O.prototype={fetch:function(d,Y){this._resetPendingIO();if(d&&d.length){if(this._prevResultsLen===0&&this._prevQuery&&this._prevQuery.length&&d.indexOf(this._prevQuery)===0){this._prevQuery=d;H.call(this,[],Y);}else{this._prevQuery=d;this._prevResultsLen=undefined;N=new Date().getTime();this._pendingIO=K.fetch({query:d,limit:this._limit,useCors:this._useCors,host:this._host,timeout:this._timeout,origin:"searchSuggestions"},B.rbind(H,this,Y),B.bind(X,this,Y));}}else{this._prevQuery="";H.call(this,[],Y);}return{abort:B.bind(this._resetPendingIO,this)};},_resetPendingIO:function(){if(this._pendingIO&&this._pendingIO.isInProgress()){this._pendingIO.abort();}this._pendingIO=null;}};function b(Y){return new O(Y);}B.namespace("mail.ui").XobniContactsSearch={getDataFetcher:b,getRenderer:function(){return R;},getSelectionHandler:function(){return V;},doPeopleSearch:function(Y,f){var d=this,e;B.xobniContacts.isXobnified(function(h){if(h){d.getDataFetcher().fetch(Y,function(j){if(j&&j.xobniContactSearch&&j.xobniContactSearch.length){if(B.mail.ui.EntitySearch&&B.mail.ui.EntitySearch.findExactMatch){e=B.mail.ui.EntitySearch.findExactMatch(j.xobniContactSearch[0].name);}if(e){B.fire("searchSuggestion:start",{type:"entity",id:e.id});}else{B.fire("searchSuggestion:start",{type:"xContact",contactId:j.xobniContactSearch[0].id});}}else{var i=B.contacts.utils.getContactsByEmail(Y);if(i&&i[0]&&i[0].id){B.fire("searchSuggestion:start",{type:"abContact",contactId:i[0].id,emailAddress:Y});}else{f();}}});}else{var g=B.contacts.utils.getContactsByEmail(Y);if(g&&g[0]&&g[0].id){B.fire("searchSuggestion:start",{type:"abContact",contactId:g[0].id,emailAddress:Y});}else{f();}}});}};},"1.0.0",{requires:["common-utils","xobni-contacts-search-api","ac-entity-search","contacts-api-utils","_shared_module_xobni_contact_search_results_rollup","ymma-stats","isXobnifiedCheck"]});YUI.add("mail-controller-conversations-ops",function(G){var N,e,j=G.mail,S=j.model.ConvStore,J=j.model.DataStore.Folders,a=S.Conversations,D=j.Controller,K=D.Folders,Z=G.common.Utils,X=G.Lang,M=G.common.Utils.log,g={passthru:{flag:"FlagThreads",move:"MoveThreads",remove:"DeleteThreads",folders:"ListFolders"},isdup:{FlagThreads:function(m,l){var k=m.setFlags,Y=l.setFlags;if(m.mid&&l.mid&&m.mid.length===1&&l.mid.length===1&&m.mid[0]===l.mid[0]&&k.read===Y.read&&k.flagged===Y.flagged){return true;}}}},Q,W,F="%40C%40Chats",h="Trash",L="%40B%40Bulk",R=8,c={"flagged":"isFlagged","read":"isRead"},P=strings.str_cfg_tog_set_spam_read_flag;g.batchable=g.passthru;Q=D.extend("Conversations",g);W=Q.Error;e=g.order;G.mix(Q,{moveConvs:d,flagConvs:H});function U(k,Y){return k&&(Y in k);}function T(n,r,m){var p=r.origParms,o,l,k,q=n.returnCodes;if(q&&q.length){for(o=0;o<q.length;o++){if(q[o].code!=="WARN"){m("failure");return Q._error(n,W.invalidcid);}}}else{if(!p.cids){K.refresh();}else{if(r.custom.isSparse&&U(p.setFlags,"read")){if(!r.noRefresh){K.refresh();}}}}function Y(t){var s=r.origParms.fid;for(o=0;o<t.folder.length;o++){if(t.folder[o].folderInfo.fid===s){l=t.folder[o];}}if((k=l)){j.model.DataStore.Folders.set(k,"ds:conv:",1);}}if(r.bulk){D.Conversations.folders({},function(s){Y(s);});}}function V(Y,k){k("failure");return Q._error({},W.invalidparams);}function O(n,k){var m,Y,l=n.setFlags;Y={};for(m in l){Y[c[m]]=l[m];}if(Y[c.spam]){Y[c.ham]=0;}if(Y[c.ham]){Y[c.spam]=0;}if(X.isUndefined(l.spam)&&k.reason!=="move"){a.update(n.fid,k.origParms.cids||[],{flags:Y},"conv_"+k.reason);}}function i(k){var Y=0,l=k.cids;if(!X.isArray(l)){l=(l?[l]:[]);}k.cids=[];for(;Y<l.length;Y++){k.cids[Y]=l[Y].cid||l[Y];}return Y||k.selection;}function b(v,y,o){var x,Y,k,w,z,q,u,n=0,s,m=v.cids,t,r=v.setFlags,p=[];if(Z.isEmpty(r)){return V(y,o);}if(!X.isArray(m)){m=(m)?[m]:[];}if((r.spam&&(v.fid!==L))||(r.ham&&(v.fid===L))||(r.sendercompromised&&(v.fid!==L))||(r.phished&&(v.fid!==L))||(r.notmymail)){k=1;}while((x=m[n++])){var l={isFlagged:r.flagged?x.totalFlagged===x.totalMsgs:x.totalFlagged!==0,isRead:r.read?x.totalUnread===0:x.totalUnread!==x.totalMsgs};if(!Z.isEmpty(l)){for(Y in r){if((l[c[Y]]!==r[Y])||k){p.push(x);break;}}}else{p.push(x);}}if(m.length&&!p.length){o("success");return;}if(!i(v)){return V(y,o);}if(!v.spam&&((u=r.notmymail)||(w=r.spam)||(z=r.sendercompromised)||(q=r.phished)||r.ham)){s=y.getBatch();t={sourceFid:v.fid,destinationFid:(w||z||q||u)?L:"Inbox",cids:m||y.origParms.cids,spam:1,enableRetry:v.enableRetry||false};y.noRefresh=1;if((w||z||q)&&!u&&P){r.read=1;}o(1,v);s.Conversations.move(t);}delete v.spam;}function I(l,Y){if(l&&(l.reason===W.invalidparams)){return;}var k=Y.parms;if("read" in k.setFlags){K.refresh();}else{a.flush(k.fid);}function m(r){var o,p,n,q=Y.origParms.fid;for(o=0;o<r.folder.length;o++){if(r.folder[o].folderInfo.fid===q){n=r.folder[o];}}if((p=n)){j.model.DataStore.Folders.set(p,"ds:conv:",1);}}if(Y.bulk){D.Conversations.folders({},function(n){m(n);});}}function f(o,v,n){var l,p,m,s,u=v.parms,k=v.reason,q=v.api,t=o.error;if(t){for(p=0;p<t.length;p++){if(t[p].code!=="WARN"){n("failure");return Q._error(o,W.invalidmid);}}}function Y(x){var w=u.sourceFid,r=u.destinationFid;for(p=0;p<x.folder.length;p++){if(x.folder[p].folderInfo.fid===w){m=x.folder[p];}if(x.folder[p].folderInfo.fid===r){s=x.folder[p];}}if((l=m)){j.model.DataStore.Folders.set(l,"ds:conv:",1);}if((l=s)){j.model.DataStore.Folders.set(l,"ds:conv:",1);}}if(q==="move"){a.move(u.sourceFid,u.destinationFid,u.cids,null,k);if(v.bulk){D.Conversations.folders({},function(r){Y(r);});}}}function C(o,q){var n=o.destinationFid&&o.destinationFid===L,Y,p=q.origParms,l=p.destinationFid,k=p.sourceFid,m=p.cids;if(n){Y={};if(l===L){Y[c.spam]=1;Y[c.ham]=0;}if(k===L&&l!==h){Y[c.ham]=1;Y[c.spam]=0;}}Q.addTAE46Hist(m,q.api,{src:o.sourceFid||0,dest:o.destinationFid||0,hasList:o.hasList?1:0});a.remove(o.sourceFid||o.fid,m,o.destinationFid);}function A(m,k,q){var Y,n,p=m.destinationFid,l=m.sourceFid,o={fid:l,cids:m.cid,spam:1};if(!m.spam){if(p===L){n=o.setFlags={spam:1};if(P){n.read=1;}}if(l===L&&p!==h){n=o.setFlags={ham:1};}}if(n){k.newApi("flag","FlagThreads",o);Y=k.getBatch();k.noRefresh=1;q("pre","flag");q(1,o);m.spam=1;m.bidiDetection=NeoConfig.bidi;Y.Conversations.move(m);Y.execute(k.cbk);}delete m.spam;if(!i(m)){return V(k,q);}}function E(k,Y,l){if((k.fid!==h)&&(k.fid!==L)&&(k.fid!==F)&&!k.force){k.sourceFid=k.fid;delete k.fid;k.destinationFid=h;Y.api=Y.reason="move";Y.method=g.passthru.move;l("pre","move");return k;}delete k.force;if(!i(k)){return V(Y,l);}}function B(k,Y){if(k&&(k.reason===W.invalidparams)){return;}if(Y.parms.sourceFid){j.model.DataStore.Messages.flush(0,1);a.flush();}K.refresh();function l(s){var n,m,r,p,q=Y.parms.sourceFid,o=Y.parms.destinationFid;for(n=0;n<s.folder.length;n++){if(s.folder[n].folderInfo.fid===q){m=s.folder[n];}if(s.folder[n].folderInfo.fid===o){r=s.folder[n];}}if((p=m)){j.model.DataStore.Folders.set(p,"ds:conv:",1);}if((p=r)){j.model.DataStore.Folders.set(p,"ds:conv:",1);}}if(Y.bulk){D.Conversations.folders({},function(m){l(m);});}}N={success:f,failure:B};Q.hook({move:N,remove:N,flag:{success:T,failure:I}});N={pre:C};Q.hook({move:N,remove:N},0,e.optimistic);Q.hook({move:{pre:A,aborted:B},remove:{pre:E,aborted:B},flag:{pre:b,aborted:I}},0,e.fixParms);Q.hook({flag:{pre:O}},0,e.optimistic);function d(Y,AA){var AB=[],w=0,v,AC,z,m,y=0,s=false,u={},r=[],q,p=0,x,t,k,l,o,n;x=(Y.fid!==h)&&(Y.fid!==L)&&(Y.fid!==F);var AD=function(AG,AE,AF){y--;if(AF==="failure"){s=true;}if(y===0){G.fire("convops:movecbk",AC.cids,s);if(s){AA.failure();}else{AA.success();}}};for(w=0;w<Y.cids.length;w++){z=x?Y.cids[w].snapshotTime:null;if(!z){z="no";}if(!(m=u[z])){u[z]=m=[];y++;}m.push(Y.cids[w]);}if(!NeoConfig.parallelRequests){y++;}n=function(AG,AE,AF){t=Y.sourceFid||Y.fid;for(w=0;w<AG.folder.length;w++){if(AG.folder[w].folderInfo.fid===t){k=AG.folder[w];}if(Y.destinationFid&&(AG.folder[w].folderInfo.fid===Y.destinationFid)){o=AG.folder[w];
}}if((l=k)){j.model.DataStore.Folders.set(l,"ds:conv:",1);}if((l=o)){j.model.DataStore.Folders.set(l,"ds:conv:",1);}AD(AF);};for(m in u){if((p%R)===0){q=D.batch();r.push(q);}if(Y.api==="remove"){AC={fid:Y.fid,cids:u[m]};if(m!=="no"){AC.snapshotTime=m;}AC.hasList=Y.hasList;AB.push(q.Conversations.remove(AC,AD));}else{AC={sourceFid:Y.sourceFid,destinationFid:Y.destinationFid,cids:u[m]};if(m!=="no"){AC.snapshotTime=m;}AC.hasList=Y.hasList;AB.push(q.Conversations.move(AC,AD));}p++;}M({m:"Preparing batch request in move operation",params:AC});if(!NeoConfig.parallelRequests){AB.push(q.Conversations.folders({},n));}for(v=0;v<r.length;v++){r[v].execute();}return{abort:function(){for(w=0;w<AB.length;w++){AB[w].abort();}}};}function H(Y,z){var p,k,s,l,AA=[],v=0,u,AB,y,m,r=false,x=0,q=[],o=0,t={},n,w;var AC=function(AD){x--;if(AD==="failure"){r=true;}if(x===0){if(r){z.failure();}else{z.success();}}};for(v=0;v<Y.cids.length;v++){y=Y.cids[v].snapshotTime;if(!y){y="no";}if(!(m=t[y])){t[y]=m=[];x++;}m.push(Y.cids[v]);}if(m!==null){n=G.Array.map(m,function(AD){return AD.cid;});G.fire("MailLog",{m:"About to mark "+n.join(",")+" conversation(s) as "+(Y.setFlags.read===1?"read":"unread")});}w=function(AG,AD,AE){var AF;x--;if(AE==="failure"){r=true;}if(x===0){if(r){G.fire("MailLog",{m:"Marking conversation(s) as "+(Y.setFlags.read===1?"read":"unread")+" failed"});z.failure();}else{if(AG&&AG.successThreads){AF=G.Array.map(AG.successThreads,function(AH){return AH&&AH.conversation&&AH.conversation.cid?AH.conversation.cid:"";});}if(AF&&AF.join&&Y.setFlags&&Y.setFlags.read){G.fire("MailLog",{m:"Conversation(s) "+AF.join(",")+" marked as "+(Y.setFlags.read===1?"read":"unread")+" successfully"});}z.success();}}};for(m in t){if((o%R)===0){p=D.batch();q.push(p);}AB={fid:Y.fid,cids:t[m],setFlags:Y.setFlags};if(m!=="no"){AB.snapshotTime=m;}if(Y.selection){AB.selection=Y.selection;}AA.push(p.Conversations.flag(AB,w));o++;}AA.push(p.Conversations.folders({},function(AF,AD,AE){s=Y.sourceFid||Y.fid;for(v=0;v<AF.folder.length;v++){if(AF.folder[v].folderInfo.fid===s){k=AF.folder[v];}}if((l=k)){j.model.DataStore.Folders.set(l,"ds:conv:",1);}AC(AE);}));for(u=0;u<q.length;u++){q[u].execute();}return{abort:function(){for(v=0;v<AA.length;v++){AA[v].abort();}}};}},"3.0.0",{requires:["rocket-stats","mail-controller-base","mail-model-convstore","json-stringify","array-extras"]});YUI.add("mail-ui-convevents",function(D){var A=D.mail.Controller.Conversations,B=D.common.ui;var C=function(E){var F=this;F.KEY="cid";C.superclass.constructor.call(F,E);};D.extend(C,D.mail.ui.MailEvents,{fromSearch:function(G,F){var E;if(F==="Sent"||F==="Draft"){E=G.msgs[0].toEmail;if(NeoConfig.searchSuggestions){D.mail.ui.XobniContactsSearch.doPeopleSearch(E,function(){D.fire("fireSearch",'to:"'+E+'"');});}else{D.fire("fireSearch",'to:"'+E+'"');}}else{E=G.recipients[0].email;if(NeoConfig.searchSuggestions){D.mail.ui.XobniContactsSearch.doPeopleSearch(E,function(){D.fire("fireSearch",'from:"'+E+'"');});}else{D.fire("fireSearch",'from:"'+E+'"');}}},remove:function(H,F,E){var I=this,G={api:"remove",fid:H,destinationFid:(H!=="Trash")?"Trash":"",cids:F,hasList:E.hasMsgList};if(!E.hasMsgList&&(F[0].totalDraft||E.hasCompose)){I.confirmRemoveDrafts(function(){A.moveConvs(G,I.createBulkOpCallback(E));});}else{return A.moveConvs(G,I.createBulkOpCallback(E));}},move:function(K,F,I,E){var L=this,G,J={sourceFid:K,destinationFid:F,cids:I,hasList:E.hasMsgList},H=false;E.totalMsgs=(I)?I.length:0;H=L.shouldShowProgressDialog({op:"move"},I.length);if(H){G="move";}else{G="moveConvs";}if(F==="Trash"&&!E.hasMsgList&&(I[0].totalDraft||E.hasCompose)){L.confirmRemoveDrafts(function(){A[G](J,L.createBulkOpCallback(E));});}else{return A[G](J,L.createBulkOpCallback(E));}},flag:function(K,H,J,E){var L=this,I,G,F=false;E.totalMsgs=(H)?H.length:0;I={fid:K,cids:H,setFlags:J};G=E.selection;if(G){I.selection=G;}F=L.shouldShowProgressDialog({op:"flag"},H.length);if(F){return A.flag(I,L.createBulkOpCallback(E));}else{return A.flagConvs(I,L.createBulkOpCallback(E));}},spamAct:function(H,F,G,E){var I=this;G.spam=1;I.flag(H,F,G,E);},showNotification:function(E){var F=this;if(E&&E.action){switch(E.action){case"phished":case"sendercompromised":case"spam":case"notmymail":F.showSpamNotification();break;default:break;}}},getAllHandleCallback:function(G,J){var K=this,E=K.getDataActionInfo(G.action),F=G.numMid||0,H;if(F===0){return;}function I(L){var N=[],O=L.conversations,M;for(M=0;M<O.length;M++){N.push({cid:O[M].conversation.cid,msgs:O[M].conversation.messageInfo});}return N;}if(K.shouldShowProgressDialog(E,F)){H={numCInfos:F,fid:J,groupBy:"unRead",sortKey:"date"};G.filterBy&&D.mix(H,G.filterBy);D.mix(G,{dlgHandle:null,header:E.name});K.createProgressDialog(G,function(){var N=F,M=[],O=399,L;L=(G.filterBy&&(G.filterBy["filterBy-isRead"]==0));function P(){if(N===0){K.handle(G,M,J);return;}if(N>O){H.numCInfos=O;N=N-O;}else{H.numCInfos=N;N=0;}if(M.length>0){H.start=M.length;}A.list(H,{success:function(S){var U,R,Q,T;M=M.concat(I(S));N=S.folder.totalConversations-M.length;if(L&&S.conversations){U=S.conversations[S.conversations.length-1];R=1;Q=U.conversation.messageInfo;for(T=0;T<Q.length;T++){if(Q[T].flags.isRead===0){R=0;}}N=(R)?0:(S.folder.totalConversations-M.length);}P();}});}P();});}else{H={numCInfos:F,fid:J,groupBy:"unRead",sortKey:"date"};A.list(H,{success:function(L){K.handle(G,I(L),J);}});}if(G.afterHandle){G.afterHandle();}},print:function(J,I,E){var H=J.msgs,F=H&&H[E?0:H.length-1],G;G=F.fid==="Draft"||(F.sourceFolderInfo&&F.sourceFolderInfo.fid==="Draft");if(G){F=H&&H[E?1:H.length-2];}F&&D.use("mail-ui-print",function(){D.mail.ui.print({fid:I,msg:F});});},quickFilter:function(){},addContact:function(){},send:function(){},getBulkOperations:function(E){return E&&A.bulkOps[E];},handleOpenDraft:function(){},handleAction:function(M,K,G,F){var H=M.action,E,N=K&&K[0]&&K[0].msgs,I=K&&K[0]&&K[0].midMap,J=N&&N[F?0:N.length-1],L;switch(H){case"edit":case"open":if(F&&F.sortedColumn&&(L=F._listview)&&L.arrItems){D.fire("openConv",{msg:K[0],fid:G,noScroll:M.tbAction,sortCol:F.sortedColumn,arrMsgSeq:L.arrItems,index:(L.rootSelect&&L.rootSelect.index)||null});}else{D.fire("openConv",{msg:K[0],fid:G,noScroll:M.tbAction});}break;case"forward_as_attachment":M.action="forward";M.forwardAsAttachment=true;case"forward":case"reply_sender":case"reply_all":E=J.fid==="Draft"||(J.sourceFolderInfo&&J.sourceFolderInfo.fid==="Draft");if(N&&N.length===1&&E){M.action="edit";D.fire("editMessage",D.mix(M,{fid:J.fid||J.sourceFolderInfo.fid,oMsg:J,enableRetry:false,noScroll:M.tbAction}));}else{if(E){J=N&&N[F?1:N.length-2];}D.fire("newConvMessage",D.mix(M,{fid:G,oMsg:J}));}break;case"fullheader":this.fullHeader(M,I);break;}},fullHeader:function(G,K){var J,L,I=0,F=false,H=D.mail.Controller.Messages,E=D.common.Utils.escapeHtml;if(!G.contextmenuTarget||!K){return;}L=G.contextmenuTarget.ancestor(".list-view-item");J=G.contextmenuTarget.ancestor(".list-view-item-subcontainer");if(!J){return;}J.get("children").each(function(M){if(M.getDOMNode()===L.getDOMNode()){F=K[I];}I+=1;});if(!F){return;}D.use("common-ui-dialog-helper",function(){H.fullHeader({fid:F.fid,mid:F.mid},{success:function(M){B.DialogHelper.alert({modal_classes:"lg",hd:strings.str_modal_full_header,bd:['<textarea readonly="true" style="width:100%;height:25em;" class="default">',M?E(M.rawheaders[0]):strings.str_error_no_body_returned,"</textarea>"].join(""),focusedNode:".default"});},failure:function(){B.DialogHelper.alert({hd:strings.str_modal_full_header,bd:strings.str_error_no_body_returned});}});});},redirectMessages:function(E){D.use("common-ui-dialog-helper",function(){B.DialogHelper.confirm({hd:"Redirect messages",bd:'Redirect to: &nbsp; <input id="redirectMsg" class="field-name " type="text" size="30" value="buggy_messages@yahoo.com" name="redirectMsg">'},{ok:{handler:function(G,F){E();F.destroy();},stopDestroy:true}});});},confirmRemoveDrafts:function(E){D.use("common-ui-dialog-helper",function(){B.DialogHelper.confirm({hd:strings.str_delete_conv_confirm_hdr,bd:strings.str_delete_conv_confirm_bd},{ok:{handler:function(G,F){E();F.destroy();},text:strings.str_delete}});});}});D.mail.ui.ConvEvents=new C();},"1.0.0",{requires:["mail-controller-conversations","contacts-api-utils","xobni-contacts-search","mail-controller-conversations-ops","mail-model-convstore","mail-ui-mailevents"]});YUI.add("mail-ui-proxyevents",function(E){var B=function(G){var H=this;B.superclass.constructor.call(H,G);};var D=function(H,G){var I=E.Lang.isArray(H[G])?H[G][0]:H[G];return I.mid?true:false;};var C=function(I,H,L){var K=E.Lang.isArray(I[H])?I[H][0]:I[H],G={"move":true,"flag":true,"spamAct":true,"remove":true,"fromSearch":true},J=K.totalMsgs;if(!J){return false;}if(J===1){return(G[L]||(NeoConfig.convReplyBtnsInTlbr&&(I[0].action==="reply_all"||I[0].action==="reply_sender"||I[0].action==="forward")))?true:false;}return true;};var F=function(J){var K,I,L,O,G,N,M,H=E.Lang.isArray(J)?J:[J];if(H.length==1){O=H[0];if(O.msgs&&(O.msgs.length==O.totalMsgs)){for(I=0;I<O.msgs.length;I++){G=O.msgs[I];N=G.fid||G.sourceFolderInfo&&G.sourceFolderInfo.fid||G.folderInfo&&G.folderInfo.fid||O.fid;if(N===O.fid){M=M||[];M.push(G);}}}}return M;};var A=function(I,G,H,J){return function(){var L=arguments,M,N,Q=E.Lang.isArray(L[G])?L[G][0]:L[G],K=C(L,G,I),O;if(!K&&Q&&!Q.msgs&&!Q.mid){return;}M=(D(L,G)||!K);O=M?E.mail.ui.MessageEvents:E.mail.ui.ConvEvents;if(!K){var R=(L[G] instanceof Array)?L[G][0]:L[G];if(R.msgs){var P=[];P[0]=R.msgs[0];P[0].from=R.recipients[0];L[G]=(L[G] instanceof Array)?P:P[0];}}else{if(!M&&J){N=J(L[G]);if(N&&N.length>0){L[G]=N;L[H].fromConv=true;O=E.mail.ui.MessageEvents;}}}return O[I].apply(O,L);};};E.extend(B,E.mail.ui.MailEvents,{remove:A("remove",1),move:A("move",2),flag:A("flag",1),spamAct:A("spamAct",1,3,F),print:A("print",0),quickFilter:A("quickFilter",0),addContact:A("addContact",0),send:A("send",1),handleAction:A("handleAction",1),fromSearch:A("fromSearch",0),handleOpenDraft:function(){},getBulkOperations:function(H,G){var J=G&&G.get("selectionType");var I=(J==="main")?E.Mail.ui.ConvEvents:(J==="sub")?E.Mail.ui.ConvEvents:null;return I&&I.getBulkOperations.apply(I,arguments);},getAllHandleCallback:function(){return E.mail.ui.MessageEvents.getAllHandleCallback.apply(E.mail.ui.MessageEvents,arguments);}});E.mail.ui.MailEventsProxy=new B();},"1.0.0",{requires:["mail-ui-mailevents","mail-ui-messageevents","mail-ui-convevents"]});