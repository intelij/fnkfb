YUI.add("mail-ui-mb-rightrail-controller",function(B){var C,E=B.common.Utils,J="5413663";C=function(M){this.body=B.Node.one("body");this.rootNode=(M&&M.rootNode)||B.Node.one("#theAd");this.mbRightRailSlot=B.one("#slot_mbRightRail");};C.prototype={init:function L(M){this.darlaAPI=M;if(this.isMoneyballEnabled()){this._bindUI();this._initMbView();}},isMoneyballEnabled:function(){return((NeoConfig.mbPencil>0)&&NeoConfig.enableMoneyball&&!NeoConfig.isMailPlus&&NeoConfig.hasAds&&(NeoConfig.mbOpt||!(NeoConfig.mbPencilList&&!NeoConfig.moneyball.click_url))&&(!NeoConfig.partnerType||NeoConfig.partnerType==="pg"||NeoConfig.partnerType==="ycorp")&&NeoConfig.intl==="us"&&NeoConfig.lang==="en-US");},_hideMBRightRail:function F(){!this.mbRightRailSlot.hasClass("hidden")&&this.mbRightRailSlot.addClass("hidden");},_showMBRightRail:function K(){var M=this;setTimeout(function(){M.mbRightRailSlot.hasClass("hidden")&&M.mbRightRailSlot.removeClass("hidden");},300);},_bindUI:function(){B.on("darla:blankAdLoaded",function(){var N=this.darlaAPI.getEligibleRightRailAdPos(),O="#slot_"+N,M;this.darlaAPI.setElementDisplay(O,false);switch(N){case"MON":M=5;break;case"LREC":M=2;break;case"SKY":M=3;break;}this.fetchAndRenderAd(M);},this);B.on("adReturned:MON",function(){this.darlaAPI.setElementDisplay("#slot_MON",true);this.destroyAd();},this);B.on("adReturned:LREC",function(){this.darlaAPI.setElementDisplay("#slot_LREC",true);this.destroyAd();},this);B.on("adReturned:SKY",function(){this.darlaAPI.setElementDisplay("#slot_SKY",true);this.destroyAd();},this);},fetchAndRenderAd:function G(M){this.mbRequest=new B.mail.ui.mbRequest();this.mbRequest.execute(this.renderAd,this,J,{"numAds":M});},parseResponse:function H(T){var R=[],P,N,M,Q;if(T&&T.ads){for(var O in T.ads){P=T.ads[O];if(P&&P.tag){try{M=B.JSON.parse(P.tag);if(M.image){Q=B.Lang.trim(M.image).replace(/^http:\/\/l\d?\./,"https://s.")||"";}if(P.beacon){N=P.beacon.replace("$(AD_POSN)",J);}R.push({ad_headline:M.headline,ad_summary:M.summary,ad_img:Q,ad_source:M.source,image_width:M.imageWidth,image_height:M.imageHeight,click_url:M.clickUrl,landing_url:M.landingUrl,creative_id:P.creativeId,beacon:N,ri:P.ri});}catch(S){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-moneyball-mbRightRailController:1",S,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-moneyball-mbRightRailController:1");}}if(!P||!P.tag){E.rocketstats.stat("mb","rightrail_response_malformed");}}}return R;},renderAd:function I(N){var M=this.parseResponse(N),O=this;if(M){this.mbView.set("mbRightRailResponse",M);if(this.mbView){setTimeout(function(){O.mbView.renderRightRailAd();},400);}else{this._initMbView();}}},_initMbView:function A(){this.mbView=new B.mail.ui.mbView({rootNode:this.rootNode,adType:18});this.mbView.set("eventSource","mbRightRailAd");},destroyAd:function D(){this.mbRightRailSlot.setHTML("");}};B.augment(C,B.EventTarget);B.augment(C,B.Attribute);B.namespace("mail.ui");B.mail.ui.mbRightRailController=C;},"1.0.0",{requires:["mail-ui-mb-model","mail-ui-mb-view","rocket-stats","common-utils"]});