YUI.add("messenger-constants",function(E){"use strict";E.namespace("Messenger.Common").Constants={STATE:{INVISIBLE:-1,AVAILABLE:0,BUSY:2,NOTATHOME:3,NOTATDESK:4,NOTINOFFICE:5,ONPHONE:6,ONVACATION:7,OUTTOLUNCH:8,STEPPEDOUT:9,AWAY:10,CUSTOM:99,IDLE:999,PENDING:9998,OFFLINE:9999},DEFAULT_IMAGE:"http://mail.yimg.com/ok/u/assets/img/display-img/profile_{{pixels|32|48}}e.png",DEFAULT_IMAGE_SSL:"https://s.yimg.com/ok/u/assets/img/display-img/profile_{{pixels|32|48}}e.png",EVENTS:{OFFLINE:"offline",FATAL_IO_ERROR:"fatal_io_err",NETWORK_ERROR_RESOLVED:"io_ok",TEMP_NETWORK_ERROR:"temp_io_err",SESSION_EXPIRED:"session_expired",MESSAGE:"new_message",AB_PARSING_COMPLETE:"ab_parsing_complete",ADD_REJECTED:"add_req_rejected",ADD_ACCEPTED:"add_req_accepted",ADD_REQUEST_RECEIVED:"add_req",ADD_REQUEST_SENT:"add_sent",ACK_RECEIVED:"ack_received",LOGOUT_LOCAL:"local_logout",DISPLAYNAME_UPDATED:"name_updated",SEND_ERROR:"send_error",CONTACTS_UPDATED:"yim:contactsupdated",SHOW_OPTIONS:"show_options",SMS_ERROR:"sms_error",CONVERSATION_INIT:"conversation_init",CL_COLLAPSE_TOGGLE:"cl_collapse_toggle"},SMS:{RATIO_BREACHED:19,INVALID_NUMBER:22},NOTIFICATION_INLINE:0,NOTIFICATION_STATICTOP:1,NOTIFICATION_INLINE_PLAINTEXT:2,NOTIFICATION_INLINE_TOP:3,NOTIFICATION_SECTION:4,NOTIFICATION_SECTION_TOP:5}},"@VERSION@",{requires:[]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("intl",function(e,t){var n={},r="yuiRootLang",i="yuiActiveLang",s=[];e.mix(e.namespace("Intl"),{_mod:function(e){return n[e]||(n[e]={}),n[e]},setLang:function(e,t){var n=this._mod(e),s=n[i],o=!!n[t];return o&&t!==s&&(n[i]=t,this.fire("intl:langChange",{module:e,prevVal:s,newVal:t===r?"":t})),o},getLang:function(e){var t=this._mod(e)[i];return t===r?"":t},add:function(e,t,n){t=t||r,this._mod(e)[t]=n,this.setLang(e,t)},get:function(t,n,r){var s=this._mod(t),o;return r=r||s[i],o=s[r]||{},n?o[n]:e.merge(o)},getAvailableLangs:function(t){var n=e.Env._loader,r=n&&n.moduleInfo[t],i=r&&r.lang;return i?i.concat():s}}),e.augment(e.Intl,e.EventTarget),e.Intl.publish("intl:langChange",{emitFacade:!0})},"3.13.0",{requires:["intl-base","event-custom"]});
YUI.add("xframe",function(e){"use strict";if(!window.JSON){window.JSON=e.JSON}if(!Function.prototype.bind){Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e,arguments)}}}function t(e){this._init(e)}t.prototype={_init:function(t){this.isProxy=t.isProxy;this.logoutURL=null;this.timeoutDelay=5e3;this._boundReceive=this._receive.bind(this);if(window.addEventListener){window.addEventListener("message",this._boundReceive,false)}else{window.attachEvent("onmessage",this._boundReceive)}this._listeners=[];this._parseTimers=[];this._key=this._genKey();if(!this.isProxy){this._localId="msg_"+(new Date).getTime();this._connected=false;this._cbid=0;this._cbs=[];this._sendQueue=[];if(!t.proxy||!t.yuiPath||!t.xframePath){throw new Error("XFrame connect called without required parameters:  proxy, yuiPath, xframePath")}this._url=t.proxy+"#"+this._key+"*"+(window.__mimStartTime?window.__mimStartTime:"")+"*"+t.localDomain+"*"+this._localId+"*y="+t.yuiPath+"*xframePath="+t.xframePath;this._createProxy();this._remoteDomain=t.proxy}else{e.namespace("Messenger").logPerf=function(e,t){var i,r;if(window.console&&window.__mimStartTime){i=e;r=(new Date).getTime();if(t){t+="-proxy";i+=" ~ "+t}if(window.console){console["log"](i+" +"+(r-window.__mimStartTime))}}};var i=window.location.href.split("#")[1].split("*");this._remoteKey=i[0];this._remoteDomain=i[2];this._pendingRequests={};if(!this._domainCheck(this._remoteDomain)){throw new Error("Invalid source domain, xframe connection disallowed - "+i[2])}window.__mimStartTime=i[1];e.Messenger.logPerf("Proxy xframe loaded, generating and sending the key","xframe");this._remoteWindow=window.parent;this._send(JSON.stringify({token:this._key,key:this._remoteKey}))}},destroy:function(){while(this._listeners.length){this._listeners.pop().detach()}if(this.iframe){this.iframe.parentNode.removeChild(this.iframe);delete this.iframe}while(this._parseTimers.length){clearTimeout(this._parseTimers.pop())}this._removeWindowEvents();this._connected=false;this._destroyed=true},_removeWindowEvents:function(){if(window.removeEventListener){window.removeEventListener("message",this._boundReceive,false)}else{window.detachEvent("onmessage",this._boundReceive)}},_genKey:function(){return"main_"+Math.floor(1e18*Math.random()).toString(36)},_createProxy:function(){var t,i,r=this._url,s,n,o=this;this._proxyRetries=this._proxyRetries||0;if(this._proxyRetries===1){this._removeUrlParameters(r)}else if(this._proxyRetries>4){this._initFailure();return}e.Messenger.logPerf("Injecting an invisible iframe proxy","xframe");t=document.createElement("div");n='<iframe style="visibility:hidden;position:absolute;'+'border:none;height:0px;width:0px;left:-9999px;"></iframe>';t.innerHTML=n;i=t.firstChild;if(i.addEventListener){i.addEventListener("load",o._iframeLoadComplete.bind(o),false);i.addEventListener("error",o._iframeLoadError.bind(o),false)}else{i.attachEvent("onload",o._iframeLoadComplete.bind(o));i.attachEvent("onerror",o._iframeLoadError.bind(o))}i.src=r;o._appendIframeToBody(i);if(!this.iframe_onloadfired_timeout){s=3e3+this._proxyRetries*1e3;this.iframe_onloadfired_timeout=setTimeout(function(){if(!this._destroyed&&!this._iframe_loaded){this.iframe_onloadfired_timeout=null;this._retryCreateProxy()}}.bind(this),s)}this.iframe=i},_iframeLoadComplete:function(){var t=this;e.Messenger.logPerf("iFrame onload event fired","xframe");if(this.iframe_onloadfired_timeout){clearTimeout(this.iframe_onloadfired_timeout);this.iframe_onloadfired_timeout=null;this._iframe_loaded=true}this._remoteWindow=this.iframe.contentWindow;if(!this._connected&&!this._destroyed){this.iframe_load_timeout=setTimeout(function(){t._retryCreateProxy()},this.timeoutDelay)}},_iframeLoadError:function(){if(!this._connected&&!this._destroyed&&!this._iframe_loaded){this._retryCreateProxy()}},_appendIframeToBody:function(e){document.body.appendChild(e)},_removeUrlParameters:function(e){var t,i;t=e.indexOf("?");i=e.indexOf("#");if(t>-1&&t<i){e=e.split(e.substring(t,i)).join("");this._src=e}},_retryCreateProxy:function(){if(!this._destroyed&&!this._connected){if(this.iframe){this.iframe.parentNode.removeChild(this.iframe);delete this.iframe}this._proxyRetries++;this._createProxy()}},send:function(t){var i=t.method,r=t.url,s=t.body,n=t.callback,o=t.timeout,a=++this._cbid,d;if(this._fatalError){this._xframeInitializationError(n);return}d=JSON.stringify({cbid:a,method:i,url:r,body:s,key:this._remoteKey,timeout:o});this._cbs[a]=n;if(!this._connected){e.Messenger.logPerf("Proxy not available, adding to queue","xframe");this._sendQueue.push({data:t,callback:n})}else{return this._send(d)}},_send:function(t){var i=this;if(!this._remoteWindow){setTimeout(function(){i._send(t)},0);return}try{e.Messenger.logPerf("Sending postMessage to remote window","xframe");t=t.replace(/\|/g,"__PIPE__");this._remoteWindow.postMessage(t,this._remoteDomain)}catch(r){if(!this._pmRetry){this._pmRetry=true;setTimeout(function(){i._send(t)},100)}else{this._initFailure()}return}this._pmRetry=false},ajax:function(t,i,r,s,n){if(!t||!i){return}var o,a=e.guid("xframereq_"),d=false,h=this;o=this._createXHR();o.open(t,i,true);o.setRequestHeader("Content-Type","application/json;charset=utf-8");o.setRequestHeader("X-Yahoo-Msgr-User-Agent","YahooMessenger/1.0 (Mail Messenger;1.0.0.0)");this._pendingRequests[a]={};this._pendingRequests[a].request=o;o.onreadystatechange=function(){try{d=h._ajaxResponseProcessCallback(o,s)}catch(e){try{h._xframeInternalError(s)}catch(t){}}h._ajaxCleanStep(d,o,a)};this._pendingRequests[a].timer=setTimeout(function(){h._ajaxTimeoutRequestProcess(o,a,s)},n||18e5);o.send(r||"")},_ajaxResponseProcessCallback:function(t,i){var r=false,s,n;if(t.readyState===4&&!r){e.Messenger.logPerf("AJAX response received","xframe");r=true;s="{}";n="status unavailable";try{n=t.statusText}catch(o){}if(t.status>=200&&t.status<210){s=t.responseText}else if(t.status===0||t.status>1e3){s=JSON.stringify({error:{code:800,detail:"Network error"},httpStatus:t.status,responseText:t.responseText||""})}else{s=JSON.stringify({error:{},httpStatus:t.status,detail:n,responseText:t.responseText||""})}i(s)}return r},_ajaxTimeoutRequestProcess:function(e,t,i){if(e){e.onreadystatechange=null;try{e.abort()}catch(r){}e.abort=null;e=null}if(this._pendingRequests[t]){delete this._pendingRequests[t]}i({error:{code:700,detail:"Client Side Timeout"}})},_ajaxCleanStep:function(e,t,i){if(e){clearTimeout(this._pendingRequests[i].timer);delete this._pendingRequests[i];t.onreadystatechange=null;t.abort=null;t=null}},_receive:function(t){if(t._event&&!t.data){t.data=t._event.data;t.source=t._event.source}e.Messenger.logPerf("postMessage Data received","xframe");var i={},r=t.origin;if(typeof t.data==="string"){i=e.Lang.trimLeft(t.data)}else{return}if(!i.length||i.charAt(0)!=="{"&&i.charAt(0)!=="["){return}i=i.replace(/__PIPE__/g,"|");try{i=JSON.parse(i)}catch(s){i={}}if(this._destroyed||!i||i.key!==this._key){return}if(this.isProxy){this._receiveProxy(i)}else{if(i.token){e.Messenger.logPerf("Initial xframe token handshake completed");if(this.iframe_load_timeout){clearTimeout(this.iframe_load_timeout);this.iframe_load_timeout=null}this._remoteKey=i.token;if(!this._domainCheck(r)){throw new Error("Invalid domain error - "+r)}this._connected=true;while(this._sendQueue.length){var n=this._sendQueue.shift();this.send(n.data)}}else if(this._connected){var o=this._cbs[i.cbid],a=i.text;delete this._cbs[i.cbid];try{o(a)}catch(d){}}else{throw new Error("Received a response in xframe before the handshake completed - "+i)}}},_receiveProxy:function(t){var i=this;if(!e.Lang.isUndefined(t.logoutURL)){this.setLogoutURL(t.logoutURL)}else if(t.command&&t.command==="cancelRequests"){this._cancelRequests()}else{this.ajax(t.method,t.url,t.body,function(e){var r=JSON.stringify({cbid:t.cbid,text:e,key:i._remoteKey});i._parseTimers.push(setTimeout(function(){if(!i._destroyed){i._send(r)}},0))},t.timeout)}},_domainCheck:function(e){var t=this._parseURI(e),i=t.host,r=[".yahoo.com"];while(r.length){var s=r.shift();if(i.substr(i.length-s.length)===s){this.otherDomain=t.protocol+"://"+t.host;return true}}return false},_parseURI:function(e){var t=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],r=/(?:^|&)([^&=]*)=?([^&]*)/g,s=t.exec(e),n={queryKey:{}},o=i.length;while(o--){n[i[o]]=s[o]||""}n.query.replace(r,function(e,t,i){if(t){n.queryKey[t]=i}});return n},cancelRequests:function(){if(!this._destroyed&&this._connected){var e=JSON.stringify({command:"cancelRequests",key:this._remoteKey});this._remoteWindow.postMessage(e,this._remoteDomain)}},_cancelRequests:function(){var e,t;for(e in this._pendingRequests){if(this._pendingRequests.hasOwnProperty(e)){t=this._pendingRequests[e];try{t.request.abort()}catch(i){}if(t.timer){clearTimeout(t.timer)}}}this._pendingRequests={}},sendLogoutURL:function(e){if(!this._destroyed){var t=this;if(!this._connected){setTimeout(function(){t.sendLogoutURL(e)},100);return}var i=JSON.stringify({logoutURL:e,key:this._remoteKey});this._remoteWindow.postMessage(i,this._remoteDomain)}},setLogoutURL:function(e){if(e&&e!==""){this._registerUnloadHandler()}this.logoutURL=e},_registerUnloadHandler:function(){if(!this._unloadHandler){if(window.addEventListener){window.addEventListener("unload",this._logoutOnUnload.bind(this),false)}else{window.attachEvent("onunload",this._logoutOnUnload.bind(this))}this._unloadHandler=true}},_initFailure:function(){while(this._sendQueue.length){var e=this._sendQueue.shift();this._xframeInitializationError(e.callback)}this._fatalError=true},_logoutOnUnload:function(){var t=this.logoutURL,i;if(t){i=this._createXHR();if(!i){return}i.open("get",t,e.UA.gecko?true:false);i.setRequestHeader("X-Yahoo-Msgr-User-Agent","YahooMessenger/1.0 (WC Messenger; 1.0.0.0)");try{i.send(null)}catch(r){}setTimeout(function(){i.abort()},3e3)}},_createXHR:function(){var e;if(typeof XMLHttpRequest!=="undefined"){e=new XMLHttpRequest}else if(window.ActiveXObject){e=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")}()}else{throw new Error("This browser does not support XMLHttpRequest.")}return e},_xframeInternalError:function(e){e(JSON.stringify({error:{code:600,detail:"internal XFrame error"}}))},_xframeInitializationError:function(e){e({error:{code:701,detail:"XFrame initialization error"}})}};e.namespace("Messenger").Xframe=t},"1.0.0",{requires:[]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("lang/datatype-date-format_en-GB",function(e){e.Intl.add("datatype-date-format","en-GB",{a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],c:"%a, %b %d, %Y %H:%M:%S %Z",p:["AM","PM"],P:["am","pm"],x:"%d/%m/%Y",X:"%H:%M:%S"})},"3.13.0");
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("datatype-date-format",function(e,t){var n=function(e,t,n){typeof n=="undefined"&&(n=10),t+="";for(;parseInt(e,10)<n&&n>1;n/=10)e=t+e;return e.toString()},r={formats:{a:function(e,t){return t.a[e.getDay()]},A:function(e,t){return t.A[e.getDay()]},b:function(e,t){return t.b[e.getMonth()]},B:function(e,t){return t.B[e.getMonth()]},C:function(e){return n(parseInt(e.getFullYear()/100,10),0)},d:["getDate","0"],e:["getDate"," "],g:function(e){return n(parseInt(r.formats.G(e)%100,10),0)},G:function(e){var t=e.getFullYear(),n=parseInt(r.formats.V(e),10),i=parseInt(r.formats.W(e),10);return i>n?t++:i===0&&n>=52&&t--,t},H:["getHours","0"],I:function(e){var t=e.getHours()%12;return n(t===0?12:t,0)},j:function(e){var t=new Date(""+e.getFullYear()+"/1/1 GMT"),r=new Date(""+e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" GMT"),i=r-t,s=parseInt(i/6e4/60/24,10)+1;return n(s,0,100)},k:["getHours"," "],l:function(e){var t=e.getHours()%12;return n(t===0?12:t," ")},m:function(e){return n(e.getMonth()+1,0)},M:["getMinutes","0"],p:function(e,t){return t.p[e.getHours()>=12?1:0]},P:function(e,t){return t.P[e.getHours()>=12?1:0]},s:function(e,t){return parseInt(e.getTime()/1e3,10)},S:["getSeconds","0"],u:function(e){var t=e.getDay();return t===0?7:t},U:function(e){var t=parseInt(r.formats.j(e),10),i=6-e.getDay(),s=parseInt((t+i)/7,10);return n(s,0)},V:function(e){var t=parseInt(r.formats.W(e),10),i=(new Date(""+e.getFullYear()+"/1/1")).getDay(),s=t+(i>4||i<=1?0:1);return s===53&&(new Date(""+e.getFullYear()+"/12/31")).getDay()<4?s=1:s===0&&(s=r.formats.V(new Date(""+(e.getFullYear()-1)+"/12/31"))),n(s,0)},w:"getDay",W:function(e){var t=parseInt(r.formats.j(e),10),i=7-r.formats.u(e),s=parseInt((t+i)/7,10);return n(s,0,10)},y:function(e){return n(e.getFullYear()%100,0)},Y:"getFullYear",z:function(e){var t=e.getTimezoneOffset(),r=n(parseInt(Math.abs(t/60),10),0),i=n(Math.abs(t%60),0);return(t>0?"-":"+")+r+i},Z:function(e){var t=e.toString().replace(/^.*:\d\d( GMT[+-]\d+)? \(?([A-Za-z ]+)\)?\d*$/,"$2").replace(/[a-z ]/g,"");return t.length>4&&(t=r.formats.z(e)),t},"%":function(e){return"%"}},aggregates:{c:"locale",D:"%m/%d/%y",F:"%Y-%m-%d",h:"%b",n:"\n",r:"%I:%M:%S %p",R:"%H:%M",t:"	",T:"%H:%M:%S",x:"locale",X:"locale"},format:function(t,i){i=i||{};if(!e.Lang.isDate(t))return e.Lang.isValue(t)?t:"";var s,o,u,a,f;s=i.format||"%Y-%m-%d",o=e.Intl.get("datatype-date-format");var l=function(e,t){if(u&&t==="r")return o[t];var n=r.aggregates[t];return n==="locale"?o[t]:n},c=function(i,s){var u=r.formats[s];switch(e.Lang.type(u)){case"string":return t[u]();case"function":return u.call(t,t,o);case"array":if(e.Lang.type(u[0])==="string")return n(t[u[0]](),u[1]);default:return s}};while(s.match(/%[cDFhnrRtTxX]/))s=s.replace(/%([cDFhnrRtTxX])/g,l);var h=s.replace(/%([aAbBCdegGHIjklmMpPsSuUVwWyYzZ%])/g,c);return l=c=undefined,h}};e.mix(e.namespace("Date"),r),e.namespace("DataType"),e.DataType.Date=e.Date},"3.13.0",{lang:["ar","ar-JO","ca","ca-ES","da","da-DK","de","de-AT","de-DE","el","el-GR","en","en-AU","en-CA","en-GB","en-IE","en-IN","en-JO","en-MY","en-NZ","en-PH","en-SG","en-US","es","es-AR","es-BO","es-CL","es-CO","es-EC","es-ES","es-MX","es-PE","es-PY","es-US","es-UY","es-VE","fi","fi-FI","fr","fr-BE","fr-CA","fr-FR","hi","hi-IN","hu","id","id-ID","it","it-IT","ja","ja-JP","ko","ko-KR","ms","ms-MY","nb","nb-NO","nl","nl-BE","nl-NL","pl","pl-PL","pt","pt-BR","ro","ro-RO","ru","ru-RU","sv","sv-SE","th","th-TH","tr","tr-TR","vi","vi-VN","zh-Hans","zh-Hans-CN","zh-Hant","zh-Hant-HK","zh-Hant-TW"]});
YUI.add("messenger-utils",function(e){"use strict";var t=e.Messenger.Common.Constants,n=window.location.protocol==="https:";e.Messenger.Common.Utils={substitute:function(e,t){return e.replace(/\{\{([^{}]*)\}\}/g,function(e,n){var o=t[n];return typeof o==="string"||typeof o==="number"?o:e})},parseURI:function(e){var t=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],o=/(?:^|&)([^&=]*)=?([^&]*)/g,r=t.exec(e),i={queryKey:{}},s=n.length;while(s--){i[n[s]]=r[s]||""}i.query.replace(o,function(e,t,n){if(t){i.queryKey[t]=n}});return i},generateImgURL:function(e,o){var r=e.displayImagePrefs||e,i=e.user,s=e.network||"yahoo",a=e.size||32,c=n?"https://ycpi-mail-rest-img.msg.yahoo.com":"http://rest-img.msg.yahoo.com",u=r.avatarPreference,m;if(s==="facebook"){if(!r.imageUrl){if(r.checksum){m=c+"/v1/displayImage/custom/facebook/"+encodeURIComponent(i)+"?size=square&chksum="+encodeURIComponent(r.checksum)+"&redirect=true&src=minty"}else{m=c+"/v1/displayImage/custom/facebook/"+encodeURIComponent(i)+"?size=square&cachebuster="+(new Date).getTime()+encodeURIComponent(Math.floor(Math.random()*1e4))+"&redirect=true&src=minty"}}else{m=r.imageUrl}}else{if(+u===1){m=r.avatarHash?window.location.protocol+"//avatars.zenfs.com/users/"+encodeURIComponent(r.avatarHash)+".medium.png":n?t.DEFAULT_IMAGE_SSL:t.DEFAULT_IMAGE}else if(+u===2){if(r.guid&&r.guid.length>0){m=window.location.protocol+"//msgr.zenfs.com/msgrDisImg/"+encodeURIComponent(r.guid);if(r.checksum){m+="?checksum="+encodeURIComponent(r.checksum)}}else if(r.checksum){m=c+"/v1/displayImage/custom/yahoo/"+encodeURIComponent(i)+"?height={{pixels|32|48}}&width={{pixels|32|48}}&chksum="+encodeURIComponent(r.checksum)+"&redirect=false&src=minty"}}else if(+u===-1&&s==="yahoo"){m=c+"/v1/displayImage/yahoo/"+encodeURIComponent(i)+"?height={{pixels|32|48}}&width={{pixels|32|48}}&maxage=259200"}}if(!m){return o?null:this.getDefaultBuddyImage(a)}else{return this.substitute(m,{"pixels|32|48":a})}},getDefaultBuddyImage:function(e){e=e||32;var o=n?t.DEFAULT_IMAGE_SSL:t.DEFAULT_IMAGE;return this.substitute(o,{"pixels|32|48":e})},getUserId:function(e,t){if(!e){return false}t=t||"yahoo";return e+"~"+t},doLongWork:function(e,t,n){var o=e.length,r=this,i=80;if(!e.__currIndex__){e.__currIndex__=0}e.__startTime__=(new Date).getTime();while(e.__currIndex__<o&&(new Date).getTime()-e.__startTime__<i){t(e[e.__currIndex__]);e.__currIndex__++}if(e.__currIndex__===o){delete e.__currIndex__;delete e.__startTime__;if(n){n()}}else{setTimeout(function(){r.doLongWork(e,t,n)},0)}},getConversationId:function(e,t,n){return[e,t,n||"yahoo"].join("~")},normalizePresenceState:function(e){var n=e.presenceState;if(n===99){n={0:0,1:2,2:999}[e.customDNDStatus];if(typeof n==="undefined"){n=0}}else if(typeof n==="undefined"){n=t.STATE.OFFLINE}return n},normalizePresenceMessage:function(t){var n;if(typeof t==="number"){t=t.toString()}t=t?t.replace(/[\r\n|\r|\n]+/g," "):"";n=t?e.Messenger.YMLUtil.ymlToHtml(t,true):"";return n},slicer:function(e,t,n){var o=0,r=t,i=e.length,s;while(o<i){s=e.slice(o,r);n(s,o,r,e);o+=t;r+=t}},unescapeHTML:function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#39;":"'","&#x2F;":"/","&#47;":"/","&#x60;":"`","&#96;":"`"},n,o=e||"";for(n in t){if(t.hasOwnProperty(n)){o=o.replace(new RegExp(n,"ig"),t[n])}}return o},validateURI:function(e){e+="";var t=decodeURIComponent(e).toLowerCase(),n=t.match(/(https)|(http)|(\/\/)|([#?\/])/g);if(n!==null&&(t.indexOf(n[0])===0||e.indexOf(":")===-1)){return true}return false},isCorp:function(){return e.Messenger.Neo.NeoConfig.isCorpmail===true||window.location.href.indexOf("yahoo-inc.com")!==-1}}},"1.0.0",{requires:["messenger-constants","datatype-date-format","messenger-ymlutils"]});YUI.add("messenger-ymlutils",function(e){var t={emoticons:{yahoo:{":)":1,":-)":1,"(-:":1,"(:)":1,"(:":1,":(":2,":-(":2,";)":3,";-)":3,":-/":7,":-\\":7,":S":7,":x":8,":-x":8,"(L)":8,':">':9,":$":9,":-P":10,":P":10,":-*":11,":*":11,"(K)":11,"=((":12,"(U)":12,":-O":13,":O":13,"X-(":14,"X(":14,":@":14,"B-)":16,"(H)":16,">:)":19,"(6)":19,":((":20,":-((":20,":'(":20,":|":22,":-|":22,"/:)":23,"/:-)":23,"^o)":23,"o:-)":25,"0:-)":25,"o:)":25,"0:)":25,"(A)":25,":-B":26,":B":26,"8-|":29,"8-)":29,":-&":31,"+o(":31,":-$":32,":-#":32,"<:-P":36,"<:o)":36,"(:|":37,"(:}":37,":-?":39,"*-)":39,":))":21,":-))":21,"=))":24,":D":4,":-D":4,";;)":5,";;-)":5,">:D<":6,":->":15,":>":15,":-S":17,"#:-S":18,"=;":27,"I-)":28,"|-)":28,"L-)":30,"[-(":33,":o)":34,":0)":34,"<@:)":34,"8-}":35,"=P~":38,"#-o":40,"=D>":41,":-SS":42,"@-)":43,":^O":44,":-w":45,":-<":46,">:P":47,"<):)":48,":)]":100,":-c":101,"~x(":102,":-h":103,":-t":104,"8->":105,":-??":106,"%-(":107,":o3":108,X_X:109,":!!":110,"\\m/":111,":@)":49,"3:-O":50,"3:-0":50,":(|)":51,"~:>":52,"@};-":53,"%%-":54,"**==":55,"(~~)":56,"~o)":57,"*-:)":58,"8-X":59,"=:)":60,"=:-)":60,">-)":61,":-L":62,"[-O<":63,"$-)":64,':-"':65,"b-(":66,":)>-":67,"[-X":68,"\\:D/":69,">:/":70,";))":71,"o->":72,"o=>":73,"o-+":74,"(%)":75,":-@":76,"^:)^":77,":-j":78,"(*)":79,":-q":112,":-bd":113,"^#(^":114,":bz":115,"~^o^~":120,"'@^@|||":121,"[]---":122,"^O^||3":123,":-(||>":124,"'+_+":125,":::^^:::":126,"o|^_^|o":127,":puke!":128,"o|\\~":129,"o|:-)":130,"[]==[]":131,":-)/\\:-)":132,":(game)":133,"'@-@":134,":->~~":135,"?@_@?":136,":(tv)":137,"&[]":138,"%||:-{":139,"%*-{":140,":(fight)":141},msn:{":)":1,":(":2,";)":3,":S":7,"(L)":8,":$":9,":P":10,"(K)":11,"(U)":12,":-O":13,":@":14,"(H)":16,"(6)":19,":'(":20,":|":22,"^o)":23,"(A)":25,":-B":26,"8-)":29,"+o(":31,":-#":32,"<:o)":36,"(:|":37,"*-)":39},facebook:{":)":1,":-)":1,":]":1,"=)":1,":-(":2,":(":2,":[":2,"=(":2,";)":3,";-)":3,"O.o":7,"o.O":7,"<3":8,":p":10,":-p":10,"=P":10,":*":11,":-*":11,":O":13,":o":13,":-O":13,":-o":13,"8|":16,"8-|":16,"B|":16,"B-|":16,"3:)":19,"3:-)":19,":v":20,":'(":20,"O:)":25,"O:-)":25,"8)":26,"8-)":26,"B)":26,"B-)":26,":/":39,":-/":39,":-\\":39,":\\":39,":D":4,":-D":4,"=D":4,"-_-":33,":3":45,">:(":102,">:-(":102,"^_^":111,">:O":114,">:-O":114,">:o":114,">:-o":114}},deentitize:function(e){var t=e.replace(/&gt;/g,">");t=t.replace(/&lt;/g,"<");t=t.replace(/&quot;/g,'"');t=t.replace(/&apos;/g,"'");t=t.replace(/&amp;/g,"&");return t},emoticonPickerEntries:{yahoo:{1:":)",2:":(",3:";)",4:":-/",5:":x",6:':">',7:":P",8:":-*",9:"=((",10:":-<",11:"~X(",12:":-O",13:"X-(",14:"B-)",15:">:)",16:":((",17:":|",18:"/:)",19:"O:-)",20:":-B",21:">:P",22:":-h",23:"8-|",24:":-&",25:":-$",26:"<:-P",27:"(:|",28:":-?",29:":))",30:"=))",31:":D",32:"<):)",33:":-t",34:";;)",35:">:D<",36:":>",37:":-S",38:"#:-S",39:"=;",40:"I-)",41:"L-)",42:"[-(",43:":)]",44:"8->",45:":O)",46:"8-}",47:"=P~",48:"#-o",49:"=D>",50:":-SS",51:"@-)",52:":^o",53:":-w",54:":-c",57:"~^o^~",58:"'@^@|||",59:"[]---",60:"^O^||3",61:":-(||>",62:"'+_+",63:":::^^:::",64:"o|^_^|o",65:":puke!",66:"o|\\~",67:"o|:-)",68:"[]==[]",69:":-)/\\:-)",70:":(game)",71:"'@-@",72:":->~~",73:"?@_@?",74:":(tv)",75:"&[]",76:"%||:-{",77:"%*-{",78:":(fight)"},msn:{1:":)",2:":(",3:";)",4:":S",5:"(L)",6:":$",7:":P",8:"(K)",9:"(U)",12:":-O",13:":@",14:"(H)",15:"(6)",16:":'(",17:":|",18:"^o)",20:":-B",23:"8-)",24:"+o(",25:":-#",26:"<:o)",27:"(:|",28:"*-)"},facebook:{1:" =) ",2:" =( ",3:" ;-) ",4:" o.O ",5:" <3 ",7:" =P ",8:" :-* ",12:" :-o ",14:" B-| ",15:" 3:-) ",16:" :'( ",20:" B-) ",28:" :\\ ",31:" =D ",42:" -_- ",53:" :3 "}},emoticonLabels:{1:"smile",2:"sad",3:"wink",4:"confused",5:"lovestruck",6:"blushing",7:"tongue",8:"kiss",9:"broken_heart",12:"surprise",13:"angry",14:"cool",15:"devilish",16:"crying",17:"straight_face",18:"raised_eyebrow",19:"angel",20:"nerd",23:"rolling_eyes",24:"sick",25:"shh",26:"party",27:"yawn",28:"thinking",29:"laughing",30:"rofl",31:"big_grin",34:"batting_eyelashes",35:"big_hug",36:"smug",37:"worried",38:"whew",39:"talk_to_the_hand",40:"sleepy",41:"loser",42:"not_talking",45:"clown",46:"silly",47:"drooling",48:"doh",49:"applause",50:"nail_biting",51:"hypnotized",52:"liar",53:"waiting",10:"sigh",21:"phbbbt",32:"cowboy",43:"on_the_phone",54:"call_me",11:"wits_end",22:"wave",33:"time_out",44:"daydreaming",57:"cheer",58:"dizzy",59:"cook",60:"eat",61:"give_up",62:"cold",63:"hot",64:"music",65:"puke",66:"sing",67:"catch",68:"exercise",69:"high_five",70:"play_game",71:"searching",72:"spooky",73:"studying",74:"tv",75:"gift",76:"unlucky",77:"down_on_luck",78:"fight"},ymlToHtml:function(e,a,r){e=t.addClosingTags(e);e=t.ymlToHtmlRaw(e,true,null,r);if(!a){e=t.addDefaultFont(e,false);e=t.addClosingTags(e)}return e},ymlToHtmlRaw:function(a,r,n,o){var s=window.location.protocol==="https:"?"https://s.yimg.com/pu/emoticon/v2/":"http://l.yimg.com/pu/emoticon/v2/";var i=15,l=6,f=32,c=l,g=f,u=50,d=64,h=[],b=[],m={black:"#000000",red:"#ff0000",green:"#008200",yellow:"#848200",blue:"#0000ff",purple:"#840084",cyan:"#008284",orange:"#ff8000",pink:"#ff0084",gray:"#848284"};function v(e){e=e.replace(/&/g,"&"+"amp;");e=e.replace(/</g,"&"+"lt;");e=e.replace(/>/g,"&"+"gt;");e=e.replace(/'/g,"&"+"#x27;");e=e.replace(/"/g,"&"+"quot;");return e}function p(){var e=this.s=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}if(e.length===0){e.push("")}this.$=function(t){e.push(t);return this};this.toString=function(){if(e.length>1){e=[e.join("")]}return e[0]}}function T(e,t,a){if(typeof t=="undefined"){if(e.charAt(0)=="#"){e=e.substring(1)}var r=parseInt(e,16);this.red=(r&16711680)>>16;this.green=(r&65280)>>8;this.blue=r&255}else{this.red=e;this.green=t;this.blue=a}this.toString=function(){function e(e){var t="00"+e.toString(16);return t.substring(t.length-2)}return"#"+e(this.red)+e(this.green)+e(this.blue)}}function k(e,t,a){if(e.length<2||a<2){return e[0]}if(e!=h){h=e;var r=0;var n=e[0];var o=e[1];var s=n.red;var i=n.green;var l=n.blue;var f=o.red;var c=o.green;var g=o.blue;var u=(e.length-1)/d;for(var m=0;m<d;m++){var v=m*u;var p=Math.floor(v);if(p!=r){s=f;i=c;l=g;o=e[p+1];f=o.red;c=o.green;g=o.blue;r=p}var k=v-p;var y=1-k;var x=Math.floor(s*y+f*k);var w=Math.floor(i*y+c*k);var $=Math.floor(l*y+g*k);b[m]=new T(x,w,$)}}var P=a-1;if(t>P){t=P}var S=Math.floor(t*(d-1)/P);return b[S]}function y(e){if(r){e=e.replace(/\r\n/g,"<br/>");e=e.replace(/\r/g,"<br/>");e=e.replace(/\n/g,"<br/>")}if(n){e=e.replace(/\s/g,"&nbsp;")}return e}function x(e){return y(v(e))}function w(e,t){if(!t||t.mode=="normal"){e=x(e)}else{var a,r=new p,n;for(var o=0;o<e.length;o++){if(t.mode=="fade"){a=k(t.colors,o,e.length)}else{a=t.colors[o%t.colors.length]}n=x(e.charAt(o));r.$('<font color="').$(a).$('">').$(n).$("</font>")}e=r.toString()}return e}function $(e){return e.replace(/\[/gi,"\\[").replace(/\$/gi,"\\$").replace(/\^/gi,"\\^").replace(/\\/gi,"\\\\").replace(/\./gi,"\\.").replace(/\|/gi,"\\|").replace(/\?/gi,"\\?").replace(/\*/gi,"\\*").replace(/\+/gi,"\\+").replace(/\(/gi,"\\(").replace(/\)/gi,"\\)").replace(/\//gi,"\\/")}function P(t,a){a=a||0;var r=/<([a-zA-Z0-9#]+[^><]*)>/,n={size:true,face:true,color:true,dir:true},o,s,i,l,f,u,d,h,b,p=null,k=a===0?t:t.substring(a),y=r.exec(k),x,w,P,S,_;if(y){p={};p.startTag=y[0];b=y[1];p.treatAsText=false;p.startPos=y.index+a;if(b.charAt(b.length-1)==="/"){p.treatAsText=true;p.endPos=p.startPos+p.startTag.length;return p}i=b.indexOf(" ");p.name=i!==-1?b.substring(0,i):b;p.attributes=i!==-1?b.substring(i+1).toLowerCase():"";p.contentStartPos=p.startPos+p.startTag.length;x=$(p.name);if(p.name.indexOf("url=")==0){l=new RegExp("</\\s*url\\s*>","ig")}else{l=new RegExp("</\\s*"+x+"\\s*>","ig")}k=t.substring(p.contentStartPos);y=l.exec(k);var O=new RegExp("<\\s*"+x+"[^>]*>","ig");var A=0;while(y!==null){p.endTag=y[0];p.endPos=p.contentStartPos+l.lastIndex;O.lastIndex=0;var z=O.exec(k.substring(A,l.lastIndex));if(p.endPos<t.length&&z){y=l.exec(k);p.endTag=null;p.endPos=null;A+=O.lastIndex}else{y=null}}if(p.endTag){p.contentEndPos=p.endPos-p.endTag.length;p.content=t.substring(p.contentStartPos,p.contentEndPos)}else{p.endPos=t.length;p.content=t.substring(p.contentStartPos);if(p.name=="font"||p.name=="b"||p.name=="u"||p.name=="i"){p.endTag="</"+p.name+">"}}switch(p.name.toLowerCase()){case"b":p.startTag="<b>";break;case"i":p.startTag="<i>";break;case"u":p.startTag="<u>";break;case"font":var R="",D,M="",B="";if(p.attributes!==""){u=p.attributes.split(" ");for(o=0,s=u.length;o<s;o++){d=u[o].split("=");if(d.length===2&&!n[d[0]]){p.treatAsText=true;return p}}}D=b.match(/size="([^"]*)"/);if(D!==null){var I;if(D[1].match(/[^0-9]/)){p.treatAsText=true;return p}else{I=D[1]-0;if(I<c){I=c}if(I>g){I=g}I=v(I+"")+"pt"}R=' style="font-size:'+I+'"'}D=b.match(/face="([^"]*)"/);if(D!==null){M=' face="'+v(D[1])+'"'}D=b.match(/color="([^"]*)"/);if(D!==null){B=' color="'+v(D[1])+'"'}if(R+M+B){p.startTag="<font"+R+M+B+">"}break;case"a":p.treatAsText=true;return p;case"url":p.startTag="";p.endTag="";break;case"fade":case"alt":p.startTag="";if(!p.endTag){p.content=t.substring(p.contentStartPos);p.endPos=t.length}p.endTag="";p.colors=p.attributes.split(",");var s=p.colors.length;for(var o=0;o<s;o++){p.colors[o]=new T(p.colors[o])}if(p.colors.length>1){p.setRenderMode=p.name.toLowerCase()}else if(p.colors.length==1){p.startTag='<font color="'+p.colors[0]+'">';p.endTag="</font>"}break;case"black":case"blue":case"cyan":case"gray":case"green":case"pink":case"purple":case"orange":case"red":case"yellow":p.startTag='<font color="'+m[p.name]+'">';p.endTag="</font>";break;default:if(p.name.indexOf("url=")===0){p.startTag=p.name.substring(4);if(p.startTag.indexOf('"')==0){p.startTag=p.startTag.substring(1)}if(p.startTag.charAt(p.startTag.length-1)=='"'){p.startTag=p.startTag.substring(0,p.startTag.length-1)}h=p.startTag;if(e.Messenger.Common.Utils.validateURI(h)){p.startTag='<a href="'+p.startTag+'" class="link" target="_blank">';if(p.content){p.startTag+=p.content;p.content=null}else{p.startTag+=h}p.startTag+="</a>";p.treatAsText=false;p.endTag=""}else{p.treatAsText=true}}else if(p.name.charAt(0)=="#"){p.startTag='<font color="'+v(p.name)+'">';p.endTag="</font>"}else if(p.name.indexOf("snd=")===0){p.startTag="";p.endTag=""}else{p.treatAsText=true}}}return p}function S(e){var t=e.split("["),a,r,n=0,o=0,s=0;if(t.length==1){return e}else{var i=new p;for(a=0;a<t.length;a++){var l=t[a],f=l.indexOf("m");if(f===-1){i.$(l)}else{var c=l.substring(0,f),g=true;switch(c){case"0":i.$("</font>");break;case"1":i.$("<b>");n++;break;case"2":i.$("<i>");s++;break;case"30":i.$('<font color="'+m.black+'">');break;case"31":i.$('<font color="'+m.blue+'">');break;case"32":i.$('<font color="'+m.cyan+'">');break;case"33":i.$('<font color="'+m.gray+'">');break;case"34":i.$('<font color="'+m.green+'">');break;case"35":i.$('<font color="'+m.pink+'">');break;case"36":i.$('<font color="'+m.purple+'">');break;case"37":i.$('<font color="'+m.orange+'">');break;case"38":i.$('<font color="'+m.red+'">');break;case"39":i.$('<font color="'+m.yellow+'">');break;case"4":i.$("<u>");o++;break;case"l":i.$("<url>");break;case"x1":if(n){i.$("</b>");n--}break;case"x2":if(s){i.$("</i>");s--}break;case"x4":if(o){i.$("</u>");o--}break;case"xc":i.$("</font>");break;case"xl":i.$("</url>");break;default:if(c.indexOf("#")===0){i.$('<font color="'+c+'">')}else{i.$(l);g=false}}f++;if(g&&f<l.length){i.$(l.substring(f))}}}return i.toString()}}function _(e,a,r){var n,o=0,l=0,f="yahoo";if(r=="msn"||r=="facebook"){f=r}n=new p;for(var c=0;c<e.length;c++){var g=8,u=0,d;for(;!u&&g>=2;g--){d=e.substring(c,c+g);if(d!=="eval"){u=t.emoticons[f][d];if(!u){u=t.emoticons[f][d.toUpperCase()]}if(!u){u=t.emoticons[f][d.toLowerCase()]}}}if(u){if(l!==c){n.$(w(e.substring(l,c),a))}var h=d.replace('"',"&quot;"),b='<img border=0 src="'+s+u+'.gif" alt="'+h+'" title="'+h+'" data-emoticon="true"/>';n.$(b);c+=g;l=c+1;o++;if(o==i){break}}}if(l<e.length){n.$(w(e.substring(l),a))}return n.toString()}function O(e,t,a){var r=/(\b(www\.|https?:\/\/)[A-Z0-9][A-Z0-9\-_.!~*();\/?:@&=+$,#%]*)/gi,n=new p,o,s,i,l=0,f;o=r.exec(e);while(o!==null){s=o[0];i=r.lastIndex-s.length;if(l<i){n.$(_(e.substring(l,i),t,a))}l=r.lastIndex;f=s.toLowerCase().indexOf("http")===0;if(f){n.$('<a href="'+s+'" target="_blank" class="link">'+s+"</a>")}else{n.$('<a href="http://'+s+'" target="_blank" class="link">'+s+"</a>")}o=r.exec(e)}if(l<e.length){n.$(_(e.substring(l),t,a))}return n.toString()}function A(e,t,a,r,n){r=r||0;if(r===u){return false}var o=P(e,0),s=0;while(o){if(o.startPos>s){t.$(O(e.substring(s,o.startPos),a,n))}if(o.treatAsText){t.$(O(o.startTag),a)}else{t.$(o.startTag)}if(o.content){var i=o.setRenderMode?{mode:o.setRenderMode,colors:o.colors}:a;if(!A(o.content,t,i,r+1,n)){return false}}if(o.endTag){if(o.treatAsText){t.$(O(o.endTag,a,n))}else{t.$(o.endTag)}}s=o.endPos;o=o.endPos<e.length?P(e,o.endPos):null}if(s<e.length){t.$(O(e.substring(s),a,n))}return true}var z=S(a);var R=new p;if(A(z,R,{mode:"normal"},null,o)){return R.toString()}else{return x(a)}},domToYml:function(a){if(e.UA.gecko&&a.innerHTML){a.innerHTML=t.removeTrailingBR(a.innerHTML)}var r=t.domToYmlRaw(a);return t.addDefaultFont(r,true,a.style).replace(/\u00a0/g," ")},domToYmlRaw:function(a){var r=["8","10","12","14","18","24","36"],n={"x-small":"1",small:"2",medium:"3",large:"4","x-large":"5","xx-large":"6"};var o="",s=0;var i=null;var l=a.childNodes.length;if(l>0){i=a.childNodes}if(a.nodeType==3){return a.nodeValue}else if(a.nodeType==1){switch(a.tagName){case"BR":o+="\n";break;case"B":case"STRONG":o+="<b>";for(s=0;s<l;s++){o+=t.domToYmlRaw(i[s])}o+="</b>";break;case"I":case"EM":o+="<i>";for(s=0;s<l;s++){o+=t.domToYmlRaw(i[s])}o+="</i>";break;case"U":o+="<u>";for(s=0;s<l;s++){o+=t.domToYmlRaw(i[s])}o+="</u>";break;case"DIV":case"SPAN":case"FONT":var f;var c;var g;var u=false,d=false,h=false;var b=a.getAttribute("style");var m=false;f=a.getAttribute("face");c=a.getAttribute("size");g=a.getAttribute("color");if(b){if(a.style.fontFamily&&a.style.fontFamily.length>0){f=a.style.fontFamily}if(a.style.fontSize&&a.style.fontSize.length>0){m=true;c=n[a.style.fontSize]?n[a.style.fontSize]:a.style.fontSize}if(a.style.color&&a.style.color.length>0){g=a.style.color}if(a.style.fontWeight=="bold"){u=true}if(a.style.textDecoration=="underline"){d=true}if(a.style.fontStyle=="italic"){h=true}}if(f||c||g){o+="<font";if(f&&c){o+=' face="'+f+'" size="'+(m?c:r[c-1])+'"'}else if(f&&!c){o+=' face="'+f+'"'}else if(!f&&c){if(c.match(/\D/)){o+=' size="'+c+'"'}else{o+=' size="'+r[c-1]+'"'}}if(g){g=g.replace(/\s/g,"");var v;if(v=g.match(/rgb\((\d*),(\d*),(\d*)\)/i)){g="#";var p=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");var T=Math.floor((v[1]-0)/16);g+=p[T]+p[v[1]-0-16*T];T=Math.floor((v[2]-0)/16);g+=p[T]+p[v[2]-0-16*T];T=Math.floor((v[3]-0)/16);g+=p[T]+p[v[3]-0-16*T]}o+=' color="'+g+'"'}o+=">"}if(u){o+="<b>"}if(d){o+="<u>"}if(h){o+="<i>"}if(g){o+="["+g+"m"}for(s=0;s<l;s++){o+=t.domToYmlRaw(i[s])}if(g){o+="[xcm"}if(h){o+="</i>"}if(d){o+="</u>"}if(u){o+="</b>"}if(c||f||g){o+="</font>"}if(e.UA.ie&&a.tagName=="DIV"&&a.parentNode&&a!==a.parentNode.lastChild){o+="\n"}break;case"IMG":var k=a.getAttribute("alt"),y=a.getAttribute("data-emoticon");if(y&&k){o+=k}break;case"INPUT":case"TEXTAREA":var k=a.value;if(k){o+=k}break;default:for(s=0;s<l;s++){o+=t.domToYmlRaw(i[s])}break}return o}else{return""}},addClosingTags:function(e){var t=e;var a=e.split("<font");var r=a.length-1;a=e.split("</font>");var n=a.length-1;for(var o=0;o<r-n;o++){t+="</font>"}return t},removeTrailingBR:function(e){var t;var a=e;if(t=e.match(/^(.*)<br>(.*)$/)){if(t[2].match(/>?[^<>]+?</)){a=t[1]+"<br>"+t[2]}else{a=t[1]+t[2]}}return a},addDefaultFont:function(e,t,a){if(!e.match){e=""+e}if(a){var r="";var n="";if(a.fontFamily&&a.fontFamily!==""){n='face="'+a.fontFamily+'"'}if(a.fontSize&&a.fontSize!==""){r='size="'+a.fontSize.replace(/pt/,"")+'"'}if(r.length>0||n.length>0){e="<font "+n+" "+r+">"+e+"</font>"}return e}else{var o="";var s="";var i=e;while(i.match&&i.match(/^<(.*?)>/)){var l=RegExp.$1;i=i.replace(/^<(.*?)>/,"");if(l.indexOf("font")===0&&l.indexOf("size")<0){o=s+"<"+l+' size="'+(t?"12":"2")+'">'+i;break}else if(l.indexOf("font")===0){o=s+"<"+l+">"+i;break}else s+="<"+l+">"}if(o.length==0){o='<font size="'+(t?"12":"2")+'">'+s+i+"</font>"}return o}}};e.namespace("Messenger").YMLUtil=t},"1.0.0",{requires:["messenger-constants","messenger-utils"]});YUI.add("messenger-xframetransport",function(e){"use strict";var r=e.Messenger.Common.Utils,t=e.Messenger.urlParams||{},s=location.protocol==="https:",i="xframe-proxy_20130927.html",a=t.ymsgrpws?t.ymsgrpws:s?"https://ycpi-mail-preferences.msg.yahoo.com":"http://preference.msg.yahoo.com",o,n={yim_core:{url:t.coreServer?t.coreServer:"",proxy_path:"/"+i+"?bc",parsed_url:null,proxy_url:null,xframe:null},yim_notify:{url:t.notifyServer?t.notifyServer:"",proxy_path:"/v2/xframe/"+i+"?bc",parsed_url:null,proxy_url:null,xframe:null},ssp:{url:a,proxy_path:"/"+i+"?cb",parsed_url:null,proxy_url:null,xframe:null}},u=r.parseURI(window.location.href),c=u.protocol+"://"+u.authority;function f(){var e=document.getElementsByTagName("script"),r,t,s,i="http://yui.yahooapis.com/combo?3.10.3/yui-base/yui-base-min.js"+"&3.10.3/json-parse/json-parse-min.js&3.10.3/json-stringify/json-stringify-min.js";for(r=0,t=e.length;r<t;r++){s=e[r].src;if(s&&(s.indexOf("yui-min.js")>-1||s.indexOf("yui.js")>-1||s.indexOf("yui-debug.js")>-1)){i=s;break}}return i}e.namespace("Messenger.Common").Transport={updateServiceURL:function(t){var s;n[t].parsed_url=r.parseURI(n[t].url);n[t].proxy_url=n[t].parsed_url.protocol+"://"+n[t].parsed_url.authority+n[t].proxy_path;if(n[t].xframe!==null&&n[t].xframe.destroy){n[t].xframe.destroy()}if(n[t].url&&n[t].url!==""){if(!this.xframePath){this.xframePath=e.Tictac.base.getBase()+e.Tictac.base.getAssetURL("js/","tictac-mim");s=window.YUI_config.groups.mim_core.filter;if(s==="min"){this.xframePath+="xframe-min.js"}else if(s==="debug"){this.xframePath+="xframe-debug.js"}else{this.xframePath+="xframe.js"}}if(!o){o=f()}n[t].xframe=new e.Messenger.Xframe({yim_core:n[t].url,proxy:n[t].proxy_url,xframePath:this.xframePath,yuiPath:o,localDomain:c})}},initialize:function(){this.updateServiceURL("yim_core");this.updateServiceURL("yim_notify")},setServiceURL:function(r,t){var s=this._getService(r);if(e.Lang.isString(t)&&(!s.xframe||t!==s.url)){s.url=t;this.updateServiceURL(r)}else if(!t){s.url=null;if(s.xframe){s.xframe.destroy()}s.xframe=null}},getServiceURL:function(e){if(n[e]){return n[e].url}},_getService:function(e){if(n[e]){return n[e]}return null},_getServices:function(){return n},setLogoutURL:function(e){var r=this._getService("yim_core");r.xframe.sendLogoutURL(e)},issueRequest:function(e){var r=e.id,t=e.body,s=e.method,i=e.server,a=this._getService(i),o=e.path||"",n=e.args||[],u=a.xframe,c=e.timeout||1e4,f,l=this;if(!u){this.updateServiceURL(i);u=a.xframe}f=a.url+o+"?"+n.join("&");u.send({method:s,timeout:c,url:f,body:t,callback:function(s){t=t||"";var a,o={};if(typeof s==="string"){s=s.replace(/^\s+/,"").replace(/\s+$/,"");if(s!==""){try{a=JSON.parse(s)}catch(n){}}}else{a=s}a=a||{};if(a.responseText&&!a.responseObj){try{a.responseObj=JSON.parse(a.responseText)}catch(n){}}if(a.responseObj&&a.responseObj.error){a.error=a.responseObj.error}if(t!==""){try{o=JSON.parse(t)}catch(n){}}a.body=o;a.parameters=e.args;if(a.error&&a.error.code===701){if(!l._xframeRetryAttempted){l._xframeRetryAttempted=true;l.updateServiceURL(i);l.issueRequest(e);return}else{a.error.code=600}}if(e.callback){e.callback(r,a)}}})},killConnections:function(){e.each(this._getServices(),function(e){if(e.xframe){try{e.xframe.destroy()}catch(r){}}})},cancelRequests:function(e){var r=this._getService(e).xframe;r.cancelRequests()}}},"1.0.0",{requires:["tictac-base","messenger-utils","xframe"]});YUI.add("messenger-stats",function(t){"use strict";t.Messenger.Common.Stats={stat:function(t,s){if(this.statsImpl){try{this.statsImpl.stat(t,s)}catch(a){}}},setStatsAPI:function(t){this.statsImpl=t}}},"@VERSION@",{requires:[]});YUI.add("underscore", function () {
    (function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,v=e.reduce,h=e.reduceRight,g=e.filter,d=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,j=i.bind,w=function(n){return n instanceof w?n:this instanceof w?(this._wrapped=n,void 0):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):n._=w,w.VERSION="1.4.3";var A=w.each=w.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a in n)if(w.has(n,a)&&t.call(e,n[a],a,n)===r)return};w.map=w.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e[e.length]=t.call(r,n,u,i)}),e)};var O="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduce===v)return e&&(t=w.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},w.reduceRight=w.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduceRight===h)return e&&(t=w.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=w.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},w.find=w.detect=function(n,t,r){var e;return E(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},w.filter=w.select=function(n,t,r){var e=[];return null==n?e:g&&n.filter===g?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&(e[e.length]=n)}),e)},w.reject=function(n,t,r){return w.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},w.every=w.all=function(n,t,e){t||(t=w.identity);var u=!0;return null==n?u:d&&n.every===d?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var E=w.some=w.any=function(n,t,e){t||(t=w.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};w.contains=w.include=function(n,t){return null==n?!1:y&&n.indexOf===y?-1!=n.indexOf(t):E(n,function(n){return n===t})},w.invoke=function(n,t){var r=o.call(arguments,2);return w.map(n,function(n){return(w.isFunction(t)?t:n[t]).apply(n,r)})},w.pluck=function(n,t){return w.map(n,function(n){return n[t]})},w.where=function(n,t){return w.isEmpty(t)?[]:w.filter(n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},w.max=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.max.apply(Math,n);if(!t&&w.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>=e.computed&&(e={value:n,computed:a})}),e.value},w.min=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.min.apply(Math,n);if(!t&&w.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;e.computed>a&&(e={value:n,computed:a})}),e.value},w.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=w.random(r++),e[r-1]=e[t],e[t]=n}),e};var F=function(n){return w.isFunction(n)?n:function(t){return t[n]}};w.sortBy=function(n,t,r){var e=F(t);return w.pluck(w.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||void 0===r)return 1;if(e>r||void 0===e)return-1}return n.index<t.index?-1:1}),"value")};var k=function(n,t,r,e){var u={},i=F(t||w.identity);return A(n,function(t,a){var o=i.call(r,t,a,n);e(u,o,t)}),u};w.groupBy=function(n,t,r){return k(n,t,r,function(n,t,r){(w.has(n,t)?n[t]:n[t]=[]).push(r)})},w.countBy=function(n,t,r){return k(n,t,r,function(n,t){w.has(n,t)||(n[t]=0),n[t]++})},w.sortedIndex=function(n,t,r,e){r=null==r?w.identity:F(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;u>r.call(e,n[o])?i=o+1:a=o}return i},w.toArray=function(n){return n?w.isArray(n)?o.call(n):n.length===+n.length?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:n.length===+n.length?n.length:w.keys(n).length},w.first=w.head=w.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},w.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},w.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},w.rest=w.tail=w.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var R=function(n,t,r){return A(n,function(n){w.isArray(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r};w.flatten=function(n,t){return R(n,t,[])},w.without=function(n){return w.difference(n,o.call(arguments,1))},w.uniq=w.unique=function(n,t,r,e){w.isFunction(t)&&(e=r,r=t,t=!1);var u=r?w.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:w.contains(a,r))||(a.push(r),i.push(n[e]))}),i},w.union=function(){return w.uniq(c.apply(e,arguments))},w.intersection=function(n){var t=o.call(arguments,1);return w.filter(w.uniq(n),function(n){return w.every(t,function(t){return w.indexOf(t,n)>=0})})},w.difference=function(n){var t=c.apply(e,o.call(arguments,1));return w.filter(n,function(n){return!w.contains(t,n)})},w.zip=function(){for(var n=o.call(arguments),t=w.max(w.pluck(n,"length")),r=Array(t),e=0;t>e;e++)r[e]=w.pluck(n,""+e);return r},w.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},w.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=w.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},w.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},w.range=function(n,t,r){1>=arguments.length&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=Array(e);e>u;)i[u++]=n,n+=r;return i};var I=function(){};w.bind=function(n,t){var r,e;if(n.bind===j&&j)return j.apply(n,o.call(arguments,1));if(!w.isFunction(n))throw new TypeError;return r=o.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(o.call(arguments)));I.prototype=n.prototype;var u=new I;I.prototype=null;var i=n.apply(u,r.concat(o.call(arguments)));return Object(i)===i?i:u}},w.bindAll=function(n){var t=o.call(arguments,1);return 0==t.length&&(t=w.functions(n)),A(t,function(t){n[t]=w.bind(n[t],n)}),n},w.memoize=function(n,t){var r={};return t||(t=w.identity),function(){var e=t.apply(this,arguments);return w.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},w.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},w.defer=function(n){return w.delay.apply(w,[n,1].concat(o.call(arguments,1)))},w.throttle=function(n,t){var r,e,u,i,a=0,o=function(){a=new Date,u=null,i=n.apply(r,e)};return function(){var c=new Date,l=t-(c-a);return r=this,e=arguments,0>=l?(clearTimeout(u),u=null,a=c,i=n.apply(r,e)):u||(u=setTimeout(o,l)),i}},w.debounce=function(n,t,r){var e,u;return function(){var i=this,a=arguments,o=function(){e=null,r||(u=n.apply(i,a))},c=r&&!e;return clearTimeout(e),e=setTimeout(o,t),c&&(u=n.apply(i,a)),u}},w.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},w.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},w.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},w.keys=_||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)w.has(n,r)&&(t[t.length]=r);return t},w.values=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push(n[r]);return t},w.pairs=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push([r,n[r]]);return t},w.invert=function(n){var t={};for(var r in n)w.has(n,r)&&(t[n[r]]=r);return t},w.functions=w.methods=function(n){var t=[];for(var r in n)w.isFunction(n[r])&&t.push(r);return t.sort()},w.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},w.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},w.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)w.contains(r,u)||(t[u]=n[u]);return t},w.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)null==n[r]&&(n[r]=t[r])}),n},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n};var S=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;r.push(n),e.push(t);var a=0,o=!0;if("[object Array]"==u){if(a=n.length,o=a==t.length)for(;a--&&(o=S(n[a],t[a],r,e)););}else{var c=n.constructor,f=t.constructor;if(c!==f&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(f)&&f instanceof f))return!1;for(var s in n)if(w.has(n,s)&&(a++,!(o=w.has(t,s)&&S(n[s],t[s],r,e))))break;if(o){for(s in t)if(w.has(t,s)&&!a--)break;o=!a}}return r.pop(),e.pop(),o};w.isEqual=function(n,t){return S(n,t,[],[])},w.isEmpty=function(n){if(null==n)return!0;if(w.isArray(n)||w.isString(n))return 0===n.length;for(var t in n)if(w.has(n,t))return!1;return!0},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=x||function(n){return"[object Array]"==l.call(n)},w.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){w["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return!(!n||!w.has(n,"callee"))}),w.isFunction=function(n){return"function"==typeof n},w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!=+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return void 0===n},w.has=function(n,t){return f.call(n,t)},w.noConflict=function(){return n._=t,this},w.identity=function(n){return n},w.times=function(n,t,r){for(var e=Array(n),u=0;n>u;u++)e[u]=t.call(r,u);return e},w.random=function(n,t){return null==t&&(t=n,n=0),n+(0|Math.random()*(t-n+1))};var T={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};T.unescape=w.invert(T.escape);var M={escape:RegExp("["+w.keys(T.escape).join("")+"]","g"),unescape:RegExp("("+w.keys(T.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(n){w[n]=function(t){return null==t?"":(""+t).replace(M[n],function(t){return T[n][t]})}}),w.result=function(n,t){if(null==n)return null;var r=n[t];return w.isFunction(r)?r.call(n):r},w.mixin=function(n){A(w.functions(n),function(t){var r=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),z.call(this,r.apply(w,n))}})};var N=0;w.uniqueId=function(n){var t=""+ ++N;return n?n+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(n,t,r){r=w.defaults({},r,w.templateSettings);var e=RegExp([(r.escape||q).source,(r.interpolate||q).source,(r.evaluate||q).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(t,r,e,a,o){return i+=n.slice(u,o).replace(D,function(n){return"\\"+B[n]}),r&&(i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(i+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),a&&(i+="';\n"+a+"\n__p+='"),u=o+t.length,t}),i+="';\n",r.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var a=Function(r.variable||"obj","_",i)}catch(o){throw o.source=i,o}if(t)return a(t,w);var c=function(n){return a.call(this,n,w)};return c.source="function("+(r.variable||"obj")+"){\n"+i+"}",c},w.chain=function(n){return w(n).chain()};var z=function(n){return this._chain?w(n).chain():n};w.mixin(w),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];w.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],z.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];w.prototype[n]=function(){return z.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(window);
});YUI.add("backbone", function () {
// Backbone.js 0.9.10
// (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Backbone may be freely distributed under the MIT license.
// For all details and documentation:
// http://backbonejs.org
(function(){var n=this,B=n.Backbone,h=[],C=h.push,u=h.slice,D=h.splice,g;g="undefined"!==typeof exports?exports:n.Backbone={};g.VERSION="0.9.10";var f=n._;!f&&"undefined"!==typeof require&&(f=require("underscore"));g.$=n.jQuery||n.Zepto||n.ender;g.noConflict=function(){n.Backbone=B;return this};g.emulateHTTP=!1;g.emulateJSON=!1;var v=/\s+/,q=function(a,b,c,d){if(!c)return!0;if("object"===typeof c)for(var e in c)a[b].apply(a,[e,c[e]].concat(d));else if(v.test(c)){c=c.split(v);e=0;for(var f=c.length;e<
f;e++)a[b].apply(a,[c[e]].concat(d))}else return!0},w=function(a,b){var c,d=-1,e=a.length;switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);break;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,b[0]);break;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,b[0],b[1]);break;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,b[0],b[1],b[2]);break;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},h=g.Events={on:function(a,b,c){if(!q(this,"on",a,[b,c])||!b)return this;this._events||(this._events=
{});(this._events[a]||(this._events[a]=[])).push({callback:b,context:c,ctx:c||this});return this},once:function(a,b,c){if(!q(this,"once",a,[b,c])||!b)return this;var d=this,e=f.once(function(){d.off(a,e);b.apply(this,arguments)});e._callback=b;this.on(a,e,c);return this},off:function(a,b,c){var d,e,t,g,j,l,k,h;if(!this._events||!q(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;g=a?[a]:f.keys(this._events);j=0;for(l=g.length;j<l;j++)if(a=g[j],d=this._events[a]){t=[];if(b||
c){k=0;for(h=d.length;k<h;k++)e=d[k],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&t.push(e)}this._events[a]=t}return this},trigger:function(a){if(!this._events)return this;var b=u.call(arguments,1);if(!q(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;c&&w(c,b);d&&w(d,arguments);return this},listenTo:function(a,b,c){var d=this._listeners||(this._listeners={}),e=a._listenerId||(a._listenerId=f.uniqueId("l"));d[e]=a;a.on(b,"object"===typeof b?this:c,this);
return this},stopListening:function(a,b,c){var d=this._listeners;if(d){if(a)a.off(b,"object"===typeof b?this:c,this),!b&&!c&&delete d[a._listenerId];else{"object"===typeof b&&(c=this);for(var e in d)d[e].off(b,c,this);this._listeners={}}return this}}};h.bind=h.on;h.unbind=h.off;f.extend(g,h);var r=g.Model=function(a,b){var c,d=a||{};this.cid=f.uniqueId("c");this.attributes={};b&&b.collection&&(this.collection=b.collection);b&&b.parse&&(d=this.parse(d,b)||{});if(c=f.result(this,"defaults"))d=f.defaults({},
d,c);this.set(d,b);this.changed={};this.initialize.apply(this,arguments)};f.extend(r.prototype,h,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return f.clone(this.attributes)},sync:function(){return g.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return f.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,g,p,j,l,k;if(null==a)return this;"object"===typeof a?(e=a,c=b):(e={})[a]=b;c||(c={});
if(!this._validate(e,c))return!1;g=c.unset;p=c.silent;a=[];j=this._changing;this._changing=!0;j||(this._previousAttributes=f.clone(this.attributes),this.changed={});k=this.attributes;l=this._previousAttributes;this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],f.isEqual(k[d],b)||a.push(d),f.isEqual(l[d],b)?delete this.changed[d]:this.changed[d]=b,g?delete k[d]:k[d]=b;if(!p){a.length&&(this._pending=!0);b=0;for(d=a.length;b<d;b++)this.trigger("change:"+a[b],this,k[a[b]],c)}if(j)return this;
if(!p)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);this._changing=this._pending=!1;return this},unset:function(a,b){return this.set(a,void 0,f.extend({},b,{unset:!0}))},clear:function(a){var b={},c;for(c in this.attributes)b[c]=void 0;return this.set(b,f.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._changing?
this._previousAttributes:this.attributes,e;for(e in a)if(!f.isEqual(d[e],b=a[e]))(c||(c={}))[e]=b;return c},previous:function(a){return null==a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},fetch:function(a){a=a?f.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=a.success;a.success=function(a,d,e){if(!a.set(a.parse(d,e),e))return!1;b&&b(a,d,e)};return this.sync("read",this,a)},save:function(a,b,c){var d,e,g=this.attributes;
null==a||"object"===typeof a?(d=a,c=b):(d={})[a]=b;if(d&&(!c||!c.wait)&&!this.set(d,c))return!1;c=f.extend({validate:!0},c);if(!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=f.extend({},g,d));void 0===c.parse&&(c.parse=!0);e=c.success;c.success=function(a,b,c){a.attributes=g;var k=a.parse(b,c);c.wait&&(k=f.extend(d||{},k));if(f.isObject(k)&&!a.set(k,c))return!1;e&&e(a,b,c)};a=this.isNew()?"create":c.patch?"patch":"update";"patch"===a&&(c.attrs=d);a=this.sync(a,this,c);d&&c.wait&&(this.attributes=
g);return a},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(a,b,e){(e.wait||a.isNew())&&d();c&&c(a,b,e)};if(this.isNew())return a.success(this,null,a),!1;var e=this.sync("delete",this,a);a.wait||d();return e},url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url")||x();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},
isNew:function(){return null==this.id},isValid:function(a){return!this.validate||!this.validate(this.attributes,a)},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;if(!c)return!0;this.trigger("invalid",this,c,b||{});return!1}});var s=g.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);void 0!==b.comparator&&(this.comparator=b.comparator);this.models=[];this._reset();this.initialize.apply(this,
arguments);a&&this.reset(a,f.extend({silent:!0},b))};f.extend(s.prototype,h,{model:r,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return g.sync.apply(this,arguments)},add:function(a,b){a=f.isArray(a)?a.slice():[a];b||(b={});var c,d,e,g,p,j,l,k,h,m;l=[];k=b.at;h=this.comparator&&null==k&&!1!=b.sort;m=f.isString(this.comparator)?this.comparator:null;c=0;for(d=a.length;c<d;c++)(e=this._prepareModel(g=a[c],b))?(p=this.get(e))?b.merge&&(p.set(g===
e?e.attributes:g,b),h&&(!j&&p.hasChanged(m))&&(j=!0)):(l.push(e),e.on("all",this._onModelEvent,this),this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e)):this.trigger("invalid",this,g,b);l.length&&(h&&(j=!0),this.length+=l.length,null!=k?D.apply(this.models,[k,0].concat(l)):C.apply(this.models,l));j&&this.sort({silent:!0});if(b.silent)return this;c=0;for(d=l.length;c<d;c++)(e=l[c]).trigger("add",e,this,b);j&&this.trigger("sort",this,b);return this},remove:function(a,b){a=f.isArray(a)?a.slice():[a];
b||(b={});var c,d,e,g;c=0;for(d=a.length;c<d;c++)if(g=this.get(a[c]))delete this._byId[g.id],delete this._byId[g.cid],e=this.indexOf(g),this.models.splice(e,1),this.length--,b.silent||(b.index=e,g.trigger("remove",g,this,b)),this._removeReference(g);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,f.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,f.extend({at:0},
b));return a},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){if(null!=a)return this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[a.id||a.cid||a[this._idAttr]||a]},at:function(a){return this.models[a]},where:function(a){return f.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");
a||(a={});f.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(f.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},pluck:function(a){return f.invoke(this.models,"get",a)},update:function(a,b){b=f.extend({add:!0,merge:!0,remove:!0},b);b.parse&&(a=this.parse(a,b));var c,d,e,g,h=[],j=[],l={};f.isArray(a)||(a=a?[a]:[]);if(b.add&&!b.remove)return this.add(a,b);d=0;for(e=a.length;d<e;d++)c=a[d],g=this.get(c),
b.remove&&g&&(l[g.cid]=!0),(b.add&&!g||b.merge&&g)&&h.push(c);if(b.remove){d=0;for(e=this.models.length;d<e;d++)c=this.models[d],l[c.cid]||j.push(c)}j.length&&this.remove(j,b);h.length&&this.add(h,b);return this},reset:function(a,b){b||(b={});b.parse&&(a=this.parse(a,b));for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);b.previousModels=this.models.slice();this._reset();a&&this.add(a,f.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=
a?f.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=a.success;a.success=function(a,d,e){a[e.update?"update":"reset"](d,e);b&&b(a,d,e)};return this.sync("read",this,a)},create:function(a,b){b=b?f.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;b.success=function(a,b,f){f.wait&&c.add(a,f);d&&d(a,b,f)};a.save(null,b);return a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models.length=
0;this._byId={}},_prepareModel:function(a,b){if(a instanceof r)return a.collection||(a.collection=this),a;b||(b={});b.collection=this;var c=new this.model(a,b);return!c._validate(a,b)?!1:c},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"===a||"remove"===a)&&c!==this||("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=
b)),this.trigger.apply(this,arguments))},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=f.isFunction(b)?b:function(a){return a.get(b)};return f.sortedIndex(this.models,a,d,c)}});f.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),function(a){s.prototype[a]=function(){var b=
u.call(arguments);b.unshift(this.models);return f[a].apply(f,b)}});f.each(["groupBy","countBy","sortBy"],function(a){s.prototype[a]=function(b,c){var d=f.isFunction(b)?b:function(a){return a.get(b)};return f[a](this.models,d,c)}});var y=g.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},E=/\((.*?)\)/g,F=/(\(\?)?:\w+/g,G=/\*\w+/g,H=/[\-{}\[\]+?.,\\\^$|#\s]/g;f.extend(y.prototype,h,{initialize:function(){},route:function(a,b,c){f.isRegExp(a)||
(a=this._routeToRegExp(a));c||(c=this[b]);g.history.route(a,f.bind(function(d){d=this._extractParameters(a,d);c&&c.apply(this,d);this.trigger.apply(this,["route:"+b].concat(d));this.trigger("route",b,d);g.history.trigger("route",this,b,d)},this));return this},navigate:function(a,b){g.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes)for(var a,b=f.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])},_routeToRegExp:function(a){a=a.replace(H,"\\$&").replace(E,"(?:$1)?").replace(F,
function(a,c){return c?a:"([^/]+)"}).replace(G,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var m=g.History=function(){this.handlers=[];f.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},z=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,J=/msie [\w.]+/,K=/\/$/;m.started=!1;f.extend(m.prototype,h,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,
b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(K,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(z,"")},start:function(a){if(m.started)throw Error("Backbone.history has already been started");m.started=!0;this.options=f.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||
!this.history||!this.history.pushState);a=this.getFragment();var b=document.documentMode,b=J.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);this.root=("/"+this.root+"/").replace(I,"/");b&&this._wantsHashChange&&(this.iframe=g.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)g.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!b)g.$(window).on("hashchange",this.checkUrl);
else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&(this._hasPushState&&b&&a.hash)&&(this.fragment=this.getHash().replace(z,""),this.history.replaceState({},document.title,
this.root+this.fragment+a.search));if(!this.options.silent)return this.loadUrl()},stop:function(){g.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);m.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},
loadUrl:function(a){var b=this.fragment=this.getFragment(a);return f.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!m.started)return!1;if(!b||!0===b)b={trigger:b};a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&
(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});g.history=new m;var A=g.View=function(a){this.cid=f.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},L=/^(\S+)\s*(.*)$/,M="model collection el id attributes className tagName events".split(" ");
f.extend(A.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof g.$?a:g.$(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=f.result(this,"events"))){this.undelegateEvents();for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);
if(!c)throw Error('Method "'+a[b]+'" does not exist');var d=b.match(L),e=d[1],d=d[2],c=f.bind(c,this),e=e+(".delegateEvents"+this.cid);if(""===d)this.$el.on(e,c);else this.$el.on(e,d,c)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=f.extend({},f.result(this,"options"),a));f.extend(this,f.pick(a,M));this.options=a},_ensureElement:function(){if(this.el)this.setElement(f.result(this,"el"),!1);else{var a=f.extend({},f.result(this,"attributes"));
this.id&&(a.id=f.result(this,"id"));this.className&&(a["class"]=f.result(this,"className"));a=g.$("<"+f.result(this,"tagName")+">").attr(a);this.setElement(a,!1)}}});var N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};g.sync=function(a,b,c){var d=N[a];f.defaults(c||(c={}),{emulateHTTP:g.emulateHTTP,emulateJSON:g.emulateJSON});var e={type:d,dataType:"json"};c.url||(e.url=f.result(b,"url")||x());if(null==c.data&&b&&("create"===a||"update"===a||"patch"===a))e.contentType="application/json",
e.data=JSON.stringify(c.attrs||b.toJSON(c));c.emulateJSON&&(e.contentType="application/x-www-form-urlencoded",e.data=e.data?{model:e.data}:{});if(c.emulateHTTP&&("PUT"===d||"DELETE"===d||"PATCH"===d)){e.type="POST";c.emulateJSON&&(e.data._method=d);var h=c.beforeSend;c.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d);if(h)return h.apply(this,arguments)}}"GET"!==e.type&&!c.emulateJSON&&(e.processData=!1);var m=c.success;c.success=function(a){m&&m(b,a,c);b.trigger("sync",b,a,c)};
var j=c.error;c.error=function(a){j&&j(b,a,c);b.trigger("error",b,a,c)};a=c.xhr=g.ajax(f.extend(e,c));b.trigger("request",b,a,c);return a};g.ajax=function(){return g.$.ajax.apply(g.$,arguments)};r.extend=s.extend=y.extend=A.extend=m.extend=function(a,b){var c=this,d;d=a&&f.has(a,"constructor")?a.constructor:function(){return c.apply(this,arguments)};f.extend(d,c,b);var e=function(){this.constructor=d};e.prototype=c.prototype;d.prototype=new e;a&&f.extend(d.prototype,a);d.__super__=c.prototype;return d};
var x=function(){throw Error('A "url" property or function must be specified');}}).call(window);}, "", {requires: ["underscore"]});YUI.add("tictac-base-model",function(a){"use strict",a.namespace("Tictac.base").Model=Backbone.Model.extend({initialize:function(){var a=this;a.trackChanges&&(a.changedProperties={},a.on("change",a._handleChange,a))},_handleChange:function(){a.mix(this.changedProperties,this.changedAttributes(),!0)},isDirty:function(){return this.trackChanges&&!_.isEmpty(this.changedProperties)},getChanges:function(){return this.changedProperties},resetChanges:function(){this.changedProperties={}},destroy:function(a){a=a||{},a.wait=!1,Backbone.Model.prototype.destroy.apply(this,arguments),this.off()},sync:function(a,b,c){if(a!=="delete")throw new Error("Sync called for unsupported method");c&&c.success&&c.success(this,null,c)}})},"@VERSION@",{requires:["backbone"]});YUI.add("messenger-systemsettings",function(e){"use strict";e.namespace("Messenger.Model").SystemSettings=new e.Tictac.base.Model({defaults:{smsEnabled:true,topContactsEnabled:false,isRTL:false}})},"@VERSION@",{requires:["tictac-base-model"]});YUI.add("messenger-requestmanager",function(e){"use strict";var t=110,i=12e4,s=20*60*1e3,n={KEEPALIVE:{method:"PUT",path:"/v1/session/keepalive",args:["notifyServerToken=2"]},GET_CRUMB:{method:"GET",path:"/v1/session",args:["amIOnline=0"]}},r=e.Messenger.Common.Constants.EVENTS,o,a=e.Messenger.Common.Utils,h=typeof navigator.onLine!=="undefined",c=0;o={appId:"mim",crumb:null,sessionId:null,imToken:null,primaryLoginId:null,transport:null,initialize:function(){this.transport=this.transport||e.Messenger.Common.Transport;this._notifyLog={};this._listeners={};this._watchers={};this._pendingRequests=[];if(h){this._boundOffline=e.bind(this._handleOffline,this);if(window.addEventListener){window.addEventListener("offline",this._boundOffline,false)}else{window.attachEvent("onoffline",this._boundOffline)}}},destroy:function(){if(h){if(window.removeEventListener){window.removeEventListener("offline",this._boundOffline,false)}else{window.detachEvent("onoffline",this._boundOffline)}}},setTransport:function(e){this.transport=e},setServerURL:function(e,t){this.transport.setServiceURL(e,t)},issueRequest:function(e,t){var i=this.transport,s=e.args?e.args.slice(0):[],n=e.retries||0,o=e.server||"yim_core",a=e.method,h=e.path,l=e.type,f=e.postBody,u,_=this,g=location.protocol==="https:",d=g?"https://ycpi-mail-rest-core.msg.yahoo.com":"http://prod.rest-core.msg.yahoo.com";t=t||0;if(!i){throw new Error("Attempt made to issue a request using RequestManager without setting a transport")}if(o==="yim_core"||o==="yim_notify"){if(!this.crumb){if(l!=="GET_CRUMB"){if(this.sessionId||l==="LOGIN"){this.getCrumb();this._pendingRequests.push(e);return}else{return}}}else if(!this.sessionId&&l!=="LOGIN"){return}}if(o==="yim_notify"){s.push("imtoken="+encodeURIComponent(this.imToken))}if(this.crumb){s.push("c="+encodeURIComponent(this.crumb))}if(this.sessionId&&l!=="GET_CRUMB"){s.push("sid="+encodeURIComponent(this.sessionId))}u=typeof f==="object"?JSON.stringify(f):f;if(o==="yim_core"&&!i.getServiceURL(o)){this.setServerURL("yim_core",d)}if(a==="DELETE"&&o!=="ssp"){s.push("_method=delete");a="POST"}s.push("msgrAppId="+this.appId);s.push("cache="+(new Date).getTime());function m(i,s){if(s.error){if(t<n){_.issueRequest(e,++t);return}if(s.error.code===-1002||l==="HANGING_GET"&&s.httpStatus===403){if(l!=="GET_CRUMB"){if(!_._refreshingCrumb){_._refreshingCrumb=true;_.crumb=null;_.getCrumb();_._pendingRequests.push(e);return}else{_._refreshingCrumb=false;_._handleSessionExpired();return}}}else{switch(s.error.code){case 28:_._handleSessionExpired();break;case 4:case 30:_.trigger(r.FATAL_IO_ERROR);_._clearState();return;case 600:_.trigger(r.FATAL_IO_ERROR);_._clearState();return;case 700:_.issueRequest(e);return;default:break}}}else if(l!=="GET_CRUMB"&&_._refreshingCrumb){_._refreshingCrumb=false}if(s.error){if(e.errorCallback){e.errorCallback(s)}}else{if(l==="LOGIN"){_.processLoginData(s)}else if(l==="LOGOUT"){_._clearState()}if(e.successCallback){e.successCallback(s)}}}i.issueRequest({args:s,body:u,method:a,server:o,path:h,id:++c,timeout:e.timeout,callback:m})},startListening:function(){if(!this._listening){this._listening=true;this._notifySequence=0;this._getNotifications();this._keepaliveTimer=e.later(s,this,this._keepAlive,null,true)}},processLoginData:function(t){var i=this,s=e.Messenger.urlParams||{};this.sessionId=t.sessionId;this.primaryLoginId=t.primaryLoginId;this.imToken=t.notifyServerToken.token;if(s.coreServer){this.setServerURL("yim_core",e.Messenger.urlParams.coreServer)}else{this.setServerURL("yim_core",window.location.protocol+"//"+t.server)}if(s.notifyServer){this.setServerURL("yim_notify",s.notifyServer)}else{this.setServerURL("yim_notify",window.location.protocol+"//"+t.notifyServer)}this.startListening();e.later(0,null,function(){var e=window.location.protocol+"//"+t.server+"/v1/session/delete?logoffType=0";e+="&sid="+encodeURIComponent(t.sessionId);e+="&c="+encodeURIComponent(i.crumb);e+="&msgrAppId=mim&blocking=0";i.setLogoutURL(e)})},addListener:function(e,t){this._listeners[e]=this._listeners[e]||[];this._listeners[e].push(t);if(this._notifyLog[e]){while(this._notifyLog[e].length){t(this._notifyLog[e].pop())}}return function(e,t,i){return{detach:function(){e._listeners[t].splice(i,1)}}}(this,e,this._listeners[e].length-1)},addListeners:function(e){var t,i;for(t=0,i=e.length;t<i;t++){this.addListener(e[t].id,e[t].callback)}},watchNotifications:function(e,t){var i,s;this._watchers[e]=this._watchers[e]||[];this._watchers[e].push(t);if(this._notifyLog[e]){for(i=0,s=this._notifyLog[e].length;i<s;i++){t(this._notifyLog[e][i])}}return function(e,t,i){return{detach:function(){e._watchers[t].splice(i,1)}}}(this,e,this._watchers[e].length-1)},getCrumb:function(e){var t=n.GET_CRUMB,i=this;e=e||{};if(e.checkStatus){t.args=["amIOnline=1"]}if(!i._crumbPending){i._crumbPending=true;i.crumb=null;i.issueRequest({type:"GET_CRUMB",method:t.method,path:t.path,args:t.args,successCallback:function(t){i.crumb=t.crumb;while(i._pendingRequests.length){i.issueRequest(i._pendingRequests.pop())}i._crumbPending=false;if(e.successCallback){e.successCallback(t)}},errorCallback:function(){i._crumbPending=false;i.trigger(r.FATAL_IO_ERROR);i._clearState()}})}},killConnections:function(){if(this._logoutUrl){var e=new Image;e.src=this._logoutUrl;this._logoutUrl=null}this.transport.killConnections()},setLogoutURL:function(e){this._logoutUrl=e;this.transport.setLogoutURL(e)},_getNotifications:function(){this._notifySequence=this._notifySequence||0;if(this._notifyPending){return}this._notifyPending=true;this.issueRequest({type:"HANGING_GET",timeout:i,server:"yim_notify",method:"GET",path:"/v1/pushchannel/"+this.primaryLoginId,args:["seq="+this._notifySequence,"format=json","idle="+t],successCallback:e.bind(this._getNotificationsSuccessCallback,this),errorCallback:e.bind(this._getNotificationsErrorCallback,this)})},_getNotificationsSuccessCallback:function(t){this._notifyPending=false;var i=this,s=t.responses||[];if(i._hgRetryCount){i._hgRetryCount=0;i.trigger(r.NETWORK_ERROR_RESOLVED)}e.Messenger.logPerf("Processing "+s.length+" notifications in RequestManager");a.doLongWork(s,function(e){var t,s,n;for(t in e){if(e.hasOwnProperty(t)){i._notifySequence++;if(t==="disconnect"){i._clearState()}if(i._listeners[t]){for(s=0,n=i._listeners[t].length;s<n;s++){try{i._listeners[t][s](e[t])}catch(r){}}}else{i._notifyLog[t]=i._notifyLog[t]||[];i._notifyLog[t].push(e[t])}if(i._watchers[t]){for(s=0,n=i._watchers[t].length;s<n;s++){i._watchers[t][s](e[t])}}}}},function(){e.Messenger.logPerf("Finished processing "+s.length+" notifications");if(i._listening){i._getNotifications()}})},_getNotificationsErrorCallback:function(){this._notifyPending=false;var t;if(this._listening){if(!this._hgRetryCount){this._hgRetryCount=0;this.trigger(r.TEMP_NETWORK_ERROR)}this._hgRetryCount++;t=this._hgRetryCount<10?500:5e3;e.later(t,this,this._getNotifications)}},_handleSessionExpired:function(){this._clearState();this.trigger(r.SESSION_EXPIRED)},_clearState:function(){this.crumb=this.sessionId=this.imToken=null;this._pendingRequests=[];this._listening=false;this._notifySequence=0;this._crumbPending=false;this._notifyPending=false;if(this._keepaliveTimer){this._keepaliveTimer.cancel();delete this._keepaliveTimer}this.transport.cancelRequests("yim_notify")},_handleOffline:function(){if(this._listening){this.transport.cancelRequests("yim_notify")}},_keepAlive:function(){var t=n.KEEPALIVE,i=this;this.issueRequest({type:"KEEPALIVE",method:t.method,path:t.path,args:t.args,successCallback:e.bind(function(e){if(e.notifyServerToken&&e.notifyServerToken.token){i.imToken=e.notifyServerToken.token}},i)})}};_.extend(o,Backbone.Events);e.namespace("Messenger.Common").RequestManager=o;o.initialize()},"@VERSION@",{requires:["messenger-constants","oop","backbone","messenger-utils"]});YUI.add("messenger-session",function(e){"use strict";var s=e.Messenger.Common.Constants,t=s.EVENTS,i=e.Messenger.Common.Stats,n=e.Messenger.Model.SystemSettings,o,a=e.Messenger.Common.Utils,r={LOGIN:{method:"POST",path:"/v1/session"},LOGOUT:{method:"DELETE",path:"/v1/session"},SET_PRESENCE:{method:"PUT",path:"/v1/presence"},WAKEUP:{method:"PUT",path:"/v1/session",args:["action=mpop-activate"]}};o=e.Tictac.base.Model.extend({initialize:function(){var i=e.Messenger.Common.RequestManager,n=this;i.addListeners([{id:"buddyStatus",callback:e.bind(this._processBuddyStatus,this)},{id:"disconnect",callback:e.bind(this._processDisconnect,this)},{id:"endPointState",callback:e.bind(this._processEndPointState,this)},{id:"setVisibilityState",callback:e.bind(this._processVisibilityState,this)}]);i.on(t.SESSION_EXPIRED,e.bind(this._processSessionExpired,this));i.on(t.TEMP_NETWORK_ERROR,function(){n.set("presenceState",s.STATE.PENDING)});i.on(t.NETWORK_ERROR_RESOLVED,function(){n.set("presenceState",n.previous("presenceState"))});i.on(t.FATAL_IO_ERROR,function(){n._processDisconnect()})},login:function(t,o){if(this.isOnline()){if(o){o()}return}i.stat("login");i.stat("toggle",{ltxt:"signin"});t=t||{};this.set("presenceState",s.STATE.PENDING);var a=e.Messenger.Common.RequestManager,c=t.state||0,p=t.message||"",g=r["LOGIN"],l=[{clientCapability:"smiley"},{clientCapability:"mpop"},{clientCapability:"richText"},{clientCapability:"interop"},{clientCapability:"activateSSA"},{clientCapability:"typing"}],u,f;if(n.get("smsEnabled")){l.push({clientCapability:"sms"})}u={presenceState:c,presenceMessage:p,profileLogin:0,clientCapabilities:l,mpopLoginInfo:{loginType:t.dormant?1:0}};u.loginTriggers=[{loginTrigger:"mpopStateTransfer"},{loginTrigger:"ignoreList"},{loginTrigger:"invisibleList"}];f=["notifyServerToken=2","fieldsBuddyList="+encodeURIComponent("+groups"),"fieldsBuddyList="+encodeURIComponent("-uri")];a.issueRequest({type:"LOGIN",method:g.method,path:g.path,args:f,postBody:u,successCallback:e.bind(function(e){this.set({presenceState:c,presenceMessage:p});this.processLoginData(e);if(o){o(e)}},this),errorCallback:e.bind(function(){this.set("presenceState",s.STATE.OFFLINE)},this)})},logout:function(i){var n=e.Messenger.Common.RequestManager,o=r["LOGOUT"],a,c=this.get("presenceState");a={logoffType:i==="global"?2:0};this.set("presenceState",s.STATE.PENDING);n.issueRequest({type:"LOGOUT",method:o.method,path:o.path,postBody:a,successCallback:e.bind(function(){this.set({presenceState:s.STATE.OFFLINE,presenceMessage:"",online:false})},this),errorCallback:e.bind(function(){this.set("presenceState",c)},this)});this.trigger(t.LOGOUT_LOCAL)},processLoginData:function(e){var s=e.primaryLoginId,t=this.get("loggedInId"),i=[],n,o;if(e.profileLoginIds){for(n=0,o=e.profileLoginIds.length;n<o;n++){i.push(e.profileLoginIds[n].profileLoginId);if(e.profileLoginIds[n]["default"]){s=e.profileLoginIds[n].profileLoginId}}}if(t&&s!==t){this.logout()}else{this.set({primaryId:e.primaryLoginId,loggedInId:s,aliases:i,mpopInfo:e.mpopInfo||{},image:a.generateImgURL({user:s,network:"yahoo",displayImagePrefs:e.displayInfo}),presenceSubscriptionsMaxPerRequest:e.constants.presenceSubscriptionsMaxPerRequest,buddies:e.contacts})}},isOnline:function(){return this.get("presenceState")!==s.STATE.OFFLINE},isInvisible:function(){return this.get("presenceState")===s.STATE.INVISIBLE},becomePrimary:function(t){var i=r.WAKEUP,n=this,o=this.get("mpopInfo"),a=e.Messenger.Common.RequestManager;if(this.isOnline()&&o&&o.state!==0){a.issueRequest({type:"MPOP_ACTIVATE",method:i.method,path:i.path,args:i.args,successCallback:function(e){o=n.get("mpopInfo");o.state=0;n.set("mpopInfo",o);if(n.get("presenceState")===s.STATE.IDLE){n.setPresence(s.STATE.AVAILABLE)}if(t){t(e)}}})}},isPrimary:function(){return this.get("mpopInfo").state===0?true:false},isMyself:function(s){var t=this,i=t.get("aliases"),n=t.get("primaryId");if(s===n){return true}return i&&e.Array.indexOf(i,s)!==-1},quickLogout:function(){if(this.isOnline()){e.Messenger.Common.RequestManager.killConnections()}},setPresence:function(t,i,n){var o=this;if(t===s.STATE.OFFLINE){o.logout()}else if(!o.isOnline()){o.login({state:t,message:i})}else if(!o.isPrimary()){n|=0;if(n<3){o.becomePrimary(function(){o.setPresence(t,i,n+1)})}else{}}else{var a=r["SET_PRESENCE"],c={presenceState:t},p=e.Messenger.Common.RequestManager;if(typeof i!=="undefined"){c.presenceMessage=i}p.issueRequest({type:"PRESENCE",method:a.method,path:a.path,postBody:c,successCallback:function(){o.set({presenceState:t,presenceMessage:i||""})}})}},_processBuddyStatus:function(e){if(e.echo){var s=this.get("presenceState"),t=this.get("presenceMessage"),i=e.presenceMessage,n=a.normalizePresenceState(e);if(n!==s||i!==t){this.set("presenceState",n);if(typeof i!=="undefined"){this.set("presenceMessage",i)}}}},_processDisconnect:function(){this.set("presenceState",s.STATE.OFFLINE);this.set("presenceMessage","")},_processSessionExpired:function(){var e=this.get("presenceState"),s=this.get("presenceMessage");this._processDisconnect();this.login(e,s)},_processEndPointState:function(e){var s=e.endPointInfo;if(s){s.totalEndpoints=s.totalEndpoints||s.numberOfEndPoints;this.set("mpopInfo",s);if(s.state!==0&&s.numberOfEndPoints===1){this.becomePrimary()}}},_processVisibilityState:function(e){var t=this.get("presenceState");if(e.state===2){if(t!==s.STATE.INVISIBLE){this._previousState={state:t,message:this.get("presenceMessage")};this.set("presenceState",s.STATE.INVISIBLE);this.set("presenceMessage","")}}else{if(t===s.STATE.INVISIBLE){if(this._previousState){this.set("presenceState",this._previousState.state);this.set("presenceMessage",this._previousState.message)}else{this.set("presenceState",s.STATE.AVAILABLE)}}}}});e.namespace("Messenger.Model").Session=new o({presenceState:s.STATE.OFFLINE,presenceMessage:"",primaryId:null,loggedInId:null,aliases:null,facebookOnline:false,mpopInfo:{},image:null})},"@VERSION@",{requires:["messenger-constants","messenger-requestmanager","messenger-utils","tictac-base-model","messenger-stats","messenger-systemsettings"]});YUI.add("messenger-usersettings",function(e){"use strict";var t;t=e.Tictac.base.Model.extend({_prefStores:[],_prefMapping:{},addKeys:function(t,r){var s=this,n;if(!r||!r.get||!r.set){throw new Error("Invalid prefStore set for UserSettings")}s._prefStores.push(r);_.each(t,function(e,t){s._prefMapping[t]={defaultVal:e,store:r}});if(r===e.namespace("Messenger.Common").MSDBUserPreferences){n=s.getPreference("mimPrefMigrated");if(!n){s._loadOMKeys()}}},getPreference:function(e,t){var r=this;if(!r._prefMapping[e]){throw new Error("Get called for unsupported preference "+e)}var s=r._prefMapping[e],n;if(!r.has(e)){if(s.store.async){s.store.get(e,function(n){if(typeof n==="undefined"){n=s.defaultVal}r.set(e,n);t(n)});return}else{n=s.store.get(e);if(typeof n==="undefined"){n=s.defaultVal}r.set(e,n)}}else{n=r.get(e)}if(t){t(n)}return n},setPreference:function(e,t){var r=e,s=this;if(typeof r!=="object"){r={};r[e]=t}_.each(r,function(e,t){var r=s._prefMapping[t],n;if(typeof r==="undefined"){throw new Error("Unsupported key value "+t+" passed to UserSettings set method")}n=r.store;if(typeof e==="object"||s.get(t)!==e){if(n.save){n._dirty=true}s.set(t,e);n.set(t,e)}})},save:function(e){var t=0;function r(){t--;if(t===0&&e){e()}}_.each(this._prefStores,function(e){if(e._dirty){e._dirty=false;t++;e.save(r)}})},_loadOMKeys:function(){var t=e.Messenger.Common.OMUtils,r=this;if(!t){r._settingsMigrated();return}t.fetchAllKeys({success:function(e){_.each(e,function(e,t){r.setPreference(t,e)});r._settingsMigrated()},failure:function(){r._settingsMigrated()}})},_settingsMigrated:function(){var e=this;e.setPreference("mimPrefMigrated",true);e.save()}});e.namespace("Messenger.Model").UserSettings=new t},"@VERSION@",{requires:["tictac-base-model","underscore"]});YUI.add("messenger-contact",function(e){"use strict";var s=e.Messenger.Common.Constants,t=e.Messenger.Common.Utils,o={ACCEPT_ADD:{method:"POST",path:"/v1/buddyrequest/{{network}}/{{adderId}}"},ADD_USER:{method:"PUT",path:"/v1/group/{{groupname}}/contact/{{network}}/{{user}}"},DENY_ADD:{method:"DELETE",path:"/v1/buddyrequest/{{network}}/{{adderId}}"},IGNORE_USER:{method:"PUT",path:"/v1/ignorelist/{{network}}/{{user}}"},UNIGNORE_USER:{method:"DELETE",path:"/v1/ignorelist/{{network}}/{{user}}"},REPORT_SPAM:{method:"POST",path:"/v1/abuse/spim"},DELETE_USER:{method:"DELETE",path:"/v1/group/{{group}}/contact/{{network}}/{{user}}"},EDIT_CONTACT:{method:"PUT",path:"/v1/contact/{{network}}/{{contactId}}"},VISIBLE_LIST_ADD:{method:"PUT",path:"/v1/stealth/visiblelist"},VISIBLE_LIST_DELETE:{method:"DELETE",path:"/v1/stealth/visiblelist"},INVISIBLE_LIST_ADD:{method:"PUT",path:"/v1/stealth/invisiblelist"},INVISIBLE_LIST_DELETE:{method:"DELETE",path:"/v1/stealth/invisiblelist"}};e.namespace("Messenger.Model").Contact=e.Tictac.base.Model.extend({defaults:{presenceState:s.STATE.OFFLINE,presenceMessage:"",customDNDStatus:null,firstName:"",lastName:"",nickname:"",mobileno:null,email:"",user:"",displayName:"",network:"yahoo",image:t.getDefaultBuddyImage(),authorized:false,incomingAddRequest:false,onVisibleList:false,onInvisibleList:false,ignored:false,type:"unknown",score:0,clientType:"0",addressbook:{},topContact:false,groups:[],clientCapabilities:{richText:true,smileys:true,buzz:true,fileXfer:true,voice:true,video:true,typing:true,videoDevice:true}},requestManager:e.Messenger.Common.RequestManager,initialize:function(){if(!this.get("displayName")){this.set({displayName:this.get("user")})}},sendAddResponse:function(s){var n={authReason:s.message||""},a=s.accept?o.ACCEPT_ADD:o.DENY_ADD;if(s.alias){n.authAs=s.alias}e.Messenger.Common.RequestManager.issueRequest({method:a.method,path:t.substitute(a.path,{network:encodeURIComponent(this.get("network")),adderId:encodeURIComponent(this.get("user"))}),postBody:n,successCallback:s.success||null,errorCallback:s.err||null});this.set("incomingAddRequest",false);if(s.accept&&this.get("type")!=="buddy"){this.sendAddRequest(s)}},sendAddRequest:function(n){var a={message:n.message||""},i=o.ADD_USER,r=this.get("network"),u=this.get("user"),c=this;if(this.get("type")==="buddy"){return}if(n.addAs){a.addAs=n.addAs}a.addressbook=this._getAddressbook();if(_.indexOf(this.get("groups"),n.group)===-1){this.get("groups").push(n.group)}e.Messenger.Common.RequestManager.issueRequest({method:i.method,path:t.substitute(i.path,{user:encodeURIComponent(u),network:encodeURIComponent(r),groupname:encodeURIComponent(n.group)}),postBody:a,successCallback:function(){c.set({type:"buddy"});e.Messenger.GlobalEvents.trigger(s.EVENTS.ADD_REQUEST_SENT,c);if(n.successCallback){n.successCallback()}},errorCallback:n.errorCallback})},ignoreUser:function(s){s=s||{};var n=this.get("user"),a=this.get("network"),i=o.IGNORE_USER,r=this;e.Messenger.Common.RequestManager.issueRequest({method:i.method,path:t.substitute(i.path,{network:encodeURIComponent(a),user:encodeURIComponent(n)}),postBody:{},successCallback:function(){r.set("ignored",true);if(s.success){s.success()}},errorCallback:s.err||null});this.declinePendingAddRequest()},unignoreUser:function(s){s=s||{};var n=this.get("user"),a=this.get("network"),i=o.UNIGNORE_USER,r=this;e.Messenger.Common.RequestManager.issueRequest({method:i.method,path:t.substitute(i.path,{network:encodeURIComponent(a),user:encodeURIComponent(n)}),postBody:{},successCallback:function(){r.set("ignored",false);if(s.success){s.success()}},errorCallback:s.err||null})},deleteContact:function(s){s=s||{};var n=this,a=s.groups||n.get("groups").slice(0),i=o.DELETE_USER,r=0;_.each(a,function(o){var u=t.substitute(i.path,{group:encodeURIComponent(o.name||o),network:encodeURIComponent(n.get("network")),user:encodeURIComponent(n.get("user"))});e.Messenger.Common.RequestManager.issueRequest({method:i.method,path:u,successCallback:function(){var e=n.get("groups");e.splice(_.indexOf(e,o),1);n.set("groups",e);r++;if(r===a.length&&s.successCallback){if(e.length===0){n.set("type","unknown")}s.successCallback()}},errorCallback:function(e){if(s.errorCallback){s.errorCallback(e)}}})})},reportSpam:function(s){var t=o.REPORT_SPAM;e.Messenger.Common.RequestManager.issueRequest({method:t.method,path:t.path,postBody:{spammerId:this.get("user"),spammedAs:s.alias,initiatedBy:s.initiatedBy,network:this.get("network"),spims:s.spims},successCallback:s.success||null,errorCallback:s.err||null});this.declinePendingAddRequest()},declinePendingAddRequest:function(){if(this.get("incomingAddRequest")){this.sendAddResponse({accept:false})}},_getAddressbook:function(){var e={email:this.get("email")||"",firstname:this.get("firstName")||"",lastname:this.get("lastName")||"",nickname:this.get("nickname")||"",mobileno:this.get("mobileno")||"",homeno:this.get("homeno")||"",workno:this.get("workno")||""};if(this.get("addressbookId")){e.id=this.get("addressbookId")}return e},editContact:function(s){s=s||{};var n=o.EDIT_CONTACT;e.Messenger.Common.RequestManager.issueRequest({method:n.method,path:t.substitute(n.path,{network:encodeURIComponent(s.network||this.get("network")),contactId:encodeURIComponent(s.user||this.get("user"))}),postBody:{addressbook:s.addressbook||this._getAddressbook()},successCallback:s.success||null,errorCallback:s.failure||null})},addToVisibleList:function(s){var t=this,n=o.VISIBLE_LIST_ADD;s=s||{};if(this.get("isInvisible")){this.removeFromInvisibleList(s)}e.Messenger.Common.RequestManager.issueRequest({method:n.method,path:n.path,postBody:{members:[{id:t.get("user"),network:t.get("network")}]},successCallback:e.bind(function(e){this.set("isVisible",true);if(s.successCallback){s.successCallback(e)}},this),errorCallback:s.errorCallback})},removeFromVisibleList:function(s){var t=this,n=o.VISIBLE_LIST_DELETE;s=s||{};e.Messenger.Common.RequestManager.issueRequest({method:n.method,path:n.path,postBody:{members:[{id:t.get("user"),network:t.get("network")}]},successCallback:e.bind(function(e){this.set("isVisible",false);if(s.successCallback){s.successCallback(e)}},this),errorCallback:s.errorCallback})},addToInvisibleList:function(s){var t=this,n=o.INVISIBLE_LIST_ADD;s=s||{};if(this.get("isVisible")){this.removeFromVisibleList(s)}e.Messenger.Common.RequestManager.issueRequest({method:n.method,path:n.path,postBody:{members:[{id:t.get("user"),network:t.get("network")}]},successCallback:e.bind(function(e){this.set("isInvisible",true);if(s.successCallback){s.successCallback(e)}},this),errorCallback:s.errorCallback})},removeFromInvisibleList:function(s){var t=this,n=o.INVISIBLE_LIST_DELETE;s=s||{};e.Messenger.Common.RequestManager.issueRequest({method:n.method,path:n.path,postBody:{members:[{id:t.get("user"),network:t.get("network")}]},successCallback:e.bind(function(e){this.set("isInvisible",false);if(s.successCallback){s.successCallback(e)}},this),errorCallback:s.errorCallback})}})},"@VERSION@",{requires:["messenger-constants","messenger-utils","messenger-requestmanager","tictac-base-model"]});YUI.add("messenger-message",function(t){"use strict";function e(e){this._yml=e.yml||e.node&&t.Messenger.YMLUtil.domToYml(e.node)||"";this.sender=e.sender;this.receiver=e.receiver;this.fromSelf=e.fromSelf;this.timeStamp=e.timeStamp;this.type=e.type;this.hash=e.hash;this.msgContext=e.msgContext;this.sequence=e.sequence;this.status=e.status;this.mobileno=e.mobileno;this.network=e.network}e.prototype={};e.prototype.constructor=e;e.prototype.html=function(){if(!this._html){this._html=t.Messenger.YMLUtil.ymlToHtml(this._yml)}return this._html};e.prototype.yml=function(){return this._yml};e.prototype.text=function(){var e=this;if(!e._text){try{e._text=t.Node.create(this.html()).get("text")}catch(s){e._text=""}}return e._text};t.namespace("Messenger.Model").Message=e},"@VERSION@",{requires:["messenger-ymlutils"]});YUI.add("messenger-smsutils",function(e){"use strict";var n={us:{name:"united_states",code:"1",idd:["011"],ndd:["1"]},ca:{name:"canada",code:"1",idd:["011"],ndd:["1"]},hk:{name:"hong_kong",code:"852",idd:["001"],ndd:[]},id:{name:"indonesia",code:"62",idd:["001","008"],ndd:["0"]},"in":{name:"india",code:"91",idd:["00"],ndd:["0"]},kr:{name:"south_korea",code:"82",idd:["001","002"],ndd:["0"]},kw:{name:"kuwait",code:"965",idd:["00"],ndd:["0"]},my:{name:"malaysia",code:"60",idd:["00"],ndd:["0"]},ph:{name:"philippines",code:"63",idd:["00"],ndd:["0"]},pk:{name:"pakistan",code:"92",idd:["00"],ndd:["0"]},th:{name:"thailand",code:"66",idd:["001"],ndd:["0"]},vn:{name:"vietnam",code:"84",idd:["00"],ndd:["0"]}},r=e.Messenger.Model.UserSettings;function d(e){var n;switch(e){case"e1":case"":n="us";break;case"cf":n="ca";break;case"hi":n="in";break;default:n=e;break}return n}function t(e){var r=d(e);return n[r]?n[r]:null}function i(e,n){var r;if(n&&n.length>0){for(r=0;r<n.length;r++){if(e.indexOf(n[r])===0){return e.slice(n[r].length)}}}return null}e.namespace("Messenger.Common").SMSUtils={getCountries:function(){var r,d=[];for(r in n){if(n.hasOwnProperty(r)){d.push(e.merge({key:r},n[r]))}}return d},getIntlCode:d,normalizeNumber:function(e,n){var d,s,a=typeof NeoConfig!=="undefined"?NeoConfig.intl:"";if(!n){n=r.getPreference("mimHomeCountryPref");n=n===""&&a&&_.indexOf(_.map(this.getCountries(),function(e){return e.key}),a)===0?a:n}e=e.replace(/^\s+|\s+$/g,"");if(e.indexOf("+")===0){return e.replace(/[^0-9]/g,"")}e=e.replace(/[^0-9]/g,"");d=t(n);if(!d){return null}s=i(e,d.idd);if(s){return s}else if(d.code){s=i(e,d.ndd);if(s){return d.code+s}return d.code+e}return null},countUtf8Bytes:function(e){var n,r=e.length,d=0;for(n=0;n<r;n++){d+=this.charToBytes(e.charCodeAt(n))}return d},splitStrBytes:function(e,n){var r="",d,t,i,s,a=0;for(t=0,i=e.length;t<i&&a<n;t++){s=this.charToBytes(e.charCodeAt(t));if(a+s<=n){a+=s;r+=e.charAt(t)}else{break}}d=e.substring(r.length);return[r,d]},charToBytes:function(e){if(e<128){return 1}else if(e<2048){return 2}else{return 3}}}},"1.0.0",{requires:["underscore","messenger-constants","messenger-utils","messenger-usersettings"]});YUI.add("tictac-base-strings",function(a){a.namespace("Tictac.base").strings={str_comp_font_size_attr:"Select a font size",str_conv_dialog_alert:"Alert",str_conv_dialog_confirm:"Confirm",str_notepad:"Notepad",str_ok:"OK",str_rte_font_arial_attr:"Helvetica Neue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, Sans-Serif",str_rte_font_bookman_attr:"bookman old style, new york, times, serif",str_rte_font_classic:"Classic",str_rte_font_classicwide:"Classic wide",str_rte_font_courier:"Courier New",str_rte_font_courier_attr:"Courier New, courier, monaco, monospace, sans-serif",str_rte_font_garamond:"Garamond",str_rte_font_garamond_attr:"garamond, new york, times, serif",str_rte_font_huge:"Huge",str_rte_font_large:"Large",str_rte_font_lucida:"Lucida Console",str_rte_font_lucida_attr:"lucida console, sans-serif",str_rte_font_medium:"Medium",str_rte_font_modern:"Modern",str_rte_font_modernwide:"Modern wide",str_rte_font_small:"Small",str_rte_font_times_attr:"times new roman, new york, times, serif",str_rte_font_tiny:"Tiny",str_rte_font_verdana_attr:"verdana, helvetica, sans-serif",str_rte_font_xlarge:"X-Large",str_size_bytes:"{{size}}B",str_size_gb:"{{size}}GB",str_size_kb:"{{size}}KB",str_size_mb:"{{size}}MB",last:null}},"1.0.0");YUI.add("tictac-base-mailutils",function(a){var b={"ameritech.net":!0,"btinternet.com":!0,"btopenworld.com":!0,"demobroadband.com":!0,"ovi.com":!0,"flash.net":!0,"nl.rogers.com":!0,"nvbell.net":!0,"pacbell.net":!0,"prodigy.net":!0,"rogers.com":!0,"sbcglobal.net":!0,"snet.net":!0,"swbell.net":!0,"talk21.com":!0,"verizon.net":!0,"wans.net":!0,"ymail.com":!0,"rocketmail.com":!0,"yahoo-inc.com":!0},c={ad:!0,ae:!0,af:!0,ag:!0,ai:!0,al:!0,am:!0,an:!0,ao:!0,aq:!0,ar:!0,as:!0,at:!0,au:!0,aw:!0,az:!0,ba:!0,bb:!0,bd:!0,be:!0,bf:!0,bg:!0,bh:!0,bi:!0,bj:!0,bm:!0,bn:!0,bo:!0,br:!0,bs:!0,bt:!0,bv:!0,bw:!0,by:!0,bz:!0,ca:!0,cc:!0,cf:!0,cg:!0,ch:!0,ci:!0,ck:!0,cl:!0,cm:!0,cn:!0,co:!0,cr:!0,cs:!0,cu:!0,cv:!0,cx:!0,cy:!0,cz:!0,de:!0,dj:!0,dk:!0,dm:!0,"do":!0,dz:!0,ec:!0,ee:!0,eg:!0,eh:!0,es:!0,et:!0,fi:!0,fj:!0,fk:!0,fm:!0,fo:!0,fr:!0,fx:!0,ga:!0,gb:!0,gd:!0,ge:!0,gh:!0,gi:!0,gl:!0,gp:!0,gq:!0,gf:!0,gm:!0,gn:!0,gr:!0,gt:!0,gu:!0,gw:!0,gy:!0,hk:!0,hm:!0,hn:!0,hr:!0,ht:!0,hu:!0,id:!0,ie:!0,il:!0,"in":!0,io:!0,iq:!0,ir:!0,is:!0,it:!0,jm:!0,jo:!0,jp:!0,ke:!0,kg:!0,kh:!0,ki:!0,km:!0,kn:!0,kp:!0,kr:!0,kw:!0,ky:!0,kz:!0,la:!0,lb:!0,lc:!0,li:!0,lk:!0,lr:!0,ls:!0,lt:!0,lu:!0,lv:!0,ly:!0,ma:!0,mc:!0,md:!0,mg:!0,mh:!0,ml:!0,mm:!0,mn:!0,mo:!0,mp:!0,mq:!0,mr:!0,ms:!0,mt:!0,mu:!0,mv:!0,mw:!0,mx:!0,my:!0,mz:!0,na:!0,nc:!0,ne:!0,nf:!0,ng:!0,ni:!0,nl:!0,no:!0,np:!0,nr:!0,nt:!0,nu:!0,nz:!0,om:!0,pa:!0,pe:!0,pf:!0,pg:!0,ph:!0,pk:!0,pl:!0,pm:!0,pn:!0,pt:!0,pr:!0,pw:!0,py:!0,qa:!0,re:!0,ro:!0,ru:!0,rw:!0,sa:!0,sb:!0,sc:!0,sd:!0,se:!0,sg:!0,sh:!0,si:!0,sj:!0,sk:!0,sl:!0,sm:!0,sn:!0,so:!0,sr:!0,st:!0,su:!0,sv:!0,sy:!0,sz:!0,tc:!0,td:!0,tf:!0,tg:!0,th:!0,tj:!0,tk:!0,tm:!0,tn:!0,to:!0,tp:!0,tr:!0,tt:!0,tv:!0,tw:!0,tz:!0,ua:!0,ug:!0,uk:!0,um:!0,us:!0,uy:!0,uz:!0,va:!0,vc:!0,ve:!0,vg:!0,vi:!0,vn:!0,vu:!0,wf:!0,ws:!0,ye:!0,yu:!0,za:!0,zm:!0,zr:!0,zw:!0},d={aero:!0,asia:!0,biz:!0,com:!0,edu:!0,gov:!0,info:!0,jobs:!0,mil:!0,mobi:!0,museum:!0,name:!0,net:!0,org:!0,co:!0};a.namespace("Tictac.base").mailutils={openMessage:function(a){var b=a.fid.replace?a.fid.replace("%2F","%5C").replace("%2f","%5c"):a.fid,c={fid:b,msg:{mid:a.mid,fid:b}};c[a.name]=!0,window.yui.fire("openMessage",c)},rotateAds:function(b,c,d){var e={type:"a",name:"VISIBLE",evt:{sp:b,npv:!c,trace:d||"tictac"}},f=window.yui||a;f.fire("darlaEvent",{action:e})},getYahooIdFromEmail:function(a){function h(a){var c=!1,d=-1,e;if(!a)return!1;e=a.split("."),c=e.length>2;if(c){d=a.indexOf(".");if(d!==-1)return a=a.slice(d+1),h(a)}return b[a]?!0:!1}function i(a){if(!a)return!1;var b=a.split(".");return b[0]!=="yahoo"?!1:b.length>3?!1:b.length>2&&c[b[2]]?d[b[1]]:b.length===2?d[b[1]]||c[b[1]]:!1}var e,f,g;g=a.toLowerCase().split("@"),e=g[0],f=g[1];if(h(f))e=a;else{if(!i(f))return;f==="yahoo.cn"&&(e=a)}if(e.length<4||e.length>32)return;return e},isOutlook:function(a){if(a.indexOf("@outlook.")>-1||a.indexOf("@hotmail.com")>-1||a.indexOf("@live.com")>-1||a.indexOf("@msn.com")>-1)return!0},isAOL:function(a){if(a.indexOf("@aol.com")>-1)return!0},isGmail:function(a){if(a.indexOf("@gmail.com")>-1||a.indexOf("@google.com")>-1)return!0},getFontFamilies:function(){var b=a.Tictac.base.strings,c=[],d=[{value:b.str_rte_font_arial_attr,name:b.str_rte_font_modern},{value:b.str_rte_font_verdana_attr,name:b.str_rte_font_modernwide},{value:b.str_rte_font_times_attr,name:b.str_rte_font_classic},{value:b.str_rte_font_bookman_attr,name:b.str_rte_font_classicwide},{value:b.str_rte_font_courier_attr,name:b.str_rte_font_courier},{value:b.str_rte_font_garamond_attr,name:b.str_rte_font_garamond},{value:b.str_rte_font_lucida_attr,name:b.str_rte_font_lucida}];return window.strings&&window.strings.str_cfg_intl_fonts&&(c=a.JSON.parse(window.strings.str_cfg_intl_fonts)),d.concat(c)},getFontFamiliesByFont:function(){var b=a.Tictac.base.strings,c={};return c[b.str_rte_font_modern]=b.str_rte_font_arial_attr,c[b.str_rte_font_modernwide]=b.str_rte_font_verdana_attr,c[b.str_rte_font_classic]=b.str_rte_font_times_attr,c[b.str_rte_font_classicwide]=b.str_rte_font_bookman_attr,c[b.str_rte_font_courier]=b.str_rte_font_courier_attr,c[b.str_rte_font_garamond]=b.str_rte_font_garamond_attr,c[b.str_rte_font_lucida]=b.str_rte_font_lucida_attr,c}}},"1.0.0",{requires:["tictac-base-strings","json-parse"]});YUI.add("messenger-abutils",function(e){"use strict";var a=e.Messenger.Common.SMSUtils;e.namespace("Messenger.Common").ABUtils={parseContacts:function(s,i){var n=_.keys(s),r=[],o=this;if(n.length===0){return[]}e.Messenger.Common.Utils.doLongWork(n,function(e){var i=s[e],n=[],t={};if(!i.fields){return}_.each(i.fields,function(e){var s,i,r;switch(e.type){case"name":t.firstName=e.value.givenName||"";t.lastName=e.value.familyName||"";break;case"nickname":t.nickname=e.value;break;case"email":t.email=e.value;t.mail_score=e.sc_score||0;r=o.extractYidFromEmail(t.email);if(r){n.push({id:r.id,network:r.network})}t.sc_score=e.sc_score;break;case"phone":if(e.flags&&e.flags[0]){s=e.flags[0];switch(s){case"HOME":t.homeno=e.value;break;case"WORK":t.workno=e.value;break;case"MOBILE":t.mobileno=e.value;t.normalizedNumber=a.normalizeNumber(t.mobileno);if(!n.length){n.push({id:t.mobileno,network:"sms"})}break}}break;case"guid":t.guid=e.value;break;case"yahooid":if(e.value&&e.value.length>=4&&e.value.length<=32){n.push({id:e.value,network:"yahoo"})}break;case"otherid":i=e.flags&&e.flags[0];if(i==="IBM"||i==="LCS"){n.push({id:e.value,network:i.toLowerCase()})}}});t.addressbookId=i.id;if(n.length>1&&n[0].network==="sms"){n.shift()}_.each(n,function(e){r.push(_.extend(e,t))})},function(){if(i){i(r)}})},extractYidFromEmail:function(a){if(typeof a!=="string"){return}var s=e.Tictac.base.mailutils.getYahooIdFromEmail(a);return s?{id:s,network:"yahoo"}:undefined}}},"1.0.0",{requires:["underscore","messenger-constants","messenger-utils","messenger-smsutils","tictac-base-mailutils"]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("escape",function(e,t){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;"},r={html:function(e){return(e+"").replace(/[&<>"'\/`]/g,r._htmlReplacer)},regex:function(e){return(e+"").replace(/[\-$\^*()+\[\]{}|\\,.?\s]/g,"\\$&")},_htmlReplacer:function(e){return n[e]}};r.regexp=r.regex,e.Escape=r},"3.13.0",{requires:["yui-base"]});
YUI.add("messenger-contactlist",function(e){"use strict";var t=e.Messenger.Common.Constants,s=t.EVENTS,n=e.Messenger.Common.RequestManager,i=e.Messenger.Model.Session,r=e.Messenger.Common.Utils,a=e.Messenger.Common.SMSUtils,o,d=null,c={SUBSCRIBE_PRESENCE:{method:"PUT",path:"/v1/subscription/presence",args:["blocking=0"]},UNSUBSCRIBE_PRESENCE:{method:"DELETE",path:"/v1/subscription/presence",args:["blocking=0"]}};o=Backbone.Collection.extend({model:e.Messenger.Model.Contact,requestManager:n,utils:r,initialize:function(t,r){var a=this;r=r||{};a._displayNameTemplate=r.displayNameTemplate||"{{firstName}} {{lastName}}";a.ABParsed=false;a.parseBuddies();i.on("change:buddies",a.parseBuddies,a);i.on("change:presenceState",a._handlePresenceChange,a);i.on(s.OFFLINE,a.reset,a);n.addListeners([{id:"buddyInfo",callback:e.bind(a._handleBuddyInfo,a)},{id:"buddyStatus",callback:e.bind(a._handleBuddyStatus,a)},{id:"logOff",callback:e.bind(a._handleBuddyLogout,a)},{id:"buddyAuthorize",callback:e.bind(a._handleBuddyAuthorize,a)},{id:"displayImagePrefs",callback:e.bind(a._handleDisplayImagePrefs,a)},{id:"ignoreList",callback:e.bind(a._handleIgnoreList,a)},{id:"editIgnoreList",callback:e.bind(a._handleEditIgnore,a)},{id:"editInvisibleList",callback:e.bind(a._handleEditInvisible,a)},{id:"editVisibleList",callback:e.bind(a._handleEditVisible,a)}]);a.on("change:firstName change:lastName",a._handleNameChange,a)},setDisplayNameTemplate:function(e){this._displayNameTemplate=e},parseAddressBook:function(t){var n=this,i=[],a=e.Messenger.Model.UserSettings.getPreference("mimShowOnlyBuddies")?"unsubscribe":"subscribe";e.Messenger.Common.ABUtils.parseContacts(t,function(e){_.each(e,function(e){var t;e.user=e.user||e.id;e.id=r.getUserId(e.user,e.network);t=n.get(e.id);if(!t||t.get("type")==="unknown"){e.type="addressbook";e=n.normalizeContact(e)}else{_.extend(e,n._generateDisplayName(e))}i.push(e)});n.add(i,{merge:true});n.handleABPresence(a);n.ABParsed=true;n.trigger(s.AB_PARSING_COMPLETE)})},handleAddressBookContactRemoval:function(e){var t=this;_.each(e,function(e){t.remove(t.where({addressbookId:e.id,type:"addressbook"}))})},parseBuddies:function(){var t=i.get("buddies"),s=this,n,a=[];if(!t||!t.length){return}function o(t){t=t.contact||t;n=s.get(r.getUserId(t.id,t.network||"yahoo"));if(n){e.mix(t,n.attributes)}t=s.normalizeContact(t);t.type="buddy";a.push(t)}e.Messenger.logPerf("Starting parsing of buddies");r.doLongWork(t,o,function(){e.Messenger.logPerf("Finished parsing "+t.length+" buddies");s.add(a,{merge:true})})},_handlePresenceChange:function(e){if(e.get("presenceState")===t.STATE.OFFLINE){_.each(this.filter(function(e){return e.get("presenceState")!==t.STATE.OFFLINE}),function(e){e.set("presenceState",t.STATE.OFFLINE)})}else if(e.previous("presenceState")===t.STATE.OFFLINE||e.previous("presenceState")===t.STATE.PENDING){this.handleABPresence("subscribe")}},_handleNameChange:function(e){var t=this,s=t._generateDisplayName({firstName:e.get("firstName"),lastName:e.get("lastName"),user:e.get("user")});e.set({displayName:s.displayName})},_generateDisplayName:function(t){var s,n;if(t.firstName&&t.lastName){s=r.substitute(this._displayNameTemplate,{firstName:t.firstName,lastName:t.lastName})}else{s=t.firstName||t.lastName||t.user}n=r.unescapeHTML(s);s=e.Escape.html(n);return{displayName:s,displayNameRaw:n}},normalizeContact:function(e){var t,s;if(e.contact){e=e.contact}e.user=e.user||e.sender||e.id;e.network=e.network||"yahoo";e.id=r.getUserId(e.user,e.network);_.extend(e,this._generateDisplayName(e));if(typeof e.presence!=="undefined"){e.presenceState=e.presence.presenceState;e.presenceMessage=e.presence.presenceMessage}e.presenceMessage=e.presenceMessage?r.normalizePresenceMessage(e.presenceMessage):"";e.presenceState=r.normalizePresenceState(e);if(typeof e.authorized!=="undefined"){e.authorized=e.authorized===0?false:true}t=e.clientCapabilities;if(typeof t!=="undefined"){e.clientCapabilities={};e.clientCapabilities.richText=!!(t&1);e.clientCapabilities.smileys=!!(t&2);e.clientCapabilities.buzz=!!(t&4);e.clientCapabilities.fileXfer=!!(t&32768);e.clientCapabilities.voice=!!(t&65536);e.clientCapabilities.video=!!(t&4194304);e.clientCapabilities.typing=!!(t&8388608);e.clientCapabilities.videoDevice=!!(t&16777216)}s=r.generateImgURL(e,true);if(s){e.image=s}if(this.get(e.id)&&this.get(e.id).get("type")==="buddy"){e.type="buddy"}if(e.network==="sms"){e.mobileno=e.mobileno||e.user;e.normalizedNumber=e.normalizedNumber||a.normalizeNumber(e.mobileno)}return e},getContact:function(e,t){t=t||"yahoo";var s=r.getUserId(e,t),n=this.get(s);if(!e){return null}if(!n){this.add(this.normalizeContact({user:e,network:t}));n=this.get(s)}return n},deleteContact:function(e){var t=this.get(e),s=t.get("addressbookId");if(t.type==="addressbook"){this.handleABPresence("unsubscribe",[t])}else{t.deleteContact()}if(s){try{yui.contacts.api.deleteContacts([s])}catch(n){}}this.remove(t)},_handleBuddyInfo:function(t){var s=t.contact,n=this,i=[];if(!this._presenceReceived){e.Messenger.logPerfStats("t4");this._presenceReceived=true;e.Messenger.logPerf("*** First contact presence received")}if(!s){return}if(!s.length){s=[s]}e.Array.each(s,function(e){var t=e.sender||e.id||e.user,s=e.network||"yahoo";if(s==="facebook"){return}e.id=r.getUserId(t,s);if(!n.get(e.id)){e=n.normalizeContact(e)}else{if(typeof e.presence!=="undefined"){e.presenceState=e.presence.presenceState;e.presenceMessage=e.presence.presenceMessage}e.presenceState=r.normalizePresenceState(e);e.presenceMessage=r.normalizePresenceMessage(e.presenceMessage)}i.push(e)});n.update(i,{remove:false})},_handleBuddyStatus:function(e){var t={user:e.sender,network:e.network||"yahoo",presenceState:r.normalizePresenceState(e),presenceMessage:r.normalizePresenceMessage(e.presenceMessage),id:r.getUserId(e.sender,e.network||"yahoo")};if(e.echo){return}if(e.network==="facebook"){return}if(!this.get(t.id)){t=this.normalizeContact(t)}this.update([t],{remove:false})},_handleBuddyLogout:function(e){var s={user:e.buddy,network:e.network||"yahoo"};s=this.find(function(e){return e.get("user")===s.user&&e.get("network")===s.network});if(s){s.set("presenceState",t.STATE.OFFLINE)}},_handleBuddyAuthorize:function(e){var t,n,r,a;if(e.echo){return}n=e.network||"yahoo";r=e.user||e.id||e.sender;a=this.getContact(r,n);if(e.status===0||e.status===3){a.set("incomingAddRequest",true);t=e.receiver||i.get("loggedInId");this.trigger(s.ADD_REQUEST_RECEIVED,{alias:t,user:r,network:n,msg:e.msg||""})}else if(e.status===1){if(e.authState===2){if(a){this.remove(a)}this.trigger(s.ADD_REJECTED,e)}else{if(a){a.set({authorized:true})}this.trigger(s.ADD_ACCEPTED,e)}}},_handleDisplayImagePrefs:function(e){var t=this,s=e.sender,n=e.network||"yahoo",a=t.get(r.getUserId(s,n));if(i.isMyself(s)){i.set("image",e.url)}else if(a){a.set("image",r.generateImgURL({user:s,network:n,displayImagePrefs:e}))}},handleABPresence:function(e,s){var n=c.SUBSCRIBE_PRESENCE,r="PRESENCE",a=[],o=i.get("presenceSubscriptionsMaxPerRequest")||50,d=this;s=s||this.where({type:"addressbook"});if(!i.isOnline()){return}if(e==="unsubscribe"){n=c.UNSUBSCRIBE_PRESENCE;r="PRESENCE_OFF"}_.each(s,function(s){var n,r=s.get("network"),o=s.get("user");if(e==="unsubscribe"){s.set("presenceState",t.STATE.OFFLINE);s.set("presenceMessage","")}if(r!=="sms"&&!i.isMyself(o)){n={id:o};if(r&&r!=="yahoo"){n.network=r}a.push(n)}});d.utils.slicer(a,o,function(e){d.requestManager.issueRequest({type:r,method:n.method,path:n.path,args:n.args,postBody:{members:e}})})},_unsubscribeABPresence:function(e){var t=c.UNSUBSCRIBE_PRESENCE;if(!i.isOnline()||e.get("type")!=="addressbook"){return}this.requestManager.issueRequest({type:"PRESENCE_OFF",method:t.method,path:t.path,args:t.args,postBody:{members:[e.get("user")]}})},_handleIgnoreList:function(e){var t=e.ignoredUsers,s,n,i;_.each(this.where({ignored:true}),function(e){e.set("ignored",false)});for(s=0,n=t.length;s<n;s++){i=this.getContact(t[s].ignoredUser.id,t[s].ignoredUser.network||"yahoo");i.set("ignored",true)}},_handleEditIgnore:function(e){var t=e.userName,s=e.network||"yahoo",n;if(!e.errorCode&&e.type===1&&t){n=this.getContact(t,s);if(e.state===1){n.set("ignored",true)}else{n.set("ignored",false)}}},_handleEditVisible:function(e){var t=this,s=e.buddyList;if(!e.errorCode&&e.type===1){if(e.command===3){t.where({isVisible:true}).set("isVisible",false)}else{_.each(s,function(s){var n=s.buddy,i=s.network||"yahoo",r=t.getContact(n,i);if(r){r.set("isVisible",e.command===1)}})}}},_handleEditInvisible:function(e){var t=this,s=e.buddyList;if(!e.errorCode&&e.type===1){if(e.command===3){t.where({isInvisible:true}).set("isInvisible",false)}else{_.each(s,function(s){var n=s.buddy,i=s.network||"yahoo",r=t.getContact(n,i);if(r){r.set("isInvisible",e.command===1)}})}}}});e.namespace("Messenger.Model").ContactList={getInstance:function(e){if(!d){d=new o(null,e)}return d}}},"@VERSION@",{requires:["messenger-contact","messenger-session","messenger-systemsettings","messenger-conversationlist","messenger-utils","messenger-abutils","escape","messenger-smsutils","messenger-constants"]});