YUI.add("mail-ui-convpane-error",function(B){B.namespace("mail.ui");var R=B.mail,E=R.ui,P=E._ConvPane,C=B.common.Utils,A=C.rocketstats,J=C.ymmastats,I=C.substitute,N=B.ui.Templates._shared_module_thread_thread_display_rollup,F=E.MessagePaneUtils,D=E.PaneUtils;function G(U){var V=this,T="",S;if(V.conv_deleted_error){S=N.conv_deleted_error;}else{if(V.msg_deleted_error){T=D.getMsgSub(this.message);S=N.msg_deleted_error;}else{if(!U){T=D.getMsgSub(this.message);S=N.conv_loading_error;}else{T=(U&&U.header&&U.header.subject)?U.header.subject:strings["str_msg-view_no_subject"];S=N.loading_error;}}}return I(S,{msg_subject:C.escapeHtml(T)},V.readFormatters,0,strings);}function O(){var X=this,W=X.message||{},S=X.sourceFolderInfo||0,T,U,V="";if(W.mid){T=S?S.fid:"";U=S?S.name:"";if(T){V=I(N.diff_folder_error,{newFid:T,foldername:U},0,0,strings);}}if(!V){V=X.getFailureMarkup();}return V;}function K(){return I(N.loading_slow,0,0,0,strings);}function L(){var S=this;if(S.outboundReq){S.augmentFormatters();S.slowLoad=S.msg_deleted_error=S.conv_deleted_error=S.loading_error=S.loading_moved=0;S.loading_slow=1;S.render();}}function M(j,b){var d=this,l=B.mail,c=l.model.DataStore,Z,k,V,f=d.retryPrefix(),g=j.reason,a=j.data&&j.data.status,U=b?"preloadFailure":"loadConvFailure",T=C.Stopwatch,X=T.get("MsgInPreview"),h,i,W,e={"GetCidsInvalidMids":true,"MessageFetchFailed":true,"MessageIdsNotFound":true,"MessageNotFound":true,"GetMessageInvalidId":true,"MessageSelectionNotFound":true,"MessageIdsDeleted":true,"ERROR":true},Y={"ConvIdCouldNotBeFound":true,"InvalidConvId":true,"MalformedConvId":true};function S(n){var m=n&&(n.match(/Client\.([\w\W]+)$/)||n.match(/Server\.([\w\W]+)$/));return(m&&m[1])||n;}A.stat("convread",(f+U));A.stat("convread",(f+U+"Reason:"+g));J.stat("convread","result=>failure,env=>"+NeoConfig.mailEnv);d.isTae4=d.isTae46=false;if(j.code==="BatchItemError"){W=j.fault&&j.fault.detail&&j.fault.detail[0]&&j.fault.detail[0].code;W=S(W);}else{W=(j.reason&&j.reason.code&&S(j.reason.code))||(j.code&&S(j.code));}h=c.Folders.get(d.fid);V=j?j.data:0;if(e[W]===true){d.isTae4=true;i="TAE4:GDM:FAILURE:"+d.numRetries+":";A.stat("messageread",i+g);A.stat("messageread",i+g+":code:"+W);A.stat("messageread",i+g+":status:"+a);A.stat("messageread",i+(h.isSystem?"system":"custom"));if(d.numRetries>=d.maxRetries){d.canRetry=false;A.stat("messageread","TAE4:GDM:NoRetry:"+W);A.stat("messageread","tae45");}else{d.canRetry=true;}}else{if(Y[W]===true){d.canRetry=false;d.isTae46=true;if(W==="ConvIdCouldNotBeFound"){if(d.numRetries<d.maxRetries){d.canRetry=true;}}}}if(X){F.cleanUpStopwatch(X);X.stop("MsgInPreviewFailure");}X=d.stopwatch;if(X){X.stop("MsgInTabFailure");}d.augmentFormatters();Z=j.cid;d.resetRequestLoadingState(true);if(j.reason===B.mail.Controller.Messages.Error.moved){d.fireEvent("moved",k);d.sourceFolderInfo=V.sourceFolderInfo?V.sourceFolderInfo:0;d.loading_moved=1;}else{if(j.code!==B.common.net.Error.abort){if(W==="InvalidConvId"){d.conv_deleted_error=1;}else{if(W==="MessageIdsDeleted"){d.msg_deleted_error=1;}}d.fireEvent("getFailure",k);d.loading_error=1;}}if(d.loading_error||d.loading_moved){d.render();}}function Q(W,a){var Y=this,b,U,T=Y.retryPrefix(),V=W.reason,X=a?"preloadFailure":"loadMessageFailure",c=C.Stopwatch,S=c.get("MsgInPreview");clearTimeout(Y.slowLoad);A.stat("messageread",(T+X));A.stat("messageread",(T+X+"Reason:"+V));if(S){F.cleanUpStopwatch(S);S.stop("MsgInPreviewFailure");}S=Y.stopwatch;if(S){S.stop("MsgInTabFailure");}Y.augmentFormatters();try{U=W?W.data:0;if(U&&!U.mid&&U.callback){U=U.callback.args.primeMsg;}b=U?U.mid:0;}catch(Z){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-error:1",Z,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-error:1");b="";}Y.outboundReq=Y.request=null;clearTimeout(Y.slowLoad);Y.isRetrying=Y.loading_slow=0;if(W.reason===B.mail.Controller.Messages.Error.moved){Y.fireEvent("moved",b);Y.sourceFolderInfo=U.sourceFolderInfo?U.sourceFolderInfo:0;U.loading_moved=1;}else{if(W.code!==B.common.net.Error.abort){Y.fireEvent("getFailure",b);U.loading_error=1;}}if(U.loading_error||U.loading_moved){return I(N.msg_loading,U,Y.readFormatters,null,strings);}}function H(){var U=this,S,T=3;U.maxRetries=T;if(!U.readFormatters.loading_slow){B.mix(U.readFormatters,{show_tae:function(){if(U.isTae4||U.isTae46){S=U.isTae4?"4":"46";return I(N.show_tae,{tae_code:S},null,0,strings);}},loading_slow:function(){return U.loading_slow?U.getSlowMarkup():"";},conv_loading_error:function(){return U.loading_error?U.getFailureMarkup():"";},diff_folder_error:function(){return U.loading_moved?U.getMovedMarkup():"";},loading_error:function(V){return U.getFailureMarkup(V);},multi_retry_else:function(V){return I(N.multi_retry_else,V,U.readFormatters,0,strings);},is_perm:function(){return(U.numRetries>=T)?I(N.is_perm,{msg_fail_tae_code:45},0,0,strings):"";},is_perm_else:function(V){return(U.numRetries<T)?I(N.is_perm_else,V,U.readFormatters,0,strings):"";},can_retry:function(){return U.canRetry?I(N.can_retry,null,0,0,strings):"";}});}}B.mix(P.prototype,{getFailureMarkup:G,getMovedMarkup:O,getSlowMarkup:K,onFailure:M,onMsgFailure:Q,handleSlowRequest:L,augmentFormatters:H});},"1.0.0",{requires:["common-utils","_shared_module_thread_thread_display_rollup","mail-ui-pane-utils"]});