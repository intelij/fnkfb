YUI.add("contacts-api-config",function(F){F.namespace("contacts");var A=F.contacts,D={1:"asc",2:"desc"},C={1:"first",3:"last",6:"email"},B;B=function(){var I=this,H=function(J){return !!J;},G={baseHost:{validator:H},uri:{},headers:{},wssid:{},guid:{},requestFn:{},wspath:{value:"/ws/sd",validator:H},start:{},count:{value:"max",validator:H},sortfields:{},out:{value:"guid,nickname,email,yahooid,otherid,phone,jobtitle,company,notes,link,custom,name,address,birthday,anniversary"},prefs:{value:null},sort:{},fields:{},view:{value:["compact"]},rev:{value:0,validator:H},loadSmartContacts:{value:true},reloadOnUpdate:{value:true},fieldsToProcess:{value:["name","nickname","email","yahooid"],validator:function(J){return F.Lang.isArray(J);}}};I.addAttrs(G);I.setSortField=function(J){I.set("sortfields",C[J]);return I.get("sortfields");};I.setSortOrder=function(J){I.set("sort",D[J]);return I.get("sort");};};F.augment(B,F.Attribute);A.config=new B();if(A.clientConfig){A.config.setAttrs(A.clientConfig);}else{if(NeoConfig){var E={guid:NeoConfig.neoguid,wssid:NeoConfig.wssid,wspath:NeoConfig.socdirProxyPath,sortfields:"first",sort:"asc"};if(F.Object.getValue(F,["common","net","SessionMgr"])){E.requestFn=F.common.net.SessionMgr.requestProxy;}A.config.setAttrs(E);}}},"1.0.0",{requires:["attribute"]});YUI.add("contacts-api-cache",function(F){F.namespace("contacts");var B=F.contacts,C=F.contacts.config,E,D=F.Lang,A={CONTACT_CHANGED:"contacts:api:contactChanged",CONTACTS_LOADED:"contacts:api:loaded",CONTACT_IMAGE_UPDATED:"contacts:api:imageUpdated"};B.EVENTS=A;E=function(){var O=this,G=false,N=0,L,P={},T={},U={},Q={},R=[],J=null,I,H,K,S,M;I=function(V,Y){var W,X;if(!Y){Q={};}for(W in V){if(V.hasOwnProperty(W)){X=V[W];Q[X.id]=Q[X.id]||X;if(Y){Q[X.id].contacts=Q[X.id].contacts||[];Q[X.id].contacts.push(Y.id);}}}};M=function(a,Z){var V=a.fields,b,d,W,c,Y,X=P[a.id]={typedFields:{},typedFieldValues:{}};if(!V){return;}Z=Z||[];b=Z.length>0;for(Y in V){if(V.hasOwnProperty(Y)){d=V[Y];W=d.value;c=d.type;if(b&&F.Array.indexOf(Z,c)===-1){continue;}if(!X.typedFields[c]){X.typedFields[c]=[];}if(!X.typedFieldValues[c]){X.typedFieldValues[c]=[];}if(c==="name"){if(W.familyName.indexOf("<")!==-1){W.familyName="";}if(W.givenName.indexOf("<")!==-1){W.givenName="";}}X.typedFields[c].push(d);X.typedFieldValues[c].push(W);}}};O.loadSortPrefs=function(V,W){if(!J){J={};}J.sort_order=V;J.sort_field=W;};O.setSortPrefs=function(V,W){O.loadSortPrefs(V,W);F.later(10,O,F.contacts.api.load,[1]);};O.getSortPrefs=function(){return J;};O.load=function(Y){var b,a=C.get("loadSmartContacts"),Z,V=C.get("fieldsToProcess"),W=[];var X=Y.contacts.contact||[];U={};R=[];T={};Q={};P={};for(Z=0;Z<X.length;Z++){b=X[Z];if(!a&&b.isSmartContact){continue;}W.push(b);M(b,V);R[Z]=b.id;U[b.id]=b;H(b);I(b.categories,b);}L=Y;L.contacts.contact=W;L.contacts.count=L.contacts.total=W.length;G=true;F.later(10,O,O.fire,[A.CONTACTS_LOADED]);};O.removeFromCategories=function(V){var X=V.categories||[],W=X.length,Y,Z,a;for(Y=0;Y<W;Y++){Z=X[Y].id;a=Q[Z].contacts;if(a){a.splice(F.Array.indexOf(a,V.id),1);}}};O.update=function(k){var g,f,a,c,b=C.get("fieldsToProcess"),X=[],j=[],d=[],Z=[],e=[],h=[],W=[],V,Y;if(k.syncresult){N=k.syncresult.rev;g=k.syncresult.diff.contacts;W=k.syncresult.results.contacts;}else{if(D.isArray(k)){g=k;}else{g=[k.contact];}}for(Y=0;Y<W.length;Y+=1){f=W[Y];c=f.op;a=U[f.id];switch(c){case"remove":h.push(a);break;case"add":Z.push(f);break;case"update":e.push(f);break;}}for(Y=0;Y<g.length;Y+=1){f=g[Y];c=f.op||"add";a=U[f.id];switch(c){case"remove":if(a){K(a);R.splice(F.Array.indexOf(R,a.id),1);O.removeFromCategories(a);d.push(a);}break;default:if(a){K(a);j.push(f);}else{X.push(f);}M(f,b);I(f.categories,f);U[f.id]=f;H(f);break;}}V={created:X,modified:j,removed:d,createdCurrent:Z,modifiedCurrent:e,removedCurrent:h};if(X.length||j.length){if(C.get("reloadOnUpdate")){F.later(10,O,F.contacts.api.load,[1]);}}else{F.later(10,O,O.fire,[A.CONTACTS_LOADED]);}F.later(10,O,O.fire,[A.CONTACT_CHANGED,V]);return V;};O.updateCategories=function(){var V={categories:Q};if(C.get("reloadOnUpdate")){F.later(10,O,F.contacts.api.load,[1]);}F.later(10,O,O.fire,[A.CONTACT_CHANGED,V]);};H=function(Y){var V,X,Z,W;V=P[Y.id].typedFieldValues.email;if(!V||V.length===0){return;}for(W in V){if(V.hasOwnProperty(W)){X=V[W];Z=X.toLowerCase();T[Z]=T[Z]||[];T[Z].push(Y);}}};K=function(Z){var V,Y,W,b,a,X;V=P[Z.id].typedFieldValues.email||[];a=Z.id;for(X in V){if(V.hasOwnProperty(X)){Y=V[X];b=Y.toLowerCase();W=T[b];if(W&&W[a]){W[a]=undefined;}}}};O.isLoaded=function(){return G;};O.getResponseObject=function(){return L;};O.getContactsData=function(){return P;};O.getContacts=function(){return U;};O.getEmails=function(){return T;};O.getCategories=function(){return Q;};O.getContactOrder=function(){return R;};O.getCurrentRevision=function(){return N;};O.setCurrentRevision=function(V){N=V;};O.loadTinyUserCard=function(W){var Z=W.contacts.contact,a,V=C.get("fieldsToProcess"),Y=[],X;for(X in Z){if(Z.hasOwnProperty(X)){a=Z[X];M(a,V);U[a.id]=a;H(a);Y.push(a);}}F.later(10,O,O.fire,[A.CONTACT_IMAGE_UPDATED,Y]);return Y;};O.getContactsByBucket=function(W,b,Y){var c,d=[],X,Z=W+b,a,V=[];if(Y){X=Q[Y];if(X){d=X.contacts||[];}}else{d=R||[];}for(a=W;a<Z;a++){c=d[a];if(c){V.push(U[c]);}else{break;}}return{contacts:V,total:d.length};};O.removeFlatContact=function(a,Z){var Y=P[a].flatContacts,W,V=Y.length,X;for(W=0;W<V;W++){X=Y[W];if(X.emailField&&X.emailField.id===Z){Y.splice(W,1);break;}}};O.removeField=function(b,Y){var W=U[b];if(W){var V=W.fields,Z,X=V.length,a;for(Z=0;Z<X;Z++){a=V[Z];if(a.id===Y){V.splice(Z,1);if(a.type==="email"){O.removeFlatContact(b,Y);}break;}}}};S=(function(){var V={broadcast:1,emitFacade:true};O.publish(A.CONTACT_CHANGED,V);O.publish(A.CONTACTS_LOADED,V);O.publish(A.CONTACT_IMAGE_UPDATED,V);}());};F.augment(E,F.EventTarget);B.cache=new E();},"1.0.0",{requires:["contacts-api-config","common-utils-stats"]});YUI.add("contacts-api-utils",function(D){D.namespace("contacts");var A=D.contacts,B=A.cache,C=function(){var E=this;E.getContactsByEmail=function(F){if(!F||F===""){return null;}return B.getEmails()[F.toLowerCase()];};E.isEmailKnown=function(F,G){var H,I;H=E.getContactsByEmail(F);if(G&&H){for(I=0;I<H.length;I++){if(!(H[I].isSmartContact)){return 1;}}return 0;}return(H)?1:0;};E.getContactById=function(G){var F;F=B.getContacts()[G];return F;};E.getContactsByIds=function(G){var H,F;H=[];for(F in G){if(G.hasOwnProperty(F)){H.push(E.getContactById(G[F]));}}return H;};E.getCategoryById=function(G){var F;F=B.getCategories()[G];return F;};E.areContactsLoaded=function(){return B.isLoaded();};E.getResponseObject=function(){return B.getResponseObject();};E.getContacts=function(H){var F,I={},G=B.getContacts();if(!H){return G;}for(F in G){if(G.hasOwnProperty(F)&&G[F].id>=0){I[F]=G[F];}}return I;};E.getSmartContacts=function(){var F,G={};for(F in B.getContacts()){if(B.getContacts().hasOwnProperty(F)&&B.getContacts()[F].id<0){G[F]=B.getContacts()[F];}}return G;};E.getAllContacts=function(){return B.getContacts();};E.getCategories=function(){return B.getCategories();};E.getContactsClone=function(G){var H={},F,I,K,J;if(G){F=B.getContactsByBucket(0,B.getContactOrder().length,G).contacts;K=F.length;while(K--){H[F[K].id]=F[K];}}else{I=E.getContacts();for(J in I){H[J]=I[J];}}return H;};E.getFlatContacts=function(){var G=E.getContacts(),I=[],H,J,F;for(J in G){if(G.hasOwnProperty(J)){H=E.getBasicFlatContacts(G[J]);for(F in H){if(H.hasOwnProperty(F)){I.push(H[F]);}}}}return I;};E.getFieldsByType=function(F,G){return B.getContactsData()[F.id].typedFields[G];};E.getFieldValues=function(G,J,H){var I,F,K;if(!G||!J){return null;}if(H){F=E.getFieldsByType(G,J);if(F){I=[];for(K in F){if(F.hasOwnProperty(K)&&D.Array.indexOf(K.flags,H)){I.push(K.value);}}}return I;}return B.getContactsData()[G.id].typedFieldValues[J];};E.getShownContactName=function(H){var G,K,F=D.Lang.trim,J=F(H.name),I=H.email;if(E.isEmailKnown(I)){G=E.getContactsByEmail(I);K=E.getFirstFieldValue(G[0],"nickname");if(K){return K;}K=E.getFirstFieldValue(G[0],"name");if(K){K=K.familyName+" "+K.givenName;if(F(K)){return K;}}}return J||I;};E.getFirstFieldValue=function(F,H,G){if(!F||!H){return null;}return(E.getFieldValues(F,H,G)||[])[0];};E.getHigherPrecedenceFieldByType=function(G,H){if(!G){return null;}function I(K,J){return K.id-J.id;}var F=(E.getFieldsByType(G,H)||[]);if(F.sort(I)[0]){return F.sort(I)[0].value;}return null;};E.getBasicFlatContacts=function(F){var K=B.getContactsData()[F.id].flatContacts,G,L,J=F.isSmartContact?1:0,I,H;if(!K){K=[];L=E.getFieldsByType(F,"email")||[];G=E.getHigherPrecedenceFieldByType(F,"name")||{};I=(L.length&&L[0])||{value:""};for(H in L){if(L.hasOwnProperty(H)){K.push({firstname:G.givenName,lastname:G.familyName,middlename:G.middleName,nickname:E.getFirstFieldValue(F,"nickname"),email:L[H].value,emailField:L[H],id:F.id,isPrimary:L[H].value===I.value,isSmartContact:J,sc_score:L[H].sc_score});}}B.getContactsData()[F.id].flatContacts=K;}return K;};E.getContactImage=function(F){var H=B.getContactsData()[F.id].image,G;if(!H){G=E.getFirstFieldValue(F,"guid");if(G){H=G.image;}B.getContactsData()[F.id].image=H;}return H;};E.getSortedFlatContacts=function(F){return E.sortFlatContacts(E.getFlatContacts(),F);};E.sortFlatContacts=function(K,J){var I=J||["sc_score","firstname","lastname","email"];function F(L){var O=0,N,P=L.matches,M;if(P){for(N in P){if(P[N].length===1){M=P[N][0];if((M.endIndex-M.startIndex)===L[N].length){O++;}}}}return O;}function G(N,L,P){var O=N[P],M=L[P];if(P==="sc_score"){if(F(N)){O++;}if(F(L)){M++;}}if(O&&M){return(O===M)?null:(P==="sc_score")?((O>M)?-1:1):((O<M)?-1:1);}else{if(!O&&!M){return null;}}return(O)?-1:1;}function H(N,M){var L,O;for(O in I){if(I.hasOwnProperty(O)){L=G(N,M,I[O]);if(L){return L;}}}return 0;}K.sort(H);return K;};E.getContactsCacheBucket=function(H,G,F){return B.getContactsByBucket(H,G,F);};E.getContactOrder=function(){return B.getContactOrder();};E.loadSortPrefs=function(F,G){B.loadSortPrefs(F,G);};E.getSortPrefs=function(){return B.getSortPrefs();};E.getSortedContacts=function(){var I=E.getContacts(),J=E.getContactOrder(),H=J.length,F=[],G;for(G=0;G<H;G++){F.push(I[J[G]]);}return F;};E.getTotalContacts=function(){return B.getContactOrder().length;};};A.utils=new C();},"1.0.0",{requires:["contacts-api-cache","common-utils-stats"]});YUI.add("contacts-api-urigenerator",function(A){var E=A.contacts,L=E.utils,M,C=A.Lang,K="/v1/user/{guid}/contacts",J="/v1/user/{guid}/contact/{cid}",N="{field}.{condition}={query}",D={"asc":1,"desc":2,1:1,2:2},I={"first":-10001,"last":-10003,"email":4,"-10001":"first","-10003":"last",4:"email",1:-10001,3:-10003,6:4};if(A.common&&A.common.Utils){M=A.common.Utils;}function B(S,T,R){var U=S.split(" "),P,O="",Q=U.length;while(Q--){P=U[Q];if(P){if(O){O+=";";}O+=N.replace("{field}",T).replace("{condition}",R).replace("{query}",encodeURIComponent(P.replace(/,/g,"\\,")));}}return O;}function H(S,U){var V={id:S.id,op:"update",fields:[],categories:[]},Y=V.fields,R=S.fields||[],W=U.fields||[],P={},T,Z,O,X,Q;S=A.clone(S,true);U=A.clone(U,true);Q=R.length;while(Q--){P[parseInt(R[Q].id,10)]=R[Q];}Q=W.length;while(Q--){O=W[Q];T=parseInt(O.id,10);X=O.categories;Z=P[T];if(!Z){Y.push({op:"add",value:O.value,type:O.type,flags:O.flags||[]});if(X){Y[Y.length-1].categories=X;}}else{if(O.type!==Z.type||!M.congruent(O.value,Z.value,false)||!M.congruent(O.flags,Z.flags,false)||!M.congruent(X,Z.categories,false)){if(O.type==="yahooid"&&!M.congruent(X,Z.categories,false)){Y.push({op:"remove",id:Z.id});Y.push({op:"add",value:O.value,type:O.type,flags:O.flags||[],categories:X});}else{Y.push({op:"update",id:T,value:O.value,type:O.type,flags:O.flags||[]});if(X){Y[Y.length-1].categories=X;}}}delete P[T];}}for(Q in P){if(P.hasOwnProperty(Q)){Y.push({op:"remove",id:Q});}}return V;}function G(S,O){S=S||[];O=O||[];var V=[],U={},R,Q,T,P;P=S.length;while(P--){U[parseInt(S[P].id,10)]=S[P];}P=O.length;while(P--){R=O[P];T=R.id;Q=U[T];if(!Q){V.push({op:"addTo",id:T});}else{delete U[T];}}for(P in U){if(U.hasOwnProperty(P)){V.push({op:"removeFrom",id:S[P].id});}}return V;}function F(O){O.path=O.wspath||"ws/sd";O.baseHost=O.baseHost||A.config.win.location.host;this.params=undefined;this.method="GET";this.rev=O.rev;this.headers=O.headers||{"Content-Type":"application/json"};this.uri=O.uri||A.config.win.location.protocol+"//"+(O.baseHost+"/"+O.path).replace("//","/")+"?";this.uri+=(O.singleContact?J.replace("{guid}",O.guid).replace("{cid}",O.id):K.replace("{guid}",O.guid));if(O.prefs){this.uri+="/preferences;";}this.init(O);}F.prototype={init:function(P){var O=F.METHODS,Q=P.type||O.DEFAULT;switch(Q){case O.SAVE:case O.DELETE:if(C.isNumber(this.rev)&&this.rev>=0){this.method="PUT";if(P.isCreateList){this.setCreateListParams(P);}else{this.setPUTParams(P);}this.setPUTUri(P);}else{this.method="POST";if(P.isCreateList){this.setCreateListParams(P);}else{this.setPOSTParams(P);}this.setPOSTUri(P);}break;case O.SAVE_PREFS:this.method="POST";this.setPOSTPrefsParams(P);this.setPOSTUri(P);break;case O.DELETE_CATEGORIES:case O.SAVE_CATEGORIES:this.method="PUT";this.setCategoriesParams(P);this.setPUTUri(P);break;case O.UPDATE_CONTACTS_CATEGORIES:this.method="PUT";this.setUpdateCategoriesParams(P);this.setPUTUri(P);break;case O.REMOVE_FIELD:this.method="PUT";this.setRemoveFieldParams(P);this.setPUTUri(P);break;default:this.method="GET";this.setGETUri(P);break;}},getURI:function(){return this.uri;},getMethod:function(){return this.method;},setMethod:function(O){this.method=O;},getHeaders:function(){return this.headers;},setHeaders:function(O){this.headers=O;},getParams:function(){return this.params;},stripContact:function(O){if(O._data){O._data=undefined;}},setPOSTPrefsParams:function(R){var Q=R.prefs,P={},O=Q.sort_order,S=Q.sort_field;this.params={};if(Q){if(O){P.sort_order=D[O];}if(S){P.sort_type=I[S];}this.params.preferences=P;}},setPOSTParams:function(P){var O={};this.params={};if(P.contacts&&C.isArray(P.contacts)&&!C.isUndefined(P.contacts[0])){O=P.contacts[0];}this.stripContact(O);this.params.contact=O;},setPOSTUri:function(O){this.uri+="?format=json";if(O.wssid){this.uri+="&wssid="+O.wssid;}},setCreateListParams:function(R){var W=R.newContacts,S=R.updateContacts,O={"name":R.category,"op":"add","refid":"01"},P=[{"refid":"01",op:"addTo"}],Q={rev:this.rev,categories:[],contacts:[]},V,U,T;Q.categories.push(O);T=W.length;while(T--){V=W[T];U={"op":"add","fields":[{"value":{givenName:V.name},"type":"name","op":"add"},{"value":V.email,"type":"email","op":"add"}],"categories":P};Q.contacts.push(U);}T=S.length;while(T--){U={"id":S[T].id,"op":"update","categories":P};Q.contacts.push(U);}this.params={contactsync:Q};},setPUTParams:function(O){var Z=O.contacts||[],T=O.categories||[],Y=[],S=[],W,V,a,R,U,X,Q,P;this.params={contactsync:{rev:this.rev}};Q=Z.length;if(Q>0){while(Q--){W=A.clone(Z[Q]);if(C.isValue(W.id)){if(W.op&&W.op==="remove"){}else{V=L.getContactById(W.id);R=W.categories;a=V.categories;W=H(V,W);W.categories=G(a,R);}}else{W.op="add";X=W.fields||[];P=X.length;while(P--){X[P].op="add";}X=W.categories||[];P=X.length;while(P--){X[P]={op:"addTo",id:X[P].id};}this.stripContact(W);}Y.push(W);}this.params.contactsync.contacts=Y;}Q=T.length;if(Q>0){while(Q--){U=A.clone(T[Q]);if(C.isValue(U.id)){throw new Error("category modification not yet implemented");}else{U.op="add";}U.contacts=L.getContactsByIds(U.contacts);S.push(U);}this.params.contactsync.categories=S;}},setPUTUri:function(O){this.setPOSTUri(O);},setGETUri:function(P){var S,O=P.fields,Q,R=this.uri;if(O){for(Q in O){if(O.hasOwnProperty(Q)){S=O[Q];if(S.name&&S.condition&&S.value){R+=";"+S.name+"."+S.condition+"="+S.value;}}}}if(P.searchQuery&&P.searchField&&P.searchCondition){R+=";"+B(P.searchQuery,P.searchField,P.searchCondition);}if(P.out){R+=";out="+P.out;}if(P.start){R+=";start="+P.start;}if(P.count){R+=";count="+P.count;}if(P.sortfields){R+=";sort-fields="+P.sortfields;}if(P.sort){R+=";sort="+P.sort;}R+="?format=json";if(P.view){if(C.isArray(P.view)){R+="&view="+P.view.join("&view=");}else{R+="&view="+P.view;}}if(C.isValue(P.rev)){R+="&rev="+P.rev;}if(P.wssid){R+="&wssid="+P.wssid;}if(P.id){R+="&id="+P.id;}if(!P._sc){R+="&_sc=0";}this.uri=R;},setCategoriesParams:function(S){var P=S.categories||[],U={rev:this.rev,categories:[],contacts:[]},R=[],Q={},O,T=P.length;while(T--){O=P[T];if(O.id){if(O.op==="remove"){Q=O;
}else{Q={"op":"update","new":{"name":O.name},"old":{"id":O.id}};}}else{Q={"op":"add","name":O.name};}R.push(Q);}U.categories=R;this.params={contactsync:U};},setUpdateCategoriesParams:function(U){var S=U.categories.addTo||[],Z=S.length,Y=U.categories.removeFrom||[],V=Y.length,a=U.contacts,P=a.length,R=[],X=[],O=[],b=1,T={rev:this.rev,categories:[],contacts:[]},W,Q;W=Z;while(W--){Q=S[W];if(A.Lang.isNumber(Q)){X.push({"id":S[W],"op":"addTo"});}else{O.push({"name":Q,"op":"add","refid":b});X.push({"refid":b,"op":"addTo"});b++;}}W=V;while(W--){X.push({"id":Y[W],"op":"removeFrom"});}W=P;while(W--){R.push({"id":a[W],"op":"update","categories":X});}T.contacts=R;T.categories=O;this.params={contactsync:T};},setRemoveFieldParams:function(Q){var P={rev:this.rev,contacts:[]},O=false,U=Q.fieldId,R=Q.contactId,V=L.getContactById(R),X={"id":R},T=V.fields,W,S=T.length;while(S--){W=T[S];if(W.id!==U&&W.type!=="guid"){O=true;break;}}if(O){X.op="update";X.fields=[{"op":"remove","id":U}];}else{X.op="remove";}P.contacts=[X];this.params={contactsync:P};}};F.METHODS={DEFAULT:0,GETCONTACTS:1,SAVE:2,DELETE:3,SAVE_CATEGORIES:4,DELETE_CATEGORIES:5,SAVE_PREFS:6,UPDATE_CONTACTS_CATEGORIES:7,REMOVE_FIELD:8};A.namespace("contacts");E.URIGenerator=F;},"1.0.0",{requires:["contacts-api-utils"]});YUI.add("contacts-api-io",function(F){F.namespace("contacts");var A=F.contacts,D=F.Lang,E=F.JSON;function B(G,H){return function(L,J){var I={};if(!J){return G.failure(I,J,H);}try{I=G.parseJSON(J);}catch(K){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-comms-shared-src-contacts-api-io:1",K,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-comms-shared-src-contacts-api-io:1");return G.failure(I,J,H);}if(I.error||!G.isSuccess(J.status)){return G.failure(I,J,H);}return G.success(I,J,H);};}function C(G){this.io=null;this.maxRetries=2;this.retryCount=0;this.uriGenerator=A.URIGenerator;this.onSuccess=function(){};this.onFailure=function(){};this.hook=G;}C.prototype={parseJSON:function(H){var G={};if(typeof H.body==="string"){G=E.parse(H.body);}else{if(typeof H.body==="object"){G=H.body;}else{if(typeof H.responseText==="string"&&H.responseText!==""){G=E.parse(H.responseText);}else{F.fire("MailLog",{m:"contacts-api-io.Request.parseJSON",info:"Contacts API returned empty or unrecognized response"});throw new Error("no response body to parse");}}}G.status=H.status;G.statusText=H.statusText;return G;},isSuccess:function(G){switch(G){case 200:case 201:case 202:case 204:return true;}return false;},doRetry:function(G){switch(G){case 500:return true;}return false;},success:function(G,H,I){this.onSuccess(G,H,I);this.retryCount=0;},failure:function(G,H,J){var I=G.error&&G.error.detail&&G.error.detail.match(/-\d+/);if(("-50304"===I||!H||this.doRetry(H.status))&&this.retryCount<this.maxRetries){this.retryCount+=1;return F.later(100,this,function(){this.send(J);});}this.retryCount=0;G.errorCode=(!D.isUndefined(I)&&!D.isNull(I))?I:"-99999";this.onFailure(G,H,J);},send:function(J){var K=B(this,J),I=this,H=this.uriGenerator.getURI(),G={data:E.stringify(this.uriGenerator.getParams()),on:{success:K,failure:K},headers:this.uriGenerator.getHeaders(),method:this.uriGenerator.getMethod(),sync:false};if(this.hook){G.serviceCredType="loose";I.io=this.hook(H,G);}else{F.use("io",function(L){I.io=L.io(H,G);});}},abort:function(){if(this.io&&(typeof this.io.abort==="function")){this.io.abort();return true;}else{return false;}}};A.sendRequest=function(L,K,H,G,J){var I=new C(G,J);if(K){I.onSuccess=K;}if(H){I.onFailure=H;}if(L){I.uriGenerator=L;}I.send();return I;};A.Request=C;},"1.0.0",{requires:["contacts-api-urigenerator","json"]});YUI.add("contacts-api-adapter",function(D){D.namespace("contacts");var E=D.contacts,H=E.URIGenerator,B=E.cache,G=D.Lang,F="CONTACTS",I,C,A;if(D.common&&D.common.Utils){I=D.common.Utils;C=I.rocketstats;A=new I.Stopwatch("ContactsRequest");}E.APIAdapter={};(function(){var N=this,J=false,M=E.sendRequest;N.getContact=function(Q,X,T,R){var W,U,Y,V,O;if(B.isLoaded()&&!R){W=B.getContacts()[Q];if(W){if(X&&G.isFunction(X)){X({contact:W});}}return;}U=E.config.getAttrs();Y=U.requestFn||null;V={baseHost:U.baseHost||D.config.win.location.host,uri:U.uri,headers:U.headers,guid:U.guid,wssid:U.wssid,type:H.METHODS.GETCONTACTS,start:U.start,count:U.count||"max",sortfields:U.sortfields,out:U.out,sort:U.sort,fields:U.fields,wspath:U.wspath,_sc:false,view:U.view,rev:U.rev,singleContact:true,id:Q};O=new H(V);function S(Z){if(X&&G.isFunction(X)){X(Z);}if(C){C.stat(F,"API:getContact");C.stat(F,"API:getContact:",Z.status);}}function P(Z){if(C){C.stat(F,"API:ERR:getContact");C.stat(F,"API:ERR:getContact:",Z.errorCode);}if(T&&G.isFunction(T)){T(Z);}}M(O,S,P,Y);};N.getContacts=function(Q,V,R){if(B.isLoaded()&&!Q){if(V&&G.isFunction(V)){V(B.getContacts());}return;}var T=E.config.getAttrs(),W=T.requestFn||null,O,U={baseHost:T.baseHost||D.config.win.location.host,uri:T.uri,headers:T.headers,guid:T.guid,wssid:T.wssid,type:H.METHODS.GETCONTACTS,start:T.start,count:T.count||"max",sortfields:T.sortfields,out:T.out,sort:T.sort,fields:T.fields,wspath:T.wspath,_sc:(typeof(NeoConfig)!=="undefined"&&NeoConfig.smartcomplete_enabled),view:T.view};function S(Z,X){var a=X.responseHeaders,Y;if(a){Y=a["X-Yahoo-Social-ContactsRev"]||a["X-Yahoo-Social-Contactsrev"]||a["x-yahoo-social-contactsrev"];if(Y){B.setCurrentRevision(parseInt(Y,10));}}B.load(Z);if(V&&G.isFunction(V)){V(B.getContacts());}if(C){C.stat(F,"API:getContacts");C.stat(F,"API:getContacts:",Z.status);}J=false;}function P(X){J=false;if(C){C.stat(F,"API:ERR:getContacts");C.stat(F,"API:ERR:getContacts:",X.errorCode);}if(R&&G.isFunction(R)){R(X);}}if(J&&V&&G.isFunction(V)){D.once("contacts:api:loaded",function(){V(B.getContacts());});}else{J=true;O=new H(U);M(O,S,P,W);}};N.createList=function(Y,U,Q,W,S){var T=E.config.getAttrs(),X=T.requestFn||null,V={baseHost:T.baseHost,uri:T.uri,headers:T.headers,guid:T.guid,type:H.METHODS.SAVE,wspath:T.wspath,wssid:T.wssid,rev:B.getCurrentRevision(),newContacts:Y,updateContacts:U,category:Q,isCreateList:true},O=new H(V);O.setMethod("PUT");function R(a){if(C){C.stat(F,"API:createList");C.stat(F,"API:createList:",a.status);}var Z=B.update(a);if(W&&G.isFunction(W)){W(Z,a);}}function P(Z){if(C){C.stat(F,"API:ERR:createList");C.stat(F,"API:ERR:createList:",Z.errorCode);}if(S&&G.isFunction(S)){S(Z);}}M(O,R,P,X);};N.deleteContacts=function(Y,W,T){var U=E.config.getAttrs(),X=U.requestFn||null,R=[],P=(Y&&G.isArray(Y))?Y.length:0,V={baseHost:U.baseHost,guid:U.guid,type:H.METHODS.DELETE,wspath:U.wspath,uri:U.uri,headers:U.headers,rev:B.getCurrentRevision(),wssid:U.wssid},O;while(P--){R.push({id:Y[P],op:"remove"});}V.contacts=R;O=new H(V);function Q(Z){if(C){C.stat(F,"API:ERR:contactsDelete");C.stat(F,"API:ERR:contactsDelete:",Z.errorCode);}if(T&&G.isFunction(T)){T(Z);}}function S(b){var d,a,c,Z;if(b.status===202){d=b.syncresult.results;a=d.contacts;c=a.length;while(c--){if(a[c].error){b.errorCode=a[c].error;Q(false,b);return;}}}if(C){C.stat(F,"API:contactsDelete");C.stat(F,"API:contactsDelete:",b.status);}Z=B.update(b);if(W&&G.isFunction(W)){W(Z,b);}}M(O,S,Q,X);};function L(X,S,V,Y,U,R){var W=S.requestFn||null,O,T={baseHost:S.baseHost,uri:S.uri,headers:S.headers,guid:S.guid,type:H.METHODS.SAVE,wspath:S.wspath,wssid:S.wssid};function Q(a){V.push(a.contact);if(C){C.stat(F,"API:multiTransactionSave");C.stat(F,"API:multiTransactionSave:",a.status);}if(X.length===0){var Z=B.update(V);if(U&&G.isFunction(U)){U(Z);}}else{L(X,S,V,Y,U,R);}}function P(Z){if(C){C.stat(F,"API:ERR:multiTransactionSave");C.stat(F,"API:ERR:multiTransactionSave:",Z.errorCode);}if(X.length===0&&V.length>0){B.update(V);}else{if(X.length>0){L(X,S,V,Y,U,R);return;}}if(R&&G.isFunction(R)){R(Z);}}if(Y){T.contacts=Y;}else{T.contacts=[X.shift()];}O=new H(T);M(O,Q,P,W,{contact:T.contacts});}function K(W,S,U,Q){var V=S.requestFn||null,O,T={baseHost:S.baseHost,guid:S.guid,type:H.METHODS.SAVE,wspath:S.wspath,uri:S.uri,headers:S.headers,rev:B.getCurrentRevision(),wssid:S.wssid};function R(Y){if(C){C.stat(F,"API:singleTransactionSave");C.stat(F,"API:singleTransactionSave:",Y.status);}var X=B.update(Y);if(U&&G.isFunction(U)){U(X,Y);}}function P(X){if(C){C.stat(F,"API:ERR:singleTransactionSave");C.stat(F,"API:ERR:singleTransactionSave:",X.errorCode);}if(Q&&G.isFunction(Q)){Q(X);}}if(!G.isArray(W)){W=[W];}T.contacts=W;O=new H(T);M(O,R,P,V);}this.saveContacts=function(R,S,Q){var P=E.config.getAttrs(),O=B.getCurrentRevision();if(O>0||!G.isArray(R)||R.length===1){K(R,P,S,Q);}else{L(R,P,[],S,Q);}};this.getContactsTinyUserCard=function(V,U,Q){var S=E.config.getAttrs(),W=S.requestFn||null,T={baseHost:S.baseHost||D.config.win.location.host,uri:S.uri,headers:S.headers,guid:S.guid,wssid:S.wssid,type:H.METHODS.GETCONTACTS,start:0,count:1,fields:[{name:"guid",condition:"is",value:V}],wspath:S.wspath,view:"tinyusercard"},O=new H(T);function R(Y){if(C){C.stat(F,"API:getUserCard");C.stat(F,"API:getUserCard:",Y.status);}var X=B.loadTinyUserCard(Y)[0];if(U&&G.isFunction(U)){U(X);}}function P(X){if(C){C.stat(F,"API:ERRgetUserCard");C.stat(F,"API:ERRgetUserCard:",X.errorCode);}if(Q&&G.isFunction(Q)){Q(X);}}M(O,R,P,W);};this.saveCategory=function(Q,V,R){var T=E.config.getAttrs(),W=T.requestFn||null,U={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.SAVE_CATEGORIES,wspath:T.wspath,uri:T.uri,headers:T.headers,rev:B.getCurrentRevision(),categories:[Q],wssid:T.wssid},O=new H(U);function S(X){var Y=X.syncresult.results,Z,a;if(X.status===202){Z=Y.categories;if(Z[0].error){X.errorCode=Z[0].error;P(false,X);return;}}a=X.syncresult.diff;if(C){C.stat(F,"API:saveCategories");C.stat(F,"API:saveCategories:",X.status);}B.updateCategories(X);
if(V&&G.isFunction(V)){V(a,X);}}function P(X){if(C){C.stat(F,"API:ERR:saveCategory");C.stat(F,"API:ERR:saveCategory:",X.errorCode);}if(R&&G.isFunction(R)){R(X);}}M(O,S,P,W);};this.deleteCategory=function(Q,V,R){var T=E.config.getAttrs(),W=T.requestFn||null,U={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.DELETE_CATEGORIES,wspath:T.wspath,uri:T.uri,headers:T.headers,rev:B.getCurrentRevision(),categories:[{id:Q,op:"remove"}],wssid:T.wssid},O=new H(U);function S(X){var Y=X.syncresult.results,Z;if(X.status===202){Z=Y.categories;if(Z[0].error){X.errorCode=Z[0].error;P(false,X);return;}}if(C){C.stat(F,"API:deleteCategories");C.stat(F,"API:deleteCategories:",X.status);}B.updateCategories(X);if(V&&G.isFunction(V)){V(X.syncresult.diff,X);}}function P(X){if(C){C.stat(F,"API:ERR:deleteCategory");C.stat(F,"API:ERR:deleteCategory:",X.errorCode);}if(R&&G.isFunction(R)){R(X);}}M(O,S,P,W);};this.updateContactsCategories=function(Y,S,X,V,R){var T=E.config.getAttrs(),W=T.requestFn||null,U={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.UPDATE_CONTACTS_CATEGORIES,wspath:T.wspath,uri:T.uri,headers:T.headers,rev:B.getCurrentRevision(),categories:{addTo:S,removeFrom:X},contacts:Y,wssid:T.wssid},O=new H(U);function Q(Z){var a=Z.syncresult.results,b;if(Z.status===202){b=a.categories;if(b[0].error){Z.errorCode=b[0].error;P(false,Z);return;}}if(C){C.stat(F,"API:updateContactsCategories");C.stat(F,"API:updateContactsCategories:",Z.status);}B.updateCategories(Z);if(V&&G.isFunction(V)){V(Z.syncresult.diff,Z);}}function P(Z,a){if(C){C.stat(F,"API:ERR:updateContactsCategories");C.stat(F,"API:ERR:updateContactsCategories:",a.errorCode);}if(R&&G.isFunction(R)){R(a);}}M(O,Q,P,W);};this.removeField=function(T,V,W,R){var S=E.config.getAttrs(),X=S.requestFn||null,U={rev:B.getCurrentRevision(),contactId:T,fieldId:V,baseHost:S.baseHost,guid:S.guid,type:H.METHODS.REMOVE_FIELD,wspath:S.wspath,uri:S.uri,headers:S.headers,wssid:S.wssid},O=new H(U);function Q(Y){if(C){C.stat(F,"API:removeEmail");C.stat(F,"API:removeEmail:",Y.status);}B.updateCategories(Y);if(W&&G.isFunction(W)){W(Y.syncresult.diff,Y);}}function P(Y,Z){if(C){C.stat(F,"API:ERR:removeEmail");C.stat(F,"API:ERR:removeEmail:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}M(O,Q,P,X);};this.setSortField=function(T,V,Q){var S=E.config.getAttrs(),W=S.requestFn||null,U={baseHost:S.baseHost,guid:S.guid,type:H.METHODS.SAVE_PREFS,wspath:S.wspath,uri:S.uri,headers:S.headers,wssid:S.wssid,prefs:{sort_field:T}},O=new H(U);function R(Y){var X=Y.preferences;if(X){B.setSortPrefs(X.sort_order,X.sort_type);if(V&&G.isFunction(V)){V();}if(C){C.stat(F,"API:setSortField");C.stat(F,"API:setSortField:",Y.status);}}}function P(X){if(C){C.stat(F,"API:ERR:setSortField");C.stat(F,"API:ERR:setSortField:",X.errorCode);}if(Q&&G.isFunction(Q)){Q(X);}}M(O,R,P,W);};this.setSortOrder=function(T,V,Q){var S=E.config.getAttrs(),W=S.requestFn||null,U={baseHost:S.baseHost,guid:S.guid,type:H.METHODS.SAVE_PREFS,wspath:S.wspath,uri:S.uri,headers:S.headers,wssid:S.wssid,prefs:{sort_order:T}},O=new H(U);function R(Y){var X=Y.preferences;if(X){B.setSortPrefs(X.sort_order,X.sort_type);if(V&&G.isFunction(V)){V();}if(C){C.stat(F,"API:setSortOrder");C.stat(F,"API:setSortOrder:",Y.status);}}}function P(X){if(C){C.stat(F,"API:ERR:setSortOrder");C.stat(F,"API:ERR:setSortOrder:",X.errorCode);}if(Q&&G.isFunction(Q)){Q(X);}}M(O,R,P,W);};this.getSortPrefs=function(U,R){if(B.getSortPrefs()){if(U&&G.isFunction(U)){U(B.getSortPrefs());}return;}var Q=E.config.getAttrs(),P=Q.requestFn||null,V={baseHost:Q.baseHost||D.config.win.location.host,uri:Q.uri,headers:Q.headers,guid:Q.guid,wssid:Q.wssid,type:H.METHODS.DEFAULT,wspath:Q.wspath,prefs:true},S=new H(V);function O(X){var W=X.preferences;if(W){if(W.sort_order&&W.sort_type){B.setSortPrefs(W.sort_order,W.sort_type);if(U&&G.isFunction(U)){U();}if(C){C.stat(F,"API:getSortPreferences");C.stat(F,"API:getSortPreferences:",X.status);}}}}function T(W){if(C){C.stat(F,"API:ERR:getSortPreferences");C.stat(F,"API:ERR:getSortPreferences:",W.errorCode);}if(R&&G.isFunction(R)){R(W);}}M(S,O,T,P);};this.removeField=function(T,V,W,R){var S=E.config.getAttrs(),X=S.requestFn||null,U={rev:B.getCurrentRevision(),contactId:T,fieldId:V,baseHost:S.baseHost,guid:S.guid,type:H.METHODS.REMOVE_FIELD,wspath:S.wspath,uri:S.uri,headers:S.headers,wssid:S.wssid},O=new H(U);function Q(Y){if(C){C.stat(F,"API:removeEmail");C.stat(F,"API:removeEmail:",Y.status);}B.updateCategories(Y);if(W&&G.isFunction(W)){W(Y.syncresult.diff,Y);}}function P(Y,Z){if(C){C.stat(F,"API:ERR:removeEmail");C.stat(F,"API:ERR:removeEmail:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}M(O,Q,P,X);};this.searchContacts=function(W,U,Q){var S=E.config.getAttrs(),V=S.requestFn||null,T={baseHost:S.baseHost,guid:S.guid,type:H.METHODS.GETCONTACTS,wspath:S.wspath,uri:S.uri,headers:S.headers,wssid:S.wssid,out:S.out,fields:S.fields,search:S.search,searchField:"all",searchCondition:"contains",searchQuery:W},O=new H(T);function R(X){var Y=X.contacts.contact||[];if(U&&G.isFunction(U)){U(Y);}if(C){C.stat(F,"API:searchContacts");C.stat(F,"API:searchContacts:",X.status);}}function P(X){if(C){C.stat(F,"API:ERR:searchContacts");C.stat(F,"API:ERR:searchContacts:",X.errorCode);}if(Q&&G.isFunction(Q)){Q(X);}}M(O,R,P,V);};this.createEmptyContact=function(){return{fields:[],categories:[]};};}.apply(E.APIAdapter));},"1.0.0",{requires:["contacts-api-io","contacts-api-cache","contacts-api-urigenerator","contacts-api-config","json","common-utils","rocket-stats"]});YUI.add("contacts-api",function(E){E.namespace("contacts");var B=E.contacts,D=B.APIAdapter,C=B.cache,A=function(){var F=this;this.load=function(H,I,G){D.getContacts(H,I,G);};this.saveContacts=function(H,I,G){D.saveContacts(H,I,G);};this.deleteContacts=function(H,I,G){D.deleteContacts(H,I,G);};this.saveCategory=function(G,I,H){D.saveCategory(G,I,H);};this.deleteCategory=function(G,I,H){D.deleteCategory(G,I,H);};this.createList=function(G,I,J,K,H){D.createList(G,I,J,K,H);};this.getContacts=function(H,I,G){if(typeof(H)!=="boolean"){return;}D.getContacts(H,I,G);};this.getContact=function(J,I,G,H){D.getContact(J,I,G,H);};this.createEmptyContact=function(H,G){return D.createEmptyContact(H,G);};this.getContactImage=function(G,I,H){D.getContactsTinyUserCard(G,I,H);};this.searchContacts=function(H,I,G){D.searchContacts(H,I,G);};E.on("contacts:contactChanged",function(){F.load(1);});this.setSortOrder=function(G,I,H){D.setSortOrder(G,I,H);};this.setSortField=function(H,I,G){D.setSortField(H,I,G);};this.getSortPrefs=function(H,G){D.getSortPrefs(H,G);};this.updateContactsCategories=function(J,H,G,K,I){D.updateContactsCategories(J,H,G,K,I);};this.removeEmail=function(I,G,J,H){D.removeField(I,G,J,H);};this.removeEmail=function(J,I,H){C.removeField(J,I);var G=E.contacts.utils.getContactById(J);if(G&&!G.isSmartContact){D.removeField(J,I);}if(H){H();}};};B.api=new A();},"1.0.0",{requires:["contacts-api-adapter","contacts-api-config","contacts-api-cache","contacts-api-utils"]});