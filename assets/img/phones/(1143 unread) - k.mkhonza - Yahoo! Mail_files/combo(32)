YUI.add("mail-ui-foldersview-bind",function(A){var O=A.Node.one,V=A.common.Utils,W=A.mail.persist.MetaData,S=strings.str_nav_inbox;var U="#storm-listnav",Q="#custom-folders",H=O(U),G=O(Q),I={"in":"Inbox",chats:"%40C%40Chats",drafts:"Draft",sent:"Sent",folder:"%40B%40Bulk",spam:"%40B%40Bulk",trash:"Trash"},b={"Inbox":"str_tabs_inbox","Draft":"str_tabs_drafts","Sent":"str_tabs_sent","%40B%40Bulk":"str_tabs_spam","%40C%40Chats":"str_tabs_conversations","Trash":"str_tabs_trash"},T=NeoConfig.grayoutEnabled,M=A.Lang;var P=function(g,d,e){var Y={"action":e,"args":{}},f={"inbox":"folderview_inbox","drafts":"folderview_draft","sent":"folderview_sent","trash":"folderview_trash","conversations":"folderview_chat","spam":"folderview_bulk","custom_fldr":"folderview_custom"},c;if(e==="sysFldCk"){if(typeof(g)==="string"&&d==="btn"){Y.args.btn=g.replace("btn-","");if(g==="checkmail"){c="inbox";}}else{c=b[g]&&b[g].replace("str_tabs_","");Y.args.id=c;}}if(e==="usr_fldr"){c="custom_fldr";Y.args.id=g||"";}Y.spid=f[c]||"";A.fire("mt:click",Y);return true;};var a=function(g){var h=this,Y=T&&A.mail.ui.ContextButton,f=g.target,d=g.currentTarget;g.preventDefault();function c(j){var e=d.menu.getContextTarget(),i;if(e){j.target=e.ancestor(function(k){i=k.getAttribute("data-fid")||null;return i;},true);if(i){h.handleFolderActions(j,i);}}}if(!d.menu){A.use("common-ui-menu-helper",function(i){var e=i.common.ui.MenuHelper;e.createLoadingMenu(H,{isContext:true,xy:[g.clientX,g.clientY]});i.use("mail-ui-inboxmenu-base",function(j){j.mail.ui.InboxMenu.insert("menu-system-folder",function(){var k=O("#menu-system-folder");j.common.ui.MenuHelper.create(d,{menu:k,isContext:true,xy:[g.clientX,g.clientY],contextTarget:g.target,keys:function(l){l(j.mail.ui.InboxMenu.getValidKeys(k));}},function(){k.on("menuSelected",c);k.on("menu:state",function(n){var l=d.menu.getContextTarget().ancestor("li");if(!l.hasClass("sysfolder")){n.preventDefault();}if(n.state==="show"){var m=this.one("[data-action=folder-allread]");if(l&&"%40C%40Chats"===l.getAttribute("data-fid")){m.addClass("disabled");m.one("a").set("aria-disabled",true);}else{m.removeClass("disabled");m.one("a").removeAttribute("aria-disabled");}}else{if(n.state==="hide"){f&&f.focus();}}if(Y){Y.setNodeFolderMenu(l,k);}K(l,n.state);});});});});});}};function K(Y,c){if(Y){if("show"===c&&!Y.hasClass("selected")){Y.addClass("cntxtmenu");}else{if("hide"===c){Y.removeClass("cntxtmenu");}}}}function B(g,h){var f,c=h.keyCode===40?"next":"previous",Y,d;if(g){Y=g[c]();if(Y){if(Y.getComputedStyle("display")==="none"||Y.hasClass("nav-separator")||Y.hasClass("nav-toggle")){f=B(Y,h);}else{f=Y;}}else{d=g.get("parentNode").all("> li");Y=d.item(c==="next"?0:d.size()-1);if(Y.getComputedStyle("display")==="none"||Y.hasClass("nav-separator")||Y.hasClass("nav-toggle")){f=B(Y,h);}else{f=Y;}}}else{f=null;}return f;}var R=function(c){P("checkmail","btn","sysFldCk");var Y=c.currentTarget,d=Y.getAttribute("data-mboxid");this.checkMail(d);};var E=function(Y){A.fire("#system-folders.li:keydown",Y);};var C=function(f){var g=f.currentTarget,d=f.keyCode,Y,c=A.UA.os;if((c==="macintosh")&&(d===8)){d=46;}switch(d){case 46:if(!g.one("input")){this.handleFolderActions({dataAction:"folder-remove"},g.getAttribute("data-fid"));f.preventDefault();}break;case 67:this.handleFolderActions({dataAction:"folder-rename",target:g});break;case 121:case 77:Y=(c==="windows"||c==="win");if((Y&&f.shiftKey&&d===121)||(!Y&&f.ctrlKey&&f.shiftKey&&f.altKey&&d===77)){f.preventDefault();V.simulateContextMenu(f.target);}break;}};var L=function(j){var i=j.target,g,Y,f,d,c,h=false;if(j.keyCode===38||j.keyCode===40){j.halt();g=B(i.ancestor("li"),j);if(g){i.set("tabIndex",-1);Y=g.one("a[role=option]");if(Y){Y.set("tabIndex",0);Y.focus();}else{A.use("common-utils-error",function(e){e.common.Utils.error.report("Anchor not set; listItem markup is '"+g.getHTML()+"'","UP_DOWN_NAV_ERROR",1,1,1);});}}else{if(j.keyCode===38){if(i===A.one("#custom-folders a")){A.one("#custom-folders-btn").focus();j.halt();}}}}else{if(NeoConfig.nav){if(j.keyCode==37||j.keyCode==39||j.keyCode==13){d=i.ancestor("li");if(d.hasClass("papa-folder")){h=true;c=d.one(".listnav-folder-toggle");if(j.keyCode==37){c.replaceClass("icon-chevron-down","icon-chevron-right");d.next().addClass("hidden");}else{if(j.keyCode==39){c.replaceClass("icon-chevron-right","icon-chevron-down");d.next().removeClass("hidden");}else{if(c.hasClass("icon-chevron-down")){c.replaceClass("icon-chevron-down","icon-chevron-right");d.next().addClass("hidden");}else{c.replaceClass("icon-chevron-right","icon-chevron-down");d.next().removeClass("hidden");}}}}else{if(d.hasClass("openable")){h=true;F();c=d.one(".listnav-toggle");if(j.keyCode==37){d.removeClass("nav-open");}else{if(j.keyCode==39){d.addClass("nav-open");}else{d.toggleClass("nav-open");}}}}if(h){j.halt();}}}}};var Z=function(Y){var c=V.getDataAction(Y);this.handleFolderActions({"dataAction":c.action,target:Y.target});};var J=function(d){var c=d.currentTarget,Y=c.one("input.trash"),f;if(c.hasClass("icon-small-delete")||Y){d.halt();A.UA.webkit&&d.target.focus();f=V.getDataAction(d);this.handleFolderActions({dataAction:f.action,target:d.target});P(d.currentTarget.get("id"),"btn","sysFldCk");}};var D=function(l){var m=l.currentTarget,f=l.target,k,Y,c,j,d,h,i;A.fire("ds:folder:system:switch",m);if(l.target.hasClass("clicker")){if(m.hasClass("open")){m.removeClass("open");}else{m.addClass("open");}return;}function g(){var o=H.all(".inbox-sub"),n=W.get("neo.pref.mboxesState")===1?0:1,e;if(o){o.each(function(p){p.toggleClass("hidden");});}if((e=H.one("#"+(n?"hide":"show")+"-accts"))){e.set("tabIndex",0);e.focus();}NeoConfig.expandEA=n;W.set("neo.pref.mboxesState",n);}if(f.get("nodeName")!=="INPUT"&&!f.hasClass("trash")&&!f.hasClass("check-mail")){P(l.currentTarget.get("id"),"folder","sysFldCk");}if(m.hasClass("in")||m.hasClass("inbox-sub")){i=f.getAttribute("data-action");if(i==="show-accounts"){l.halt();g();}else{if(!f.hasClass("check-mail")){k=M.trim(f.getAttribute("data-mboxid"));
d={fid:"Inbox",name:S,mailboxId:k&&k.length>0?k:"Inbox",smartFolder:l.smartFolder,forceRefresh:l.smartFolder};}}}else{if(l.target.get("type")!=="button"){Y=m.get("className").split(" ");c=strings[b[m.getAttribute("data-fid")]];j=I[M.trim(Y[0])];h=j||Y[0];if(h){d={fid:j||Y[0],name:c,mailboxId:null,smartFolder:l.smartFolder,forceRefresh:l.smartFolder};}}}if(d){l.preventDefault();d.isTrashBtn=l.target.getAttribute("data-action")==="folder-empty-trash";this.set("fid",d);}};var N=function(c){var Y=c.currentTarget,d=Y.getAttribute("data-fid");if(c.target.hasClass("clicker")){if(Y.hasClass("open")){Y.removeClass("open");}else{Y.addClass("open");}return;}P(d,"folder","usr_fldr");if(this.get("active")&&(d===c.fid)){this.handleFolderActions({dataAction:"folder-rename",target:c.currentTarget});}else{this.set("fid",{fid:d,smartFolder:c.smartFolder,forceRefresh:c.smartFolder});}};var X=function(f){var g=this,Y=T&&A.mail.ui.ContextButton,d=f.target;f.preventDefault();function c(i){var e=G.menu.getContextTarget(),h;if(e){i.target=e.ancestor(function(j){h=j.getAttribute("data-fid")||null;return h;},true);if(h){g.handleFolderActions(i,h);}}}if(!G.menu){A.use("common-ui-menu-helper",function(h){var e=h.common.ui.MenuHelper;e.createLoadingMenu(G,{isContext:true,xy:[f.clientX,f.clientY]});h.use("mail-ui-inboxmenu-base",function(i){i.mail.ui.InboxMenu.insert("menu-folder",function(){var j=O("#menu-folder");e.create(G,{menu:j,isContext:true,xy:[f.clientX,f.clientY],contextTarget:f.target,keys:function(k){k(i.mail.ui.InboxMenu.getValidKeys(j));}},function(){j.on("menuSelected",c);j.on("menu:state",function(l){var k=G.menu.getContextTarget().ancestor("li");if(Y){Y.setNodeFolderMenu(k,j);}K(k,l.state);if(l.state==="hide"){d&&d.focus();}});});});});});}};function F(){var c="neo.pref.folderState",Y;Y=parseInt(W.get("neo.pref.folderState"),10)===0?1:0;W.set(c,Y);}A.mix(A.mail.FoldersView,{contextClick:a,folderHilite:K,checkMailClick:R,sysFoldersKeyDown:E,usrFoldersKeyDown:C,upDownNavigation:L,newFolderClick:Z,emptyFolderOnClick:J,sysFoldersClick:D,usrFoldersClick:N,usrFoldersContextClick:X,updateFolderPref:F});},"1.0.0");