YUI.add("mail-ui-boss-themes",function(B){var s=NeoConfig,c="boss-thm",t="themes-opened",n="loading",h="selected",k="disabled",f="hide",j="zoom-img",d="boss.thm",U=15000,Z=12,E=500,M=500,w=67,O=200,X=206,Q=120,J=69,D=32,C=s.wideLeftRail?280:235,W=0.5,m=B.one("html"),q=B.one("body"),I=q.one(".attribution-bar"),L=I.one(".attribution"),V=I.one(".loader"),p=I.one(".boss-tabs"),e=I.one(".boss-themes"),H=I.one(".boss-thumbs-ul"),v=B.common.Utils.rocketstats.bucketStat,g=B.mail.ui.Boss,a,K,N,r,S=s.themeList,A=[],R,F,u=false,o=s.isRTL,i=o?"marginRight":"marginLeft",G,b,T=g.cancelTimer,x=B.common.persist.getCookie(),P,l;b=function(){function AR(){return q.hasClass(c);}function AJ(AY,Ab){var AZ=new Image(),Aa=AY.src,AX=AY.img;AZ.onload=function(){if(AX&&Aa){AX.setAttribute("src",Aa);}Ab(AY);};setTimeout(function(){AZ.src=Aa;},0);}function AP(){return m.get("offsetWidth")-D*2-C;}function AK(){var AX=parseInt(H.getStyle(i),10),Aa=AP(),Af=Math.floor(-AX/J)+1,AY=-AX%J,Ab=AY>0?J-AY:0,Ad=Math.floor((Aa-J+AY)/J),AZ=Af+Ad+(Aa-(Ad*J)-Ab>0?1:0),Ae=[],Ac=0;H.all(".thumb").each(function(Ag){if(Ag.hasClass(f)){return;}Ac++;if(Ac<Af||Ac>AZ){return;}Ae.push(Ag);});return Ae;}function AC(AX){AX.img.get("parentNode").addClass("loaded");}function AI(){var Ad=window.devicePixelRatio&&window.devicePixelRatio>1,AY=AK(),Ac=AY.length,Ab,AZ,AX,Aa;for(Aa=0;Aa<Ac;Aa++){AX=AY[Aa];Ab=AX.one(".thumb-img");if(Ab&&!Ab.getAttribute("src")){if(Ad){AZ=Ab.getAttribute("data-srcx2")||Ab.getAttribute("data-src");}else{AZ=Ab.getAttribute("data-src");}AJ({img:Ab,src:AZ},AC);}}}function AS(){r=A.length*J;H.setStyle("width",r);B.use("options-pages_css");u=true;}function z(AY){var AX;H.all("."+h).removeClass(h);AX=H.one('.thumb[data-theme="'+AY+'"]');if(AX){AX.addClass(h);}}function AE(Ac){var AY,Aa=A.length,AZ,AX,Ab;for(AY=0;AY<Aa;AY++){if(A[AY]===Ac){AX=AP();AZ=-J*AY;Ab=AX-r;if(AZ!==0){AZ+=Math.ceil(J/2);e.one(".prev").removeClass(k);}if(AZ<=Ab){AZ=Ab;e.one(".next").addClass(k);}H.setStyle(i,AZ+"px");break;}}}function AT(){q.addClass(c);I.setStyle("maxWidth",m.get("offsetWidth"));L.setAttribute("title",L.getAttribute("data-title"));F=R=s.theme.id;if(!u){AS();AE(R);}z(R);AI();}function AL(){q.removeClass(c);L.setAttribute("title","");if(F!==R){B.fire("saveTheme",{theme:F});R=F;B.fire("mt:click",{action:"boss_save_theme",append:{actnDtl:F}});v("boss","theme:save",null,{bucket:true});v("boss","theme:save:"+F,null,{bucket:true});B.fire("util:ymstats",{name:"boss_themes",tags:{action:"save",theme:F}});}AV();}function y(AX){P=AX;AX=AX?1:0;x.set(d,AX);v("boss","theme:switcher:"+AX);}function AA(){if(I.hasClass(t)){I.removeClass(t);y(false);B.fire("mt:click",{action:"boss_hide_themes"});v("boss","thumbs:hide",null,{bucket:true});}else{I.addClass(t);y(true);B.fire("mt:click",{action:"boss_show_themes"});v("boss","thumbs:show",null,{bucket:true});}}function Y(AX){if(F!==s.theme.id){I.addClass(n);a.start();B.use("mail-ui-themes",function(AY){AY.mail.ui.Themes.changeTheme(AX,function(){I.removeClass(n);a.stop();},true);});z(AX);B.fire("mt:click",{action:"boss_change_theme",append:{actnDtl:AX}});v("boss","theme:change",null,{bucket:true});v("boss","theme:change:"+AX,null,{bucket:true});B.fire("util:ymstats",{name:"boss_themes",tags:{action:"change",theme:AX}});}}function AU(AX){F=AX.currentTarget.getAttribute("data-theme");Y(F);}function AM(){T(K);T(N);}function AD(){var AX=G.get("boundingBox");if(AX){F=AX.one("[data-theme]").getAttribute("data-theme");Y(F);}}function AO(AX){if(l){AG({currentTarget:l});g.overActiveArea(AX);}}function AH(AX){if(l){AB({currentTarget:l});g.outsideActiveArea(AX);}}function AN(AY){var Ag=window.devicePixelRatio&&window.devicePixelRatio>1,Ad=AY.one(".thumb-img"),Ae,Af,Ac=AY.getAttribute("data-theme"),Ab,Aa=AY.getXY(),AX,AZ;if(NeoConfig.isRTL){Aa[0]+=w;}if(!G){G=new B.Overlay({zIndex:U+1,visible:false,id:"bossZoom"});G.render(q);Ab=G.get("boundingBox");Ab.on("hover",AO,AH);Ab.on("mousedown",AD);}else{Ab=G.get("boundingBox");}if(Ad){if(Ag){Ae=Ad.getAttribute("data-srczx2")||Ad.getAttribute("data-srcz");}else{Ae=Ad.getAttribute("data-srcz");}AJ({src:Ae,theme:Ac},function(Ai){var Ah=Ab.one('[data-theme="'+Ai.theme+'"]');if(Ah){Ah.setAttribute("src",Ai.src);}});Af='<img class="'+j+'" data-theme="'+Ac+'" src="'+Ad.getAttribute("src")+'">';}else{Af='<div class="boss-zoom-'+Ac+" "+j+' thumb-solid" data-theme="'+Ac+'"><b class="color"></b></div>';}G.set("bodyContent",Af);if(!G.get("visible")){Ab.addClass("no-transition");G.move(Aa[0],Aa[1]);Ab.removeClass("no-transition");}G.show();if(o){AX=Aa[0]-w/2+O/2;if(AX<X){AX=X;}}else{AX=Aa[0]+w/2-O/2;AZ=m.get("offsetWidth")-X;if(AX>AZ){AX=AZ;}}G.move(AX,Aa[1]-Q-Z);Ab.addClass("zoomed");l=AY;}function AG(AX){AM();K=B.later(E,this,function(){if(l!==AX.currentTarget){AN(AX.currentTarget);B.fire("mt:click",{action:"boss_show_zoom"});v("boss","show:zoom",null,{bucket:true});}});}function AV(){var AX,AY;if(G){AX=G.get("bodyContent").getAttribute("data-theme");AY=H.one('.thumb[data-theme="'+AX+'"]').getXY();if(o){AY[0]+=w;}G.get("boundingBox").removeClass("zoomed");G.move(AY[0],AY[1]);G.hide();l=null;}}function AB(AX){AM();N=B.later(M,this,function(){AV(AX.currentTarget);B.fire("mt:click",{action:"boss_hide_zoom"});v("boss","hide:zoom",null,{bucket:true});});}function AF(Ac){var Ab=Ac.target,Aa,AX,AY=AP(),AZ;if(Ab.get("nodeName")!=="A"){Ab=Ab.ancestor("a");}Aa=Ab.getAttribute("data-cat");AZ=p.one("."+h);if(!AZ||AZ.getAttribute("data-cat")!==Aa){AZ.removeClass(h);Ab.addClass(h);if(Aa==="all"){AX=H.all(".thumb");}else{H.all(".thumb").addClass(f);AX=H.all('.thumb[data-cat="'+Aa+'"]');}AX.removeClass(f);H.setStyle(i,0);r=AX.size()*J;H.setStyle("width",r);e.one(".prev").addClass(k);if(r<AY){e.one(".next").addClass(k);}else{e.one(".next").removeClass(k);}AI();B.fire("mt:click",{action:"boss_theme_category"});v("boss","theme:category",null,{bucket:true});}}function AW(Ad){var AY,AX,AZ,Ae,Ab,Aa,Ac;if(I.hasClass(t)){Ac=Ad.target;Ae=parseInt(H.getStyle(i),10);AZ=AP();if(r<=AZ){Aa=0;e.one(".prev").addClass(k);
e.one(".next").addClass(k);}else{if(Ac.hasClass("next")){Aa=Ae-(AZ*W);}else{Aa=Ae+(AZ*W);}Ab=AZ-r;if(Aa>=0){Aa=0;Ac.addClass(k);}else{if(Aa<=Ab){Aa=Ab;Ac.addClass(k);}else{Ac.removeClass(k);}}}if(Ae!==Aa){if(Ac.hasClass("next")){AY=".prev";AX="next";}else{AY=".next";AX="prev";}e.one(AY).removeClass(k);H.setStyle(i,Aa+"px");AI();B.fire("mt:click",{action:"boss_"+AX+"_thumbs"});v("boss","thumbs:"+AX,null,{bucket:true});}}}function AQ(){var AX,AY;for(AX in S){if(S.hasOwnProperty(AX)){A.push(AX);}}H.delegate("mousedown",AU,"a");e.delegate("click",AW,".boss-scroller");p.delegate("click",AF,"a");H.delegate("hover",AG,AB,"a");a=new B.comms.ui.Envelope(V);AY=x.get(d);if(AY){P=AY==="1"?true:false;}else{P=true;}I[P?"addClass":"removeClass"](t);}AQ();B.mix(this,{getVisibleThumbs:AK,loadThumb:AJ,isActive:AR,toggleSwitcher:AA,show:AT,hide:AL});};B.mail.ui.Boss.Themes=new b();},"1.0.0",{requires:["rocket-stats","comms-ui-envelope","overlay","common-persist-cookie-data"]});