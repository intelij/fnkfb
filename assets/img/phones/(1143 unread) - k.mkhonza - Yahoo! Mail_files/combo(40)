YUI.add("tictac-flickr-auth",function(r){var i=r.Tictac.flickr,c=i.Stats.stat,e=i.strings,o=i.rollups,l=r.Tictac.base.utils,n=l.verify,t=i.Webservice,a,s;function u(){if(s){s.destroy();s=null}}function _(){c("flickr_newuser_cancel");u()}function f(){u();a.ok()}function d(){r.common.ui.DialogHelper.cancelDialog({hd:e.str_share_from_flickr+'<div id ="flickrHeader"></div>',bd:"",noScroll:true},null,function(r){var i=r.get("contentBox");s=r;r.hide();i.addClass("flickr-loading-dialog");i.one(".modal-bd").addClass("flickr-loading");r.show();r.center()})}function m(){c("flickr_newuser_ok");u();d();t.createAcct({success:function(r){u();if(r&&r.just_registered){c("flickr_new_account_created_success")}else{c("flickr_existing_account_link_success")}k(r)},failure:function(){var i=l.subs(e.str_please_login,{flickr_login_url:"http://www.flickr.com/signin"});u();c("flickr_new_account_created_failure");r.common.ui.DialogHelper.alert({hd:e.str_sorry,bd:o.authError({error:e.str_problem_connecting,solution:i}),noScroll:true})}})}function k(i){var c=e.str_no_name,l=NeoConfig.emailAddress,t,a;n(i,"missing userinfo");t=i.username;c=i.fullname?i.fullname:c;a=i.just_registered?e.str_confirm_dialog_body_new:e.str_confirm_dialog_body_linked;if(l.indexOf("@yahoo.com")>0){l=l.replace("@yahoo.com","")}l="("+l+")";l=i.just_registered?"":l;r.common.ui.DialogHelper.alert({hd:e.str_confirm_dialog_title,bd:o.confirmation({realName:c,screenName:t,yid:l,body:a}),noScroll:true},{ok:{handler:f}},function(r){s=r})}function g(){var i=l.subs(e.str_learn_more_privacy,{url_learn_more:"http://www.flickr.com/new/",url_privacy:"http://www.flickr.com/help/privacy-policy/"});r.common.ui.DialogHelper.confirm({hd:e.str_share_photos_from_flickr,bd:o.initialDialog({body:e.str_share_photos_body,learn_more:i}),noScroll:true},{ok:{handler:m},cancel:{handler:_}},function(r){s=r})}var h={link:function(r){a=r;g()}};r.namespace("Tictac.flickr").Auth=h},"1.0.0",{requires:["tictac-base-utils","tictac-flickr-stats","tictac-flickr-strings","tictac-flickr-rollups","tictac-flickr-ws","common-ui-dialog-helper"]});YUI.add("tictac-flickr-chooser",function(e){var t=50,o=12,i,l=e.Tictac,n=l.base.utils,r=l.flickr,s=r.Model,a=r.rollups,c=r.Stats.stat,f,d,p,u,h,v,k,m,_,g,y,w="stream",C=[],S={},b={},M={},T=false;function H(){var t=[],o={is_private:"1",is_friend:"1",is_family:"1"},i,l;if(w==="stream"){l=k.all("div.photolist-item-selected img");o["photos"]=t}else{l=k.all("div.photoset-item-selected img");o["sets"]=t}c("flickr_picker_ok");c("flickr_picker_files_selected",{count:l.size()});l.each(function(e){var o=s.urlToPhoto(e.get("src")).id,i=w==="stream"?b[o]:S[o];t.push(i)});if(s.hasPrivatePhoto(t)){i=v.get("contentBox").one(".modal-ft");i.get("children").remove();i.addClass("flickr-footer-waiting");i.append("<span>"+y.str_fetching_photo_info_flickr+"</span>")}else if(s.hasPrivateSet(t)){e.common.ui.DialogHelper.confirm({hd:y.str_share_from_flickr,bd:'<div id="flickrGuestPassConfirm"></div>',suppressActive:true,noScroll:true},{ok:{handler:function(e,t){var i=t.get("contentBox"),l,n=i.one("input[value=share_public]"),r=n&&n.get("checked");if(!r){l=i.one(".modal-ft");l.get("children").remove();l.addClass("flickr-footer-waiting");l.append("<span>"+y.str_fetching_photo_info_flickr+"</span>")}s.makeShareable(o,{success:function(e){h.success(e,w==="set");t.destroy();L()},failure:function(){t.destroy();L()}},r)},stopDestroy:true},cancel:{handler:function(){}}},function n(e){var o=e.get("contentBox"),i=o.one("#flickrGuestPassConfirm"),l;if(s.areAllPrivatePhotos(t)){l=t.length>1?y.str_guest_all_photos_sets:y.str_guest_all_photos_set;i.setHTML(l)}else{l=t.length>1?y.str_guest_some_photos_sets:y.str_guest_some_photos_set;i.setHTML(l);i.append(a.guestpassdialog())}});return}s.makeShareable(o,{success:function(e){h.success(e,w==="set");L()},failure:function(){L()}})}function x(){c("flickr_picker_cancel");if(typeof h!=="undefined"&&typeof h.cancel==="function"){h.cancel()}L()}function P(e){h=e;y=r.strings;D()}function U(t){var o=F(),i=A(),l=e.one("div#sets"),n=e.one("div#stream");if(w==="set"){return}if(t&&t.type==="click"){c("flickr_picker_sets")}w="set";l.addClass("active");n.removeClass("active");i.hide();if(d===1){R()}o.show();K()}function B(t){var o=F(),i=A(),l=e.one("div#sets"),n=e.one("div#stream");if(w==="stream"){return}if(t&&t.type==="click"){c("flickr_picker_photostream")}w="stream";n.addClass("active");l.removeClass("active");o.hide();if(f===1){N()}i.show();K()}function D(){e.common.ui.DialogHelper.confirm({hd:y.str_share_from_flickr+'<div id ="flickrHeader"></div>',bd:'<div id="flickrChooser">'+'<div class="flickr-photos-container">'+'</div><div class="flickr-sets-container"></div></div>',noScroll:true},{ok:{handler:H,stopDestroy:true},cancel:{handler:function(){if(V()){r.UploadController.cancelUploads()}x()},stopDestroy:true}},function t(t){var o=t.get("contentBox"),i,l;t.hide();o.addClass("tictac-flickr-chooser-dialog");k=e.one("div#flickrChooser");O(o);I();t.show();t.center();v=t;i=A();i.plug(e.Plugin.ScrollInfo);l=F();l.plug(e.Plugin.ScrollInfo);C.push(i.scrollInfo.on("scrollToBottom",N),l.scrollInfo.on("scrollToBottom",R),k.delegate("click",G,"div.photolist-item"),k.delegate("click",W,"div.photoset-item"));Q()})}function O(t){var o,i;o=e.Node.create(a.chooser_bottom({upload_link:y.str_upload_link}));t.one(".modal-ft").append(o);T=r.UploadController.init({container:t.one("#flickr-upload-view"),link:t.one("#upload-link-bottom"),error:t.one("#flickr-error"),drop:t,onStart:Z,onDone:$,onCancel:et});if(!T){t.one("#upload-link-bottom").setStyle("display","none")}i=t.one("#flickr-upload-view").setStyle("display","none");C.push(i.one("#uploadCancelModalOverlay").on("click",function(e){e.preventDefault();r.UploadController.cancelUploads();$()}));g=t.one(".countModalOverlay");C.push(g.on("click",function(e){e.preventDefault();c("flickr_picker_remove_all");K()}))}function I(){var t=e.one("div#flickrHeader");if(!t.one(".menu")){t.append(a.header({str_photostream:y.str_photostream,str_photoset:y.str_sets,str_menu_greeting:s.getFlickrHandle()}))}m=e.one("div#sets");_=e.one("div#stream");C.push(m.on("click",U),_.on("click",B))}function L(){e.each(C,function(e){e.detach()});C=[];if(v){v.destroy();v=null;k=null;h=null}w="stream";r.UploadController.cleanup()}function j(t){e.Array.each(t,function(e){b[e.id]=e})}function z(t){e.Array.each(t,function(e){S[e.primary]=e})}function A(){return k.one("div.flickr-photos-container")}function F(){return k.one("div.flickr-sets-container")}function E(t){var o=k.all("div.photoset-item-selected img").size(),i=k.all("div.photolist-item-selected img").size(),l=e.Lang.isUndefined(t)?o||i||"":t,n=g.one("a"),r;n.setHTML(l);r="none";if(l&&!V()){r="inline"}g.setStyle("display",r)}function G(e){var t=e.target.ancestor("div.photolist-item-inner"),o;if(!t){return}o=s.urlToPhoto(t.one("img").get("src")).id;t.toggleClass("photolist-item-selected");E();if(t.hasClass("photolist-item-selected")){M[o]=true}else{delete M[o]}}function W(e){var t=e.target.ancestor("div.photoset-item-inner");if(!t){return}t.toggleClass("photoset-item-selected");E()}function q(e){if(!e||e!=="TOS"){c("flickr_picker_photostream_failure")}var t=h;L();if(t.failure){t.failure(e)}}function N(){var e=Math.ceil(p/t),o=A(),i;if(f!==1&&f>e){return}if(o.one("div.flickr-row-loading")){return}i=o.appendChild('<div class="flickr-row flickr-row-loading"></div>');if(f===1){i.addClass("flickr-row-loading-initial")}s.photos("photostream",{perpage:t,page:f,safe_search:2,extras:"url_z, url_s, url_o"},{success:it,failure:q});f+=1}function R(){var e=Math.ceil(u/o),t=F(),i;if(d!==1&&d>e){return}if(t.one("div.flickr-row-loading")){return}i=t.appendChild('<div class="flickr-row flickr-row-loading"></div>');if(d===1){i.addClass("flickr-row-loading-initial")}s.photosets({perpage:o,page:d},{success:Y,failure:J});d+=1}function Y(e){var t=[],o,i=n.subs(y.str_create_one_now,{flickr_sets_url:"http://www.flickr.com/photos/organize/?start_tab=sets"}),l=F();if(!e){J();return}if(e.page==="1"&&e.total.toString()==="0"){o=l.one("div.flickr-row-loading");o.remove();l.appendChild(a.chooseremptyset({createsetlink:i}));return}z(e.photoset);if(e.page==="1"){u=e.total}s.formatItems(e.photoset);t=r.justifier.justifySets(e.photoset);o=l.one("div.flickr-row-loading");if(o){o.remove()}l.appendChild(a.setlist({rows:t}))}function J(e){if(!e||e!=="TOS"){c("flickr_picker_sets_failure")}var t=h;L();if(t.failure){t.failure(e)}}function K(){var e=k.all("div.photolist-item-selected"),t=k.all("div.photoset-item-selected");if(!e.isEmpty()){e.removeClass("photolist-item-selected")}if(!t.isEmpty()){t.removeClass("photoset-item-selected")}E("");M={}}function Q(e){b={};p=0;f=1;S={};u=0;d=1;A().empty();F().empty();if(!e){M={}}N()}function V(){return v.get("contentBox").one("#flickr-upload-view").getStyle("display")!=="none"}function X(e){var t=v.get("contentBox"),o=t.one("#flickr-status");if(e){t.one("span#okayModalOverlay").setStyle("display","none");t.one("span#cancelModalOverlay").setStyle("display","none");t.one("#upload-link-bottom").setStyle("display","none");t.one("#flickr-upload-view").setStyle("display","inline");E();return}t.one("span#okayModalOverlay").setStyle("display","inline-block");t.one("#upload-link-bottom").setStyle("display","block");t.one("#flickr-upload-view").setStyle("display","none");t.one("span#cancelModalOverlay").setStyle("display","inline-block");if(o){o.setHTML("")}}function Z(){X(true)}function $(e){X(false);B();if(!e){Q(true)}}function et(){}function tt(e){var t=e.one("div.flickr-row-loading-initial"),o=n.subs(y.str_no_photos_flickr_add_some,{flickr_upload_url:"http://www.flickr.com/"});t.remove();e.appendChild(a.chooseremptyphoto({uploadphotolink:o}));if(r.UploadController.getUploader().type==="FORM"){return}e.one("div.flickr-no-data a").on("click",function(e){var t=v.get("contentBox").one("#upload-link-bottom");if(!T){return}e.preventDefault();t._node.click()})}function ot(t){e.each(t,function(e){if(M[e.id]){e.isSelected=true}})}function it(t){var o,l=200,n=A(),c,f;if(typeof t==="undefined"){q();return}o=t.photo;if(t.page===1&&t.total.toString()==="0"){tt(n);return}j(o);if(t.page===1){p=t.total}c=n.one("div.flickr-row-loading");if(!i){c.setStyle("overflow","scroll");i=c.appendChild('<div style="height:9000px"></div>').get("clientWidth")-1}if(c){c.remove()}ot(o);f=r.justifier.justify(o,{rowHeight:l,rowWidth:i,pad:8},false,"s");n.appendChild(a.photolist({rows:f}));n.all(".flickr-row").setStyle("width",i+8);n.all("div.photolist-item:last-child").setStyle("padding-right","8px");E();e.one("div#greeting").setHTML(s.getFlickrHandle())}var lt={choose:function(e){P(e)}};e.namespace("Tictac.flickr").Chooser=lt},"1.0.0",{requires:["array-extras","common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btns_ok_cancel","node-scroll-info","event-hover","tictac-base-utils","tictac-flickr-justifier","tictac-flickr-model","tictac-flickr-rollups","tictac-flickr-strings","tictac-flickr-stats","tictac-flickr-uploadctrl"]});YUI.add("tictac-flickr-footer",function(t){var e=t.Tictac.base.utils,o=e.verify,r=t.Tictac.flickr,i=r.rollups,a=r.Stats.stat,n=r.strings;function c(t){return t.rte.getDocRoot()}function s(t){var e=c(t),o=e.all("div[class$=tictac-att-flickr-container]").pop();if(o){o.remove(true)}}function f(t){var e=480,o=600,a,s,f,l=c(t),u,h=t.rte.get("isRich")?i.footerRich:i.footerPlain;if(!t.photos.length){return}if(t.isSet){u=t.photos.length>1?n.str_flickr_msg_set_footer_plural:n.str_flickr_msg_set_footer;a=r.justifier.justifySets(t.photos)}else{u=t.photos.length>1?n.str_flickr_msg_footer_plural:n.str_flickr_msg_footer;a=r.justifier.justify(t.photos,{rowHeight:e,rowWidth:o,pad:8,footer:true},true,"z")}u=u.replace("{{username}}",t.username);l.append(h({rows:a,title:u}));s=l.one("div.tictac-att-flickr-container");f=s.all(".fk-attachment");f.on("mouseover",function(t){t.currentTarget.one(".fk-attachment-delete").show()});f.on("mouseout",function(t){t.currentTarget.one(".fk-attachment-delete").hide()})}function l(){s(this)}function u(){f(this)}function h(e){var o=this,r,i;if(e.changedType!=="mousedown"){return}if(t.Array.indexOf(e.classNames,"fk-attachment-delete")!==-1){i=c(this);r=e.changedNode.get("parentNode").getAttribute("href");o.photos=t.Array.filter(o.photos,function(t){return t.shareURL!==r});s(o);f(o);a("flickr_footer_remove");return}if(t.Array.indexOf(e.classNames,"fk-remove-all")!==-1){s(o);o.photos=null}}function p(t,e){var o=this;o.photos=[];o.rte=t;o.username=e;o.evtHandles=[t.on("beforeModeSwitch",l,o),t.on("afterModeSwitch",u,o),t.on("nodeChange",h,o),t.on("closeChange",o.cleanup,o)]}t.mix(p.prototype,{cleanup:function(){var e=this;t.each(e.evtHandles,function(t){if(t.detach){t.detach()}});delete e.evtHandles},onChosePhotos:function(e,r){var i=this;o(t.Lang.isArray(e),"footer onChosePhotos expected photo array");i.isSet=r;i.photos=e;s(i);f(i)}});t.namespace("Tictac.flickr").footer=p;t.namespace("Tictac.flickr").Footer=p},"1.0.0",{requires:["array-extras","tictac-base-utils","tictac-flickr-justifier","tictac-flickr-rollups","tictac-flickr-strings","tictac-flickr-stats"]});YUI.add("tictac-flickr-stats",function(c){var _={flickr_share_from:60,flickr_newuser_ok:61,flickr_newuser_cancel:62,flickr_existing_account_link_success:63,flickr_existing_account_link_failure:64,flickr_new_account_created_success:65,flickr_new_account_created_failure:66,flickr_picker_cancel:67,flickr_picker_ok:68,flickr_picker_sets:69,flickr_picker_photostream:70,flickr_picker_search:71,flickr_picker_unlink:72,flickr_picker_gotoflickr:73,flickr_picker_files_selected:74,flickr_picker_remove_all:75,flickr_save_to:76,flickr_save_all_to:77,flickr_saver_ok:78,flickr_saver_cancel:79,flickr_saver_files_count:80,flickr_saver_to_photostream:81,flickr_saver_to_existing_set:82,flickr_saver_to_new_set:83,flickr_saver_unlink:84,flickr_saver_gotoflickr:85,flickr_footer_remove:86,flickr_picker_upload:87,flickr_picker_upload_files_count:88,flickr_picker_upload_error:89,flickr_picker_upload_cancel:90,flickr_picker_upload_success:91,flickr_picker_photostream_failure:92,flickr_picker_sets_failure:93},r={count:29},e={},i={name:"flickr",appId:"1000934436956",isSampled:Math.floor(Math.random()*100)===0,actionEnums:_,customFieldEnums:r},l=new c.Tictac.base.Stats({name:"",ywa:i,ultActions:e});c.namespace("Tictac.flickr.Stats").stat=function(c,_){l.stat(c,_?_:{})}},"1.0.0",{requires:["tictac-base-stats"]});