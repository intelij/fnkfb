YUI.add("tictac-att-attachment-compose",function(t){var a=t.Tictac.att;function e(){e.superclass.constructor.apply(this,arguments)}e.NAME="attachment";t.extend(e,a.Attachment,{activate:function(){var a=this,e=new t.Tictac.widget.Progressbar,s=this.getNode();e.render(a.getNode());a.progressbar=e;if(s){(s.one(".tictac-att-other-save-btn")||s.one(".tictac-att-thumb-save-options")).hide();if(s.hasClass("tictac-att-other")){s.one(".tictac-att-cancel-file-uploading").removeClass("hidden")}}},setProgress:function(t){if(this.progressbar){this.progressbar.set(t)}},deactivate:function(){var t=this,a=this.getNode();if(t.progressbar){t.progressbar.cleanup();t.progressbar=null}if(a){(a.one(".tictac-att-other-save-btn")||a.one(".tictac-att-thumb-save-options")).show();a.removeClass("tictac-att-uploading");if(a.hasClass("tictac-att-other")){a.one(".tictac-att-cancel-file-uploading").addClass("hidden")}}}});a.AttachmentProgressbar=e;function s(){s.superclass.constructor.apply(this,arguments)}s.NAME="attachment";t.extend(s,a.Attachment,{activate:function(){this.getNode().addClass("tictac-att-uploading")},deactivate:function(){this.getNode().removeClass("tictac-att-uploading")}});a.AttachmentSpinny=s},"1.0.0",{requires:["tictac-att-attachments","tictac-att-progressbar"]});YUI.add("tictac-att-attachment-error",function(a){function e(a){var e={};if(a==="download:virus_not_downloadable"){e={save_to_computer:false,save_to_dropbox:false,has_save_options:false}}return e}function t(a){var e="has-error";switch(a){case"tray:download_cleaned":case"tray:compose_warning":case"download:virus_detected_cleaned":case"download:password_protection":case"compose:virus_cleaned":case"compose:password_protection":case"compose:generic_warning":e="has-warning";break;case"tray:download_error":case"tray:compose_error":case"download:virus_not_downloadable":case"download:virus_scan_incomplete":case"download:retry_network_error":case"compose:virus_not_cleaned":case"compose:generic_error":e="has-error";break}return e}function _(e,t){var _=a.Tictac.att.strings,r;switch(e){case"tray:download_cleaned":if(t&&t.num){r="str_tictac_att_file_download_success_plural"}else{r="str_tictac_att_file_download_success_singular"}break;case"tray:compose_error":if(t&&t.num&&t.num!==1){r="str_tictac_att_compose_no_send_plural"}else{r="str_tictac_att_compose_no_send_singular"}break;case"tray:compose_warning":if(t&&t.num&&t.num!==1){r="str_tictac_att_compose_warning_plural"}else{r="str_tictac_att_compose_warning_singular"}break;case"tray:download_error":if(t&&t.num&&t.num!==1){r="str_tictac_att_file_download_fail_plural"}else{r="str_tictac_att_file_download_fail_singular"}break;case"download:virus_not_downloadable":if(t&&t.virus_name){r="str_tictac_att_download_virus_named_not_downloadable"}else{r="str_tictac_att_download_virus_not_downloadable"}break;case"download:virus_scan_incomplete":r="str_tictac_att_download_virus_scan_incomplete";break;case"download:retry_network_error":r="str_tictac_att_download_retry_network_error";break;case"download:password_protection":r="str_tictac_att_download_password_protection";break;case"download:virus_detected_cleaned":if(t&&t.virus_name){r="str_tictac_att_download_virus_named_detected_cleaned"}else{r="str_tictac_att_download_virus_detected_cleaned"}break;case"compose:virus_cleaned":if(t&&t.virus_name){r="str_tictac_att_compose_named_virus_cleaned"}else{r="str_tictac_att_compose_virus_cleaned"}break;case"compose:virus_not_cleaned":if(t&&t.virus_name){r="str_tictac_att_compose_named_virus_not_cleaned"}else{r="str_tictac_att_compose_virus_not_cleaned"}break;case"compose:password_protection":r="str_tictac_att_compose_password_protected";break;case"compose:generic_error":r="str_tictac_att_compose_generic_error";break;case"compose:generic_warning":r="str_tictac_att_compose_generic_warning";break;default:r="str_tictac_att_file_download_fail_singular";break}if(_[r]){return a.Tictac.base.utils.subs(_[r],t)}return null}a.namespace("Tictac.att").attError=function(a,r){return{message:_(a,r),cssClass:t(a),menuSettings:e(a)}}},"1.0.0",{requires:["tictac-base-utils","tictac-att-strings"]});YUI.add("tictac-att-downloader",function(e){var t,r,a=e.Tictac.att.strings,n=e.Tictac.base.utils.verify;function o(t){return e.Array.map(t,function(e){return e.aid})}function s(e,t){var r,a=false,n=false;switch(e){case"download_av_internal_error":case"download_av_server_down":case"download_av_error":r="download:retry_network_error";a=true;break;case"download_has_virus":case"download_has_virus_cant_clean":r="download:virus_not_downloadable";a=true;break;case"download_not_scannable":r="download:password_protection";n=true;break;case"download_cleaned":r="download:virus_detected_cleaned";n=true;break;case"download_av_no_virus":break;default:a=true;r="download:retry_network_error";break}return{failed:a||n,error:a,warning:n,code:r,extras:{virus_name:t}}}function i(){var t=new Date,r=e.Tictac.att.strings.str_tictac_att_attachments;r+="_"+t.getFullYear();r+=t.getMonth()+1;r+=t.getDate();return r}function c(t,n,o){var s=window.yui.common.ui.DialogHelper.confirm,i,c,d,l=o&&o.fullscan===1;if(l){t+="&fullscan=1"}function u(){if(!r){r=document.createElement("iframe");r.id="tictac-attachment-downloader";r.style.display="none";e.one("body").append(r)}r.src=t}if(e.UA.ie&&e.UA.ie<9){d=a[n===1?"str_tictac_att_download_done_singular":"str_tictac_att_download_done_plural"];i={hd:a.str_tictac_att_download_title,bd:d};c={ok:{handler:u}};s(i,c,function(){var t=e.one("#modalOverlay");if(t){try{t.get("parentNode").get("parentNode").setStyle("zIndex","999999")}finally{}}})}else{u()}}function d(t,r){var a=2,o=0,s=0,i=t.attachments,c=false;n(i.length>0,"populateSecureDownloadURLs expected at least 1 att");function d(t,r){var a=t.downloadUrl.replace(/^https?:\/\/[\s\S]*yahoo\.com/,"")+"&giveurl=1";o+=1;e.io(a,{on:{success:function(e,r){t.secureDownload={url:r.responseText};o-=1;l()},failure:function(e,a){o-=1;if(!r){d(t,true);return}t.secureDownload={error:e,res:a};c=true;l()}}})}function l(){var e=t.attachments;while(o<a&&s<e.length){s+=1;d(e[s-1])}if(o===0&&s>=e.length){r(c?"failed":"success",t)}}l()}function l(r,a,n,o,u){var f=u&&u.appid,w=[window.location.protocol+"//",window.location.host,"/ws/mail/v2.0/jsonrpc?","appid="+(f||"YahooMailNeo"),"&m=VirusScanAttachments","&wssid="+NeoConfig.wssid,"&windowid="+NeoConfig.windowId,"&r="+(new Date).getTime()].join(""),_={method:"VirusScanAttachments",params:[{downloadInfo:r,archiveName:i(),archive:r.length>1?true:false}]},h=new Date;o=e.Lang.isUndefined(o)?true:o;if(u){for(var g in u){if(u.hasOwnProperty(g)&&g!=="appid"){w+="&"+g+"="+u[g]}}}function p(o,s){var i,c,d,u;try{i=e.JSON.parse(s.response||s.responseText)}catch(f){a("failed",{});t.stat("download_error_json");return}if(i&&i.error){if(i.error.code==="Client.ClientRedirect.SessionIdReissue"&&!n){c=i.error.detail.url;d=c.match(/[\&|\?]wssid=([^\&\#]+)/);u=d.length>1?d[1]:NeoConfig.wssid;NeoConfig.wssid=u;l(r,a,true);return}}t.stat("download_error_general",{status:i.error.code+": "+i.error.message});a("failed",{})}function m(n,i){var l=e.JSON.parse(i.response||i.responseText).result,f,w=new Date,_={},g;g={errors:0,warnings:0};if(l.hasOwnProperty("downloadArchiveUrl")){f=l.downloadArchiveUrl}else if(l.hasOwnProperty("attachInfoResult")&&l.attachInfoResult.length>0&&l.attachInfoResult[0].hasOwnProperty("downloadUrl")){f=l.attachInfoResult[0].downloadUrl}if(l&&l.attachInfoResult){_=e.Array.map(l.attachInfoResult,function(a,n){var o=s(a.errorString,a.virusFound?a.virusFound[0]:null);if(o.error){t.stat("download_success_error",{status:a.errorString})}else{t.stat("download_success_success",{type:a.attachmentType+"/"+a.attachmentSubtype,size:Math.round(a.fileSize/1024)})}if(o.warning){t.stat("download_success_warning",{status:a.errorString})}if(o.error){g.errors++}else if(o.warning){g.warnings++}return e.merge(o,{aid:r[n].aid,fileName:a.fileName,downloadUrl:a.downloadUrl||""})});e.mix(g,{attachments:_})}if(o&&f){c(f,r.length,u);a("success",g);t.stat("download_success",{count:l.attachInfoResult.length,time:w-h});if(g.warnings>0){t.stat("download_success_warnings",{count:l.attachInfoResult.length,status:g.warnings})}if(g.errors>0){t.stat("download_success_errors",{count:l.attachInfoResult.length,status:g.errors})}}else{t.stat("download_success_nourl");d(g,a)}}e.Tictac.base.mailIO.send(w,{data:e.JSON.stringify(_),method:"POST",headers:{"Content-Type":"application/json"},on:{success:m,failure:p}})}function u(t,r,a,n){var o=t.get("attachments"),s=e.Tictac.att.attError,i;if(a==="failed"){t.showError("tray:download_error",r.length)}else if(n.errors){t.showError("tray:download_error",n.errors)}else if(n.warnings){t.showError("tray:download_cleaned",n.warnings)}if(!n.attachments){e.Array.each(r,function(e){if(!o.get){return false}i=o.get(e.aid);i.updateProperty("error",s("download:retry_network_error"))});return false}e.Array.each(n.attachments,function(e){if(!o.get){return true}i=o.get(e.aid);if(e.failed&&e.code){i.updateProperty("error",s(e.code,e.extras))}else if(i.hasError()){i.updateProperty("error",{})}});return true}function f(e,t,r){var a=o(t);e.setStatus(a,"scanning");l(t,function(n,o){e.clearStatus(a,"scanning");u(e,t,n,o);if(r){r()}})}function w(e,t,r,a,n){var s=o(t);if(e){e.setStatus(s,"scanning")}l(t,function(a,o){if(!e){r(a,o);return}e.clearStatus(s,"scanning");if(n||n===undefined){if(u(e,t,a,o)){if(r){r(a,o)}}else{e.showError("tray:download_error",t.length)}}else{if(r){r(a,o)}}},false,false,a)}function _(e){if(e&&e.stat){t=e}}e.namespace("Tictac.att").downloader={download:f,getURLs:w,setStats:_,downloadAttachments:l}},"1.0.0",{requires:["array-extras","io","tictac-base-mail-io","node","tictac-att-strings","tictac-att-attachment-error","tictac-base-utils","querystring-stringify-simple"]});/*jshint maxstatements: 50 */YUI.add("tictac-attach-view",function(a){function i(b,d,e){function n(a){return a.halt(),!1}var f=this;f.model=b,f.controller=d,f.rte=e.rte,f.stat=a.Tictac.attach.Controller.conf.stat,f.username=e.username?e.username:"The sender";var h=e.tray,i=e.rte.getDocRoot().ancestor(".inner");if(h)h.setAttribute("contentEditable","false");else if(g&&g.attachment_well){var j=g.attachment_well({});e.tray=h=a.Node.create(j)}i&&h&&i.append(h),f.tray=new a.Tictac.att.AttachmentTray({attachments:new a.Tictac.att.Collection,isCompose:!0,boundingBox:e.tray}),f.evtHandles=[f.tray.on("removeall",f.cmdRemoveAllAttachments,f),f.tray.on("norton",f.nortonClick,f),f.model.on("added",f.addAttachment,f),f.model.on("deleted",f.removeAttachment,f),f.model.on("updated",f.updateAttachment,f),f.model.on("failures",f.updateFailureText,f),f.model.on("emptied",f.updateAttachmentEmpty,f),f.model.after("quota",function(a){(a.violation.size||a.violation.count)&&f.onQuotaViolated(a.violation,a.isDialogHandled)}),f.tray.on("menu-item-selected",function(a){var b;if(!a.attachment)return;b=a.attachment.getId(),a.action==="remove"?f.cmdRemoveAttachment(b):a.action==="download"?f.cmdDownloadAttachment(b):a.action==="save_dropbox"&&f.cmdSaveAttachmentToDropbox(b),a.action==="retry"&&a.attachment&&(this._attachmentMenu.allowSimClick(),f.cmdRetryAttachment(a.attachment.getId()))})];var k=0,l=[],m=e.tray;m&&(l.push(m.delegate("click",function(a){if(a.target.ancestor(".tictac-att-thumb-save-options"))return;var b=new Date,c=b-k;c>1&&n(a),k=b},".tictac-att-viewer")),l.push(m.delegate("key",function(a){a.keyCode===13&&a.shiftKey?n(a,!0):a.keyCode===13&&n(a)},"down:13",".tictac-att-thumb"))),e.dropbox&&c.hasTictacModule("tictac-dropbox")&&a.use("tictac-dropbox-footer",function(a){f.footer=new a.Tictac.dropbox.footer(f.rte,f.model,f.username)})}function j(a){return a.isDropbox()?!1:b.filter(a)}var b=a.Tictac.att.filter,c=a.Tictac.base.utils,d=c.getVal,e=a.Tictac.attach.Utils.isSvrResponseWarning,f={ERROR_TITLE:"ERROR_TITLE",ERROR_SIZE:"ERROR_SIZE",ERROR_COUNT:"ERROR_COUNT",alert:function(){}},g=a.Tictac.attach.rollups,h=/[\w\W]+\.([^\.]+$)/;a.extend(i,a.Base,{updateFailureText:function(a){var b=this;if(a===0){b.tray.hideError();return}b.tray.showError(b.model.areAllWarningOrSuccess()?"tray:compose_warning":"tray:compose_error",a)},onQuotaViolated:function(a,b){var c=this,d;a.size?d=f.ERROR_SIZE:d=f.ERROR_COUNT,b||f.alert({hd:f.ERROR_TITLE,bd:d,restoreFocusNode:c.tray.get("boundingBox")}),c.model.delDownToQuota()},isDownloadable:function(a){return a.isUploadValid()&&!a.isDropbox()},addAttachment:function(c,e){var f=this,g,i=f.tray.get("boundingBox");if(f.model.count(j)===0){f.tray.hide();return}if(!j(c))return;f.tray.show(),e&&!this._pendingScroll&&(this._pendingScroll=!0,setTimeout(function(){this._pendingScroll=!1,i.scrollIntoView()},0)),g=new a.Tictac.att["Attachment"+(c.hasProgress?"Progressbar":"Spinny")]({filename:c.filename,thumbnail:c.thumbnail,size:c.size}),g.setId(c.id),g.set("dropbox",c.dropbox?!0:!1),f.tray.addAttachment(g),c.isUploadDone()?(g.set("removable",!0),g.updateProperty("filetype",b.map(c.mimetype,c.filename.replace(h,"$1"),!1))):(g.updateProperty("cancelable",!0),g.activate(),f.tray.setStatus([c.id],"uploading")),f.isDownloadable(c)&&g.set("downloadable",!0),d(a,"Tictac.dropbox.controller")&&g.set("shareable",!0)},updateAttachment:function(a){var b=this,c=b.tray.get("attachments"),d=c.get(a.id);if(!j(a))return;a.hasProgress&&d.setProgress(a.progress),a.thumbnail&&d.updateProperty("thumbnail",a.thumbnail),d&&a.uploadState==="success"?b.successHandler(d,a):d&&a.uploadState==="failed"&&b.failureHandler(d,a)},successHandler:function(c,d){var f=this,g="compose:generic_warning";c.data.size=d.size,c.set("cancelable",!1),c.set("removable",!0),c.set("retryable",!1),c.updateProperty("error",{}),f.isDownloadable(d)&&c.set("downloadable",!0);switch(d.reason){case"uploadAVNotScannable":g="compose:password_protection";break;case"uploadAVCleaned":g="compose:virus_cleaned"}c.updateProperty("error",e(d.reason)?a.Tictac.att.attError(g):{}),c.updateProperty("filetype",b.map(d.mimetype,d.filename.replace(h,"$1"))),c.deactivate(),f.tray.clearStatus([d.id],"uploading"),f.stat("view_upload_success")},failureHandler:function(b,c){var d=this,e="compose:generic_error";switch(c.reason){case"uploadAVCannotClean":case"uploadAVHasVirus":e="compose:virus_not_cleaned"}b.set("cancelable",!1),b.set("removable",!0),b.set("downloadable",!1),b.set("shareable",!1),a.UA.ie||b.set("retryable",!0),b.updateProperty("error",a.Tictac.att.attError(e)),b.deactivate(),d.tray.clearStatus([c.id],"uploading"),d.stat("view_upload_failure")},updateAttachmentEmpty:function(){this.tray.hide()},removeAttachment:function(a){var b=this;if(!j(a))return;b.tray.clearStatus([a.id],"uploading"),b.tray.removeAttachment(a.id)},cmdRemoveAllAttachments:function(){var a=this;a.controller.deleteAttachments(function(a){return!a.isDropbox()}),a.controller.saveDraft(),a.controller.trackClick("att_cmps_rmv")},cmdRemoveAttachment:function(a){var b=this;b.controller.trackClick("att_cmps_mnu_rmv"),b.controller.deleteAttachment(a),b.controller.saveDraft()},cmdRetryAttachment:function(a){this.controller.trackClick("att_cmps_mnu_rtry"),this.controller.retryAttachment(a)},cmdDownloadAttachment:function(b){var c=this,d=c.tray,e=a.Tictac.att.downloader;d.setStatus([b],"scanning"),c.controller.getDownloadInfo(b,function(a){a.aid=b,e.setStats({stat:c.stat}),e.download(d,[a])})},cmdSaveAttachmentToDropbox:function(b){var c=this,d=c.tray;c.controller.trackClick("att_save_to_dropbox"),c.stat("dropbox_saveto",{message:"compose"}),d.setStatus([b],"scanning"),c.controller.getDownloadInfo(b,function(e){e.aid=b,a.use("tictac-dropbox-controller",function(a){a.Tictac.dropbox.controller.saveTo(d,[e],{stat:c.stat})})})},nortonClick:function(){this.controller.trackClick("att_cmps_nrtn")},render:function(){this.tray.render()},cleanup:function(){var b=this;b.tray.destroy(),b.tray=null,b.controller=null,a.each(b.evtHandles,function(a){a.detach&&a.detach()}),delete b.evtHandles,b.footer&&b.footer.cleanup()}}),a.namespace("Tictac.attach").View=i,a.namespace("Tictac.attach.View").conf=f,a.namespace("tictac.attach").View=i,a.namespace("tictac.attach.View").conf=f},"1.0.0",{requires:["base-base","node","tictac-base-utils","tictac-attach-utils","tictac-att-attachment-tray","tictac-att-filter","tictac-att-attachment-compose","tictac-att-attachment-error","tictac-att-attachments","tictac-attach-rollups","tictac-att-downloader"]});/**
 * Tictac form Uploader.
 */YUI.add("tictac-attach-uploader-form",function(a){function n(){return a.UA.ie?"IE"+a.UA.ie:a.UA.safari?"Safari"+a.UA.safari:a.UA.chrome?"Chrome"+a.UA.chrome:a.UA.gecko?"Firefox"+a.UA.gecko:"unknown"}function o(a){var b=this;if(!g.UPLOAD_URL_BASE)throw"You must configure UPLOAD_URL_BASE'";return b.type="FORM",b.selectFilesButton=a.selectFilesButton,b.instanceId=h++,b.fileMap={},b.fileCount=0,i[b.instanceId]=b,b.evtHandles=[],b}var b=['<form method="post" enctype="multipart/form-data" ','class="attachment-button-form"></form>'].join(""),c=['<input type="file" id="attachment-button-input" ','name="uploadfile" style="position: absolute; ',"top: 0; right: 0; z-index: 100; opacity: 0; ",'filter: alpha(opacity=0); display:block;">'].join(""),d=['<iframe id="FILE_ID" name="FILE_ID" ','style="display:none;"></iframe>'].join(""),e=["<script>window.onunload=function(){","parent.UploaderService.onIframeUpdate(",'"INSTANCE_ID", "FILE_ID");};',"</script>"].join(""),f=function(a,b){g.stat("form_tt_"+a,b)},g={IFRAME_USE_TIMEOUTS:!0,IFRAME_UPLOAD_TIMEOUT_MS:15e5,IFRAME_POLL_INTERVAL_MS:2e3,IFRAME_MAX_POLL_ATTEMPTS:15,REDIRECT_URL_BASE:document.location.protocol+"//"+document.location.host,UPLOAD_URL_BASE:"",BUILD_ID:0,stat:function(a,b){l("STAT: "+a+":"+b)},stopwatch:function(){l("STOPWATCH not conf'ed."),this.stop=function(){}}},h=0,i={},j=0,k=a.Tictac.base.utils,l=k.log,m=k.verify;window.UploaderService={onIframeUpdate:function(a,b){var c=i[a];c&&c.onIframeUpdate(b)},handlePostRedirectResponse:function(b){var c,d;b&&b.charAt(0)==="?"&&(b=b.substring(1)),d=a.QueryString.parse(b),l("postRedirectResponse parsed "+b,d),m(d.hasOwnProperty("instanceId")&&i[d.instanceId],"UploaderForm unmapped instanceId:"+d.instanceId),c=i[d.instanceId],c.onPostResponse(d)}},o.NAME="tictac-attach-uploader-form",a.mix(o.prototype,{cleanup:function(){var b=this;a.Array.each(b.evtHandles,function(a){a.detach()}),b.selectFilesButton.detachAll(),delete i[b.instanceId]},render:function(d){var e=a.Node.create(b),f=a.Node.create(c),g=this,h=g.evtHandles;d.append(e.append(g.selectFilesButton.append(f))),g.container=d,h=h.concat([f.on("change",g.onFileSelected,g),f.on("click",g.onAttachButtonClicked,g)])},simulateClick:function(){var a=this,b=a.container.one("#attachment-button-input");b._node.click()},startUpload:function(b){function i(){e.abandon(d,"Attachment_UploadNoResponse")}m(a.Lang.isArray(b.fileList)&&b.fileList.length===1,"startUpload got invalid evt.fileList");var c=b.currentTarget.ancestor("form"),d=b.fileList[0],e=this,h;e.fire("fileuploadstart",{file:d}),h=e.makeIframeId(d.id),d.iframe=e.injectIframe(d,h),c.set("target",h),c.set("action",e.makeUploadURL(d.id)),c._node.submit(),f("FormUploader",{message:"onFileSelect"}),d.stopwatch=new g.stopwatch("AttachmentUpload"),d.stopwatch.attType="form",g.IFRAME_USE_TIMEOUTS&&(d.timeout=setTimeout(i,g.IFRAME_UPLOAD_TIMEOUT_MS)),c._node.reset()},cancel:function(a){var b=this,c=b.fileMap[a];m(c,"uploaderForm can't cancel "+a),b.clearCallbacks(c),delete b.fileMap[c.id],c.iframe&&c.iframe.remove(!0),f("Attachment_UploadCancelled"),b.fire("uploadcancel",{file:c})}},!0),a.mix(o.prototype,{makeIframeId:function(a){return j+=1,a+"_"+j},onAttachButtonClicked:function(){this.fire("attachbuttonclick")},onFileSelected:function(a){var b=a.currentTarget,c={name:b.get("value")},d=this;if(!c.name)return;c.id="FORM_FILE_"+d.fileCount,d.fileCount+=1,d.fileMap[c.id]=c,a.fileList=[c],d.fire("fileselect",a)},injectIframe:function(a,b){var c=this;m(c.container,"You forgot to call UploaderForm.render");var f=d.replace(/FILE_ID/g,b),g=c.container.appendChild(f),h=g._node,i=h.contentDocument||h.contentWindow.document;return i.open("text/html","replace"),i.write(e.replace("INSTANCE_ID",c.instanceId).replace("FILE_ID",a.id)),i.close(),g},onIframeUpdate:function(a){var b=this.fileMap[a];if(!b){l("UploaderForm IframeLoad for unknown file");return}this.clearCallbacks(b),b.interval=setInterval(this.makeIframePoller(b),g.IFRAME_POLL_INTERVAL_MS)},clearCallbacks:function(a){a.timeout&&(clearTimeout(a.timeout),delete a.timeout),a.interval&&(clearInterval(a.interval),delete a.interval),a.evtIframeLoad&&(a.evtIframeLoad.detach(),delete a.evtIframeLoad)},makeIframePoller:function(b){function m(d){var e,g;try{e=d.pathname}catch(h){g="uploaderFormUploadServerHangUp_Error_"+h.message}return e?e:(g=g||"uploaderFormUploadServerHangUp",j+=1,j>2&&(c.abandon(b,g),f("AttachUploadIframeError",{message:a.UA.os+"-"+n()})),null)}function o(){var a=h&&h.location,d=m(a);k+=1;if(k>=g.IFRAME_MAX_POLL_ATTEMPTS){c.abandon(b,"Attachment_UploadTimeout");return}if(!d)return;if(d.indexOf("attach.php")!==-1){l("UploaderForm iframe success for "+b.id),c.clearCallbacks(b),b.processed=!0;return}if(a===i||d.indexOf("ya/upload")!==-1)return;c.abandon(b,"Attachment_UploadUnexpectedResponse")}var c=this,d=b.iframe._node,e=d.contentDocument||d.contentWindow.document,h=d.contentWindow||e,i=h.location,j=0,k=0;return o},abandon:function(a,b){var c=this;f("abandon",{message:b}),c.clearCallbacks(a),delete c.fileMap[a.id],a.iframe.remove(!0),c.fire("uploaderror",{file:a,reason:b})},makeUploadURL:function(a){var b=this,c;return c=[g.REDIRECT_URL_BASE,"/neo/php/attach.php?instanceId=",b.instanceId,"&bid=",g.BUILD_ID,"&fileId=",a].join(""),[g.UPLOAD_URL_BASE,"?resulturl=",encodeURIComponent(c)].join("")},onPostResponse:function(b){var c=this,d,e="uploadcomplete",g=a.Tictac.attach.Utils;m(b.fileId,"onPostResponse no file id"),l("onPostResponse",b),d=c.fileMap[b.fileId],d.iframe.remove(!0),delete c.fileMap[d.id],d.diskfilename=b.diskfilename,d.mimetype=b.mimetype,d.size=parseInt(b.filesize,10),g.isSvrResponseSuccess(b.errorcode)||g.isSvrResponseWarning(b.errorcode)?e="uploadcomplete":e="uploaderror",d.stopwatch&&(d.stopwatch.attSize=d.size,d.stopwatch.stop(),delete d.stopwatch),c.clearCallbacks(d),d.reason=b.errorcode,f("server_response",{message:d.reason}),c.fire(e,{file:d})}},!0),a.namespace("Tictac.attach").UploaderForm=o,a.namespace("Tictac.attach.UploaderForm").conf=g,a.namespace("tictac.attach").UploaderForm=o,a.namespace("tictac.attach.UploaderForm").conf=g,a.augment(o,a.EventTarget,!0,null,{prefix:"uploaderform"})},"1.0.0",{requires:["event-custom","querystring-parse-simple","tictac-base-utils","tictac-attach-utils"]});YUI.add("tictac-attach-controller",function(a){function k(a){return parseInt(c(a,"size","0"),10)||0}function l(a,b,c,d){var e=this;e.uploader=a,e.model=b,e.switchUploaderType=c,e.composeView=d,e.getDownloadInfo=function(a,b){d.attGetDownloadInfo(a,b)},e.aidsByFids={},e.evtHandles=[],e.setUploader(a),d&&e.evtHandles.push(d.on("compose:getDisplayMessageResponse",function(a){a&&e._processGDM(a)}))}function m(b,c){var d;return a.Object.some(b.aidsByFids,function(a,b){return a===c?(d=b,!0):!1}),d}function n(a,b){return a.aidsByFids[b]}function o(a,b,c){return a.model.checkId(c)?!1:(d("aborting "+b+" on "+c),!0)}function p(a,b,c){function f(){a.model.set(b.id,"thumbnail",c),d(c)}var e=new Image;e.src=c;if(e.complete){f();return}e.onload=f,a.thumbnailRequests.push(e)}var b=a.Tictac.base.utils,c=b.getVal,d=b.log,e=b.verify,f=5,g=3e4,h=2e3,i={stat:function(){d("stat not conf'ed.")}},j=function(a,b){i.stat("controller_"+a,b)};l.prototype={setUploader:function(a){var b=this;b.uploader=a,b.evtHandles=b.evtHandles.concat([a.on("fileselect",b.fileselect,b),a.on("fileuploadstart",b.fileuploadstart,b),a.on("filedrop",b.filedrop,b),a.on("uploadprogress",b.uploadprogress,b),a.on("uploadcomplete",b.uploadcomplete,b),a.on("uploaderror",b.uploaderror,b),a.on("uploadcancel",b.uploadcancel,b),a.on("uploadfatalerror",b.uploadfatalerror,b),a.on("attachbuttonclick",b.attachButtonClick,b)]),b.thumbnailRequests=[]},uploadfatalerror:function(){var a=this;e(a.uploader.type==="HTML5","controller only handles fatal errors for HTML5"),a.deleteAttachments(),a.switchUploaderType(!0)},attachButtonClick:function(){this.trackClick("cmps_attfl",{t1:"cmpsTb"})},startUpload:function(b,c,d){var e=this;a.Array.each(c,function(a){var b={filename:a.name,size:k(a),hasProgress:a.hasProgress};d&&(b.dropbox={alf:!0},j("db_upload_start",{count:1,size:b.size})),e.aidsByFids[a.id]=e.model.add(b,!0)}),e.model.commit(),e.uploader.startUpload(b,d)},fileselect:function(b){var e=this,f=e.model,g=b.fileList,h=0,i=0,j=c(a,"Tictac.dropbox.controller"),l,m;d("controller fileselect",g),h=a.Array.reduce(g,0,function(a,b){var c=k(b);return i=Math.max(i,c),a+c});if(j&&j.dialogIfTooBig(i,g.length>1))return;if(j&&!f.willFit(h)){l=function(a){e.startUpload(b,g,a)},m=function(){a.Array.each(g,function(a){var b=n(e,a.id);b&&(e.deleteAttachment(b),d("deleted attachment "+b))})},j.attachLargeFiles(g.length>1,f,e,l,m);return}if(f.precheckQuota(g.length,h))return;e.startUpload(b,g)},fileuploadstart:function(a){var b=a.file,c=this,e=n(c,b.id),f=c.model,g=f.get(e);if(o(c,"fileuploadstart",e))return;g.uploadStartTime||(g.uploadStartTime=(new Date).getTime()),c.model.setUploadState(e,{state:"started"}),d("controller fileuploadstart",b)},filedrop:function(a){this.trackClick("att_cmps_dnd_mlti",{ltxt:a.numberOfFiles})},uploadprogress:function(a){var b=a.file,c=this,d=n(c,b.id);if(o(c,"uploadprogress",d))return;c.model.set(d,"progress",b.percentLoaded)},uploadcomplete:function(b){var c=b.file,e=this,f=e.model,g=n(e,c.id),h;if(o(e,"uploadcomplete",g))return;d("controller uploadcomplete",b),h=f.get(g);if(a.Lang.isNumber(c.size)){if(e.uploader.type==="FORM"&&!f.willFit(c.size)){e.handleFormSizeViolation(g);return}h.size=c.size}h.diskfilename=c.diskfilename,h.setMimeType(c.mimetype),h.retryCount>0&&j("controller_uploadretrysuccess"),h.isDropbox()&&c.dropboxLink&&(h.dropbox.link=c.dropboxLink,j("db_upload_success",{count:1,size:c.size})),e.model.setUploadState(g,{state:"success",reason:c.reason}),!h.isDropbox()&&h.isImage()?e.updateThumbnailURLs():e.saveDraft()},uploaderror:function(a){var b=a.file,c=this,e=n(c,b.id),i=c.model,k=i.get(e),l=c.uploader,m=(new Date).getTime()-k.uploadStartTime;if(!k.isDropbox()&&a.transferFailed&&l.retryUpload&&(k.retryCount===0||m<g&&k.retryCount<f)){k.retryCount++,setTimeout(function(){l.retryUpload(b.id)},h);return}d("controller uploaderror",a),l.type==="HTML5"&&a.transferFailed&&j("uploaderror"),k.isDropbox()&&j("db_upload_failure",{count:1,size:b.size});if(l.type==="FORM"&&b.reason==="uploadFileSizeError"){c.handleFormSizeViolation(e);return}i.setUploadState(e,{state:"failed",reason:b.reason})},uploadcancel:function(a){var b=a.file,c=this,f=n(c,b.id);e(!c.model.checkId(f),"Unexpected uploadcancel: "+b.id),d("got uploadcancel")},cancelUploadsInProgress:function(){var b=this,c;a.Array.each(b.model.getAll(),function(a){c=m(b,a.id),c&&!a.isUploadDone()&&(d("cancelling upload: "+a.id+" (fid: "+c+")"),b.uploader.cancel(c),b.model.setUploadState(a.id,{state:"failed",reason:"cancelled"}))})},deleteAttachments:function(b){var c=this,d=0;return a.Array.each(this.model.getAll(!0),function(a){if(b&&!b(a))return;c.deleteAttachment(a.id),d+=1}),d},deleteAttachment:function(a){var b=this,c=this.model.get(a),d=m(b,a);b.model.del(a),d&&(c.isUploadDone()||b.uploader.cancel(d),delete b.aidsByFids[d])},retryAttachment:function(a){var b=this;b.uploader.type==="HTML5"&&(b.cancelUploadsInProgress(),b.switchUploaderType(!1)),b.deleteAttachment(a),b.uploader.simulateClick()},trackClick:function(){a.Tictac.attach.Utils.trackClick.apply(this,arguments)},cleanup:function(){var b=this;b.thumbnailTimer&&b.thumbnailTimer.cancel(),a.each(b.evtHandles,function(a){a.detach&&a.detach()}),delete b.evtHandles,a.each(b.thumbnailRequests,function(a){a.onload=null}),delete b.thumbnailRequests},handleFormSizeViolation:function(b){var d=this,e=d.model,f=c(a,"Tictac.dropbox.controller"),g=1,h=m(d,b);delete d.aidsByFids[h],e.del(b),g+=d.deleteAttachments(function(a){return!a.isDropbox()&&!a.isUploadDone()});if(!f){e.fireQuotaViolation({size:!0});return}f.attachLargeFiles(g>1,e,d)},updateThumbnailURLs:function(){var b=this,c=3e3;if(b.thumbnailTimer)return;if(b.awaitingGetMsgResponse){b.thumbnailTimer=a.later(c,this,function(){b.thumbnailTimer=null,b.updateThumbnailURLs()});return}b.awaitingGetMsgResponse=!0,b.saveDraft()},saveDraft:function(){var a=this;a.composeView.attGetMsg(function(b){a._processGDM(b)},!0)},_processGDM:function(b){var c=this,d=b.attachments,e=c.model.getAll();c.awaitingGetMsgResponse=!1;if(!b||!b.mid||!b.part)return;d&&a.Lang.isArray(d)&&a.Array.each(d,function(d){var f,g,h;for(f=0,g=e.length;f<g;f++)if(e[f].filename===a.Lang.trim(d.filename)&&e[f].size===d.size){h=e[f];break}if(!h)return;d.thumbnailurl&&h.isUploadValid()&&!h.thumbnail&&p(c,h,d.thumbnailurl),h.original=h.original||{},h.original.mid=b.mid,h.original.partId=d.partId,h.original.fid="Draft",h.original.disposition=d.disposition,h.original.displayable=d.isDisplayable,h.original.tnef=d.tnefId||d.tnef}),c.composeView&&c._updateInlineImages(b)},_updateInlineImages:function(b){var c=/http(s)?:\/\/[^\/ ]*\.yahoo\.com\/ya\/download\?[^\"\']*/g,d=/http(s)?:\/\/[^\/ ]*\.yahoo\.com\/ya\/download\?[^\"\']*/,e=this.composeView,f,g,h,i,j=[],k=[],l,m;if(b&&b.part&&e.cdo.get("isRichText")){f=NeoConfig.hasConv?e.baseNode:e.getRTEDocNode();for(h=0,i=b.part.length;h<i;h++)if(b.part[h].text){g=b.part[h].text;break}if(g){l=c.exec(g);while(l)j.push(l[0]),l=c.exec(g);m=f.all("img"),m.each(function(a){var b=a.get("src");d.test(b)&&k.push(a)}),k.length===j.length&&a.Array.each(k,function(a,b){a.set("src",j[b])})}}}},a.augment(l,a.EventTarget),a.namespace("Tictac.attach").Controller=l,a.namespace("Tictac.attach.Controller").conf=i,a.namespace("tictac.attach").Controller=l,a.namespace("tictac.attach.Controller").conf=i},"1.0.0",{requires:["tictac-attach-neo","tictac-attach-uploader-form","tictac-attach-model-attachments","tictac-attach-utils","tictac-base-stats","tictac-base-utils"]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("file-html5",function(e,t){var n=e.Lang,r=e.bind,i=e.config.win,s=function(e){var t=null;s.isValidFile(e)?t=e:s.isValidFile(e.file)?t=e.file:t=!1,s.superclass.constructor.apply(this,arguments),t&&s.canUpload()&&(this.get("file")||this._set("file",t),this.get("name")||this._set("name",t.name||t.fileName),this.get("size")!=(t.size||t.fileSize)&&this._set("size",t.size||t.fileSize),this.get("type")||this._set("type",t.type),t.hasOwnProperty("lastModifiedDate")&&!this.get("dateModified")&&this._set("dateModified",t.lastModifiedDate))};e.extend(s,e.Base,{initializer:function(t){this.get("id")||this._set("id",e.guid("file"))},_uploadEventHandler:function(e){var t=this.get("xhr");switch(e.type){case"progress":this.fire("uploadprogress",{originEvent:e,bytesLoaded:e.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(1e4*e.loaded/this.get("size"))/100)}),this._set("bytesUploaded",e.loaded);break;case"load":if(t.status>=200&&t.status<=299){this.fire("uploadcomplete",{originEvent:e,data:e.target.responseText});var n=t.upload,r=this.get("boundEventHandler");n.removeEventListener("progress",r),n.removeEventListener("error",r),n.removeEventListener("abort",r),t.removeEventListener("load",r),t.removeEventListener("error",r),t.removeEventListener("readystatechange",r),this._set("xhr",null)}else this.fire("uploaderror",{originEvent:e,status:t.status,statusText:t.statusText,source:"http"});break;case"error":this.fire("uploaderror",{originEvent:e,status:t.status,statusText:t.statusText,source:"io"});break;case"abort":this.fire("uploadcancel",{originEvent:e});break;case"readystatechange":this.fire("readystatechange",{readyState:e.target.readyState,originEvent:e})}},startUpload:function(t,n,i){this._set("bytesUploaded",0),this._set("xhr",new XMLHttpRequest),this._set("boundEventHandler",r(this._uploadEventHandler,this));var s=new FormData,o=i||"Filedata",u=this.get("xhr"),a=this.get("xhr").upload,f=this.get("boundEventHandler");e.each(n,function(e,t){s.append(t,e)}),s.append(o,this.get("file")),u.addEventListener("loadstart",f,!1),a.addEventListener("progress",f,!1),u.addEventListener("load",f,!1),u.addEventListener("error",f,!1),a.addEventListener("error",f,!1),a.addEventListener("abort",f,!1),u.addEventListener("abort",f,!1),u.addEventListener("loadend",f,!1),u.addEventListener("readystatechange",f,!1),u.open("POST",t,!0),u.withCredentials=this.get("xhrWithCredentials"),e.each(this.get("xhrHeaders"),function(e,t){u.setRequestHeader(t,e)}),u.send(s),this.fire("uploadstart",{xhr:u})},cancelUpload:function(){var e=this.get("xhr");e&&e.abort()}},{NAME:"file",TYPE:"html5",ATTRS:{id:{writeOnce:"initOnly",value:null},size:{writeOnce:"initOnly",value:0},name:{writeOnce:"initOnly",value:null},dateCreated:{writeOnce:"initOnly",value:null},dateModified:{writeOnce:"initOnly",value:null},bytesUploaded:{readOnly:!0,value:0},type:{writeOnce:"initOnly",value:null},file:{writeOnce:"initOnly",value:null},xhr:{readOnly:!0,value:null},xhrHeaders:{value:{}},xhrWithCredentials:{value:!0},boundEventHandler:{readOnly:!0,value:null}},isValidFile:function(e){return i&&i.File&&e instanceof File},canUpload:function(){return i&&i.FormData&&i.XMLHttpRequest}}),e.FileHTML5=s},"3.13.0",{requires:["base"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("uploader-queue",function(e,t){var n=function(){this.queuedFiles=[],this.uploadRetries={},this.numberOfUploads=0,this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this.totalBytes=0,n.superclass.constructor.apply(this,arguments)};e.extend(n,e.Base,{_currentState:n.STOPPED,initializer:function(){},_uploadStartHandler:function(e){var t=e;t.file=e.target,t.originEvent=e,this.fire("uploadstart",t)},_uploadErrorHandler:function(e){var t=this.get("errorAction"),r=e,i,s;r.file=e.target,r.originEvent=e,this.numberOfUploads-=1,delete this.currentFiles[e.target.get("id")],this._detachFileEvents(e.target),e.target.cancelUpload(),t===n.STOP?this.pauseUpload():t===n.RESTART_ASAP?(i=e.target.get("id"),s=this.uploadRetries[i]||0,s<this.get("retryCount")&&(this.uploadRetries[i]=s+1,this.addToQueueTop(e.target)),this._startNextFile()):t===n.RESTART_AFTER&&(i=e.target.get("id"),s=this.uploadRetries[i]||0,s<this.get("retryCount")&&(this.uploadRetries[i]=s+1,this.addToQueueBottom(e.target)),this._startNextFile()),this.fire("uploaderror",r)},_startNextFile:function(){if(this.queuedFiles.length>0){var e=this.queuedFiles.shift(),t=e.get("id"),n=this.get("perFileParameters"),r=n.hasOwnProperty(t)?n[t]:n;this.currentUploadedByteValues[t]=0,e.on("uploadstart",this._uploadStartHandler,this),e.on("uploadprogress",this._uploadProgressHandler,this),e.on("uploadcomplete",this._uploadCompleteHandler,this),e.on("uploaderror",this._uploadErrorHandler,this),e.on("uploadcancel",this._uploadCancelHandler,this),e.set("xhrHeaders",this.get("uploadHeaders")),e.set("xhrWithCredentials",this.get("withCredentials")),e.startUpload(this.get("uploadURL"),r,this.get("fileFieldName")),this._registerUpload(e)}},_registerUpload:function(e){this.numberOfUploads+=1,this.currentFiles[e.get("id")]=e},_unregisterUpload:function(e){this.numberOfUploads>0&&(this.numberOfUploads-=1),delete this.currentFiles[e.get("id")],delete this.uploadRetries[e.get("id")],this._detachFileEvents(e)},_detachFileEvents:function(e){e.detach("uploadstart",this._uploadStartHandler),e.detach("uploadprogress",this._uploadProgressHandler),e.detach("uploadcomplete",this._uploadCompleteHandler),e.detach("uploaderror",this._uploadErrorHandler),e.detach("uploadcancel",this._uploadCancelHandler)},_uploadCompleteHandler:function(t){this._unregisterUpload(t.target),this.totalBytesUploaded+=t.target.get("size"),delete this.currentUploadedByteValues[t.target.get("id")],this.queuedFiles.length>0&&this._currentState===n.UPLOADING&&this._startNextFile();var r=t,i=this.totalBytesUploaded,s=Math.min(100,Math.round(1e4*i/this.totalBytes)/100);r.file=t.target,r.originEvent=t,e.each(this.currentUploadedByteValues,function(e){i+=e}),this.fire("totaluploadprogress",{bytesLoaded:i,bytesTotal:this.totalBytes,percentLoaded:s}),this.fire("uploadcomplete",r),this.queuedFiles.length===0&&this.numberOfUploads<=0&&(this.fire("alluploadscomplete"),this._currentState=n.STOPPED)},_uploadCancelHandler:function(e){var t=e;t.originEvent=e,t.file=e.target,this.fire("uploadcancel",t)},_uploadProgressHandler:function(t){this.currentUploadedByteValues[t.target.get("id")]=t.bytesLoaded;var n=t,r=this.totalBytesUploaded,i=Math.min(100,Math.round(1e4*r/this.totalBytes)/100);n.originEvent=t,n.file=t.target,this.fire("uploadprogress",n),e.each(this.currentUploadedByteValues,function(e){r+=e}),this.fire("totaluploadprogress",{bytesLoaded:r,bytesTotal:this.totalBytes,percentLoaded:i})},startUpload:function(){this.queuedFiles=this.get("fileList").slice(0),this.numberOfUploads=0,this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this._currentState=n.UPLOADING;while(this.numberOfUploads<this.get("simUploads")&&this.queuedFiles.length>0)this._startNextFile()},pauseUpload:function(){this._currentState=n.STOPPED},restartUpload:function(){this._currentState=n.UPLOADING;while(this.numberOfUploads<this.get("simUploads"))this._startNextFile()},forceReupload:function(e){var t=e.get("id");this.currentFiles.hasOwnProperty(t)&&(e.cancelUpload(),this._unregisterUpload(e),this.addToQueueTop(e),this._startNextFile())},addToQueueTop:function(e){this.queuedFiles.unshift(e)},addToQueueBottom:function(e){this.queuedFiles.push(e)},cancelUpload:function(e){var t,r,i;if(e){t=e.get("id");if(this.currentFiles[t])this.currentFiles[t].cancelUpload(),this._unregisterUpload(this.currentFiles[t]),this._currentState===n.UPLOADING&&this._startNextFile();else for(r=0,len=this.queuedFiles.length;r<len;r++)if(this.queuedFiles[r].get("id")===t){this.queuedFiles.splice(r,1);break}}else{for(i in this.currentFiles)this.currentFiles[i].cancelUpload(),this._unregisterUpload(this.currentFiles[i]);this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this.fire("alluploadscancelled"),this._currentState=n.STOPPED}}},{CONTINUE:"continue",STOP:"stop",RESTART_ASAP:"restartasap",RESTART_AFTER:"restartafter",STOPPED:"stopped",UPLOADING:"uploading",NAME:"uploaderqueue",ATTRS:{simUploads:{value:2,validator:function(e){return e>=1&&e<=5}},errorAction:{value:"continue",validator:function(e){return e===n.CONTINUE||e===n.STOP||e===n.RESTART_ASAP||e===n.RESTART_AFTER}},bytesUploaded:{readOnly:!0,value:0},bytesTotal:{readOnly:!0,value:0},fileList:{value:[],lazyAdd:!1,setter:function(t){var n=t;return e.Array.each(n,function(e){this.totalBytes+=e.get("size")},this),t}},fileFieldName:{value:"Filedata"},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:!0},perFileParameters:{value:{}},retryCount:{value:3}}}),e.namespace("Uploader"),e.Uploader.Queue=n},"3.13.0",{requires:["base"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("uploader-html5",function(e,t){function i(){i.superclass.constructor.apply(this,arguments)}var n=e.Lang.sub,r=e.Uploader.Queue;e.UploaderHTML5=e.extend(i,e.Widget,{_fileInputField:null,_buttonBinding:null,queue:null,initializer:function(){this._fileInputField=null,this.queue=null,this._buttonBinding=null,this._fileList=[],this.publish("fileselect"),this.publish("uploadstart"),this.publish("fileuploadstart"),this.publish("uploadprogress"),this.publish("totaluploadprogress"),this.publish("uploadcomplete"),this.publish("alluploadscomplete"),this.publish("uploaderror"),this.publish("dragenter"),this.publish("dragover"),this.publish("dragleave"),this.publish("drop")},renderUI:function(){var t=this.get("contentBox"),n=this.get("selectFilesButton");n.setStyles({width:"100%",height:"100%"}),t.append(n),this._fileInputField=e.Node.create(i.HTML5FILEFIELD_TEMPLATE),t.append(this._fileInputField)},bindUI:function(){this._bindSelectButton(),this._setMultipleFiles(),this._setFileFilters(),this._bindDropArea(),this._triggerEnabled(),this.after("multipleFilesChange",this._setMultipleFiles,this),this.after("fileFiltersChange",this._setFileFilters,this),this.after("enabledChange",this._triggerEnabled,this),this.after("selectFilesButtonChange",this._bindSelectButton,this),this.after("dragAndDropAreaChange",this._bindDropArea,this),this.after("tabIndexChange",function(){this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},this),this._fileInputField.on("change",this._updateFileList,this),this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},_rebindFileField:function(){this._fileInputField.remove(!0),this._fileInputField=e.Node.create(i.HTML5FILEFIELD_TEMPLATE),this.get("contentBox").append(this._fileInputField),this._fileInputField.on("change",this._updateFileList,this),this._setMultipleFiles(),this._setFileFilters()},_bindDropArea:function(e){var t=e||{prevVal:null},n=this.get("dragAndDropArea");t.prevVal!==null&&(t.prevVal.detach("drop",this._ddEventHandler),t.prevVal.detach("dragenter",this._ddEventHandler),t.prevVal.detach("dragover",this._ddEventHandler),t.prevVal.detach("dragleave",this._ddEventHandler)),n!==null&&(n.on("drop",this._ddEventHandler,this),n.on("dragenter",this._ddEventHandler,this),n.on("dragover",this._ddEventHandler,this),n.on("dragleave",this._ddEventHandler,this))},_bindSelectButton:function(){this._buttonBinding=this.get("selectFilesButton").on("click",this.openFileSelectDialog,this)},_ddEventHandler:function(t){t.stopPropagation(),t.preventDefault();if(e.Array.indexOf(t._event.dataTransfer.types,"Files")>-1)switch(t.type){case"dragenter":this.fire("dragenter");break;case"dragover":this.fire("dragover");break;case"dragleave":this.fire("dragleave");break;case"drop":var n=t._event.dataTransfer.files,r=[],i=this.get("fileFilterFunction"),s;i?e.each(n,function(t){var n=new e.FileHTML5(t);i(n)&&r.push(n)}):e.each(n,function(t){r.push(new e.FileHTML5(t))}),r.length>0&&(s=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?s.concat(r):r),this.fire("fileselect",{fileList:r})),this.fire("drop",{fileList:r})}},_setButtonClass:function(e,t){t?this.get("selectFilesButton").addClass(this.get("buttonClassNames")[e]):this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[e])},_setMultipleFiles:function(){this.get("multipleFiles")===!0?this._fileInputField.set("multiple","multiple"):this._fileInputField.set("multiple","")},_setFileFilters:function(){this.get("fileFilters").length>0?this._fileInputField.set("accept",this.get("fileFilters").join(",")):this._fileInputField.set("accept","")},_triggerEnabled:function(){this.get("enabled")&&this._buttonBinding===null?(this._bindSelectButton(),this._setButtonClass("disabled",!1),this.get("selectFilesButton").setAttribute("aria-disabled","false")):!this.get("enabled")&&this._buttonBinding&&(this._buttonBinding.detach(),this._buttonBinding=null,this._setButtonClass("disabled",!0),this.get("selectFilesButton").setAttribute("aria-disabled","true"))},_getFileList:function(){return this._fileList.concat()},_setFileList:function(e){return this._fileList=e.concat(),this._fileList.concat()},_updateFileList:function(t){var n=t.target.getDOMNode().files,r=[],i=this.get("fileFilterFunction"),s;i?e.each(n,function(t){var n=new e.FileHTML5(t);i(n)&&r.push(n)}):e.each(n,function(t){r.push(new e.FileHTML5(t))}),r.length>0&&(s=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?s.concat(r):r),this.fire("fileselect",{fileList:r})),this._rebindFileField()},_uploadEventHandler:function(e){switch(e.type){case"file:uploadstart":this.fire("fileuploadstart",e);break;case"file:uploadprogress":this.fire("uploadprogress",e);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",e);break;case"file:uploadcomplete":this.fire("uploadcomplete",e);break;case"uploaderqueue:alluploadscomplete":this.queue=null,this.fire("alluploadscomplete",e);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",e);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",e)}},openFileSelectDialog:function(){var e=this._fileInputField.getDOMNode();e.click&&e.click()},upload:function(t,n,r){var i=n||this.get("uploadURL"),s=r||this.get("postVarsPerFile"),o=t.get("id");s=s.hasOwnProperty(o)?s[o]:s,t instanceof e.FileHTML5&&(t.on("uploadstart",this._uploadEventHandler,this),t.on("uploadprogress",this._uploadEventHandler,this),t.on("uploadcomplete",this._uploadEventHandler,this),t.on("uploaderror",this._uploadEventHandler,this),t.on("uploadcancel",this._uploadEventHandler,this),t.startUpload(i,s,this.get("fileFieldName")))},uploadAll:function(e,t){this.uploadThese(this.get("fileList"),e,t)},uploadThese:function(t,n,i){if(!this.queue){var s=n||this.get("uploadURL"),o=i||this.get("postVarsPerFile");this.queue=new r({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"),fileFieldName:this.get("fileFieldName"),fileList:t,uploadURL:s,perFileParameters
:o,retryCount:this.get("retryCount"),uploadHeaders:this.get("uploadHeaders"),withCredentials:this.get("withCredentials")}),this.queue.on("uploadstart",this._uploadEventHandler,this),this.queue.on("uploadprogress",this._uploadEventHandler,this),this.queue.on("totaluploadprogress",this._uploadEventHandler,this),this.queue.on("uploadcomplete",this._uploadEventHandler,this),this.queue.on("alluploadscomplete",this._uploadEventHandler,this),this.queue.on("uploadcancel",this._uploadEventHandler,this),this.queue.on("uploaderror",this._uploadEventHandler,this),this.queue.startUpload(),this.fire("uploadstart")}else this.queue._currentState===r.UPLOADING&&(this.queue.set("perFileParameters",this.get("postVarsPerFile")),e.each(t,function(e){this.queue.addToQueueBottom(e)},this))}},{HTML5FILEFIELD_TEMPLATE:"<input type='file' style='visibility:hidden; width:0px; height: 0px;'>",SELECT_FILES_BUTTON:'<button type="button" class="yui3-button" role="button" aria-label="{selectButtonLabel}" tabindex="{tabIndex}">{selectButtonLabel}</button>',TYPE:"html5",NAME:"uploader",ATTRS:{appendNewFiles:{value:!0},buttonClassNames:{value:{hover:"yui3-button-hover",active:"yui3-button-active",disabled:"yui3-button-disabled",focus:"yui3-button-selected"}},dragAndDropArea:{value:null,setter:function(t){return e.one(t)}},enabled:{value:!0},errorAction:{value:"continue",validator:function(e){return e===r.CONTINUE||e===r.STOP||e===r.RESTART_ASAP||e===r.RESTART_AFTER}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:!1},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return e.Node.create(n(e.UploaderHTML5.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel"),tabIndex:this.get("tabIndex")}))}},simLimit:{value:2,validator:function(e){return e>=1&&e<=5}},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:!0},retryCount:{value:3}}}),e.UploaderHTML5.Queue=r},"3.13.0",{requires:["widget","node-event-simulate","file-html5","uploader-queue"]});
/*jshint maxlen: 1000, white: false, maxstatements: 1000 */YUI.add("tictac-attach-yuipatch",function(a){a.Uploader.Queue.prototype.restartUpload=function(){this._currentState=a.Uploader.Queue.UPLOADING;while(this.numberOfUploads<this.get("simUploads")&&this.queuedFiles.length)this._startNextFile()},a.FileHTML5.prototype._uploadEventHandler=function(a){var b=this.get("xhr");switch(a.type){case"progress":this.fire("uploadprogress",{originEvent:a,bytesLoaded:a.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(1e4*a.loaded/this.get("size"))/100)}),this._set("bytesUploaded",a.loaded);break;case"load":if(b.status>=200&&b.status<=299){this.fire("uploadcomplete",{originEvent:a,data:a.target.responseText});var c=b.upload,d=this.get("boundEventHandler");c.removeEventListener("progress",d,!1),c.removeEventListener("error",d,!1),c.removeEventListener("abort",d,!1),b.removeEventListener("load",d,!1),b.removeEventListener("error",d,!1),b.removeEventListener("readystatechange",d,!1),this._set("xhr",null)}else this.fire("uploaderror",{originEvent:a,status:b.status,statusText:b.statusText,data:b.responseText,source:"http"});break;case"error":this.fire("uploaderror",{originEvent:a,status:b.status,statusText:b.statusText,source:"io"});break;case"abort":this.fire("uploadcancel",{originEvent:a});break;case"readystatechange":this.fire("readystatechange",{readyState:a.target.readyState,originEvent:a})}}},"1.0.0",{requires:["file-html5","uploader-queue"]});/**
 * YUI UploaderHTML5 decorator to handle things we think should be implemented
 * in YUI UploaderHTML5 code.
 */YUI.add("tictac-attach-customuploader-html5",function(a){function b(){var c=this;b.superclass.constructor.apply(c,arguments),c.set("errorAction",a.Uploader.Queue.STOP)}b.NAME="tictac-attach-customuploader-html5",a.extend(b,a.UploaderHTML5,{cancelUpload:function(a){var b=this,c=b.queue;c.cancelUpload(a),!c.queuedFiles.length&&!c.numberOfUploads&&b.cleanUpQueue()},_uploadEventHandler:function(a){var c=this,d=this.queue;b.superclass._uploadEventHandler.apply(c,arguments),(a.type==="uploaderqueue:uploaderror"||a.type==="file:uploaderror")&&!d.queuedFiles.length&&!d.numberOfUploads&&c.cleanUpQueue()},_ddEventHandler:function(c){var d=this,e=c._event.dataTransfer;c.type==="drop"&&a.Array.indexOf(e.types,"Files")>-1&&d.fire("customdrop",{numberOfFiles:e.files.length}),b.superclass._ddEventHandler.apply(d,arguments)},cleanUpQueue:function(){var a=this;a.queue.cancelUpload(),a.queue=null}}),a.namespace("Tictac.attach").CustomUploaderHTML5=b,a.namespace("tictac.attach").CustomUploaderHTML5=b},"1.0.0",{requires:["uploader-html5","tictac-attach-yuipatch"]});YUI.add("tictac-attach-strings",function(a){a.namespace("Tictac.attach").strings={str_attach_drag_here:"Drag and drop attachments here",str_attach_form_fallback_dialog_body:"We're having trouble attaching this file. Try attaching again.",str_attach_form_fallback_dialog_title:"Upload Error",str_attach_html5_attach_button:"Attach File [or Drag and Drop]",str_attach_opt_menu:"Attach from my computer",str_enhancr_card_view_on:"View on {{link}}",last:null}},"1.0.0");/**
 * Tictac HTML5 Uploader. Wraps the YUI HTML5 Uploader to adapt to our
 * controller.  Includes custom attach button markup, as required by YUI HTML5
 * Uploader.
 */YUI.add("tictac-attach-uploader-html5",function(a){function p(a){var b;return window.DOMParser?b=(new window.DOMParser).parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a)),b}function q(b){var d=this,f,g=a.Tictac.attach.strings;a.mix(b,h.uploader,!0),f=new a.Tictac.attach.CustomUploaderHTML5(b),d.dropArea=b.dropArea,d.yuiImpl=f,d.type="HTML5",d.evtHandles=[],d.getCredRetry=0,d.credWaitTimer=null,d.dropArea.appendChild(a.Tictac.attach.rollups.dragdrop({drag_here:b.dragndropStr||g.str_attach_drag_here})),d.dropArea.setStyle("position","relative"),d.tictacDropAreaNode=d.dropArea.one(".tictac-attach-droparea"),d.tictacDropAreaNode.hide(),d.btnTooltip=b.btnTooltip||g.str_attach_html5_attach_button,f.set("uploadURL",h.UPLOAD_URL_BASE),f.set("dragAndDropArea",d.dropArea),d.evtHandles=d.evtHandles.concat([d.convert(f,"uploadcomplete",d.onUploadComplete),d.convert(f,"uploaderror",d.onUploadError),d.convert(f,"uploadprogress",d.onUploadProgress),d.dropArea.on(["dragenter","dragover"],d.onDragOverOrEnter,d),d.dropArea.on("drop",d.onDrop,d),f.on("customdrop",d.onCustomDrop,d),h.dropNode.on(["dragenter","dragover"],d.onDragOverOrEnter,d),d.convert(f,"fileselect",d.onRefire),d.convert(f,"fileuploadstart",d.onRefire),d.convert(f,"uploadcancel",d.onRefire),d.convert(f,"alluploadscomplete",d.onRefire),d.convert(f,"totaluploadprogress",d.onRefire),l.on("updateUploadURL",d.setCredential,d),l.on(["dragenter","dragover"],d.onDragOverOrEnter,d),l.on("drop",d.onDrop,d),f.get("selectFilesButton").on("click",function(a){a.halt(),a.target&&a.target.blur&&a.target.blur()})]),d.get=f.get,e(f.get("appendNewFiles"),"appendNewFiles has to be true or fileFromFid breaks");if(!h.UPLOAD_URL_BASE||!h.LAUNCH_PROTOCOL){c("uploaderHtml5: only external svc uploads will work since UPLOAD_URL_BASE and LAUNCH_PROTOCOL not configured.");return}d.fetchCredential()}function r(a){return a.id=a.get("id"),a.name=a.get("name"),a.hasProgress=!0,a.size=a.get("size"),a}function s(b){return b.fileList?b.fileList=a.Array.map(b.fileList,function(a){return new r(a)}):b.file&&(b.file=new r(b.file)),b}var b=a.Tictac.base.utils,c=b.log,d=a.one(document),e=b.verify,f=b.getVal,g=a.Tictac.attach.Neo.neoConfig,h={UPLOAD_URL_BASE:"",LAUNCH_PROTOCOL:"",dropNode:a.one("body"),rteContainer:a.one("body"),stat:function(){c("stat not conf'ed.")},stopwatch:function(){c("STOPWATCH not conf'ed."),this.stop=function(){}},simpleRelogin:function(){c("relogin!")},uploader:{multipleFiles:!0,simLimit:1}},i=10,j=1e3,k=i*j,l={},m,n,o=function(a,b){h.stat("html5_tt_"+a,b)};a.augment(l,a.EventTarget),d.on("dragenter",function(a){l.fire("dragenter",a)}),d.on("dragover",function(a){l.fire("dragover",a)}),d.on("drop",function(a){l.fire("drop",a)}),q.NAME="tictac-attach-uploader-html5",q.isBrowserCapable=function(){return a.UA.chrome>=8||a.UA.gecko>=4||a.UA.safari>=536.25||a.UA.ie>=10},a.mix(q.prototype,{convert:function(a,b,c){var d=this;return a.on(b,function(a){c.call(d,new s(a),b)})},render:function(){var a=this,b;a.yuiImpl.render.apply(a.yuiImpl,arguments),b=a.yuiImpl.get("selectFilesButton"),b.setStyles({width:"",height:""}),b.setAttribute("title",a.btnTooltip),a.evtHandles.push(b.on("click",a.onAttachButtonClicked,a))},cleanup:function(){var b=this;a.Array.each(b.evtHandles,function(a){a.detach()}),b.evtHandles=null,b.yuiImpl.destroy(),b.yuiImpl=null},doUpload:function(b){var d=this,e=b.fileList,f=d.yuiImpl.get("postVarsPerFile");a.Array.each(e,function(a){f[a.get("id")]={filename:a.get("name"),filesize:a.get("size")}}),d.yuiImpl.get("uploadURL")===h.UPLOAD_URL_BASE&&o("no_cred",{message:g.neoguid}),c("uploadThese on ",e),o("onFileSelect"),d.yuiImpl.uploadThese(e,d.yuiImpl.get("uploadURL"),f)},doExternalUpload:function(b,d){var e=this,f=b.fileList,g=e.yuiImpl,h;g.queue=null,a.Array.each(f,function(a){h=a.startUpload,a.startUpload=function(b,c,e){d.configureUpload(a,function(c){b=c.url||b,e=c.fileFieldName||"file",a.set("xhrWithCredentials",c.xhrWithCredentials||!1),a.set("uploadSvc",d),h.call(a,b,c.postVars,e)})}}),c("doExternalUpload on ",f),g.uploadThese(f)},startUpload:function(a,b){var c=this;if(b){c.doExternalUpload(a,b);return}if(m){if((new Date).getTime()-n<6e5){c.doUpload(a);return}m=null,c.fetchCredential()}c.evtHandles.push(c.once("credentialSetSuccessful",c.doUpload,c,a)),c.credWaitTimer||(c.credWaitTimer=setTimeout(function(){c.getCredRetry=i,c.fire("uploadfatalerror")},k))},retryUpload:function(b){var c=this,d=c.yuiImpl.queue,e=c.fileFromId(b);o("retry",{message:g.neoguid}),d?(d.addToQueueTop(e),d._currentState=a.Uploader.Queue.UPLOADING,d._startNextFile()):c.yuiImpl.uploadThese([e])},cancel:function(b){var c=this,d=c.yuiImpl,e=d.queue;if(e)if(b)try{e.cancelUpload(b),o("Attachment_UploadCancelled")}catch(f){}else a.Array.each(this.yuiImpl.get("fileList"),function(a){c.cancel(a)})},simulateClick:function(){var a=this,b=a.yuiImpl.get("selectFilesButton");b._node.click()}},!0),a.mix(q.prototype,{setCredVal:function(a){m=a,n=(new Date).getTime()},setCredential:function(){var a=[h.UPLOAD_URL_BASE,"&",m].join("");this.yuiImpl.set("uploadURL",a),this.yuiImpl.queue&&this.yuiImpl.queue.set("uploadURL",a)},fetchCredential:function(){function e(a,d){if(!c.yuiImpl)return;d=d.response||d.responseText,m=b.parseJSON(d),m=f(m,"Response.cred");if(!m){o("CredentialSetFailedCallback",{message:g.neoguid}),o("CredFetchSuccessData",{message:(d+"").substr(0,27)}),c.getCredRetry<i&&setTimeout(function(){c.fetchCredential(),c.getCredRetry++},j);return}clearTimeout(c.credWaitTimer),c.credWaitTimer=null,c.setCredential(),c.fire("credentialSetSuccessful"),n=(new Date).getTime(),o("CredentialSetSuccessful",{message:g.neoguid}),c.getCredRetry&&o("CredentialSetSuccessful_retry"),c.getCredRetry=0}function k(b,d){if(!c.yuiImpl)return;o("CredentialSetFailed",{message:d.status+"_"+d.statusText+"_"+g.neoguid});if(c.getCredRetry>=i)return;setTimeout(function(){d.status===302?(a.once("net:reloginSuccessful",function(){c.fetchCredential()}),h.simpleRelogin()):c.fetchCredential(),c.getCredRetry++},j)}var c=this,d=[h.LAUNCH_PROTOCOL,document.location.host,"/ya/upload_get_cred?r=",(new Date).getTime().toString(36)].join("");if(m){c.setCredential();return}a.io(d,{on:{success:e,failure:k}})},fileFromId:function(b){var c=a.Array.find(this.yuiImpl.get("fileList"),function(a){return a.id===b});return e(c,"No file found with id: "+b),c},onAttachButtonClicked:function(){this.fire("attachbuttonclick")},onCustomDrop:function(a){this.fire("filedrop",a)},onDrop:function(a){var b=this;a.halt(),b.tictacDropAreaNode&&b.tictacDropAreaNode.hide()},onDragOverOrEnter:function(b){var c=this,d=b._event.dataTransfer,e=c.tictacDropAreaNode;return a.Array.indexOf(d.types,"Files")!==-1||d.types.contains&&d.types.contains("application/x-moz-file")?(b.halt(),e&&(e.show(),c.dropAreaTimer&&(clearTimeout(c.dropAreaTimer),c.dropAreaTimer=null),c.dropAreaTimer=setTimeout(function(){e.hide()},100)),!0):!1},fileToSvc:function(b){var c=this,d=a.Tictac.attach.Utils,e=b.get("uploadSvc");return e?e:{parseServerResponse:c.parseServerResponse,isSvrResponseSuccess:d.isSvrResponseSuccess,isSvrResponseWarning:d.isSvrResponseWarning}},onUploadComplete:function(a){var b=this,d=a.file,e=b.fileToSvc(d);e.parseServerResponse(d,a.data),e.isSvrResponseSuccess(d.reason)||e.isSvrResponseWarning(d.reason)?a.type="uploadcomplete":a.type="uploaderror",c("uploaderHTML5 firing uploadcomplete: "+d.reason),o("success",{message:d.reason}),b.fire(a.type,a)},onUploadError:function(a){var b=this,c=a.file,d=this.yuiImpl,e=d.queue,f=b.fileToSvc(c),h,i;f.parseServerResponse(c,a.data),a.transferFailed=!0,e.queuedFiles.length&&e.restartUpload(),a.source==="io"?o("failure_uploaderror_io",{message:g.neoguid}):(i=(a.data+"").match(/<Error>([0-9A-Za-z]*?)<\/Error>/),h=i?i[1]:"parseerror_"+a.status+"_"+a.statusText,o("failure",{messsage:h})),c.get("isDropbox")&&o("db_upload_try_failure"),c.fire("uploaderror",a)},onUploadProgress:function(a){a.file.percentLoaded=a.percentLoaded,this.fire("uploadprogress",a)},onRefire:function(a,b){b||(b=a.type.substring(a.type.indexOf(":")+1)),this.fire(b,a)},parseServerResponse:function(b,c){var d,e;b.reason="unknown",d=p(c),c=d.firstChild,c.getElementsByTagName||(c=d.childNodes[1]),e=c.getElementsByTagName("attachment")[0];if(!e){b.reason=c.getElementsByTagName("Error")[0],b.reason&&(b.reason=b.reason.text);return}a.Array.each(e.childNodes,function(a){var c={id:"diskfilename",type:"mimetype",name:"name",size:"size",code:"reason"},d,e;d=a.nodeName,e=a.text||a.textContent;if(!c[d])return;b[c[d]]=e,d==="size"&&(b.size=parseInt(b.size,10))})}}),a.augment(q,a.EventTarget,!0,null,{prefix:"Uploaderhtml5"}),a.namespace("Tictac.attach").UploaderHTML5=q,a.Tictac.attach.UploaderHTML5.conf=h,a.namespace("tictac.attach").UploaderHTML5=q,a.namespace("tictac.attach.UploaderHTML5").conf=h},"1.0.0",{requires:["array-extras","event-custom","io","tictac-attach-customuploader-html5","tictac-attach-neo","tictac-attach-rollups","tictac-attach-strings","tictac-attach-utils","tictac-base-utils"]});YUI.add("tictac-attach-main",function(a){function k(){return window.getSelection?NeoConfig.isInternal||NeoConfig.farm==="f9323"||NeoConfig.expBucketId==="CMUSEHCRC1"||NeoConfig.expBucketId==="CMUSEHCRT1":!1}function l(){return k()&&(NeoConfig.farm==="f9323"||NeoConfig.partnerType==="ycorp"||NeoConfig.expBucketId==="CMUSEHCRT1")}function m(a){var c=this,d=c.getPreferredUploaderClassName(),e=function(){c.switchUploaderType.apply(c,arguments)};return c.evtHandles=[],f(b.UploaderHTML5.conf,b.Stats.makeStatConf()),f(b.UploaderForm.conf,b.Stats.makeStatConf()),f(b.Controller.conf,b.Stats.makeStatConf()),c.btnNode=a.attach,c.btnContainer=a.attachContainer,c.dropArea=a.dropArea,c.btnAttachCloud=c.configDropbox(a.dropbox),a.flickr&&(c.btnAttachFlickr=c.configFlickr(a.flickr,a.rte,a.username)),c.model=new b.model.Attachments,c.uploader=c.createUploader(d),c.controller=new b.Controller(c.uploader,c.model,e,a.composeView),c.view=new b.View(c.model,c.controller,a),c.uploader.render(a.attachContainer),c.view.render(),c.stat=b.Controller.conf.stat,c.attachMenuSelector=a.attachMenuSelector,c.btnAttachOption=c.configAttachOpt(a.attachOption),a.composeView&&c.evtHandles.push(a.composeView.on("compose:saveSuccess",function(a){a.mid&&c.model.updateMid(a.mid)})),c.configAutolink(a),c}var b=a.Tictac.attach,c=a.Tictac.base.utils,d=c.getVal,e=b.strings,f=b.Utils.configure,g,h,i=!1,j=c.log;m.prototype={configAutolink:function(a){var c=this;if(!k())return;c._rte=a.rte,c._rte.plug(b.enhancr.AutolinkPlugin),c._rte.after("isRichChange",function(a){c._rte.rte.autolink.set("linkingEnabled",a.newVal)}),c._rte.rte.autolink.set("linkingEnabled",c._rte.get("isRich")),c.evtHandles.push(a.composeView.on("renderComplete",function(){c._rte.rte.fire("renderComplete"),c.onRenderComplete()}),a.composeView.cdo.on("sending",function(){c.onMessageSent(a.composeView.cdo.get("origin"))}));if(!l())return;c._rte.rte.set("toolbarNode",a.composeView.baseNode.one(".bottomToolbar")),c._rte.plug(b.enhancr.CardPlugin),c.evtHandles.push(a.composeView.on("closeChange",function(){c._rte.rte.cards.destroySpinner()}))},onMessageSent:function(b){var c=["reply_sender","reply_all","forward"];if(!this.hadCardsInOriginal)return;if(-1===a.Array.indexOf(c,b.action))return;this.stat("enhancr_fwd_or_reply",{message:b.action})},onRenderComplete:function(){var a=this,b=this._rte.rte.frame.get("container"),c="div[class*='link-enhancr-attachment'][id*='enhancrCard_']";a.hadCardsInOriginal=!!b.one(c)},configDropbox:function(b){var e=this,f;return b&&c.hasTictacModule("tictac-dropbox")&&a.use("tictac-dropbox-controller",function(a){f=b.one("a").on("click",function(){a.Tictac.dropbox.controller.attachFrom(e.model)}),e.evtHandles.push(f),g=d(a,"Tictac.dropbox.strings"),b.one("a").set("text",g.str_share_from_db),f=a.on("compose:dropbox:chooser",function(){a.Tictac.dropbox.controller.attachFrom(e.model)}),e.evtHandles.push(f),a.fire("compose:dropbox:ready")}),b},configFlickr:function(b,e,f){var g=this,i;return b&&c.hasTictacModule("tictac-flickr-controller")&&a.use("tictac-flickr-controller",function(a){i=b.one("a").on("click",function(){a.Tictac.flickr.Controller.shareFrom(e,f)}),g.evtHandles.push(i),h=d(a,"Tictac.flickr.strings"),b.one("a").set("text",h.str_share_from_flickr)}),b},configAttachOpt:function(b){var c=this,d,f,g;return b&&(d=b.one("a").once("click",function(){g=a.one(c.attachMenuSelector),f=g.on("menuSelected",function(){c.uploader.simulateClick()}),c.evtHandles.push(f)}),c.evtHandles.push(d),b.one("a").set("text",e.str_attach_opt_menu)),b},cleanup:function(){var b=this;b.btnNode.remove(!0),b.btnContainer.remove(!0),b.uploader.cleanup(),b.controller.cleanup(),b.view.cleanup(),b.model.cleanup(),a.each(b.evtHandles,function(a){a.detach&&a.detach()})},getPreferredUploaderClassName:function(){var a=b.UploaderHTML5.isBrowserCapable();return!i&&a?"HTML5":"Form"},createUploader:function(a){return new b["Uploader"+a]({dropArea:this.dropArea,selectFilesButton:this.btnNode.cloneNode(!0)})},switchUploaderType:function(a){function f(){j("switching uploader type to "+d),c.uploader.cleanup(),c.btnContainer.all("*").each(function(a){a.remove(!0)}),d==="Form"&&(c.forceFormUploader=!0),c.uploader=c.createUploader(d),c.controller.setUploader(c.uploader),c.uploader.render(c.btnContainer),c.stat("ToggleFormActivated")}var c=this,d=c.uploader.type==="HTML5"?"Form":"HTML5";return a?b.Neo.alert(e.str_attach_form_fallback_dialog_title,e.str_attach_form_fallback_dialog_body,f):f()}},f(b.UploaderHTML5.conf,b.Neo.makeHTML5UploaderConf()),f(b.Controller.conf,b.Neo.makeControllerConf()),a.namespace("Tictac.attach").AttachmentComposer=m,a.namespace("tictac.attach").AttachmentComposer=m,a.augment(m,a.EventTarget,!0,null,{prefix:"attachmentcomposer"})},"1.0.0",{requires:["event-custom","tictac-att-filter","tictac-attach-enhancr-autolink","tictac-attach-enhancr-card","tictac-attach-neo","tictac-attach-stats","tictac-attach-model-attachments","tictac-attach-view","tictac-attach-controller","tictac-attach-uploader-form","tictac-attach-uploader-html5","tictac-attach-strings","tictac-attach-utils","tictac-base-utils","tictac-base-mailpreferences"]});YUI.add("mail-tt-attcomposer",function(C){var L,F=C.common.persist.UserData,D=F.get("userFeaturePref.attachTotalSize"),I=F.get("userFeaturePref.attachFiles");function B(){var M=NeoConfig.launch_protocol;if(NeoConfig.attachmentServer){M+=NeoConfig.attachmentServer+"/";}if(NeoConfig.isSSL&&!NeoConfig.isAttachSSL){M+=window.location.host;}else{M+=[strings.str_cfg_base_intl,".",NeoConfig.farm,".mail.yahoo.com"].join("");}M+="/ya/upload";return M;}L=B();function K(){var N={UPLOAD_URL_BASE:L,IFRAME_USE_TIMEOUTS:!NeoConfig.low_bandwidth,stopwatch:C.common.Utils.Stopwatch},M;M=parseInt(NeoConfig.formUploaderResponseTimeout,10);if(M){N.IFRAME_UPLOAD_TIMEOUT_MS=M;}M=parseInt(NeoConfig.formUploaderRedirectInterval,10);if(M){N.IFRAME_POLL_INTERVAL_MS=M;}return N;}function E(M){var N={},O=C.Object.keys(C.tictac.attach.Controller.conf);O=C.Array.hash(O);if(O.getDownloadInfo){N.getDownloadInfo=function(Q,P){M.attGetDownloadInfo(Q,P);};}if(O.download){N.download=function(Q,P){M.attDownload(Q,P);};}if(O.getMsg){N.getMsg=function(P,Q){M.attGetMsg(P,Q);};}return N;}function J(M){var O=this,N=M.currentTarget;C.fire("mt:click",{action:"cmps_attflmnu",append:{t1:"cmpsTb"}});M.preventDefault();if(!N.menu){C.use("common-ui-menu-helper","_shared_module_offscreen_bin_menus_compose_attach",function(Q){var P=Q.one("#menu-attach-options");P=Q.Node.create('<div id="menu-attach-options" class="optionMenu"></div>');Q.one("body").append(P);if(O.attachLargeBtn){P.appendChild(O.attachLargeBtn);}Q.common.ui.MenuHelper.create(N,{menu:P,blur:true,allowSimClick:true},function(){});});}}function G(O,M,N){var Q=M.node,P=Q.one("span.attach-btn-menu"),R=Q.one(".attachment-button-attach");O.push(P.on("click",J,N));R&&R.removeClass("right");P&&P.removeClass("hidden");}function H(Q,N,S,P){var R=false,M,T=(C.Tictac&&(C.Tictac.dropbox||C.Tictac.flickr)),O=(!C.UA.ie||T);M=C.after("om:compose_add_btn",function(){if(!R&&O&&N._node){N.one(".attachment-button-attach").ancestor().append(S);G(Q,{node:N},P);R=true;}});Q.push(M);if(O){N.one(".attachment-button-attach").ancestor().append(S);G(Q,{node:N},P);R=true;}}function A(Q,a,Z,b,N){var T=C.tictac.attach,Y=Z.one("span.attachment-button-attach"),X=window.strings,W=Z.one(".attach-btn-menu"),S,V,U,M,R,P,O="#menu-attach-options:last-of-type";P=C.Node.create("<li data-action='attach' id='attachOptn'><a>href='#'></a></li>");S=C.Node.create("<li id='attachCloudFile'><a href='#'></a></li>");V=C.Node.create("<li id='attachFlickrFile'><a href='#'></a></li>");U=Q.editor.getDoc();W.remove();Y.remove();Y.one("input[type=file]").remove();Z.empty();b.empty();T.Utils.configure(T.UploaderForm.conf,K());T.Utils.configure(T.UploaderHTML5.conf,{simpleRelogin:C.common.net.Error.simpleRelogin,stopwatch:C.common.Utils.Stopwatch,dropNode:U});T.Utils.configure(T.model.Attachments.conf,{MAX_BYTES:D,MAX_COUNT:I});T.Utils.configure(T.View.conf,{ERROR_TITLE:X.str_comp_attach_error,ERROR_SIZE:X.str_comp_attach_size_exceeded,ERROR_COUNT:X.str_comp_attach_num_files_exceeded,alert:function(c){C.use("common-ui-dialog-helper",function(d){d.common.ui.DialogHelper.alert(c);});}});if(T.Controller.conf){C.mix(T.Controller.conf,E(Q),true);}R={tray:b,attach:Y,attachContainer:Z,dropArea:Q.baseNode,dropbox:S,flickr:V,rte:N,username:NeoConfig.userDataObj.userSendPref.defaultFromName,attachOption:P,attachMenuSelector:O,composeView:Q};M=new T.AttachmentComposer(R);H(Q.handles,Z,W,M);delete a.oComposeData.attachments;a.attachments=M.model;return M;}C.namespace("mail.tt.attcomposer").make=A;},"1.0.0",{requires:["tictac-attach-main","common-utils-stats","rocket-stats"]});YUI.add("mail-ui-fullcompose",function(AB){var Af=AB.Lang.trim,P=AB.Node.create,l=AB.mail,M=l.Controller.Compose,AO=[],o=AB.common,AJ=o.Utils,Q=AJ.substitute,AT=AJ.escapeHtml,Ag=AB.ui.Templates,Ao=AJ.log,AI="hidden",AC="focus",Am=Ag._shared_module_compose_loading,O=[8,10,0,14,0,18,0],Aq=2000,D=7000,V=30,AR=67,Ai="offscreen",AK="restore";var AA=function(Y,Au,As,Av,Ar){var Ax=this,At;AA.superclass.constructor.apply(Ax,arguments);Ax.spellCheckView=null;Ax.scView=null;Ax.slowOriginReqTimer=null;Ax.keepHdrFocus=false;Ax.formatShortcutTimer=null;Ax.mouseFocusEvent=false;Ax.composeViewRendered=false;Ax.rteTabIndex=0;Ax.type="fullCompose";Ax.handles=[];Ax.lastSendState=null;Ax.closeSrc="closeBtn";Ax.containerNode=Ar.containerNode;Ax.hasRTEFormatter=true;Ax.flavor="compose";Ax.addAttrs({keydownHandler:{value:null},isQuickReply:{value:false},noFocus:{value:false}},Ar);if(Ar.maxHeightFn){Ax.maxHeightFn=Ar.maxHeightFn;Ax.maxHeight=Ax.maxHeightFn();}At=Ax._getEditorConfig();Ax.editor=new l.RTEView(At);Ax.addChild(Ax.editor);Ax.loadFormatters={start:function(Az,Ay){return(Ay==="start")?Q(Am.start,null,null,null,strings):"";},slow:function(Az,Ay){return(Ay==="slow")?Q(Am.slow,null,null,null,strings):"";},error:function(Az,Ay){return(Ay==="err")?Q(Am.error,null,null,null,strings):"";},populate:function(Az,Ay){return(Ay==="pop")?Q(Am.populate,null,null,null,strings):"";}};if(NeoConfig.bidi){AB.use("comms-intl-bidihighlight");}Ax.neoEvent("composeEvent",{emitFacade:true,broadcast:1});var Aw=Y.get("origin");Ax.enableSaveDraft=(Aw&&Aw.oMsg)?true:false;};function X(As){var At=this,Y,Ar;if(At.composeViewRendered){if(At.isDraft){Y="draft";}else{Ar=(At.cdo&&At.cdo.get&&At.cdo.get("origin"));Y=Ar?Ar.action:null;}Y=Y||"new";AB.Lang.later(90,null,function(){At.neoFire("composeEvent",{action:"darlaEvent",type:"compose_"+Y});});}At.attView&&At.attView.reposAttachObj(AK);At.attView&&At.attView.attachLargeBtn&&At.attView.attachLargeBtn.removeClass("hidden");if(As.cbk){As.cbk();}}function AD(Y){var Ar=this;if(!Ar.get("isQuickReply")){Ar.header.hideACWidget();}if(Ar.dirty&&Ar.dirty!=="ForceClose"&&NeoConfig.saveOnHideCompose){Ar._invokeSaveDraft({auto:true});AJ.rocketstats.stat("savemessage","switchingTab");}if(Ar.hiliteCP){Ar.hiliteCP.hide();}if(Ar.textCP){Ar.textCP.hide();}Ar.attView&&Ar.attView.reposAttachObj(Ai);Ar.attView&&Ar.attView.attachLargeBtn&&Ar.attView.attachLargeBtn.addClass("hidden");if(Y.cbk){Y.cbk();}}function R(){var At=this,As=At.baseNode,Ar=As.one(".cm-subject-field"),Y=As.one("input.cm-subject-field");Y.ancestor("div").removeClass(AC);return{subjectVal:Af(Ar.get("value")),subjectDir:(NeoConfig.bidi?Ar.getStyle("direction"):null)};}function L(){var Au=this,Y=Au.cdo,At=Y.get("origin"),Ar=Au.closeSrc,As;if(At&&At.action!==null){At=At.action;}else{At="new";}As={action:"cmps_tab_cls",append:{t1:"cmpsTb",ltxt:At,cmpsType:Au.get("isQuickReply")?"QR":"fullCmps"}};switch(Ar){case"closeBtn":break;case"escKey":As.append.actn="keybrd";break;case"cancelBtn":As.action="tlbr_cancelcompose";break;}Au.set("close",1);AB.fire("mt:click",As);}function Z(){var At=this,As=At.attView,Y=At.cdo,Ar=At.attComposer;At.blockSave=true;if(At.saveTimer){At.saveTimer.cancel();}At._clearOriginTimers();if(At.hiliteCP){At.hiliteCP.hide();}if(At.textCP){At.textCP.hide();}if(!AB.Lang.isNull(At.spellCheckView)&&!AB.Lang.isUndefined(At.spellCheckView)){At.spellCheckView.destroy();}delete At.spellCheckView;if(As){As.cleanUp&&As.cleanUp();delete At.attView;}if(Ar){Ar.cleanup();delete At.attComposer;}if(Y){AB.each(At.handles,function(Au){Au.detach&&Au.detach();});AB.each(Y.get("attachments"),function(Au){if(Au.timeout){clearTimeout(Au.timeout);Au.timeout=null;}});delete At.cdo;}At.fontFamilyOptions&&At.fontFamilyOptions.remove().destroy(true);At.fontSizeMenu&&At.fontSizeMenu.remove().destroy(true);At.fontNameMenu&&At.fontNameMenu.remove().destroy(true);At.formatButtons&&At.formatButtons.remove().destroy(true);At.rtSwitch=null;if(At.baseNode){AB.each(At.handles,function(Au){Au.detach();});delete At.handles;At.baseNode.remove().destroy(true);}At.header=null;At.formatters=null;At.container=null;AB.fire("compose:rte:blur");AA.superclass.ondestroy.call(this,arguments);}function U(){var As=this,Y,Ar=As.baseNode.one(".ac-input.focus .recipient-input input");if(Ar){As.header._lozengeIt(Ar);}Y=As.baseNode.all(".compose-header .field .hLozenge");if(Y.size()>100){AB.use("common-ui-dialog-helper",function(){o.ui.DialogHelper.alert({hd:strings.str_comp_dialogheader,bd:strings.str_comp_send_toomanyrecipients,suppressRestoreFocus:true},{ok:{handler:function(){}},cancel:{handler:function(){}}});});Ao({"m":"Too many recipients"});return;}Ao({"m":"Pass recipients' size check"});setTimeout(function(){As._invokeSend(true);},0);}function B(){var At=this,As,Y=At.cdo,Ar=At.handles;At.attachBtn=At.baseNode.one("#attachment-button-input");if(!NeoConfig.backButtonFull){AB.fire("initPage");}Ar.push(At.editor.on({keyDown:function(Av){var Au=false;if(Av.ctrlKey||Av.metaKey||Av.altKey||Av.shiftKey||Av.keyCode==27){Au=At.get("keydownHandler")?At.get("keydownHandler")(Av):At.onKeyDown(Av);}if(Au){Av.halt();}else{At._setDirty();setTimeout(function(){At.get("isQuickReply")&&At.resizeRTE();},0);}},focus:function(Au){At._registerFocus(Au.editor);At.header._removeLozengeHighlights();AB.fire("compose:rte:active",{editor:Au.editor,cv:At});},blur:function(Au){AB.fire("compose:rte:blur",{editor:Au.editor,cv:At});},drop:function(){var Au=At.attView,Av=Au&&Au.uploader;At._setDirty();if(Av&&Av.uploaderType===l.UploaderService.UPLOADER_TYPE_HTML5&&Av._ddEventHandler&&At.get("active")){}},paste:function(){At._setDirty();},ready:function(){if(At.focusNode){At.setFocus(At.focusNode);}}}));Ar.push(Y.on("compose:restoreFocus",function(){if(At.focusNode instanceof AB.Node){At._restoreFocus();}else{At.setFocus("body",0,1);}},At));Ar.push(At.baseNode.delegate("click",function(Az){var Ay=Az.currentTarget,Au=Ay.get("parentNode"),Ax=Au.hasClass("cc-btn")?"cc":"bcc",A0=Au.get("id");Az.halt(false);var Aw=A0==="btn-show-"+Ax+"-in-to"||A0==="btn-show-"+Ax+"-in-cc",Av="cmps_"+(Aw?"shw"+Ax:"hd"+Ax);
At.header._cmdBccSwitch(Aw,Ax);AB.fire("mt:click",{action:Av,append:{t1:"cmpsTb"}});At._restoreFocus();},"span.cc-btn a, span.bcc-btn a"));Ar.push(At.compArea.on("click",function(Au){if("quoted-text"===Au.target.getAttribute("data-action")){At._expandQuotedReply();}At.editor.setFocus();}));Ar.push(At.baseNode.delegate("click",function(){At._clearOriginTimers();At._displayLoading();M.fetchOrigin(Y,At.isDraft);},"a.retryOrigin"));At.on("renderComplete",function(){At.contentLoaded=true;AB.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base-conv",function(){});});At._addFocusListenersFresh();Ar.push(At.baseNode.on("keydown",function(Aw){var Av,Au=Aw.target;if(Aw.keyCode===13){if(Au.ancestor("div.rte-well-container")){Aw.halt();At.focusNode=Au;Av=Au.one("b");Av&&Av.simulate("click");}}}));Ar.push(At.baseNode.delegate("click",function(Av){var Au=AJ.getDataAction(Av).action;At.handleComposeAction(Au,Av);},".bottomToolbar > span"));As=At.attachBtn;if(As){Ar.push(As.on({focus:function(){As.ancestor("span").addClass("focused");},blur:function(){As.ancestor("span").removeClass("focused");},click:function(){if(At.attView&&At.attView.uploader&&At.attView.uploader.uploaderType===l.UploaderService.UPLOADER_TYPE_YUI&&!At.attView.formUploader){At.attView.switchToFormUploader({skipDefault:true});}}}));}Ar.push(At.on("compose:dirty",function(){if(!At.enableSaveDraft){At.enableSaveDraft=true;At._showDraftBtn();}}));Ar.push(AB.on("windowresize",function(){At.resizeRTE();}));At._showSendBtn(false);}function F(Y){if(Y){this.neoFire("composeEvent",{action:"showSendBtn"});}else{this.neoFire("composeEvent",{action:"hideSendBtn"});}}function N(){if(this.enableSaveDraft){this.neoFire("composeEvent",{action:"showDraftBtn"});}else{this.neoFire("composeEvent",{action:"hideDraftBtn"});}}function t(){var At=this,As=At.rteFormatter,Ar=At.handles,Y=At.cdo;As.bindUI();Ar.push(As.on("formatter:action",function(Au){At._setDirty();At._setComposePreference(Au.act,Au.val);}));Ar.push(Y.after("isRichTextChange",function(Au){At.editor.set("isRich",!NeoConfig.low_bandwidth&&Au.newVal);At.rteFormatter&&At.rteFormatter._switchEditMode(Au.newVal);}));At._intlBindUIRTE();}function Al(){var Au=this,As,Ar,Y,At;As=Au.rteFormatter=new AB.mail.ui.RTEFormatter({isBidi:NeoConfig.bidi,isSpellCheckEnabled:strings.str_tog_spellcheckEnabled,editor:Au.editor,globalPathImage:Au.formatters.global_path_img()});As.renderUI(Au.baseNode.one(".rte-well-container"));As._switchEditMode(Au._isRTEActive());Au._bindWellUIFresh();Ar=Au.richFontInfo.fontFamily;Y=Au.richFontInfo.fontSize;if(Y){At=parseInt(Y.replace("pt",""),10);At=AB.Array.indexOf(O,At);if(At>=0){As.selectedFSIndex=At+1;}}As.selectedFNIndex=Ar;Au._initializeSpellCheck();Au._bindTextSwitchFresh(Au.handles);}function AY(Y){var At=this,Ar=At.cdo.oComposeData.origin,As=At.dirty;At.baseNode.one(".rte-well-container").ancestor("tr").setStyle("float","none");At.baseNode.one(".rte-well-container").ancestor("tr").setStyle("height","auto");if(Ar.action==="forward"){At._expandQuotedReply();At.setFocus("to");}else{if(Y){At.setFocus(Y);}else{At.setFocus("body");}}At.neoFire("composeEvent",{action:"switchToFullCompose"});if(!As){At.dirty=false;}AB.Lang.later(90,null,function(){At.neoFire("composeEvent",{action:"darlaEvent",type:"compose_"+Ar.action});});AB.fire("FullCompose:fullComposeReady",{rte:At.editor,rteActive:At._isRTEActive()});}function a(){var Aw=this,As,Ar,Au=Aw.getRTEDocNode(),Av=Aw.compArea.one(".compose-quoted-text"),Y=Au.one(".yahoo_quoted"),At;Y&&Y.setStyle("display","block");As=Aw.cdo.get("yqtdPrefix");if(As){for(Ar=0;Ar<As.length;Ar++){At=Aw.getRTEDocNode().one("."+As[Ar]+"yahoo_quoted");At&&At.setStyle("display","block");}}Av&&Av.remove();Aw.resizeRTE();}function AQ(){var Y=this;if(Y.hasRTEFormatter){Y.initializeRTEFormatter();}}function AP(){var Ar=this,Y;if(NeoConfig.useAttComposerTT){Y=Ar.cdo.attachments.count();}if(Y!==0){Ar.baseNode.one("div.attachments-well").removeClass(AI);}else{Ar.baseNode.one("div.attachments-well").addClass(AI);}}function w(As){var Au=this,Ar,At;if(As){Au.parent=As;Ar=Q(Ag._shared_module_compose_fresh_conv.base,Au.cdo,Au.formatters,null,strings,Ag);As.append(Ar);Au.baseNode=As.one(".compose");if(!Au.get("isQuickReply")){Au.baseNode.addClass("full-compose");Au.baseNode.addClass("content");}Au.compArea=Au.baseNode.one("div.compose-message").one("div.inner");Au.loadingArea=Au.compArea.one("div.msg-loadingpane");Au.footer=Au.baseNode.one(".footer-separator");var Y=M.getDefaultFontInfo(!Au._isRTEActive());Au.richFontInfo.fontFamily=Y.fontFamily;Au.richFontInfo.fontSize=Y.fontSize;At=Au.baseNode.one("div.cm-plaintext");if(At){At.get("parentNode").removeChild(At);}if(AB.UA.gecko){Au.compArea.ancestor("td").setStyle("height","0");}Au.header.enableHeader(false);Au._renderWellsFresh();Au.bindUI();Au.header.render();Au.header.bind();Au.composeViewRendered=true;}}function AM(){var Ar=this,Y=Ar.footer.getY();Ar.footer.setStyles({"position":"fixed","top":Y+"px"});}function AF(){if(NeoConfig.tabs&&!NeoConfig.hasConvView){AB.later(300,this,this.doResizeRTE);}else{this.doResizeRTE();}}function AN(){var Aw=this,Av,Au,Ax=0,Ar,At,Y=Aw.baseNode.one("div.attachments-well");Ax=Y?Y.getStyle("height"):0;Ax=Ax==="auto"?0:parseInt(Ax,10);Au=AB.one("body").get("offsetHeight");if(!Aw.get("isQuickReply")){Av=parseInt(Aw.compArea.getY(),10);Au=AB.one("body").get("offsetHeight");Ar=(Au-Av-AR-10);var Ay=Ar-0.2*Au;if(Ay>300){Ay=300;}Aw.compArea.setStyles({"maxHeight":Ar+"px","minHeight":Ay+"px"});At=(Ay-Ax)>0?(Ay-Ax):0;Aw.editor.rteArea.setStyles({"minHeight":At+"px"});}else{if(!NeoConfig.smartscroll){if(parseInt(Aw.baseNode.getStyle("height"),10)>Aw.maxHeight){Aw.compArea.setStyles({"maxHeight":Aw.maxHeight-parseInt(Aw.header.hdr.getStyle("height"),10)-AR+"px"});}var As=Aw.baseNode.get("parentNode").get("offsetTop")-Aw.containerNode.get("scrollTop")+parseInt(Aw.baseNode.getStyle("height"),10)+6-Aw.containerNode.get("offsetHeight");if(As>0){Aw.containerNode.set("scrollTop",Aw.containerNode.get("scrollTop")+As);
}}}}function AW(){var As=this,Ar=As.handles;function Y(Au){var A0=Au.params,Av,Ay,At,Aw,Ax={format:1};if(!Ax.hasOwnProperty(A0.tab)){return;}if(!As.baseNode){return;}A0.tooltip=A0.tooltip||"";if(A0.tab!=="format"){return;}Ay=A0.name||"Stationery";At="<span class='btn menu' data-app='"+Au.appInstance+"'>"+"<a class='s-tp icon "+Ay+"' href='#' title='"+A0.tooltip+"'>"+"<i role='presentation' class='plaintext'>"+A0.label+"</i></a></span>";Aw=P(At);try{As.baseNode.one("."+A0.tab+"-pane").one(".om-buttons").append(Aw);}catch(Az){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailcompose-message-composeview:1",Az,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailcompose-message-composeview:1");}Av=AB.stamp(Aw);Ar.push(Aw.on("click",function(A1){A1.preventDefault();Au.handler(Av,As);}));Ar.push(AB.on("om:click_btn",function(A1){if(!A1.app||!A1.app.instance||!A1.tab){return;}if(Au.appInstance===A1.app.instance){Au.handler(Av,As);}}));}AB.each(AO,Y);Ar.push(AB.on("om:compose_add_btn",function(){Y(AO[AO.length-1]);}));}function I(Av,Au,At){var Aw=this,Ar=Aw.handles,As=P("<ul class='om-buttons'></ul>"),Y=Aw.baseNode.one("div.rte-well-container");if(AB.UA.ie===0){As.appendChild(Av);Y.addClass("largefiles");}if(AB.Tictac&&AB.Tictac.flickr){As.appendChild(At);Ar.push(At.on("click",function(Ax){AB.fire("mt:click",{action:"cmps_attflk",append:{t1:"cmpsTb"}});Ax.preventDefault();}));Y.addClass("largefiles");}if(AB.Tictac&&AB.Tictac.dropbox){As.appendChild(Au);Ar.push(Au.on("click",function(Ax){AB.fire("mt:click",{action:"cmps_attlgfl",append:{t1:"cmpsTb"}});Ax.preventDefault();}));Y.addClass("largefiles");}if(Aw.attView){Aw.attView.attachLargeBtn=As;}if(Aw.attComposer){Aw.attComposer.attachLargeBtn=As;}Ar.push(AB.on("om:click_btn",function(Ax){if(!Ax.app||!Ax.app.instance||!Ax.tab){return;}}));}function AZ(){var Av=this,Ay,Y,At,A3,Aw,Ax,A1=Av.cdo,A0,A2,As;Av.editor.render(Av.baseNode);if(NeoConfig.useAttComposerTT){A0=Av.baseNode.one("input[type=file]").ancestor("div");A2=Av.baseNode.one("div.attachments-well");As=Av.baseNode.one("div.cm-rtetext");Av.attComposer=AB.mail.tt.attcomposer.make(Av,Av.cdo,A0,A2,Av.editor);if(Av.onAttachmentsReady){Av.onAttachmentsReady(Av.cdo);}}Av._bindCDO();if(Av._isOrigin()){Av.slowOriginReqTimer=setTimeout(function(){Av._handleSlowOriginRequest();},D);Av.loadingTimer=setTimeout(function(){Av._displayLoading();},Aq);Av.editor.hideArea();if(Av.cdo&&Av.cdo.get("passive")){var Az=Av.cdo.get("content");Av.contentChangeAfter(Az);Av.replyheaderChangeAfter();Av.replyContentChangeAfter(Az);if(Av.cdo.get("attachments")){for(var Ar=0,Au=A1.oComposeData.attachments.length;Ar<Au;Ar++){Av.attView.addNewAttachment(Ar);}}}else{M.fetchOrigin(A1,Av.isDraft,Av.stopwatch,function(){if(Av.isDraft&&A1&&A1.oComposeData&&A1.oComposeData.origin&&A1.oComposeData.origin.oMsg){Av.draftMID=A1.oComposeData.origin.oMsg.mid;}});}if(Av.isDraft){Av.hasHardDraft=true;Av.draftMID=A1.oComposeData.origin.oMsg.mid;}else{Aw=A1.get("origin");AB.Lang.later(90,null,function(){Av.neoFire("composeEvent",{action:"darlaEvent",type:"compose_"+Aw.action});});}Y=A1.oComposeData.origin.oMsg;At=Y&&Y.header&&Y.header.to;A3=Av.baseNode.all("#from-field option");AB.Array.some(At||[],function(A4){A3.each(function(A6,A5){var A7=A6.get("value").replace(/.+\<(.+)\>/,"$1");if(A4.email===A7){AB.later(100,Av,function(){A6.get("parentNode").set("selectedIndex",A5);});return true;}});});Ax=Y.header?Y.header.from:Y.from;if(Ax&&Av.isDraft){AB.later(10,Av,function(){Av.header._setFromMenu(Ax);});}}else{Ay=A1.get("header");Av.header.setHeader(Ay);Av._allowEditing(A1.get("content"));Av.dirty=A1.get("prePopulated");Av.setFocus((Ay.to&&Ay.to.length>0)?"body":"to");Av.neoFire("composeEvent",{action:"darlaEvent",type:"compose_new"});}if(A1.get("passive")){Av.dirty=1;}if(Av.attComposer){Av.addAttachMenuItems(Av.attComposer.btnAttachOption,Av.attComposer.btnAttachCloud,Av.attComposer.btnAttachFlickr);}Av._initOpenMailButtons();AB.fire("FullCompose:fullComposeReady",{rte:Av.editor,rteActive:Av._isRTEActive()});AB.fire("read-stat:draftRendered");if(!NeoConfig.smartscroll&&Av.get("isQuickReply")){Av.compArea.setStyles({"minHeight":"150px","maxHeight":(Av.maxHeight-parseInt(Av.header.hdr.getStyle("height"),10)-AR-6)+"px"});}Av.resizeRTE();}function i(){var Aw=this,Au=Aw.handles,At=Aw.baseNode.one("div.rte-well-container"),Av=[".attachments-pane","#btn-fontname","#btn-fontsize","span.bold","span.italic","span.underline","#btn-forecolor","#btn-backcolor","#btn-insertunordered","#btn-insertnumbered","#btn-outdent","#btn-indent","span.align-l","span.align-c","span.align-r","#links","#emoticon","span.Stationery","#spellCheck","#btn-spell-langs","#switchtext-plain","#switchtext-rich"];function Y(){var Ax;if(Av[Aw.rteTabIndex]==="#switchtext-plain"||Av[Aw.rteTabIndex]==="#switchtext-rich"){return At.one(Av[Aw.rteTabIndex]);}if(!Aw._isRTEActive()&&Av[Aw.rteTabIndex]==="#attach-btn-menu a"){Aw.rteTabIndex=Av.length-1;return At.one(Av[Aw.rteTabIndex]);}do{Ax=At.one(Av[++Aw.rteTabIndex]);}while(!Ax||Ax.ancestor().hasClass(AI)||Ax.ancestor().getStyle("display")==="none");return Ax;}function As(){var Ax;if(Aw.rteTabIndex===0){return At.one(Av[Aw.rteTabIndex]);}if(!Aw._isRTEActive()&&Av[Aw.rteTabIndex]==="#switchtext-plain"){Aw.rteTabIndex=1;return At.one(Av[Aw.rteTabIndex]);}do{Ax=At.one(Av[--Aw.rteTabIndex]);}while(!Ax||Ax.ancestor().hasClass(AI)||Ax.ancestor().getStyle("display")==="none");return Ax;}function Ar(A0){var Ay,Ax,Az=Aw.baseNode.one(".attachments-pane");switch(A0.keyCode){case 9:if(!A0.shiftKey){Ay=Aw.baseNode.one(".attachments-well");if(Ay&&!Ay.hasClass(AI)){Ax=Ay.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!Ax){Ax=Ay.one("li.attachmentVisible span.left a");Ax&&Ax.set("tabIndex","0");}}else{A0.target.blur();Aw.setFocus("body");A0.halt();}}break;case 13:case 32:if(A0.target!==Az){A0.target._node.click();}else{A0.target.one("input")&&A0.target.one("input")._node.click();
}break;case 37:A0.target&&A0.target.set("tabIndex","-1");Ax=As();Ax&&Ax.set("tabIndex","0");Ax.focus();break;case 39:A0.target&&A0.target.set("tabIndex","-1");Ax=Y();Ax&&Ax.set("tabIndex","0");Ax.focus();break;default:}}Au.push(At.delegate("keydown",Ar,'div.attachments-pane, span[role="button"]'));}function b(Aw){var Ax=this,Av=Aw.keyCode,As=(Aw.ctrlKey||Aw.metaKey)&&(!Aw.altKey&&!Aw.shiftKey),At=AB.UA.os,Ar=(Aw.ctrlKey&&(At==="windows"||At==="win"))||(Aw.metaKey&&(At==="macintosh"||At==="mac")),Au;switch(Av){case 85:if((Ar&&Aw.shiftKey)&&!AB.UA.ie&&(!AB.UA.gecko||AB.UA.gecko>1.92)){Au=Ax.baseNode.one(".attachments-pane input");Au._node.click();Aw.halt();}break;case 13:if(Ar&&!Aw.altKey){var Y={spid:"sent",append:{t1:"cmpsTb",actn:"keybrd",cmpsType:Ax.get("isQuickReply")?"QR":"fullCmps"},action:"tlbr_send"};if(Ax.lastSendState){Y.append.ltxt=Ax.lastSendState;}AB.fire("mt:click",Y);Ax._handleSendAction();if(Aw.frameEvent){Aw.frameEvent.halt();}Aw.halt();return true;}else{if(Aw.target.get("nodeName")==="A"){Aw.target.simulate("click");return true;}}break;case 65:if(As){Ax._expandQuotedReply();}break;case 83:if(As){Ax._invokeSaveDraft();if(Aw.frameEvent){Aw.frameEvent.halt();}Aw.halt();return true;}break;case 89:if((Aw.ctrlKey||Aw.metaKey)&&Aw.shiftKey){Aw.halt();if(Ax.allowEdit){Ax._cmdTextSwitch();}return true;}break;case 219:case 221:AB.fire("tabview:handleKeyDown",Aw);break;default:break;}if(Aw.frameEvent){Aw.frameEvent.stopPropagation();if(Aw.shiftKey){if(Av===9){}}}if(As){return true;}return false;}function C(At){var Au=this,Ar=Au.baseNode.one("div.rte-well-container"),Y,As=Ar.one(".attachments-well");Au.rteTabIndex=0;if(As&&!As.hasClass(AI)){As.all("li.attachmentVisible span.left a").each(function(Av){if(!Y&&Av.get("tabIndex")=="0"){Y=Av;}});if(!Y){Y=As.one("li.attachmentVisible span.left a");Y&&Y.set("tabIndex","0");}}else{Y=Ar.one(".attachments-pane");Y&&Y.set("tabIndex","0");}Y&&Au.setFocus(Y);At.frameEvent.halt();}function d(Ar){var Y=AB.Node.getDOMNode(Ar);if(Y!==null){return(Y.tagName.toUpperCase()==="DIV");}return false;}function y(){var As=this,Y=As.cdo,Ar;if(!As.handles){As.handles=[];}Ar=As.handles;Ar.push(Y.after("contentChange",function(At){As.contentChangeAfter(At);}));Ar.push(Y.after("replyheaderChange",function(){As.replyheaderChangeAfter();}));Ar.push(Y.after("replycontentChange",function(At){As.replyContentChangeAfter(At);}));Ar.push(Y.after("originerrorChange",function(Au){As._clearOriginTimers();var At=Au.newVal;if(At.code!=o.net.Error.abort){As._writeLoadingHtml("err");}}));if(NeoConfig.useAttComposerTT){As._bindAttachmentsTT();}}function AE(){var As=this,Y=As.cdo,Ar=As.handles;Ar.push(Y.on("CDO_ATTACHMENT_ADDED",function(Av,Au,At){As._setDirty();if(!At){As.attachmentsLoading[Au]=1;}As.resizeRTE();}));Ar.push(Y.on("CDO_ATTACHMENT_DELETED",function(Au,At){As._setDirty();As.attachmentsLoading[At]=0;if(AB.UA.os==="macintosh"&&AB.UA.chrome>=11){As.setFocus("body",0,1);}else{As._restoreFocus();}As.resizeRTE();}));Ar.push(Y.on("CDO_ATTACHMENT_PROCESSED",function(Au,At){As._setDirty();As.attachmentsLoading[At]=0;As.resizeRTE();}));Ar.push(Y.on("CDO_ATTACHMENT_FILES_SELECTED",function(){var At=As.attachBtn;if(At){At.blur();}if(AB.UA.os==="macintosh"&&AB.UA.chrome>=11){As.setFocus("body",0,1);}else{As._restoreFocus();}As.resizeRTE();}));}function AX(){var As=this,Ar=As.cdo.attachments,Y=As.handles;Y.push(Ar.on("added",function(){As._setDirty();As.resizeRTE();}));Y.push(Ar.on("deleted",function(){As._setDirty();setTimeout(function(){As.resizeRTE();},50);}));Y.push(Ar.on("updated",function(At){As.resizeRTE();if(!At.isUploadDone()){return;}As._setDirty();}));}function x(Y){var Ar=this;if(!Y.uiUpdate){Y.newVal?Ar.editor.setContent(Y.newVal,!Y.textConvert||AB.UA.gecko):Ar.editor.setContent(Ar.cdo.get("content"));}}function Ak(){var Au=this,Ar=Au.cdo,At=Ar.get("header"),Y,As;As=Ar.get("origin");Au.header.setHeader(At);Y=At.subject;Au.neoFire("composeEvent",{action:"replyheaderLoad",subject:Y});}function h(Y){var As=this,Ar=As.cdo.get("header");As._allowEditing(Y.newVal,(Ar.cc&&Ar.cc.length>0)?Ar.cc:"");As.header.enableSwitchReplyButton();As.dirty=false;if(!As.get("noFocus")){As.setFocus((Ar.to&&Ar.to.length>0)?"body":"to");}}function q(Y){var Ar=this;if(!Ar.rtSwitch){Ar.rtSwitch=Ar.baseNode.all("span.switchtext");}Y.push(Ar.rtSwitch.each(function(As){As.on("click",function(At){AB.fire("mt:click",{action:"cmps_stchpt",append:{t1:"cmpsTb",ltxt:(Ar._isRTEActive()?"plaintext":"richtext")}});At.halt(false);if(Ar.allowEdit){Ar._cmdTextSwitch();}});}));}function Ad(){var At=this,As;function Y(){At.editor.fire("beforeModeSwitch");At.cdo.updateData({content:At.getContent()});At._setDirty();}function Ar(){Y();At._expandQuotedReply();M.toPlainText(At.cdo,At.editor.getContentAsPlainText());At.resizeRTE();At.setFocus("body");At.editor.fire("afterModeSwitch");}if(At._isRTEActive()){if(At.editor.hasContent()){As=true;At.confirm(strings.str_rte_plaintext,strings.str_comp_conf_plainText,Ar);}else{Ar();}}else{Y();M.toRichText(At.cdo);At.editor.fire("afterModeSwitch");}!As&&At.setFocus("body");}function Aj(){return !NeoConfig.low_bandwidth&&this.cdo.get("isRichText");}function An(){return(this.spellCheckView&&this._isRTEActive());}function J(Y){return this.baseNode.one(".cm-"+Y+" ul li");}function A(){return this.editor.getContent();}function u(){return this.editor.getRTE();}function Aa(Au,At,Y){var Aw=this,As=true,Av,Ar=Aw.editor.getRTE();if((typeof Au==="string")){Av=Aw.baseNode.one(".compose-header");switch(Au){case"to":case"cc":case"bcc":case"subject":Av=Aw.baseNode.one(".compose-header");Au=Av.one(".cm-"+Au+"-field");break;case"body":Au=Ar;As=(Y&&AB.UA.os==="macintosh"&&AB.UA.chrome>=11)?0:Aw.editor.get("ready");break;}}if(As){if(Au===Ar){Aw.editor.setFocus(At);}else{Au&&Au.focus();}}Au&&Aw._registerFocus(Au);}function AS(Au,At){var Aw=this,Ar,Y,As,Av;At=At||"";Aw._clearOriginTimers();Aw.header.enableHeader(true);Aw.editor.showArea();Aw.loadingArea.addClass(AI);Aw._activateWellFresh();if(Au){if(Aw.get("isQuickReply")&&Aw.cdo.oComposeData&&Aw.cdo.oComposeData.origin.action!=="forward"){if(!Aw.isDraft){Av=(AB.UA.ie===9)?"&nbsp;":AB.Selection.CURSOR;
Au="<p>"+Av+"</p>"+Au;}Aw.editor.setContent(Au,false);if(Aw.isDraft){Ar=Aw.cdo.get("yqtdPrefix");Aw.baseNode.one(".compose-quoted-text")&&Aw.baseNode.one(".compose-quoted-text").setStyle("display","none");for(Y=0;Y<Ar.length;Y++){As=Aw.getRTEDocNode().one("."+Ar[Y]+"yahoo_quoted");if(As){As.setStyle("display","none");}}if(As){Aw.baseNode.one(".compose-quoted-text")&&Aw.baseNode.one(".compose-quoted-text").setStyle("display","block");}}Aw.getRTEDocNode().one(".yahoo_quoted")&&Aw.getRTEDocNode().one(".yahoo_quoted").setStyle("display","none");}else{Aw.editor.setContent(Au,!Aw.isDraft);}}Aw.header.allowEditing(Au,At);Aw.allowEdit=true;Aw.fire("renderComplete");}function c(Y,As){var Ar=null;switch(Y){case"fontname":Ar="userUIPref.composeFontFamily";As=As+"|1";break;case"fontsize":Ar="userUIPref.composeFontSize";As=parseInt(As,10);As=O[--As];break;default:break;}if(Ar&&As){M.savePref(Ar,As);}}function p(){var At=this,As,Ar,Y=At.handles;if(!At._formatPane){At._formatPane=At.baseNode.one(".format-pane");}As=At._formatPane.one('[data-action="spellcheck"]');Ar=As.next();Y.push(As.on("click",function(Au){At._doSpellCheck();Au.preventDefault();}));Y.push(Ar.on("click",function(Au){At._openSpellCheckMenu(Au);Au.preventDefault();}));}function AV(Y){var Ar=this;Ar.closeSrc="cancelBtn";if(Y){Ar.dirty="ForceClose";}if(Ar.canClose()){Ar.neoFire("composeEvent",{action:"closeAction"});}}function T(Ar){var Ax=true,Av={},Y="",At=this;switch(Ar){case"send":Av.spid="sent";if(At.lastSendState){Y=At.lastSendState;}At._handleSendAction();break;case"savedraft":At.blockSave=true;At._invokeSaveDraft();break;case"cancelcompose":Ax=false;At.cancelCompose();break;case"insertsignature":var Ay=At.cdo.get("isRichText"),Au,As,Aw=M.getSignature(At.header.getHeader().from.email);if(Aw){Au=At.assembleSendBody();As=Au.html;As=M.injectSignature(As,Ay,Aw);At.cdo.set("content",As,{textConvert:true});}break;}if(Ax){Av.append={t1:"cmpsTb",cmpsType:At.get("isQuickReply")?"QR":"fullCmps"};Av.action="tlbr_"+Ar;if(Y){Av.append.ltxt=Y;}AB.fire("mt:click",Av);}}function H(Au,BF,A9){var A7=this,A8=A7.header.getHeader(),A0=true,Ax=false,Av=0,BH=(NeoConfig.useAttComposerTT)?A7.cdo.attachments:A7.cdo.get("attachments"),As,Y,BG,BE,A1,BB,A3=true,Ay,A5=A7.getRTEDocNode(),A6,Az,BD=false,At;A9=A9||0;if(A7.isSending){Ao({"m":"another mail is being sent..."});return;}At=function(BI){A7.allowSend=true;if(!BI){A7.setFocus("body",0,1);}else{A7._restoreFocus();}};if(A7.allowSend){if(A7.baseNode.one(".file-attach .downloading:not(.hidden)")||(NeoConfig.useAttComposerTT&&A7.cdo.attachments.areAnyUploading&&A7.cdo.attachments.areAnyUploading())){AB.use("common-ui-dialog-helper",function(){Ao({"m":"attachment uploading..."});A7.allowSend=false;o.ui.DialogHelper.alert({hd:strings.str_comp_dialogheader,bd:strings.str_comp_still_uploading,suppressRestoreFocus:true},{ok:{handler:At},cancel:{handler:At}});});A7.lastSendState="attInPrgrss";return;}}else{return;}if(A7.attView&&A7.attView.checkOverLimit()){A7.lastSendState="attOvrLmt";Ao({"m":"Failure: attachment oversize"});return;}if(NeoConfig.useAttComposerTT){A0=A7.cdo.attachments.areSendable();Ax=A7.cdo.attachments.areAnyInfected();}if(!A0){A7._alertInvalidAttachments(Ax);A7.lastSendState="attInvld";Ao({"m":"Failure: attachment not valid"});return;}if(typeof A7.cdo.attachments==="object"&&!(A7.cdo.attachments.count())&&NeoConfig.attachAlert){var BC=M.attachAlert(A7.getContent(),A7.cdo.get("content"));if(BC){A7.allowSend=false;var BA=strings.str_modal_send_msg_title,A4="You mentioned '"+BC+"' in your mail but there are no attachments! Send anyway?",Aw=strings.str_comp_send;A7.confirm(BA,A4,function(){Ar();},function(){At();},Aw);}}if(!A8.validAddress){var A2=strings.str_comp_invalidAddressA+"<br><br>"+AT(A8.currentAddress)+"<br><br>";A2+=Q(strings.str_comp_invalidAddressB,null,null,null,strings);A7._alertProblem(strings.str_comp_title_invalidAddr,A2);A7.lastSendState="addInvld";Ao({"m":"Failure: invalid recipient email address"});return;}if(A8.to.length<1&&A8.cc.length<1&&A8.bcc.length<1){A7._alertProblem(strings.str_comp_title_emptyToField,strings.str_comp_emptyToField);A7._registerFocus(AB.one("#to-field"));A7.lastSendState="addEmpty";Ao({"m":"Failure: recipient email address empty"});return;}if(A7.isSaving&&(A9<V)){AJ.rocketstats.stat("send","save_inprogress:"+A9);A7.container.showComposeShim(true);Ao({"m":"set up send retry while save is in progress"});AB.later(1000,A7,H,[Au,BF,A9+1]);return;}else{if(A7.isSaving&&(A9>=V)){AB.common.Utils.rocketstats.stat("MailCompose","SaveTimedOutInSend");BD=true;}}A6=A5.all("a");A6.each(function(BJ){var BI;try{BI=BJ.get("href");}catch(BK){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailcompose-message-composeview:2",BK,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailcompose-message-composeview:2");BI="";}if(typeof(BI)==="string"){BI=BI.replace(/&amp;/g,"&");BJ.set("href",BI);}});AB.fire("SentStart");Ay=new AJ.Stopwatch("SendConfirm","start");As=A7.assembleSendBody();var Ar=function(){var BL=A7.baseNode.one(".attachment-button-attach"),BJ=A7.cdo.get("origin"),BK,BO,BN={cmpsType:A7.get("isQuickReply")?"QR":"fullCmps",count:A8.to.length+A8.cc.length+A8.bcc.length},BI={header:A8,content:As.html,textcontent:As.text},BM={draftMID:A7.draftMID,noScroll:Au,cid:BJ.oMsg&&BJ.oMsg.cid};A7.isSending=true;A7._cancelSaveTimer();A7.dirty=false;if(BL){BL.fire("compose:close");}Ao({"m":"Start Sending......","subject":BI.header.subj});A7.cdo.updateData(BI);A7.cdo.fire("sending");BO=A7.cdo.get("saveaction");BK=(BO&&BO.isMailboxBusy)||false;A7.container.invokeSend(A7.cdo,BM,Ay,{isSaveTimedOut:BD,isMailboxBusy:BK});AB.fire("mt:click",{action:"msg_send",append:BN});};BG=Af(A8.subj);BE=Af(As.text);if(A7.getRTEDocNode().one("img")){A3=false;}if(BG.length<1&&BE.length<1&&A3){A1=strings.str_modal_send_msg_title;BB=strings.str_comp_invalidSubjectAndContent;Az=strings.str_comp_send;A7.lastSendState="sbCntInvld";
Ao({"m":"Warning: both subject and content are empty"});}if(A7.allowSend){if(BB){A7.allowSend=false;A7.confirm(A1,BB,function(){Ar();},function(){At(AB.one("#subject-field"));},Az);}else{Ar();}}}function S(Y){var At=this,Ar,As=At.baseNode.one(".attachment-button-attach");if(Y){Ar=At.cdo.after("saveactionChange",function(Au){if(Au&&Au.newVal&&Au.newVal.state===1){return;}Ar.detach();At.neoFire("composeEvent",{action:"closeAction",forceClose:true});As.fire("compose:close");});}else{As.fire("compose:close");At.neoFire("composeEvent",{action:"closeAction",forceClose:true});}}function E(){}function AH(Y){var Aw=this,As,Au,Ar=Aw.getRTEDocNode(),At=Ar,Ay,Ax,Av;Ay=Y?Aw.editor.getContentOnSave():Aw.editor.getContent();As=Aw.cdo.get("yqtdPrefix");if((Ar.one(".yahoo_quoted")&&Ar.one(".yahoo_quoted").getStyle("display")!=="block")||As){At=AB.Node.create("<div>"+Ay+"</div>");Ax=At.one(".yahoo_quoted");Ax&&Ax.setStyle("display","block");if(As){for(Au=0;Au<As.length;Au++){Av=At.one("."+As[Au]+"yahoo_quoted");Av&&Av.setStyle("display","block");}}Ay=At.get("innerHTML");}if(Aw._isSpellCheckActive()){l.Controller.SpellCheck.removeAllMarkers(Ar,null);}return M.assembleSendBody(At,Aw.editor.richFontInfo,Ay);}function k(){var Y=this;if(Y._isSpellCheckActive()){return;}if(Y.spellCheckView===null){if(strings.str_tog_spellcheckEnabled){Y.spellCheckView=new l.ui.SpellCheckView(Y,Y.cdo);Y.spellCheckView.bindCDO();}else{Y.spellCheckView=0;}}}function j(){var Y=this;AB.use("mail-ui-composeview-spellcheck",function(){Y._activateSpellCheck();if(Y._isSpellCheckActive()){Y.spellCheckView.doSpellCheck();Y.setFocus("body");Y.neoFire("composeEvent",{action:"darlaEvent",type:"spell_chk"});}});}function s(Y){var Ar=this;AB.use("mail-ui-composeview-spellcheck",function(){Ar._activateSpellCheck();if(Ar._isSpellCheckActive()){Ar.spellCheckView.showLangMenu(Y);}});}function r(){return this.editor.getRTE().getInstance();}function Ac(){return this.editor.getDoc();}function G(Y){var At=this,As,Ar=l.model.DataStore.Messages.getPermMidPart;if(Y.flavor!==At.flavor){return false;}if(Y&&Y.oMsg&&At.draftMID){return Ar(At.draftMID)===Ar(Y.oMsg.mid);}if(!At._isOrigin()){if(!Y||!Y.oMsg){return true;}}if(Y&&Y.oMsg){As=At.cdo.get("origin");return(Y.action===As.action&&Y.fid===As.fid&&Y.oMsg.mid===As.oMsg.mid&&Y.forwardAsAttachment===As.forwardAsAttachment);}return false;}function Ab(){var Ar=this,Y;Y=Ar.cdo.get("origin");return(Y.action&&Y.fid&&Y.oMsg);}function AL(){var Ar=this,Y;Y=Ar.cdo.get("origin");Ar._clearOriginTimers();Ar._writeLoadingHtml(Y.errInfo==="ok"?"pop":"slow");}function m(){var Y=this;Y._writeLoadingHtml("start");}function f(Ar,Y){this.editor.setContent(Ar,Y);}function Ap(Ar){var Y=this;if(Y.loadingArea.hasChildNodes()){Y.loadingArea.get("children").remove().destroy(true);}Y.loadingArea.appendChild(P(Q(Am.base,null,Y.loadFormatters,Ar,strings,Ag)));}function AU(){var Y=this;Y.slowOriginReqTimer&&clearTimeout(Y.slowOriginReqTimer);Y.loadingTimer&&clearTimeout(Y.loadingTimer);}function W(Y){var Au=this,As,At,Ar=Au.baseNode.one(".save-draft-msg");As=function(){if(Y){return strings.str_comp_saving_draft;}if(Au.lastSaveType===-1){return Q(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:Au.lastSave});}else{if(Au.lastSave){if(Au.lastSaveType===1){return Q(strings.str_comp_autosave,0,0,0,{autosave_time:Au.lastSave});}else{return Q(strings.str_comp_saved,0,0,0,{saved_time:Au.lastSave});}}}return"";};At=As();Ar.removeClass("hidden");Ar.set("innerHTML",At);if(NeoConfig.expBucketId==="CMUSCVTM08"){this.neoFire("composeEvent",{action:"setSaveNotification",statusText:At});}}function v(Y){var At=this,As,Ar;if(At.allowSend){AB.use("common-ui-dialog-helper",function(){At.allowSend=false;As={hd:Y?strings.str_rte_attachments_alert_virus_title:strings.str_comp_dialogtitle_invalidSendAttachments,bd:Y?strings.str_rte_attachments_alert_virus:strings.str_comp_dialogbody_invalidSendAttachments,suppressRestoreFocus:true};Ar=function(){At.allowSend=true;At._restoreFocus();};o.ui.DialogHelper.alert(As,{ok:{handler:Ar},cancel:{handler:Ar}});});}else{At._restoreFocus();}}function n(Y,As){var Ar=this;As=As||!Ar.draftMID;if(Ar._invokeSaveDraft({forceSave:As,auto:true})){Ar.once("compose:saveSuccess",function(){Y(Ar.draftMID);});}else{if(Ar.draftMID){Y(Ar.draftMID);}}}function g(As){var Y=As||this.getSaveNotification();if(!Y){return;}var Ar=this.baseNode&&this.baseNode.one(".bottomToolbar");Ar&&Ar.one(".save-draft-msg").setContent(Y);}function AG(){var Y=this;if(Y.lastSaveType===-1){return Q(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:Y.lastSave});}else{if(Y.lastSave){if(Y.lastSaveType===1){return Q(strings.str_comp_saved_fresh,0,0,0,{saved_time:Y.lastSave});}}}return"";}function e(Y,As){var At=this;function Ar(Au){if(Au){AB.use("mail-controller-messages",function(Av){Av.mail.Controller.Messages.get({fid:"Draft",msg:{mid:Au},cachekey:"SaveMessage",noCache:true},function(Aw){if(!Aw||!Aw.mid||!Aw.part){Av.common.Utils.rocketstats.stat("MailCompose","GDMFail:Attachment");}else{Y(Aw);}});});}}At.getMID(Ar,As);}function z(At,Y){var Av=this,As=Av.cdo.attachments,Ar=As.get(At).filename;function Au(Ay){var Ax,Aw;if(!Ay.attachments||(Ay.attachments.length!==As.count())){return;}Aw=Ay.attachments[As.order(At)];if(AB.Lang.trim(Aw.filename)!==Ar){return;}Ax={fid:"Draft",mid:Ay.mid,size:Aw.size,pid:Aw.partId,filename:Aw.filename};if(typeof Aw.tnefId!=="undefined"){Ax.tnefid=Aw.tnefId;}Y(Ax);}Av.attGetMsg(Au);}function Ae(As,Ar,Y){var At=this;AB.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),"mail-controller-messages",function(Au){At.attGetDownloadInfo(Ar,function(Av){Au.mail.common.downloader.render([Av]);Y("success");});});}function Ah(){var Ar=this,Y;Y={bidi:NeoConfig.bidi,isRTL:NeoConfig.isRTL,isFullSSL:NeoConfig.isSSL,isRich:Ar._isRTEActive(),getDefaultFontInfo:M.getDefaultFontInfo,convertToPlain:M.convertToPlain,smartscroll:NeoConfig.smartscroll&&Ar.get("isQuickReply")};return Y;}function K(){var Ar=this.cdo.get("header"),Y=this.cdo.get("textcontent");
return Ar.currentAddress||(Ar.to&&Ar.to.length>0)||(Ar.cc&&Ar.cc.length>0)||(Ar.bb&&Ar.bcc.length>0)||(Ar.subject&&Ar.subject.trim()!=="")||(Y&&Y.trim()!=="");}AB.extend(AA,l.ui.MailComposeConv);AB.mix(AA.prototype,{NAME:"FullCompose",render:w,bindUI:B,_bindWellUIFresh:t,onKeyDown:b,onFocus:d,closeCompose:L,hasContent:K,getContent:A,getRTE:u,getRTEInstance:r,getRTEDocNode:Ac,getFirstNode:J,setFocus:Aa,contentChangeAfter:x,replyheaderChangeAfter:Ak,replyContentChangeAfter:h,updateSaveText:W,postRender:AZ,matchOrigin:G,setContent:f,addAttachMenuItems:I,_bindCDO:y,_initOpenMailButtons:AW,_addFocusListenersFresh:i,_handleShiftTabFresh:C,_handleSendAction:U,handleComposeAction:T,_intlBindUIRTE:E,_allowEditing:AS,_isRTEActive:Aj,assembleSendBody:AH,_invokeSend:H,_closeAfterWarning:S,_activateWellFresh:AP,_renderWellsFresh:AQ,_bindTextSwitchFresh:q,_cmdTextSwitch:Ad,_alertInvalidAttachments:v,_initializeSpellCheck:p,_activateSpellCheck:k,_isSpellCheckActive:An,_doSpellCheck:j,_openSpellCheckMenu:s,_isOrigin:Ab,_handleSlowOriginRequest:AL,_displayLoading:m,_writeLoadingHtml:Ap,_clearOriginTimers:AU,_setComposePreference:c,_bindAttachments:AE,_bindAttachmentsTT:AX,attGetMsg:e,attGetDownloadInfo:z,attDownload:z,getMID:n,_showSendBtn:F,_showDraftBtn:N,_expandQuotedReply:a,showComposeView:X,hideComposeView:AD,getSubjectInfo:R,initializeRTEFormatter:Al,switchToFullCompose:AY,getSaveNotification:AG,setSaveNotification:g,cancelCompose:AV,resizeRTE:AF,doResizeRTE:AN,fixBottom:AM,_getEditorConfig:Ah,ondestroy:Z},true);AB.namespace("mail");l.ComposeViewConv=AA;},"1.0.0",{requires:["mail-ui-mailcompose","mail-ui-rteview","mail-ui-messagepane-utils","forms_css","attachments-fresh_css","mail-ui-composeview-attach","editor-base","editor-para","editor-br","node","stylesheet","mail-controller-compose-text","mail-model-compose","contacts-api-utils","contacts-api","filter-contacts","plugin","comms-bidi-textentry","comms-editor-autobidi","comms-intl-bidi","editor-bidi","_shared_module_compose_fresh_conv","_shared_module_toolbar_compose_fresh","_shared_module_compose_loading","_shared_module_offscreen_bin_compose","_shared_module_offscreen_bin_compose_menu_spellcheck","_shared_module_offscreen_bin_compose_modal_cancel_compose","_shared_module_rte_well_content_format_fresh","_shared_module_rte_well_content_emoticons_fresh","_shared_module_rte_well_content_fontnamesize_fresh","_shared_module_rte_well_content_attachments_fresh","_shared_module_rte_well_tabs_compose_fresh","common-ui-toolbar-base","common-ui-menu-helper","_shared_module_offscreen_bin_compose_menu_list","_shared_module_offscreen_bin_compose_menu_text_align","_shared_module_offscreen_bin_compose_menu_indent","mail-ui-rte-formatter"]});YUI.add("_shared_module_compose_title",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_title={base:"<span class='compose'><span>{{str_comp_title}}</span>{{compose_title}}</span>"};},"1.0.0");YUI.add("mail-ui-composeview-conv",function(E){var N=E.Node.create,T="hidden",H=E.common.Utils,R=H.substitute,X=H.log;var L=E.mail.ui.ConvComposeView=function(c,b,Y,e,d){var f=this;f.parent=Y;f.eventHandlers=d||{};f.initCompose(c,b,e);};function K(b,Y,c){var d=this;d.cdo=b.cdo||d.initComposeData(b,Y);d.subview=d.createComposeView(d.cdo,Y,b,c);d.bindComposeView();return d.subview;}function U(c,b){var d=this,Y;c&&c.cdo?Y=c.cdo:Y=E.mail.Controller.Compose.createCDO();if(b){d.setDraftOrigin(Y,c);d.setDraftFromAddress(Y);}else{d.setMessageFromAddress(Y);d.setMessageOrigin(Y,c);}if(c&&c.cbfn){Y.set("prePopulated",true);c.cbfn(Y,c);}if((!c||!c.action||!c.fid||!c.oMsg)&&!(c.cdo&&c.cdo.get("passive"))){E.mail.Controller.Compose.insertSignature(Y);}return Y;}function Z(Y,c,d,e){var f=this,b=null;if(d.flavor=="autocompose"){b=new E.mail.AutoComposeView(Y,c,f,d,e);}else{b=new E.mail.ComposeViewConv(Y,c,f,d,e);}f.composeView=b;b.neoFire("composeEvent",{action:"addChild","subview":b});b.neoFire("composeEvent",{action:"addSubview","subview":b});f.composeView.set("active",true);return b;}function Q(){var Y=this;if(Y.parent){Y.composeView.render(Y.parent);X({"m":"finish compose initial rendering"});Y.composeViewTainer=Y.composeView.baseNode;Y.composeView.postRender();X({"m":"finish compose post rendering"});}Y.composeView.on("FullCompose:composeEvent",Y.handleEvent,Y);Y.composeView.neoFire("composeEvent",{action:"bindComplete",ccv:Y});}function M(b){var c=this,Y=b.action;if(c.eventHandlers&&c.eventHandlers[Y]){c.eventHandlers[Y](b);}}function B(Y){var b=Y.get("header");b.from=E.mail.Controller.Compose.getDefaultFromAddress();Y.set("header",b);}function G(Y,b){if(b&&b.action&&b.fid&&b.oMsg){Y.set("origin",{action:b.action,fid:b.fid,oMsg:b.oMsg,parentMsg:b.parentMsg,ctxReq:null});}}function P(Y){var c=Y.get("header"),b=Y.get("origin").oMsg;c.from=b.from?b.from:(b.header||{}).from;Y.set("header",c);}function V(Y,b){if(b&&b.action&&b.fid&&b.oMsg){Y.set("origin",{action:b.action,fid:b.fid,oMsg:b.oMsg,forwardAsAttachment:b.forwardAsAttachment,ctxReq:null});}}function D(Y){this.parent=Y;}function F(Y,e,b,c){var d=this;b&&b.start(1,"moduleLoad");E.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base-conv",function(g){var f=d.sendConfirmView?d.sendConfirmView.sdo:null;if(b){b.start(1,"prepareSend");b.action="normal";}f=g.mail.Controller.Compose.transformSend(Y,f,e,true);X({"m":"Create sdo based on cdo","misc":e});d.createSendConfirmView(f,Y);g.mail.Controller.SendConfirm.sendMessage(f,b,d.composeView.flavor,c);g.use("contacts-api-utils",function(){d.showSendConfirm(e.noScroll);});});}function J(d,Y){var h=this,g=Y.get("origin"),f=0,e=0,c=null,b=null;if(!!g&&g.action&&g.action==="reply_sender"||g.action==="reply_all"){f=1;}else{if(!!g&&g.action==="forward"){e=1;}}c=new E.mail.SendConfirmView({sdo:d,container:h,isReply:f,isForward:e});b=N('<div class="hidden">');b.addClass(T);c.render(b);h.parent.appendChild(b);c.postrender(b);c.neoFire("sendConfirmEvent",{action:"addChild","subview":c});h.sendConfirmView=c;c.neoFire("sendConfirmEvent",{action:"addSubview","subview":c});h.sendConfirmViewTainer=b;h.bindSendConfirmView();}function I(){var Y=this;Y.sendConfirmView.on("SendConfirmView:sendConfirmEvent",Y.handleEvent,Y);}function a(Y){this.composeView.neoFire("composeEvent",{action:"updateTitle",sending:Y});}function C(Y){var b=this;b.composeViewTainer.one(".composeshim")[Y?"removeClass":"addClass"]("hidden");if(Y){b.composeViewTainer.addClass("sending");}else{b.composeViewTainer.removeClass("sending");}b.updateSendingTabTitle(Y);}function W(){var b=this,Y=E.ui.Templates._shared_module_offscreen_bin_notification_notifications.send_abuse;b.notification=new E.common.ui.Notification({sticky:true,type:"fade",className:"top",parent:".nav-bar"});b.notification.notify(R(Y,null,null,null,strings));}function O(b){var c=this,Y=E.ui.Templates._shared_module_offscreen_bin_notification_notifications.send_error;if(b){E.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_generic",function(e){var f=H.substitute(e.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"cancel","default":"default",btnLabel:strings.str_toolbar_back_to_message}),d={hd:b.title,bd:b.body,ft:f};e.common.ui.DialogHelper.createCommon(d,{cancel:{handler:function(){c.composeView.neoFire("composeEvent",{action:"switchToTab"});}}});});}else{c.notification=new E.common.ui.Notification({sticky:true,type:"fade",className:"top",parent:".nav-bar"});c.notification.on("clickEvent",function(d){if(d.action==="retry"){c.composeViewTainer.one("a[data-action=send]").simulate("click");c.showComposeShim(true);}});c.notification.notify(R(Y,null,null,null,strings));}}function S(){var Y=this;Y.showComposeShim(true);if(Y.notification){Y.notification.hide();Y.notification=null;}Y.composeActive=false;Y.subview=Y.sendConfirmView;}function A(Y){var b=this;b.composeView.isSending=false;b.composeView.resetSaveTimer();if(Y){b.composeView.dirty=true;b.composeView.allowSend=true;}b.composeActive=true;}L.prototype={initCompose:K,initComposeData:U,setMessageFromAddress:B,setDraftOrigin:G,setDraftFromAddress:P,setMessageOrigin:V,createComposeView:Z,bindComposeView:Q,setParent:D,invokeSend:F,createSendConfirmView:J,showSendConfirm:S,handleEvent:M,bindSendConfirmView:I,showCompose:A,showComposeShim:C,updateSendingTabTitle:a,notifyAbuse:W,notifyError:O};},"1.0.0",{requires:["mail-controller-base","mail-controller-compose","mail-ui-fullcompose","_shared_module_compose_title","_shared_module_offscreen_bin_notification_notifications","common-ui-notification"]});YUI.add("mail-ui-messagepane-warnings",function(D){D.namespace("mail.ui");var A=D.common.Utils.substitute,C=strings;function B(G){if(window.confirm(A([C.str_warning_msg_read_form_part1,C.str_warning_msg_read_form_part2].join("  "),C))){G.submit();}return false;}function F(G){if(strings.str_cfg_tog_exlink_alert_page){window.open(strings.str_cfg_url_exlink_alert_page+encodeURIComponent(G),"new");return false;}if(window.confirm(A([C.str_warning_msg_read_link_part1,C.str_warning_msg_read_link_part2,C.str_warning_msg_read_link_part3].join("  "),C))){window.open(G.href);}return false;}function E(G){if(!G.warningShown){window.alert(A([C.str_warning_msg_read_password_part1,C.str_warning_msg_read_password_part2].join("  "),C));G.warningShown=1;}}D.mail.ui.Warnings={showFormWarning:B,showLinkWarning:F,showPasswordWarning:E};window.theMainWindow=D.mail.ui.Warnings;},"1.0.0",{requires:["common-utils"]});YUI.add("mail-ui-mailpane-read",function(H){H.namespace("mail.ui");var C=H.mail;var B=function(){};function F(O,J,M){var P=this,K,N;M=M||P.message;N={fid:P.fid,mid:M.mid,pid:O};K=M.nonImgAttachments;for(var I=0;I<K.length;I++){var L=K[I];if((L.type==="message"||L.type==="text")&&L.partId==O){N.filename=L.filename;}}if(typeof J!=="undefined"&&J!==""&&J!=="null"){N.tnefid=J;}D([N]);}function G(R,J,T){var P=this,N,O=[],I,M;T=T||P.message;I={image:T.imgAttachments,"non-image":T.nonImgAttachments,all:T.attachments};M=I[R]||[];for(var S=0;S<M.length;S++){var L=M[S],K={fid:P.fid,mid:T.mid,pid:L.partId},Q=L.tnefId;if(L.type==="message"||L.type==="text"){K.filename=L.filename;}if(typeof Q!=="undefined"){K.tnefid=Q;}O.push(K);}if(J&&J.target){if(J.target.get("nodeName")==="A"){N={restoreFocusNode:J.target};}else{N={restoreFocusNode:J.target.ancestor("A")};}}if(O.length){D(O,N);}}function D(J,I){H.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),function(){C.common.downloader.render(J,I);});}function E(){H.fire("openOptions",{view:"security"});}function A(I,M,L){var N=this,K,J;L=L||N.fid;M=M||N.message;if(M&&!N.loading_slow&&!N.loading_error&&!N.loading_moved&&!M.flags.isRead){K=H.mail.persist.MetaData.get("cg.pref.general.markasreadinterval");if(K!="999"){K=K?parseInt(K,10)*1000:750;if(isNaN(K)){K=750;}J=K===0;H.use("mail-controller-messages-ops",function(){var O=function(){var P=C.Controller.batch();P.Messages.flag({fid:L,mid:M,setFlags:{"read":1},enableRetry:true},{suppressCodes:["*"]});return P;};if(!J){if(N.tmFireRead){clearTimeout(N.tmFireRead);N.tmFireRead=null;}N.tmFireRead=setTimeout(function(){var P=O&&O();P&&P.execute();},K);}I&&I(J?O:null);});return true;}}return false;}H.mix(B.prototype,{bindPaneContent:function(){},onSuccess:function(){},setFullFormatters:function(){},postRender:function(){},downloadAttachment:F,downloadAllAttachments:G,loadOptions:E,markAsRead:A});H.mail.ui.MailPaneRead=B;},"1.0.0",{requires:["mail-ui-common-string-utils","common-utils","common-utils-stats","mail-controller-base"]});YUI.add("mail-ui-convpane-bind",function(D){D.namespace("mail.ui");var A=D.mail.ui._ConvPane,C=A.prototype;var B=function(F,E){var G=this;D.use("mail-ui-proxyevents",function(){D.mail.ui.MailEventsProxy.handleUI({action:E},G.getMsgFid(F),null,[F]);});};C.handleUI=B;},"1.0.0");YUI.add("mail-ui-convpane-read",function(AB){AB.namespace("mail.ui");var G=AB.mail.ui._ConvPane,AG=AB.common.Utils,U=AG.substitute,F=AG.ezSub,AN=AG.escapeHtml,AK=AG.rocketstats,c=AG.ymmastats,J=AG.unescapeHtml,Ai=AB.ui.Templates,AF=Ai._shared_module_thread_thread_display_rollup,n=AB.mail,k=n.model.DataStore,AA=n.model.ConvStore,r=n.ui.PaneUtils,m=n.ui.MessagePaneUtils,Af=n.Controller,Q=n&&n.Controller?n.Controller.Messages:{},Ah=n&&n.Controller?n.Controller.Conversations:{},AV=k.Messages.getPermMidPart,L=AA.Conversations.getPermCidPart,X=".message-header",O=X+" .summary",W=X+" .badge",AQ="thread-item",a="expanded",AZ="unread",Ac=2,AP=NeoConfig.convMsgsToOpenCount||5,AM=NeoConfig.convMsgsToOpenCount||5,V=10,x=AB.mail.persist.MetaData,AC=21,AO=10,B=175,b=5,AS=(strings.str_cfg_tog_hkr_siu===true?"hkr_siu":"cg_siu"),AH=strings.str_cfg_tog_hkr_siu===true,t={"http://mail.yimg.com/a/i/cal/bell4.gif":"bell","http://mail.yimg.com/a/i/us/pim/ybang_16x16_1.gif":"certified"},z=[],K;var P=function(Y){var Am=this;Y=Y||{};P.superclass.constructor.call(Am,Y);};function Ak(Aw,Au,Av,Am,Ap){var Ao=Aw&&Aw.header,At,Ar,As,Y,Aq,An;if(Ao){At=Ao.to||[];Ar=Ao.cc||[];As=Ao.bcc||[];Y=At.concat(Ar,As);Aq=function(Ax){var Ay={to:r.getConvName(Ax),rcpt_id:r.getAddress(Ax),rcpt_name:r.getConvName(Ax)};return Ay;};An=r.createRecipientList(Y,Au,Av,Am,Aq,"");if(Am&&Y.length>Am){An+=U(Ap,{num_more_recipients:Y.length-Am},0,0,strings);}return An;}}function N(Ap){var Aq=this,Ao=Ap.srvmap,Am,Y,An="";if(!Ao){Y=Aq.inboxservices||[];Ap.srvmap=Ao={};for(Am=Y.length-1;Am>=0;Am--){Ao[Y[Am].name]=Y[Am].value;}}if(!strings.str_cfg_tog_certified_icon&&Ao.crt){delete Ao.crt;}if((AH||!Ao.crt)&&(Ao[AS]||Ao.siu||(Ap.msgs.length&&Ap.msgs[0].msgicon))){if(Ao&&Ao[AS]){An=t[Ao[AS]]||"";}else{if(Ap.msgs[0].msgicon){An=Ap.msgs[0].msgicon;}}}if(NeoConfig.isSSL&&An==="certified"){An="certified-ssl";}Ao.inboxService=An;return An;}function S(Aw,Aq,An,Av,Ap,As){if(!Aw){AG.report("Shouldn't come into getMsgMarkUp with empty message");}if(!Aw.header){return;}var Ao=this,Au=Ao.message,Y=Aw.flags.hasAttachment,Ar,At=Ao.getMsgFid(Aw),Am=At==="Draft"?true:false;Ar={from:function(){var Ay=Aw.header.from;if(Ay){var Ax={from_name:r.getConvName(Ay),from_id:r.getAddress(Ay)};return U(AF.from,Ax);}},super_collapsed:function(){return Ap?AF.super_collapsed:"";},isFlagged:function(){return Aw.flags.isFlagged?AF.isFlagged:"";},isFlagged1:function(){return Aw.flags.isFlagged?U(AF.isFlagged1,null,null,null,strings):"";},isFlagged2:function(){return Aw.flags.isFlagged?U(AF.isFlagged2,null,null,null,strings):"";},isFlagged_else:function(){return Aw.flags.isFlagged?"":U(AF.isFlagged_else,null,null,null,strings);},isFlagged_else1:function(){return Aw.flags.isFlagged?"":U(AF.isFlagged_else1,null,null,null,strings);},isUnread:function(){return Aw.flags.isRead?"":AF.isUnread;},snippet:function(){var Ax=Aw.snippet||(Aw.header&&Aw.header.snippet)||strings.str_thread_nopreview;return AN(J(AB.Lang.trim(Ax)));},expanded:function(){return Aq?AF.expanded:"";},expanded_else:function(){return Aq?"":AF.expanded_else;},date:function(){var Ax=Aw.header.receivedDate*1000;if(!Ax&&Ao.getMsgFid(Aw)==="Sent"){Ax=Aw.header&&Aw.header.sentDate*1000;}return AG.dateFormatter(new Date(Ax),Neo.getDateFormat(Ax,false,true));},received_date:function(){return Aw.header.receivedDate?AG.dateFormatter(new Date(Aw.header.receivedDate*1000),strings.str_tog_dateformat_header_long_l10n):"";},hasAttachmentDownload:function(){return Y?U(AF.hasAttachmentDownload):"";},thread_reply:function(){return U(AF.thread_reply,null,Ar,null,strings);},mid:function(){return AV(Aw.mid)||"";},hasDraft:function(){return Am?U(AF.hasDraft,null,null,null,strings):"";},hasDraft1:function(){return Am?U(AF.hasDraft1,null,null,null,strings):"";},hasDraft2:function(){return Am?U(AF.hasDraft2,null,null,null,strings):"";},hasDraft_else:function(){return Am?"":U(AF.hasDraft_else,null,Ar,null,strings);},hasAttachment:function(){return Y?U(AF.hasAttachment):"";},recipients:function(Ay,Ax){Aw=Ay||Aw;if(Aq||Ax){return U(AF.to_str,null,null,null,strings)+Ak(Aw,AF.recipients,Ar,Ax?"":3,AF.more_recipients);}},thread_attachments:function(){return Y?U(AF.thread_attachments,null,Ar):"";},msg_blocked:function(){if(!Aq){return;}return r.getBlockedMsgMarkup(Aw,AF,Ar);},msg_has_photo_attachment:function(){var Ay=Aw,Ax=Ay?Ay.imgAttachments||[]:[];return Ax.length?U(AF.msg_has_photo_attachment,Ay,Ar,null,strings):"";},attached_photos:function(){return r.getAttPhotosMarkup(Aw,AF,Ar);},msg_has_attachment:function(){var Ay=Aw,Ax=Ay?Ay.nonImgAttachments||[]:[];return !Ao.isChat(Ay)&&Ax.length?U(AF.msg_has_attachment,Ay,Ar,null,strings):"";},hide_attachments_else:function(){return U(AF.hide_attachments_else,Aw,Ar,null,strings);},attached_files:function(){return r.getAttFilesMarkup(Aw,AF,Ar);},msg_loading:function(){return(Aw.loading_slow||Aw.loading_error||Aw.loading_moved)?U(AF.page_loading,null,Ar,null,strings):"";},loading_error:function(){return Aw.loading_error?Ao.getFailureMarkup(Aw):"";},msg_truncated:function(){return Aw.body&&Aw.isTruncated&&!Ao.disableTruncate?U(AF.msg_truncated,null,null,null,strings):"";},isInternal:function(){if(NeoConfig.showFeedback){return U(AF.isInternal,null,null,null,strings);}else{return"";}},flag_info:function(){var Ay=Au&&Au.srvmap&&Au.srvmap.inboxService;var Ax=Ay?"info-"+Ay:"";return Ax;},flag_info_hover:function(){var Ay=Au&&Au.srvmap&&Au.srvmap.inboxService;var Ax=(Ay==="certified"||Ay==="certified-ssl")?"info-"+Ay:"info-unread";return Ax;},status_title:function(){var Ay=Au&&Au.srvmap&&Au.srvmap.inboxService;var Ax=(Ay==="certified"||Ay==="certified-ssl")?U(strings.str_msg_list_info_verified_attr,strings):"";return Ax;},loadhide:function(){return As?U(AF.loadhide,null,Ar,null,strings):"";},with_icons:function(){return NeoConfig.convBtmIcons?F(AF.with_icons):"";},with_icons_else:function(){return NeoConfig.convBtmIcons?"":F(AF.with_icons_else);}};if(!Ao.messageFormatter){Ao.messageFormatter=Ar;}Ao.getInboxService(Au);
if(Av){return U(AF.thread_reply,null,Ar,null,strings);}else{return U(AF.thread_item,null,Ar,null,strings);}}function AW(){var Am=this,Y=function(Ao){var As=Ao.s||"",Aq=Ao.o||0,An=Ao.f||Am.readFormatters,Ar=Ao.a||0,Ap=Ao.strs||strings;return U(As,Aq,An,Ar,Ap);};Am.showDetails=x.get("neo.pref.showHeaderDetails");this.readFormatters={anyUnread:function(){var An=Am.message;return An.totalUnread>0?AF.anyUnread:"";},anyFlagged:function(){var An=Am.message;return An.totalFlagged>0?AF.anyFlagged:"";},anyFlagged1:function(){var An=Am.message;return An.totalFlagged>0?U(AF.anyFlagged1,null,null,null,strings):"";},anyFlagged2:function(){var An=Am.message;return An.totalFlagged>0?U(AF.anyFlagged2,null,null,null,strings):"";},anyFlagged_else:function(){var An=Am.message;return An.totalFlagged<=0?U(AF.anyFlagged_else,null,null,null,strings):"";},anyFlagged_else1:function(){var An=Am.message;return An.totalFlagged<=0?U(AF.anyFlagged_else1,null,null,null,strings):"";},qr_bar:function(){return U(AF.qr_bar,{},Am.readFormatters,null,strings,Ai);},show_formatter_well:function(){return U(AF.show_formatter_well,{},Am.readFormatters,null,strings,Ai);},show_attachment_icon:function(){if(NeoConfig.useAttComposerTT){return U(AF.show_attachment_icon,{},Am.formatters,null,strings,Ai);}else{return"";}},spellCheckEnabled:function(){if(strings.str_tog_spellcheckEnabled){return U(AF.spellCheckEnabled,{HiddenClassName:""},Am.readFormatters,null,strings,Ai);}else{return U(AF.spellCheckEnabled,{HiddenClassName:" hidden"},Am.readFormatters,null,strings,Ai);}},thread_item:function(){var Aq,Ao=Am.message,Ap=true,As="",Au,Ar,Av=false,Az=0,Ax=0,At=0,Ay=0,A1=false;if(Am.loading_error||!Ao.cid){return"";}Au=Ao.msgs;Ar=Au.length;if(Ar!==Ao.totalMsgs){return"";}for(Aq=0;Aq<Ar;Aq++){var A0=Au[Aq],Aw,An=AV(A0.mid);if(AB.Lang.isUndefined(A0.header)){return;}if(Aq!==0&&Aq!==Ar-1){Ax++;}Aw=A0.body?true:false;Am.midObjMap[An]=Aq;if(Am.fid==="Sent"){if(A0.fid==="Sent"&&Aq<V){Av=false;Ay++;}else{if(Aq>=V&&!Av&&A0.fid!=="Sent"){Av=false;}else{if(Aq>=V&&!Ay){Av=true;if(Aq<Ar-1){Ax--;}}}}if(Aq===Ar-1&&!Av&&!Ay&&Ar>V){Av=true;}}else{if(Am.fid==="Draft"){if(A0.fid==="Draft"&&Aq<V){Av=false;At++;}else{if(Aq>=V&&!Av&&(A0.fid!=="Draft"&&(Au[Aq+1]&&Au[Aq+1].fid!=="Draft"))){Av=false;}else{if(Aq>=V&&!At&&(Au[Aq+1]&&Au[Aq+1].fid==="Draft")){Av=true;if(Aq<Ar-1){Ax--;}}}}if(Aq===Ar-1&&!Av&&!At&&Ar>V){Av=true;}}else{if(!A0.flags.isRead&&Aq<V){Av=false;Az++;}else{if(Aq>=V&&!Av&&A0.flags.isRead){Av=false;}else{if(Aq>=V&&!Az){Av=true;if(Aq<Ar-1){Ax--;}}}}if(Aq===Ar-1&&!Av&&!Az&&Ar>V){Av=true;}}}if(Av&&!Am.submessage&&!Am.midtocid&&!A1){As+=Y({s:AF.super_collapsed_btn,o:{collapsed_msg_count:Ax}});A1=true;}As+=Am.getMsgMarkUp(A0,Aw,null,null,false,Ap);}return As;},message_selection:function(){var An=Am.numSelected>0&&!Am.message?Y({s:AF.message_selection}):"";return An;},message_selection_else:function(){return Am.numSelected===1&&Am.message?Y({s:AF.message_selection_else}):"";},multiple_selected_msgs:function(){return Am.numSelected>1?Y({s:AF.page_conversation_history,o:{num_selected_msgs:Am.numSelected}}):"";},num_selected_msgs:function(){return Am.numSelected;},multiple_selected_msgs_else:function(){return Am.numSelected===1?Y({s:AF.page_conversation_history1}):"";},folder_message:function(Ao){var An=Ao||Am.message;if(Am.loading_error||!An.cid){return;}return Y({s:AF.folder_message,o:An});},folder_message1:function(Ao){var An=Ao||Am.message,Ap=An&&An.header;return(Ap&&(Ap.subject||(Ap.to&&Ap.to[0])||Ap.from.name))?Y({s:AF.folder_message1,o:An}):"";},expanded:function(){return Am.showDetails?AF.expanded:"";},mail_search_enabled:function(Ao){var An=Ao||Am.message;if((strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===false)||!(An&&An[0]&&An[0].subject)){return"";}else{return Y({s:AF.mail_search_enabled});}},mail_search_enabled1:function(Ao){var An=Ao||Am.message;if((strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===false)||!(An&&An[0]&&An[0].subject)){return"";}else{return Y({s:AF.mail_search_enabled1});}},msg_subject:function(){var An,Ao=r.getMsgSub(Am.message);if(Am.loading_error){An=AB.mail.Tabs.getActiveTab();if(AB.mail.ui.searchTab&&An&&An.prevTabId===AB.mail.ui.searchTab.get("id")){Ao=Ao.split("^_").join("");}}return Ao;},msg_subjectDir:function(){return r.getMsgSubDir(Am.message);},page_loading:function(){return(Am.loading_slow||Am.loading_error||Am.loading_moved)?Y({s:AF.page_loading}):"";},conv_loading:function(){if(Am.loading_error){return"";}return Y({s:AF.conv_loading});},nav_arrows:function(){if(false){return"";}else{return Y({s:AF.nav_arrows});}},summary:function(){var Ao=Am.message,An=Ao.totalMsgs;if(An>1){return"("+An+")";}else{return"";}}};Am.setFull=1;}function g(Am,A0,Ap,Aq){var At=this,Ay,An=AG.Stopwatch.get("MsgInPreview")||At.stopwatch,Av=Am&&Am.cid,As,Ar,Aw,Y,Ao,Ax,Az=[];At.wasCached=A0||"";try{An&&An.start(3,"OnSuccessLMTRender");clearTimeout(At.loadingTimer);if(Av&&At.message&&((At.message.cid&&(L(At.message.cid)===L(Av)))||(At.midtocid&&AB.Lang.isValue(At.getMessageIdxByMidLookup(At.midtocid,Am.msgs,true))))){At.loading_moved=0;At.resetRequestLoadingState(false);At.inboxservices=At.message.inboxservices||(At.message.msgs&&At.message.msgs[0]&&At.message.msgs[0].inboxservices);if(At.midtocid){At.message=Am;}else{At.message=Am;At.allMsgsInConvInfo=Am.msgs;}At.message.toggleState="expanded";if(Aq&&Am.fullmsg.mid){Aw=At.getMessageIdxByMidLookup(Am.fullmsg.mid,At.message.msgs);Am.fullmsg.cid=Am.cid;Am.fullmsg.header.snippet=Am.msgs[Aw].header.snippet;Am.fullmsg.fid=At.getMsgFid(Am.msgs[Aw]);At.message.msgs[Aw]=Am.fullmsg;At.primaryMid=Am.fullmsg.mid;Az.push(At.message.msgs[Aw]);for(Ar=0;Ar<Az.length;Ar++){Ay=Q.getQueryParams(Az[Ar],"midRequest");Az[Ar].blockImages=Ay&&Ay.blockImages;Ax=At.midObjMap[AV(Az[Ar].mid)];r.extractQuotedText(Az[Ar],AF.quoted_text_collapse,AF.quoted_text_expand,z,Ax);}}At.fireEvent("getSuccess");At.render(A0);if(Aq&&(Aw!==undefined&&Aw>=0)){At.showMessages(Aw,[At.message.msgs[Aw]],false,false,An,false,false);
if(!NeoConfig.hasConvV3){return;}}An&&An.start(1,"ThreadMsgRead");Ao=At.submessage?At.submessage:At.midtocid?{mid:At.midtocid}:Aq&&Am.fullmsg?Am.fullmsg:At.message.msgs[At.message.msgs.length-1];Aw=At.getMessageIdxByMid(Ao.mid);Y=At.getMsgNodeByMid(Ao.mid);if(Ao.fid==="Draft"){At.showMessages(Aw,[At.message.msgs[Aw]],false,false,An,false,true);}else{if(At.submessage){At.expandMessages(Aw,"adjacent","no",true,null,An,true);}else{if(At.midtocid){if(!Aq){At.expandMessages(Aw,"one",false,true,null,An,true);}}else{if(At.fid==="Sent"){At.expandMessages(Aw,"send",false,true,null,An,true);}else{if(At.fid==="Draft"){At.expandMessages(Aw,"draft",false,true,null,An,true);}else{if(Aq){At.expandMessages(Aw,"other-unread",false,true,{no_scroll_to_msg:true,no_focus:true},An,true);}else{At.expandMessages(Aw,"unread",false,true,{no_scroll_to_msg:true,no_focus:true},An,true);}}}}}}c.stat("convread","result=>success,env=>"+NeoConfig.mailEnv);}else{if(!Am){At.loadExtra(function(){this.onFailure({msg:At.message,reason:As},Ap);},1);}}}catch(Au){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1",Au,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1");AK.stat("convread","onSuccessError");}}function h(Am){var Ao=this,An,Y;if(Ao.activeComposeWidget&&(Ao.activeComposeWidget.cv.composeView!==Am)){Ao.activeComposeWidget.cv.composeView._invokeSaveDraft({auto:true});}Ao.activeComposeWidget=null;for(An in Ao.composeWidgets){Y=Ao.getComposeNodeByMid(An);if(Ao.composeWidgets[An].cv.composeView===Am){Ao.activeComposeWidget=Ao.composeWidgets[An];Y.addClass("active");AB.fire("draftCardAdded");if(!NeoConfig.smartscroll&&Ao.composeAction){Ao.listNode.set("scrollTop",Y.get("offsetTop")-10);Ao.composeAction=false;}}else{}}}function j(As){var Aq=this,Ao,At,Ap,Y,Am,An=[],Ar=0;for(At in Aq.composeWidgets){Ap=Aq.composeWidgets[At].cv.composeView;if(Ap.get("dirty")){An.push(Ap);}}if(An.length<=0){As&&As(true);}else{Y=function(Av,Au){Au.detach("compose:saveFail",Am);Au.dirty=false;Ar--;if(Ar===0){As&&As(true);}};Am=function(Av,Au){Au.detach("compose:saveSuccess",Y);Au.dirty=true;As&&As(false);};Ar=An.length;for(Ao=0;Ao<An.length;Ao++){Ap=An[Ao];Ap.once("compose:saveSuccess",Y,null,Ap);Ap.once("compose:saveFail",Am,null,Ap);Ap._invokeSaveDraft({auto:true});}}}function R(){var An=this,Am,Y;Am=An.composeWidgets;for(Y in Am){Am[Y].cv.composeView.closeCompose();}}function AR(An,Am){var Ao=this,Y;if((Ao.msgUserUnread&&Ao.msgUserUnread[AV(Am.mid)])||!Ao.get("active")){return;}if(Am&&!Ao.loading_slow&&!Ao.loading_error&&!Ao.loading_moved&&!Am.flags.isRead){Y=parseInt(AB.mail.persist.MetaData.get("cg.pref.general.markasreadinterval"),10);if(Y!==999){Y=Y?Y*1000:750;if(isNaN(Y)){Y=750;}if(Y===0){Y=100;}Ao.flagMsgList.push({"fid":An,"msg":Am});AB.use("mail-controller-messages-ops",function(){if(Ao.tmFireRead){clearTimeout(Ao.tmFireRead);Ao.tmFireRead=null;}Ao.tmFireRead=setTimeout(function(){AB.Array.forEach(Ao.flagMsgList,function(Ap){Ao.markAsReadBatch(Ap.fid,Ap.msg);});Ao.readBatch.execute({suppressCodes:["*"]});Ao.readBatch=null;Ao.flagMsgList=[];},Y);});return true;}}return false;}function l(Am,Y){var An=this;An.readBatch=An.readBatch||n.Controller.batch();An.readBatch.Messages.flag({fid:Am,mid:Y,setFlags:{"read":1},enableRetry:true});}function q(Ao,Am,Y){var Ap=this;try{if(Am&&Am.ancestor("body")){Ap.neoFire("rendered",[],Ao,Am,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},Y);}else{Ap.once("convAddedToDOM",function(){if(!Am.ancestor("body")){Am=Ap.getMsgNodeByMid(Ao.mid);}Ap.neoFire("rendered",[],Ao,Am,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},Y);},Am);}}catch(An){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2",An,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2");AK.stat("convread","convMsgRenderCompleteError");}}function Aa(){var Ar=this,Ap=Ar.listNode,Ao=Ap.get("scrollTop"),An=Ap.get("offsetHeight"),Aq=Ap.all("."+AQ),Am="has-scrolled",Y=AB.ACWidgetInst;if(Y&&Y.isVisible()){Y.hide();}if(Ao>b){Ar.hdr.addClass(Am);}else{Ar.hdr.removeClass(Am);}if(Aq.size()>1){Ar.checkAdsOnScroll(Ao,An);}clearTimeout(Ar.markAsReadTimer);Ar.markAsReadTimer=setTimeout(function(){if(!Ar.stopScrollLoad){Ar.checkMsgCardsOnScroll(Aq);}else{Ar.stopScrollLoad=false;}},200);}function AT(Am,Y){var Ar=this,Ap=window.DARLA,Ao,An,Aq=200;if(!AB.Lang.isNumber(Ar.prevY)){Ar.prevY=Am;}if(Ar.scrollAdTimer){clearTimeout(Ar.scrollAdTimer);}if(Ap&&Ap.inProgress()){}else{Ao=Math.abs(Ar.prevY-Am);An=Y*Ap.scrollThreshold;if(Ao>An){Ar.scrollAdTimer=setTimeout(function(){AB.mail.ui.darla.fireDarlaOnScroll(false);Ar.prevY=Am;},Aq);}}}function AI(Aq){var Ap=this,Y,An=Ap.message.msgs,Ao,Am;if(!Aq||!An){return;}Y=Aq.size();for(Am=0;Am<Y;Am++){Ao=Aq.item(Am);if(Ao.hasClass(a)&&Ao.hasClass(AZ)&&Ao.inRegion(Ap.listNode)){Ap.markConvMsgAsRead(Ap.getMsgFid(An[Am]),An[Am]);}}}function AL(){var Am=this,Y=this.getRoot();Am.listNode=Y.one(".thread-item-list");if(!Am.listNode||!Am.message){return;}Am.listNode.on("scroll",Am.onPaneScroll,Am);}function y(){var Am=this,Y=this.getRoot();Am.listNode=Y.one(".thread-item-list");Am.rteActiveHandler=AB.on("compose:rte:active",function(An){if(An.cv.draftMID){An.cv.scrollFocus=false;}Am.setActiveCompose(An.cv);});Am.after("activeChange",function(An){if(An.newVal){}var Ao=this;if(!An.newVal){Ao.saveDraftAction(null,true);}});Am.on("activeChange",function(An){if(An.newVal&&Am.refreshOnActive){Am.updatePaneContent();}});Am.on("closeChange",function(An){An.newVal&&Am.closeAllCompose();});Am.threadHeaderHandler=Y.delegate("click",function(Ao){var An;
Ao.stopPropagation();var Ap,As=AG.getDataAction(Ao).action,Ar=Am.message,Aq=Ao.target;An="";switch(As){case"thread-flag":Ap=Ar.totalFlagged?"unflagged":"flagged";An=Ar.totalFlagged?"unflag_thrd_hdr":"flag_thrd_hdr";Am.handleUI(Ar,Ap);break;case"thread-unread":Ap=Ar.totalUnread?"read":"unread";An=Ar.totalUnread?"read_thrd_hdr":"unread_thrd_hdr";Am.handleUI(Ar,Ap);break;case"thread-toggle":Ap=(Ar.toggleState==="expanded")?"collapse":"expandall";Am.handleToggleAllMessageCards(Aq,Ap,Ar,Am.getMsgFid(Ar));break;case"update":Am.saveDraftAction(function(){Am.loadPaneContent(7,null,{force:true},null);});break;}An&&AB.fire("mt:click",{action:An});},X);Y.delegate("focus",function(An){if(An&&An.currentTarget){Am.selNode=An.currentTarget;}},".thread-item");Am.threadItemHandler=Y.delegate("click",function(A4){if(A4.target.getAttribute("href")==="#"){A4.halt();}else{A4.stopPropagation();}AB.fire("as:close-window-click",A4);var A2,As,Ar,Aw,A6=A4.target,Ay=A4.currentTarget,A5=AG.getDataAction(A4).action,Aq=A6.hasClass("thread-item")?A6:A6.ancestor(".thread-item",true),At,Au,A7,Az=Am.message.msgs,A3;if(Aq){A7=Aq.getAttribute("data-mid");if(A7){At=Am.getMessageIdxByMid(A7);Au=Az[At];Am.selNode=Aq;}}if(A5==="contact-card-menu"&&!Aq.hasClass("expanded")){A5="select-thread";}Aw="";AB.fire("MailLog",{m:"Initializing Action from Conversation Pane",action:A5});switch(A5){case"thread-super-collapse":Am.expandSuperCollapsedNodes();break;case"select-thread":if(!Aq.hasClass("expanded")){AB.fire("MessagePane:expandClick",{cid:Am.message.cid,mid:Au.mid});Am.expandMessageTimers[A7]=AB.later(5000,null,function(){var A8={yid:NeoConfig.loginId,cid:Am.message.cid,mid:Au.mid};AG.netError("Expand Message Failed:"+AB.JSON.stringify(A8));});Am.expandMessages(At,"one","yes",false,{no_scroll_to_msg:true});Aw="expand_thrd_msg_hdr";}else{if((A6.hasClass("thread-item-header")||A6.ancestor(".thread-item-header"))&&!Aq.hasClass("collapsing")&&!Aq.hasClass("expanding")){Am.collapseMessage(Aq);Aw="collapse_thrd_msg_hdr";}}break;case"quoted-text":var A1,Ap,An=Aq.all(".thread-quoted-body"),A0;if(An&&An.size()>0){Ap=An.item(0).hasClass("hidden");Aw=Ap?"expand_qtd_thrd_msg":"collapse_qtd_thrd_msg";Aq.setStyle("height","auto");A0=Aq.one(".thread-quoted-text");if(A0){A0.one(".icon").toggleClass("icon-chevron-down");A0.one(".icon").toggleClass("icon-chevron-right");AB.fire("ToolTips:hideTooltips");A0.one(".qtd-expansion-text").set("text",Ap?strings.str_qtd_collapse:strings.str_qtd_expand);A0.setAttribute("title",Ap?strings.str_qtd_collapse:strings.str_qtd_expand);}An.each(function(A8){var BA,A9=0.3;if(Ap){A8.removeClass("hidden");BA=parseInt(A8.getComputedStyle("height"),10)+"px";A8.setStyle("height",0);A8.transition({duration:A9,height:BA},function(){A8.setStyles({height:"auto",overflow:"visible"});});}else{BA=parseInt(A8.getComputedStyle("height"),10)+"px";A8.setStyles({height:BA,overflow:"hidden"});A8.transition({duration:A9,easing:"ease-in",height:0},function(){A8.addClass("hidden");A8.setStyle("height","auto");});}});A1=Math.max(100,parseInt(Aq.getStyle("height"),10))+"px";Aq.setStyle("height",Aq.getStyle("height"));Ap&&AK.stat("conv","qtdExpanded");}break;case"thread-item-flag":A2=Au.flags.isFlagged?"unflagged":"flagged";Aw=Au.flags.isFlagged?"unflag_thrd_msg_hdr":"flag_thrd_msg_hdr";Am.handleUI(Au,A2);break;case"thread-item-delete":A2="delete";Am.handleUI(Au,A2);break;case"thread-item-unread":A2=Au.flags.isRead?"unread":"read";if(A2==="unread"){if(!Am.msgUserUnread){Am.msgUserUnread={};}Am.msgUserUnread[A7]=true;}Aw=Au.flags.isRead?"unread_thrd_msg_hdr":"read_thrd_msg_hdr";Am.handleUI(Au,A2);break;case"reply_all":case"reply_sender":case"forward":case"thread-item-replyall":Ar={};Ar.action=(A5==="thread-item-replyall")?"reply_all":A5;if(!Au){At=Az.length-1;Au=Az[At];}Am.composeAction=true;Aw=A5+"_thrd_msg";Am.initReplyForward(Ar.action,Au);break;case"edit-to":if(Am.composeWidgets[A7]){Aq.one(".thread-reply-to").setStyle("display","none");Aq.one(".thread-reply-to-edit").setStyle("display","block");}break;case"menu":if(!Aq.hasClass("quickReply")){Am.loadMenu(A4,Au,Aq,At);Aw="actnMnu_thrd_msg";}break;case"bug":A7=encodeURI(A7);A3=A7.lastIndexOf("_")+1;As="php/qtd_r.php?cid="+Am.message.cid+"&mid="+(A3?A7.slice(A3):A7)+"&fid="+Am.getMsgFid(Au);if(NeoConfig.isCorpmail){As+="&isCorpMail=1";}window.open(As,"_bug");break;case"show-images":Am.unblockImages(Au,At);Aw="show_images_thrd_msg";break;case"mail-options":Am.loadOptions();Aw="options_thrd_msg";break;case"attach-download-all":case"attach-download-all-photos":var Ao=(A5==="attach-download-all-photos")?"image":"non-image";Am.downloadAllAttachments(Ao,A4,Au);break;case"attach-download":var Ax=0,Av="";if(Ay){Ax=Ay.get("id");Av=Ay.getAttribute("tnefid");}Am.downloadAttachment(Ax,Av,Au);break;case"retry-msg-load":Am.expandMessages(At,"one","yes",false);Aw="retry_thrd_msg";break;case"retry-conv-load":Am.retryLoad();Aw="retry_thrd_hdr";break;case"view-full-msg":Am.viewFullMsg(Au,At);break;case"thread-item-edit":Ar={};Ar.action="edit";AB.fire("editMessage",AB.mix(Ar,{fid:Am.getMsgFid(Au),oMsg:Au}));break;case"contact-card-menu":AB.use("contacts-ui-contact-popup",function(){var BA=A6.getAttribute("data-name"),A9=A6.getAttribute("data-address"),BB=n.ContactPopup.TYPE_INTERMEDIATE,A8=A6;n.ContactPopup.showContactMenu(BB,A8,{email:A9,name:BA,editable:false,copyable:true});});break;case"more":Aq.one(".recipients").set("innerHTML",Am.messageFormatter.recipients(Au,true));}Aw&&AB.fire("mt:click",{action:Aw,append:{t1:"thrdRdTb"}});},".thread-item, .msg-attachments .file-attach li, .conv-loadingpane, .supercollapsed, .add-to-conv");AB.on("ds:conv:change",function(){});AB.on("ds:folder:rename",function(Aq,Ap){var Ao=Am.message.msgs,An=0;if(Aq.folderInfo.fid===Am.message.fid){Am.message.fid=Ap.folderInfo.fid;for(An=0;An<Ao.length;An++){if(Aq.folderInfo.fid===Ao[An].fid){Ao[An].fid=Ap.folderInfo.fid;if(Ao[An].folderInfo&&Ao[An].folderInfo.fid!==undefined){Ao[An].folderInfo.fid=Ap.folderInfo.fid;}if(Ao[An].sourceFolderInfo&&Ao[An].sourceFolderInfo.fid!==undefined){Ao[An].sourceFolderInfo.fid=Ap.folderInfo.fid;
}}}}});Am.refreshHandler=AB.on("ds:conv:refresh",function(As,Aq,Ar){var Av,An,Au,Ap=true,At,Ao;if(!Am.message||!Am.message.cid){return;}An=L(Am.message.cid);if(As==="lft"){Av=Ar[An];}else{if((As==="lmt")&&(Ar[0])&&(L(Ar[0].cid)===An)){Av=Ar[0];Ap=false;Au=Av.checksum;}}if(Av){At=Am.lftCongruencyCheck(Av,Am.message);if(At){if(!Am.fullView&&!Am.get("active")){Am.saveDraftAction(function(){try{Am.loadPaneContent(8,null,{force:Ap,checksum:Au},null);}catch(Aw){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3",Aw,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3");AB.use("common-utils-error",function(){AG.error.report(("loadpane convpanerefresherror "+As),Aw,1,1,1);});}});}else{if(!(As==="lmt"&&Am.currentLmtContext&&(Am.currentLmtContext.draftMID||(Am.currentLmtContext.newMsg&&(Am.currentLmtContext.newMsg.fid==="Draft"))))){Ao=Am.getRoot().one(O)||Am.getRoot().one(W);if(Ao){Ao.replace('<span class="badge" data-action="update">'+At+"</span>");}}Am.setRefreshTimer();}}}});Am.newMessageHandler=AB.on("newConvMessage",function(An){Am.composeAction=true;if(Am.get("active")){Am.initReplyForward(An.action,An.oMsg);}});Am.eventsBound=true;}function A(An,Am){var Y=true;if(An.totalMsgs>Am.totalMsgs){Y=false;return(An.totalMsgs-Am.totalMsgs);}else{return 0;}}function AD(Am,Aq,An){var Ap,Ao,Y={oldIdx:-1,newIdx:-1,remainder:true};Ap=Ao=0;while(Ap<Am.msgs.length||Ao<Aq.msgs.length){if(Ap<Am.msgs.length&&An.draftMID&&(AV(Am.msgs[Ap].mid)===AV(An.draftMID))){Y.oldIdx=Ap;Ap++;}else{if(Ao<Aq.msgs.length&&(AV(Aq.msgs[Ao].mid)===AV(An.newMsg.mid))){Y.newIdx=Ao;Ao++;}else{if((Ao<Aq.msgs.length&&Ap<Am.msgs.length)&&(AV(Am.msgs[Ap].mid)!==AV(Aq.msgs[Ao].mid))){Y.remainder=false;}Ap++,Ao++;}}}if(Ap!==Am.msgs.length||Ao!==Aq.msgs.length){Y.remainder=false;}return Y;}function Ab(){var Am=this,Y=Am.listNode;Y.all(".super-hidden").removeClass("super-hidden");Y.one(".supercollapsed")&&Y.one(".supercollapsed").remove();}function u(An){var A1=this,Au,Ax=An||A1.message,Av=Ax.totalMsgs,Ap,Aq="",At,Aw,Ao,A4,Y,As,Az=AB.one("#inboxcontainer"),Ar=Az.hasClass("prevPaneVisible")&&!Az.hasClass("offscreen"),Am=[],A3;A1.composeWidgets=[];for(Au=0;Au<Av;Au++){var A0=Ax.msgs[Au];if(A0&&A0.fid==="Draft"){Am.push(Au);}}for(Au=0;Au<Am.length;Au++){A3=Am[Au];At=Ax.msgs[A3];A4=true;if(!At.oMsgMid){var Ay=A1.getMessageIdxByMid(At.mid);if(Ay>0){for(var A2=Ay-1;A2>=0;A2--){if(At.inReplyTo===Ax.msgs[A2].mimeMsgId){At.oMsgMid=Ax.msgs[A2].mid;break;}}}}Aw=At;Ap=A1.getMsgNodeByMid(At.mid);if(!At.oMsgMid){Ao=At;Y=A1.getMsgNodeByMid(A1.message.msgs[Av-1].mid);}else{Ao=A1.message.msgs[A1.getMessageIdxByMid(At.oMsgMid)];Y=A1.getMsgNodeByMid(At.oMsgMid);}if(Ap&&(A3!==Av-1)){Ap.remove();Ap=null;}if(A3===A1.message.msgs.length-1&&A1.quickReplyBox){A1.quickReplyBox.hide();}if(Av>=V){Aq=(A3!==0&&A3!==Av-1&&Y.hasClass("super-hidden")&&A1.fid!=="Draft")?"super-hidden":"";if(A3===Av-1){Y=A1.listNode.one(".supercollapsed")?A1.listNode.one(".supercollapsed"):Y;}}if(((A1.fid==="Draft"&&A3===Am[Am.length-1])||A3===Av-1)&&!Ar){A4=false;}if(At.cookedHeader&&At.cookedHeader.subject&&At.oMsgMid){As=false;}else{As=true;}A1.initializeCompose({action:"edit",fid:A1.getMsgFid(At),oMsg:At,parentMsg:Ao,showSubject:As},Y,true,A4,Aq);Ap&&Ap.remove();}if(A1.fid==="Draft"&&A1.parentCW.msgList&&!At.oMsgMid&&Av===1){A1.subjectHandle=AB.one("#subject-field").on("valueChange",A1.updateSubject);}}function AE(Ao,Y,Av,A2,Aq){var Ax=this,Ap,As,Ay,A6,A1,Aw,A0,Az=(typeof Av!=="undefined")?Av:false,Au=Ao&&(Ao.action==="forward"),Ar=Ao&&Ao.showSubject,At,An=(typeof Aq!=="undefined")?Aq:"",A5=(typeof A2!=="undefined")?A2:false,A4=AV(Ao.parentMsg.mid),Am="",A3="quickReply";Ax.dirty=true;Ap=Ax.composeWidgets[A4];if(!Az&&Ap){A6=Ap.cv.cdo.get("origin");Ay=A6.action;if(Ay!==Ao.action){Ap.cv.composeView.header.switchReplyMode(Ao.action);}else{Ap.cv.composeView.setFocus("body");}if(!Ax.activeComposeWidget){Ax.activeComposeWidget=Ap;}else{Ax.setActiveCompose(Ap.cv.composeView);}}else{if(Az){As=" loadhide active";Am=' data-mid = "'+AV(Ao.oMsg.mid)+'"';}else{As=" active";Am="";}if(!Y){Y=Ax.getMsgNodeByMid(Ax.message.msgs[Ax.message.msgs.length-1].mid);}Y.insert('<div class = "thread-item '+A3+" expanded"+As+" "+An+'" '+Am+' tabIndex="-1" data-draftmid="'+A4+'"></div>',"after");At=Y.next();A1={isQuickReply:true,noFocus:A5,containerNode:Ax.listNode,showSubject:Ar,maxHeightFn:function(){return Ax.listNode.get("offsetHeight")-20;}};Aw={"closeAction":function(){A0.composeView.closeCompose();delete Ax.composeWidgets[A4];if(Ax.activeComposeWidget&&(Ax.activeComposeWidget.cv===A0)){Ax.activeComposeWidget=null;}AB.fire("draftCardRemoved");At.remove(true);if(Ax.message&&Ax.message.msgs.length>0&&Ax.message.msgs[Ax.message.msgs.length-1].fid!=="Draft"&&Ax.quickReplyBox){Ax.quickReplyBox.show();Ax.quickReplyBox.removeClass("loadhide");}},"bindComplete":function(A7){if(Au){Ax.expandReplyCard(At,A7.ccv.composeView);}},"updateTitle":function(A7){if(Ax.fullView&&Ax.parentCW){if(A7.sending){Ax.parentCW.tab.elTab.addClass("sending");}else{Ax.parentCW.tab.elTab.removeClass("sending");Ax.setTitle();}}},"showDeleteDraftDialog":function(A7){A7&&A7.sdcbk(false);},"qrCancel":function(){if(!NeoConfig.previewPanePref){var A7=Ax.selNode.ancestor("body");A7.all(".infp-arrow").removeClass("hidden");}A0.composeView.cancelCompose();},"switchToTab":function(){if(Ax.parentCW&&Ax.parentCW.tab!==AB.mail.Tabs.getActiveTab()){AB.mail.Tabs.switchToTab(Ax.parentCW.tab);}},"darlaEvent":function(A7){A7.action=A7.type;Ax.fire("darlaEvent",A7);}};AB.use("mail-ui-composeview-compose-loader",function(){var A7={};var A8=new AB.mail.ui.Compose.ComposeLoader(A7);A0=A8.create_conv_compose_view(Ao,Az,At,A1,Aw);Ax.composeWidgets[A4]={cv:A0};});}}function e(Ap,Ar){var As=this,An,Am,Ao,Aq,Y;if(Ar){An=As.getMessageIdxByMid(Ar.mid);Am=As.getMsgNodeByMid(Ar.mid);if(!Am){return;}if(Ap==="forward"){Ao=true;}else{Ao=false;}if(An===As.message.msgs.length-1&&As.quickReplyBox){As.quickReplyBox.hide();
}As.initializeCompose({action:Ap,fid:As.getMsgFid(Ar),oMsg:Ar,parentMsg:Ar,showSubject:Ao},Am);Y=Am.ancestor("body");Aq=Y.one(".quickReply.expanded");Aq?Y.all(".infp-arrow").addClass("hidden"):"";AB.fire("draftCardAdded");}}function d(Ao,Aq,Y){var Ar=this,Ap=Ar.getMsgFid(Aq),An=Ao.target;Ao.preventDefault();function Am(Au){var At;if(Au.dataAction==="conv-help"){return;}if(NeoConfig.hasConvRefactor){if(Au.dataAction==="reply_sender"||Au.dataAction==="forward"){Ar.initReplyForward(Au.dataAction,Aq);return;}}var As={action:Au.dataAction,context:"msg",id:(Y?Y.get("id"):0),forwardAsAttachment:0,fid:Ap,item:Au.item,hasMsgList:false,tbAction:false};AB.mail.ui.MessageEvents.handleUI(As,Ap,null,[Aq?Aq:null]);At=Au.dataAction+"_thrd_msg";At&&AB.fire("mt:click",{action:At,append:{t1:"thrdRdTb"}});}AB.use("common-ui-menu-helper",function(Av){var Au=Av.common.ui.MenuHelper,At=An.ancestor("div"),As=At.one(".card-actions-menu");As.addClass("pressed");Av.use("mail-ui-inboxmenu-base","mail-ui-messageevents",function(Aw){Aw.mail.ui.InboxMenu.insert("menu-bubble-actions",function(){var Ax=Aw.one("#menu-bubble-actions");Au.create(As,{menu:Ax,flushLeft:false,isContext:false,xy:[Ao.clientX,Ao.clientY],blur:true},function(){Ax.on("menuSelected",Am);Ax.after("menu:state",function(Az){var Ay=Az.state;if(Ay==="hide"){As.removeClass("pressed");As.unplug(Aw.Plugin.Menu);this.destroy(true);}});});},Ap,{fid:Ap});});});}function E(A1,A4,Az,Au,Ax,Av,Ap){var Ay=this,An,A2,At,Aw,Aq,Y,Ao,Am=Ay.message,As=null,A0,Ar=Ax&&Ax.no_scroll_to_msg?true:false,A3=Ax&&Ax.no_focus?true:false;Ay.messageFound=0;Av&&Av.start(2,"LoadMessageCard");At=new AG.Stopwatch("LoadMessageCard");As=AB.later(500,Ay,function(){Ay.loadExtra(function(){if(!Ay.messageFound){for(A0=0;A0<A4.length;A0++){Ao=Ay.getMsgNodeByMid(Am.msgs[A4[A0]].mid);if(Ao){if(!Ao.hasClass("expanded")){Ao.addClass("loading");}}}}},1);});Aw={success:function(BC,A5){AB.fire("MessagePane:loadMessageSuccessStart",BC);var BD=(Aw&&Aw.respProps&&Aw.respProps.wasCached)?true:false,A6=Aw&&Aw.respProps&&Aw.respProps.callPerf,BB,BA=0,A9=0,A7,A8=new Date();if(Av){Av.start(1,"GDMFetchEnd");Av.YCMSGGetEnd2=A8;Av.wasCached2=BD;Av.BECallTime2=A6;}if(At){At.wasCached=BD;At.YCMSGGetEnd=A8;At.BECallTime=A6;At.stop();}if(!Ay.isConvActive(Am.cid)){return;}for(A9=0;A9<A4.length;A9++){A7=A4[A9];if(Ay.message.msgs&&Ay.message.msgs[A7]){if(!Ay.message.msgs[A7].flags||!Ay.message.msgs[A7].header){Ay.message.msgs[A7]=k.Messages.toMessage(Ay.getMsgFid(Ay.message.msgs[A7]),Ay.message.msgs[A7]);}if(BC[BA]){BC[BA].header.snippet=Ay.message.msgs[A7].header.snippet;BC[BA].fid=Ay.getMsgFid(Ay.message.msgs[A7]);Ay.message.msgs[A7]=BC[BA];An=Q.getQueryParams(BC[BA],"midRequest");BC[BA].blockImages=An&&An.blockImages;BB=Ay.midObjMap[AV(BC[BA].mid)];r.extractQuotedText(BC[BA],AF.quoted_text_collapse,AF.quoted_text_expand,z,BB);}}BA++;}Ay.showMessages(A1,BC,false,Az,Av,Ar,false,A3);if(A5&&A5.length&&(Ap==="one"||Ap==="all")){Ay.showNotification(A1,A5);}Ay.messageFound=1;if(As){As.cancel();for(BA=0;BA<A4.length;BA++){Ao=Ay.getMsgNodeByMid(Am.msgs[A4[BA]].mid);Ao.removeClass("loading");}}if(!A3){Ay.focusMessageCard();}},failure:function(A5){Ay.loadExtra(function(){var A7=Am.msgs[A1];var A6=Ay.getMsgNodeByMid(A7);A5.data=A7;A7.body={};A7.body.display=Ay.onMsgFailure.apply(Ay,[A5,false]);Av&&Av.stop(Ay.fullView?"MsgInTabFailure":"MsgInPreviewFailure");Ay.showMessage(A7,0,A6,false,Az);},1);Ay.messageFound=1;Ay.primaryMid=null;if(As){As.cancel();for(A0=0;A0<A4.length;A0++){Ao=Ay.getMsgNodeByMid(Am.msgs[A4[A0]].mid);Ao.removeClass("loading");}}},errorPosition:401,suppressCodes:["*"]};Aq=[];for(A0=0;A0<A4.length;A0++){Aq.push(Am.msgs[A4[A0]]);}if(Aq.length===1&&Ay.message.msgs.length>1){Y=Ay.getMsgNodeByMid(Aq[0].mid);if(!Ax&&Ay.getMsgFid(Aq[0])!=="Draft"&&Y.one(".thread-body .body").get("children").size()>0){Ay.messageFound=1;Ay.showMessage(Aq[0],A4[0],Y,false,"yes");Ay.listNode.all(".loadhide").removeClass("loadhide");Ay.getRoot()&&Ay.getRoot().one(".conv-loading").addClass("hidden");return;}}AB.fire("MessagePane:loadMessageCardsStart",Ay.message,Aq);A2=Ay.requestAllMessages(Aq,Ay.message.fid,Aw,Ax,{stopwatch:Av,RSstopwatch:At});Ay.abortRequests();if(Ay.outboundReq){Ay.request=A2;Ay.requestType="loadcard";}}function o(Am){var Ap=this,Ao=Ap.getMessageIdxByMid(Am.mid),Y=Ap.getMsgNodeByMid(Am.mid),An=Ap.message.msgs[Ao];if(!AB.Lang.isValue(Ao)||!Y||!An){return false;}if(!Y.hasClass("expanded")){Ap.scrollOnExpansion=true;Ap.expandMessages(Ao,"one","yes",false);}else{Ap.scrollToMsg(An);}return true;}function H(Ap){var Aq=this,Am=Aq.getMsgNodeByMid(Ap.mid),Y=Aq.getMessageIdxByMid(Ap.mid),Ao,An;if(Y===0){Aq.listNode.set("scrollTop",0);}else{An=Am.get("offsetTop")-12;AB.use("anim",function(){var Ar=new AB.Anim({node:Aq.listNode,duration:Aq.fullView?0.2:0,to:{scroll:[0,An]}});Ar.run();Ar.on("end",function(){Ao=Aq.getMsgFid(Ap);Aq.markConvMsgAsRead(Ao,Ap);});});}Aq.scrollOnExpansion=false;}function f(Y,Am,An){var Ao=this;Ao.toggleAllMessageCards(Y,Am,An);}function Z(Am,An,Ao){var Ap=this,Y;Ap.expandSuperCollapsedNodes();Ap.lastExpandedMsgIdx=0;if(An==="expandall"){Ao.toggleState="expanded";Y=Ap.getMessageIdxByMid(Ap.message.msgs[0].mid);Ap.expandMessages(Y,"all",false,"no",false);Am&&Am.removeClass("thread-cards-collapsed");Am&&Am.addClass("thread-cards-expanded");Am.setAttribute("title",strings.str_collapse_all_attr);Am.one(".icon-text").setContent(strings.str_collapse_all);}else{Ao.toggleState="collapsed";Ap.collapseAllMessageCards();Am&&Am.removeClass("thread-cards-expanded");Am&&Am.addClass("thread-cards-collapsed");Am.setAttribute("title",strings.str_expand_all_attr);Am.one(".icon-text").setContent(strings.str_expand_all);}}function T(){var Am=this,Y=Am.lastExpandedMsgIdx;if(Am.message.msgs.length>Y){Am.fetchMoreTimer=setTimeout(function(){Am.expandMessages(Y,"all",false);},100);}else{Am.fetchMoreTimer=null;return;}}function p(A0,An,Ay,As,Aw,Au,Am){var Ax=this,Y=Ax.message,Aq,Ao,At=null,Ap=[],A1,Az=0,A2,Ar,A3,Av;switch(An){case"all":Ax.lastExpandedMsgIdx=Ax.lastExpandedMsgIdx?Ax.lastExpandedMsgIdx:0;
Am=false;A0=0;Az=0;for(Ax.lastExpandedMsgIdx;Ax.lastExpandedMsgIdx<Y.msgs.length;Ax.lastExpandedMsgIdx++){if(Az<AM){if(Ax.getMsgFid(Y.msgs[Ax.lastExpandedMsgIdx])==="Draft"){continue;}Ap.push(Ax.lastExpandedMsgIdx);Az++;}else{Ax.fetchMoreMsgs();break;}}Ax.scrollLoad=true;Ax.stopScrollLoad=true;Ax.expandAllMode=true;break;case"one":Ap.push(A0);Ax.stopScrollLoad=true;break;case"unread":case"other-unread":Ar=(An==="other-unread")?A0:0;Am=Am&&(An==="unread");Av=function(A4){Ax.expandMessages(A4+1,"other-unread",false,false,{no_scroll_to_msg:true,no_focus:true});};for(A1=Ar;A1<Y.msgs.length;A1++){if(Ax.getMsgFid(Y.msgs[A1])==="Draft"||(An==="other-unread"&&A1===0)){continue;}if(!Y.msgs[A1].flags.isRead){if(Az<AP){if(At===null&&An==="unread"){At=A1;A0=At;Ap.push(A1);A3=A1;Ax.fetchOther=AB.Lang.later(AO,Ax,Av,A3);break;}else{if(An==="other-unread"){Ap.push(A1);}}Az++;}else{break;}}}if(!Ap.length&&An!=="other-unread"){A0=Y.msgs.length-1;Ap.push(A0);}Ax.stopScrollLoad=true;break;case"adjacent":Aq=A0;(A0+Ac+1)>Y.msgs.length?Ao=Y.msgs.length:Ao=A0+Ac+1;for(Aq;Aq<Ao;Aq++){Ap.push(Aq);}Ax.stopScrollLoad=true;break;case"nfrombottom":A0=null;Az=0;for(A1=Y.msgs.length-1;A1>-1;A1--){if(Az<AP){if(Ax.getMsgFid(Y.msgs[A1])==="Draft"){continue;}if(!A0||!Y.msgs[A1].flags.isRead){A0=A1;}Ap.push(A1);Az++;}else{break;}}break;case"uptofirstread":A0=null;A2=false;if(Y.msgs.length<V){for(A1=Y.msgs.length-1;A1>-1;A1--){if(Ax.getMsgFid(Y.msgs[A1])==="Draft"){continue;}if(!Y.msgs[A1].flags.isRead){A0=A1;Ap.push(A1);if(Ap.length>AP){Ap.splice(0,1);}}else{if(Ap.length===0){Ap.push(A1);A0=A1;}break;}}}else{A0=Y.msgs.length-1;Ap.push(A0);}break;case"send":A0=null;for(A1=0;A1<Y.msgs.length;A1++){if(Ax.getMsgFid(Y.msgs[A1])==="Sent"){Ap.push(A1);A0=A1;}}break;case"draft":A0=null;Am=false;Ax.listNode.all(".loadhide").removeClass("loadhide");Ax.getRoot()&&Ax.getRoot().one(".conv-loading").addClass("hidden");break;case"scroll-up":case"scroll-down":Ap=A0.slice(0,AP);Am=false;Ax.showLoader=true;break;}Ax.selMsgIdx=A0;if(Am&&AB.Lang.isNumber(A0)){Ax.primaryMid=Ax.message.msgs[A0].mid;}Ax.loadMessageCards(A0,Ap,Ay,As,Aw,Au,An);}function Al(Am){var An=this,Y=parseInt(Am.getComputedStyle("height"),10);Am.setStyles({height:Y+"px",overflow:"hidden"});Am.transition({duration:0.2,marginTop:0,height:AC+"px"},function(){Am.setStyle("height","auto").removeClass("expanded");Am.one(".thread-footer")&&Am.one(".thread-footer").addClass("hidden");Am.one(".thread-body").setContent("");An.fire("darlaEvent",{action:An.fullView?"message_tabpane":"msgread_reading_pane"});An.fire("MessagePane:unload",Am);});}function D(As,Ar,Am,Aq,Av,At,Ap){var Az=this,Aw,An,A3=As.mid,A1=this.getMsgMarkUp(As,true,Aq),Y,A0=(Av!==false),Ao,Ax,Au;function Ay(A5,A4){Y=Az.getMsgFid(A5);if(A4.inRegion(Az.listNode)&&A4.hasClass("expanded")&&A4.hasClass("unread")){Az.markConvMsgAsRead(Y,A5);}}try{if(Am.hasClass("collapsing")||Am.hasClass("expanding")){return;}Am.replace(A1);Am=Az.getMsgNodeByMid(A3);Am.removeClass("loadhide");if(As.body){Am.one(".body").setContent(As.body.display);Ao=Ar>0?"5px":0;if(A0&&Az.initialRender){Aw=parseInt(Am.getComputedStyle("height"),10);Am.removeClass("expanded");An={duration:Az.fullView?0.2:0,height:Aw+"px"};if(Ao!==0){An.marginTop=Ao;}Am.transition(An,function(){var A4=Am.one(".thread-footer");this.addClass("expanded");if(!Ap){Az.scrollOnExpansion&&Az.scrollToMsg(As);}Ay(As,Am);Am.setStyles({height:"auto",overflow:"visible"});A4&&A4.removeClass("hidden");Az.fire("darlaEvent",{action:Az.fullView?"message_tabpane":"msgread_reading_pane"});});}else{Am.setStyle("marginTop",Ao);Am.one(".thread-footer")&&Am.one(".thread-footer").removeClass("hidden");}if(m.plainTextMessage(As.part)){if((Ax=Am.one(".thread-body .body"))!==null){Ax.setStyle("font-family","monospace");}}Am.removeClass("loading");}if(!As.loading_error){Az.convMsgRenderComplete(As,Am,At);}Au=Az.expandMessageTimers[AV(As.mid)];Au&&Au.cancel();AB.fire("MessagePane:messageExpandDone",{mid:As.mid,cid:Az.message.cid});return Am;}catch(A2){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4",A2,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4");}}function AY(An,Ap){var Am,Aq,Ao=Ap||[],Y,Ar=this;for(Am=0;Am<Ao.length;Am++){Aq=Ao[Am];Y=Ar.getMsgNodeByMid(Aq.mid);if(Y){Y.addClass("load-error");Y.one(".load-error-msg").setContent(Aq.msgPermDeleted?strings.str_msg_deleted_error:strings.str_msg_load_error_generic);}}}function w(Ax,A0,As,Ar,Ao,Av,A1,At){var Aw=this,Au=0,Ap,Az,An,Am,Aq=this.getRoot(),Y=(Av!==false);function Ay(){var A3,A2,A4;A2=AB.Lang.isArray(Ax)?Ax[0]:Ax;A3=Aw.getMsgNodeByMid(Aw.message.msgs[A2].mid);if(!Aw.expandAllMode){if(!At){Aw.selNode=A3;}if(!Y){A4=A3;setTimeout(function(){Aw.listNode&&Aw.listNode.all(".loadhide").removeClass("loadhide");if(A2>0){Aw.listNode&&Aw.listNode.set("scrollTop",A4.get("offsetTop")-12);}if(Aq.one(".conv-loading")){Aq.one(".conv-loading").addClass("hidden");}},0);}}else{Aw.selNode=null;}}Ao&&Ao.start(1,"MessageInDOM");for(Au=0;Au<A0.length;Au++){Ap=A0[Au];Az=Aw.getMessageIdxByMid(Ap.mid);An=Aw.getMsgNodeByMid(Ap.mid);if(A1){if(!An.hasClass("expanded")){An.addClass("expanded");}Aw.convMsgRenderComplete(Ap,An,Ao);}else{if(Ap.fid!=="Draft"){Aw.showMessage(Ap,Az,An,As,Ar,Ao,Y);}}}if(A1){Aq.all(".loadhide").removeClass("loadhide");Aq.one(".conv-loading").addClass("hidden");An.one(".thread-footer")&&An.one(".thread-footer").removeClass("hidden");}Aw.initialRender=true;if(Ao){Aw.fire("renderConvComplete");if(NeoConfig.hasConvView){setTimeout(function(){AB.fire("tutorConvMsgPaneRendered");},200);}}Au=Aw.primaryMid?1:0;Am=function(){var A2=new AG.Stopwatch(Aw.fullView?"MsgInTab":"MsgInPreview");A2.wasCached=true;A2.stop();};for(;Au<A0.length;Au++){setTimeout(Am,(Au+1)*250);}Aw.primaryMid=null;if(Aw.parentNode&&Aw.parentNode.ancestor("body")){Ay();setTimeout(function(){Aw.checkMsgCardsOnScroll(Aw.getAllCards());},300);}else{Aw.once("activeChange",function(){Ay();
setTimeout(function(){Aw.checkMsgCardsOnScroll(Aw.getAllCards());},300);});}}function Aj(){var Y=this;if(!Y.listNode){return null;}return Y.listNode.all("."+AQ);}function v(Am,Y){if(Y.scrollFocus){this.listNode.set("scrollTop",Am.get("offsetTop")-5);}}function s(Ao,An){var Ap=this,Y=AV(Ao.mid),Am=Ap.getMsgMarkUp(Ao,false,false,true);delete Ap.composeWidgets[Y];An.one(".thread-reply").replace(Am);}function AJ(An,Y){var Ao=this,Am={truncateAt:null};Ao.disableTruncate=1;Ao.expandMessages(Y,"one","yes",false,Am);}function Ag(An,Y){var Ao=this,Am={midRequest:{blockImages:"none"}};Ao.expandMessages(Y,"one","yes",false,Am);}function M(An,Am,Y){var Ap=this,Ao=Ap.message;if(!Am){Ao.body=Ao.attachments=Ao.imgAttachments=Ao.nonImgAttachments=0;}Ap.loadMessage(1,An,Y);}function I(){var Am=this,Y=Am.loading_slow?2:1;Am.loading_slow=Am.loading_error=Am.loading_moved=0;if(Y>0&&Y<=6){Am.numRetries=Am.numRetries?(Am.numRetries+1):1;if(Am.numRetries>=Am.maxRetries){AK.stat("messageread","maxRetry");}}Am.loading_slow=Am.loading_error=Am.loading_moved=0;Am.fireEvent("retry");Am.loadPaneContent(6,Y);Am.set("transferFocus",1);}function Ae(Ap,An){var Ar=this,Aq=Ap||[],Y,Am,Ao=Aq.length;for(Am=0;Am<Ao;Am++){if(!Y){Y=Af.batch();}Y.setAsReadOp(true);Ah.batchAddConvPrefetch(Y,Am,Ar.fid,Aq[Am],An);}Y&&Y.execute({suppressCodes:["*"],backgroundLogs:["*"]});}function AU(){var Am=this,Y;if(!NeoConfig.backButtonFull&&Am.fullView===true){AB.fire("initPage");}if(Am.quickReplyBox){Am.quickReplyBox.one("#switchtext-plain").addClass("hidden");Am.quickReplyBox.one("#switchtext-rich").removeClass("hidden");}if(NeoConfig.hasConvPerf&&!(Am.fid==="%40B%40Bulk"||Am.fid==="Trash")&&!Am.midtocid){setTimeout(function(){Am.prefetch(Am.neighbors,"Neighbors");},Math.min(AO+50,B));}if(Am.fullView){Y="thread_tabpane";}else{Y="msgread_reading_pane";}AB.fire("mt:view",{action:Y});}function Ad(){}function C(Ap,Y){var As=this,Ao,Av,Am,Ar,At,Aq,Aw,An,Au;Ao=Ap.msg;Am=Ap.replace||0;if(As.message){Av=(Ap.pos!==undefined)?Ap.pos:As.message.msgs.length;Aq=Ao.fid;if(!Ao.header){Ao=k.Messages.toMessage(Aq,Ao);}As.message.msgs.splice(Av,Am,Ao);As.message.midMap.splice(Av,Am,{fid:Ao.fid,mid:Ao.mid});As.message=AA.Conversations.calcConvSummary(As.message);Au=As.message.msgs;At=Au.length;for(Ar=0;Ar<At;Ar++){An=AV(Au[Ar].mid);As.midObjMap[An]=Ar;}if(Y){Aw=As.getMsgMarkUp(Ao,false);As.quickReplyBox?As.listNode.insertBefore(Aw,As.quickReplyBox):As.listNode.append(Aw);As.expandMessages(As.message.msgs.length-1,"one","yes");}As.updateCount();}}function AX(){var Ao=this,An,Am=Ao.message.totalMsgs,Y=Ao.getRoot().one(O);if(Y){if(Am>1){An="("+Am+")";}else{An="";}Y.set("innerHTML",An);}}function i(){var Am=AB.one("#subject-field"),Y=AB.one(X+" .thread-subject");if(Am.get("value")!==""){Y.set("innerHTML",Am.get("value"));Y.set("title",Am.get("value"));}else{Y.set("innerHTML",strings["str_msg-view_no_subject"]);Y.set("title",strings["str_msg-view_no_subject"]);}}AB.extend(P,n.ui.MailPaneRead,{setFullFormatters:AW,onSuccess:g,bindPaneContent:y,retryLoad:I,unblockImages:Ag,viewFullMsg:AJ,changeRequest:M,searchRecipients:Ad,postRender:AU,prefetch:Ae,getMsgMarkUp:S,selectMessage:o,scrollToMsg:H,expandMessages:p,collapseMessage:Al,loadMessageCards:E,showMessage:D,showMessages:w,showNotification:AY,setActiveCompose:h,saveDrafts:j,closeReply:s,insertMsgAtPos:C,loadMenu:d,expandReplyCard:v,toggleAllMessageCards:Z,handleToggleAllMessageCards:f,lftCongruencyCheck:A,lftSendSaveCongruencyCheck:AD,expandSuperCollapsedNodes:Ab,initializeCompose:AE,initializeAllDrafts:u,initReplyForward:e,updateCount:AX,updateSubject:i,closeAllCompose:R,markConvMsgAsRead:AR,convMsgRenderComplete:q,bindContentUI:AL,fetchMoreMsgs:T,checkMsgCardsOnScroll:AI,checkAdsOnScroll:AT,onPaneScroll:Aa,getAllCards:Aj,markAsReadBatch:l,getInboxService:N});AB.mix(G.prototype,P.prototype);AB.mix(G.prototype,n.ui.MailPaneRead.prototype);},"1.0.0",{requires:["mail-ui-composeview-conv","common-persist-user-data","mail-persist-meta-data","mail-ui-convpane-base","mail-ui-messagepane-warnings","_shared_module_thread_thread_display_rollup","mail-ui-mailpane-read","contacts-api","contacts-api-utils","common-utils-stats","mail-ui-messagepane-utils","mail-ui-convpane-bind","mod-conversation-history_css","mail-ui-common-fonts","common-ui-tabs-base","transition"]});YUI.add("mail-ui-log",function(D){var E=15*1000,L=D.common.Utils,C=L.ymmastats,N=200,F=1000;function M(R){R=R||{};this._sessionLogger=D.comms.log4js.getLogger("_sessionLogger",1,"ajax",{jsonReq:true});this._logger=[];this._logTimer={};this.FLUSH_LIMIT=R.FLUSH_LIMIT||N;this.LOG_LIMIT=R.LOG_LIMIT||F;this.events=R.events||{};}function G(){var R=this;D.each(R.events,function(S,T){D.on(T,function(){try{S.apply(R,arguments);}catch(U){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-debug-maillog:1",U,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-debug-maillog:1");R.add({m:"Logger Exception"},1,"JSException");}});});}function Q(R){var S=new Date();if(this._logger.length===this.LOG_LIMIT){this._logger.shift();}this._logger.push(D.JSON.stringify({t:S.toTimeString().substr(0,8)+":"+S.getMilliseconds(),d:R}));}function I(R,S){var T=this;T._logTimer[R.key]&&T._logTimer[R.key].cancel();T._logTimer[R.key]=D.later(R.time||E,R.context,function(){var U=false;if(R.onTimeout){U=!R.onTimeout.apply(R.context||null);}if(!U){T.add(R.data);C.stat("TimeoutError","reason=>"+R.key.split(":")[0]);T.flush(R.key);}S&&S.detach();});}function K(){this._logger=[];}function J(){var R=window.open("","","width=650,height=700,resizable"),S=R.document;S.open();S.write("<html>"+"<body>"+'<div id = "reason"></div>'+'<div id = "extraInfo"></div>'+'<div id = "logs"></div>'+"</body>"+"</html>");return R;}function B(){var S=this._prepareLog("Console Print"),V,T="getElementById",U,R="";if(!(this.logW&&this.logW.opener&&!this.logW.opener.closed)){this.logW=this._createUI();}V=this.logW.document;V[T]("reason").innerHTML=S.reason;V[T]("extraInfo").innerHTML=D.JSON.stringify(S.info);for(U=0;U<S.logs.length;U++){R+="<div>"+S.logs[U]+"</div>";}V[T]("logs").innerHTML=R;}function H(){var R={tid:NeoConfig.loginId+L.rand(1000000),yid:NeoConfig.loginId,browser:NeoConfig.browser,build:NeoConfig.buildNumber,url:location.toString(),hasConv:NeoConfig.hasConvView,mailplus:NeoConfig.isMailPlus.toString(),bucket:NeoConfig.expBucketId};return R;}function O(R){R=R||"MailLog";this._sessionLogger.log(D.JSON.stringify(this._prepareLog(R,this.FLUSH_LIMIT)));}function A(R){var T=this;var S=D.on(R.event,function(){if(R.condition.apply(R.context||null,arguments)){T._logTimer[R.key]&&T._logTimer[R.key].cancel();S.detach();}});T._addTimer(R,S);}function P(W,S){var U,T=[],V,X,R=this._logger.length;if(!S){X=0;}else{X=R-S;if(X<0){X=0;}}for(U=X;U<R;U++){T.push(this._logger[U]);}V={reason:W,info:this._getExtraLogInfo(),logs:T};return V;}D.mix(M.prototype,{flush:O,print:B,bindEvents:G,add:Q,addFlow:A,reset:K,_createUI:J,_addTimer:I,_getExtraLogInfo:H,_prepareLog:P});D.namespace("mail.ui").MailLog=M;},"1.0.0",{requires:["ymma-stats","comms-log4js","common-utils"]});YUI.add("mail-ui-log-events",function(B){var J=B.mail.ui.MailLog;function S(X,V,W){this.add(X);if(V&&W){this.flush(W);}}function P(){this.print();}function I(X,V){var W=[];B.each(V,function(Y){W.push(Y.mid);});this.add({m:"Load Message Cards Start",cid:X.cid,fid:X.fid,mids:W.join(", ")});}function F(W){var X=this,V;if(!W){return;}V={m:"Mail open",fid:W.fid,subject:W.message.subject};if(W.message.cid){V.cid=W.message.cid;}else{V.mid=W.message.mid;}X.add(V);if(NeoConfig.hasConv&&W.message.cid!==""){X.addFlow({event:"MessagePane:rendered",key:"mailOpenFail:"+V.cid,condition:function(Y,Z){X.add({m:"MessagePane rendered",fid:Z.fid,subject:Z.subject,cid:Z.cid});return Z.cid===V.cid;},data:{m:"TimeoutError: Mail open failed for "+V.cid+":"+V.subject}});}}function L(W){var X=this,V=W.mid;X.add({m:"Expand Click Start",mid:W.mid});X.addFlow({event:"MessagePane:messageExpandDone",key:"msgExpandFail"+V,time:5000,condition:function(Y){return V===Y.mid;},data:{m:"TimeoutError: Expand message failed"}});}function N(W){var V=[];B.each(W,function(X){V.push(X.mid);});this.add({m:"Load Message Success Start",mids:V.join(", ")});}function E(W){var V=[];B.each(W,function(X){V.push(X.mid);});this.add({m:"Message Controller getMultipleMessages",mids:V.join(", ")});}function G(W){var V=[];B.each(W,function(X){V.push(X.mid);});this.add({m:"Message Controller getMultipleMessagesSuccess",mids:V.join(", ")});}function H(X,W,V){this.add({m:"Set pending request variable",pending:X,reason:W});if(X===1){this.addFlow({event:"BaseController:pending",key:"pendingReq",time:31*1000,condition:function(Y){return Y?false:true;},data:{m:"TimeoutError: Pending is still set to 1 after 31 seconds"}});}}function K(Y,Z,X){var a=[],V=[],W;for(W=0;W<Y.length;W++){a.push(Y[W].method);}if(Z){for(W=0;W<X.length;W++){if(X[W].method){V.push(X[W].method);}}this.add({m:"Not executing batch request",methods:a.join(", "),waitingMethods:V});}else{this.add({m:"Executing batch request",methods:a.join(", ")});}}function U(V,Z){var Y=this,X=V.cid,W;if(V.totalUnread!==Z.totalUnread&&(V.totalUnread===0||Z.totalUnread===0)){if(V.totalUnread===0){Y.add({m:"Conversation changing state from read to unread in ConvStore",cid:X});W=false;}else{if(Z.totalUnread===0){Y.add({m:"Conversation changing state from unread to read in ConvStore",cid:X});W=true;}}Y.addFlow({event:"MessagePane:markConvRead",key:"markConvReadInPane:"+X,condition:function(b,a){Y.add({m:"Conversation getting marked as "+(a?"Read":"Unread")+" in the ConvPane UI",cid:b.cid});return b.cid===X&&a===W;},onTimeout:function(){var a=B.mail.model.ConvStore.Conversations.getPermCidPart,d=a(X),b,e,c=B.mail.Tabs.iterateTabs(function(f){if(f.widgetType==="convlist"||f.widgetType==="convpane"){if(f.widget&&f.widget.msgPane&&f.widget.msgPane.message){b=f.widget.msgPane.message.cid;e=a(b);if(X===b||X===e||d===b||d===e){return true;}}}});return c?true:false;},time:1000,data:{m:"TimeoutError: Conversation couldn't get marked as "+(W?"Read":"Unread")+" in the ConvPane UI",cid:X}});Y.addFlow({event:"listview:itemUpdate",key:"markConvReadInList:"+X,condition:function(b,a){var c=b.one(".list-view-item").hasClass("unread")?false:true;Y.add({m:"Conversation getting marked as "+(c?"read":"unread")+" in ConvList UI",cid:X});return a.cid===X&&c===W;},time:1000,data:{m:"TimeoutError: Conversation couldn't get marked as "+(W?"Read":"Unread")+" in the ConvList UI",cid:X}});}}function A(W,X,V){if(V.indexOf("appid=YahooMailNeo")>-1&&V.indexOf("SetMetaData")==-1){this.add({m:"Request Sent",url:V,post:W.request.postdata});}}function R(a,Y,V){var Z=this,W,X;X=D(a);W={m:"Initiating delete action",fid:Y};W[NeoConfig.hasConv?"cids":"mids"]=X.join(", ");this.add(W);if(NeoConfig.hasConv){Z.addFlow({event:"convops:movecbk",key:"removeMailFail:"+X[0],condition:function(b){X=X.sort();b=b.sort();return(X.join(",")===b.join(","));},time:30000,data:{m:"TimeoutError: Mail couldn't be deleted",ids:X.join(", ")}});}}function C(Y,W){var V,X=[];B.each(W,function(Z){X.push(M(Y[Z]));});V={m:"Removing mails from listmodel"};V[NeoConfig.hasConv?"cids":"mids"]=X.join(", ");this.add(V);}function O(V){this.add({m:"Finished syncing listview",syncReason:V});}function Q(X,W){var Y=M(W),V;V={m:"Updating single item in the list",subject:W.subject};V[NeoConfig.hasConv?"cid":"mid"]=Y;this.add(V);}function D(W){var V=[];B.each(W,function(X){V.push(M(X));});return V;}function M(V){return NeoConfig.hasConv?V.cid:V.mid;}var T=new J({events:{"MailLog":S,"printLog":P,"MessagePane:inception":F,"MessagePane:expandClick":L,"MessagePane:loadMessageCardsStart":I,"MessagePane:loadMessageSuccessStart":N,"MessageController:getMultipleMessages":E,"MessageController:getMultipleMessagesSuccess":G,"BaseController:pending":H,"BaseController:execute":K,"ConvStore:calcConvSummary":U,"net:start":A,"mailEvents:removeMails":R,"listmodel:remove":C,"listview:sync":O,"listview:itemUpdate":Q}});T.bindEvents();},"1.0.0",{requires:["mail-ui-log"]});YUI.add("mail-common-cachewarmer",function(B){B.namespace("mail.common.cachewarmer");var H=5000,L=3000,A=10,J=NeoConfig.pfm,N=50,D=B.Env._loader,K={isIdle:function(){return true;}},M=B.common.net.Session||K,I={},E=B.on("ds:msg:remove",function(Q,P){if(Q==="Inbox"){for(var O in P){I[P[O].mid]=true;}}}),G={},C=B.on("ds:conv:remove",function(Q,P){if(Q==="Inbox"){for(var O in P){G[P[O].cid]=true;}}});var F=function(O){try{return function(){this.queue[O].apply(this.queue,arguments);};}catch(P){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-common-cachewarmer:1",P,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-common-cachewarmer:1");}return false;};B.mail.common.cachewarmer={queue:(function(){var O=new B.AsyncQueue();O.defaults.timeout=N;return O;})(),add:function(){this.queue.add.apply(this.queue,arguments);return this;},run:function(){this.queue.add(this.queue.stop);this.queue.run();return this;},clear:function(){this.queue.stop();B.detach("cachewarmer:stopMessagePrefetch");},warmUp:function(Q,R,P,O){P&&this.addDelay(P);!O&&this.addIdleCheck();if(B.Lang.isArray(R)&&R.length){this.queue.add({fn:function(){B.use.apply(B,R);},timeout:10,id:Q});return this;}return false;},addDelay:function(O){if(O){this.queue.add({fn:function(){},timeout:O});return true;}return false;},addIdleCheck:function(Q){var O=0,P=this.queue;Q=Q||A;P.add({fn:function(){O++;},timeout:400,until:function(){return(M.isIdle()&&(!D||!D._loading))||(O===Q&&P.stop());}});return true;},setupLaunch:function(O){this.addDelay(O?L:H);this.addIdleCheck();return true;},preFetchMessages:function(R,Q,P,O){if(NeoConfig.hasConv){return;}this.clear();P&&this.addDelay(P);(R==="Inbox"&&!Q)?this.addInboxPreFetching():this._preFetchMessages(R,Q,O);return this.run();},addInboxPreFetching:function(){var O=this;if(NeoConfig.hasConv&&NeoConfig.hasConvPerf){O._preFetchConvs("Inbox",B.mail.ui.ConvList.getConvHdrList(),null,true);}else{if(!NeoConfig.hasConv){O._preFetchMessages("Inbox",B.mail.ui.MessageList.getMsgHdrList(),null,true);}}},_preFetchConvs:function(P,d,O,b){function R(e,h,g){var f=function(){var k=[],j;for(j in e){if(!G[e[j].cid]){k.push(e[j]);}}if(k.length>0){V=B.mail.Controller.batch();V.setAsReadOp(true);for(j=0;j<k.length;j++){if(!B.mail.model.ConvStore.Conversations.isCached(P,k[j].cid)){B.mail.Controller.Conversations.batchAddConvPrefetch(V,j,P,k[j],"CacheWarmer");}}V.execute({suppressCodes:["*"],backgroundLogs:["*"]});}else{}if(h){B.detach(g);}};this.timeout=100;this.id="convsPrefetch";this.fn=f;}var U,Q,X=[],V,Y,c,T,S=J.batch.split(","),W=J.count,a=J.maxSize,Z=B.mail.ui.ConvList;if(O&&O[0]){X=O;}else{Z&&d&&Z.getNeighbors(d,-1,X,P,W,a);}while((T=S.shift()||10)&&(c=X.splice(0,T))&&(Q=c.length)){Y=[];for(U=0;U<Q;U++){Y.push(c[U]);}this.addIdleCheck();this.queue.add(new R(Y,b,C));}B.once("cachewarmer:stopMessagePrefetch",function(e){var f=["convsPrefetch"];this.queue.remove("convsPrefetch");this.clear();if(!B.Lang.isUndefined(e)&&B.Lang.isFunction(e.done)){if(!B.Lang.isUndefined(e.data)){f.push(e.data);}e.done.apply(this,f);}},this);this.queue.on("complete",function(){B.detach("cachewarmer:stopMessagePrefetch");});return true;},_preFetchMessages:function(O,Y,V,b){function Q(d,g,f){var e=function(){var j=[];for(var h in d){if(!I[d[h].mid]){j.push(d[h]);}}if(j.length>0){B.mail.Controller.Messages.get({fid:O,prefetch:j,cachekey:"CacheWarmer"},{suppressCodes:["*"],backgroundLogs:["*"]});}else{}if(g){B.detach(f);}};this.timeout=10;this.id="messagePrefetch";this.fn=e;}if(!J||NeoConfig.hasConv){return false;}if(NeoConfig.grid){J.batch="6,6";J.count=12;}var U,P,X=[],Z,c,T,S=J.batch.split(","),W=J.count,a=J.maxSize,R=B.mail.ui.MessageList;if(V&&V[0]){X=V;}else{R&&Y&&R.getNeighbors(Y,-1,X,O,W,a);}while((T=S.shift()||10)&&(c=X.splice(0,T))&&(P=c.length)){Z=[];for(U=0;U<P;U++){Z.push(c[U]);}this.addIdleCheck();this.queue.add(new Q(Z,b,E));}B.once("cachewarmer:stopMessagePrefetch",function(d){var e=["messagePrefetch"];this.queue.remove("messagePrefetch");this.clear();if(!B.Lang.isUndefined(d)&&B.Lang.isFunction(d.done)){if(!B.Lang.isUndefined(d.data)){e.push(d.data);}d.done.apply(this,e);}},this);this.queue.on("complete",function(){B.detach("cachewarmer:stopMessagePrefetch");});return true;},addCompose:function(P,O,Q){this.warmUp("compose",Q,P,O);},prefetchNextRelease:function(O,Q){var S=this,R=Q||3000,V,P=yui,T=1,U,W={isIdle:function(){return true;}},X=P.common.net.Session||W;if(!O){return;}V=function(Y){if(X.isIdle()){Y();}else{P.Lang.later(R,S,function(){V(Y);});}};P.use("cookie",function(d){var c=NeoConfig.buildNumber.split(".").pop(),a,Z,b=[];if(c===O||O===d.Cookie.get("_ver_")){return;}a=new RegExp("_"+c+".js","g");d.all("script").each(function(e){var Y=e.get("src"),f;if(Y&&Y.match("http://mail.yimg.com/")&&Y.match("_"+c+".js")){f=Y.replace(a,"_"+O+".js");if(f!==Y){b.push(f);}}});a=new RegExp("_"+c+".css","g");d.all("link").each(function(e){var Y=e.get("href"),f;if(Y&&Y.match("http://mail.yimg.com/")&&Y.match("_"+c+".css")){f=Y.replace(a,"_"+O+".css");if(f!==Y){b.push(f);}}});if(!b.length){return;}U=new Date();Z=d.Node.create('<iframe class="offscreen" role="presentation" tabindex="-1" src="'+b.shift()+'">');Z.on("load",function(){var Y=b.shift();d.common.Utils.rocketstats.stat("prefetchRelease:asset"+T);d.common.Utils.rocketstats.stat("prefetchRelease:asset","loadTime",(new Date()-U));T++;if(!Y){d.Cookie.set("_ver_",O);return;}d.Lang.later(R,null,function(){V(function(){U=new Date();Z.set("src",Y);});});});d.one("body").appendChild(Z);});},before:F("before"),on:F("on"),after:F("after"),fire:F("fire")};},"1.0.0",{requires:["async-queue","loader","common-net-session","mail-controller-messages"]});YUI.add("mail-ui-authorview-conv",function(F){var K=F.Node.create,q=F.common.Utils,AC=q.substitute,b=q.escapeHtml,e=q.unescapeHtml,A=q.log,R=F.ui.Templates,o=R._shared_module_toolbar_compose_fresh,j="[data-action='send']";var l=function(Y){var AH=this,AG;AH.keyCodes=[];AH.keyCodesL10N={};AH.parent=null;AH.subview=null;AH.subviews=[];AH.cdo=null;AH.composeView=null;AH.sendConfirmView=null;AH.sendConfirmViewTainer=null;AH.captchaView=null;AH.captchaViewTainer=null;AH.localCharCodes=[8,77,78,73,84];AH.composeActive=true;AH.type="author";AH.widgetType="compose";AH.keyCodesL10N[strings.str_cfg_sc_keycode_save_as_draft]=83;AH.keyCodesL10N[strings.str_cfg_sc_keycode_close_tab]=220;for(AG in AH.keyCodesL10N){AH.keyCodes.push(AG);}l.superclass.constructor.call(AH,Y);AH.set("charCodes","13,13+ctrl,13+meta,27,188+ctrl,190+ctrl,"+AH.keyCodes.join("+ctrl,")+"+ctrl,"+AH.keyCodes.join("+meta,")+"+meta");if(F.UA.ie){AH.set("localCharCodes",AH.localCharCodes.join());}AH.closeChgHandler=AH.on("closeChange",AH.handleCloseChange,AH);if(NeoConfig.hasConvView){AH.msgsRemoveHandler=F.on("ds:conv:remove",AH.handleConvRemove,AH);}else{AH.msgsRemoveHandler=F.on("ds:msg:remove",AH.handleMsgRemove,AH);}AH.updateTabTitle(AH.get("title"));AH.dsMsgChgHandler=F.on("ds:msg:change",AH.handleDSMessageChange,AH);AH.activeChangedHandler=AH.on("activeChange",AH.handleActiveChange);AH.tbFormatters={lastsaved:function(){return AH.subview.setSaveNotification();},isDirty:function(){return AH.subview.enableSaveDraft?"":AC(o.isDirty,null,null,null,strings);}};};function d(Y){var AG=this;if(Y.newVal){AG.updateToolbar();AG.subview.set("active",true);AG.subview.showComposeView(Y);}else{AG.subview.set("active",false);AG.subview.hideComposeView(Y);}}function P(Y){var AG=this;if(Y.newVal){AG.subview.closeCompose();}}function c(AM,Y,AI,AK,AH){var AG,AJ=Y||[],AL;if(AH&&AH.reason==="savedraft"){return;}if(AM!=="Draft"){return;}for(AG=0;AG<AJ.length;AG++){AL=AJ[AG];if(this.subview.draftMID===AL.mid){this.set("close",1);}}}function AF(AI,AJ){var Y,AG=AJ||[],AH;if(AI!=="Draft"){return;}for(Y=0;Y<AG.length;Y++){AH=AG[Y];if(AH.totalMsgs===1&&this.subview.draftMID===AH.recentmid){this.set("close",1);}}}function k(AG,AO,AI,AQ,AL){var AM=this,AP=AM.cdo&&AM.cdo.oComposeData&&AM.cdo.oComposeData.origin,Y,AH,AJ,AK,AN;if(AP){Y=AP.oMsg;AH=AP.fid;AJ=AP.action;}if((AJ==="reply_all"||AJ==="reply_sender"||AJ==="forward")&&AL==="move"){for(AK=0;Y&&AK<AI.length;AK++){AN=AI[AK].mid;if(F.mail.model.DataStore.Messages.hasMoved(Y.mid,AN,AH,AG)){AM.backToMessageTab=null;AM.subview.showToolbarButtons&&AM.subview.showToolbarButtons();AM.dsMsgChgHandler&&AM.dsMsgChgHandler.detach();return;}}}}function AA(AG){var AH=this;var Y="str_comp_nosubject";AG=AG||strings[Y];AH.set("title",AG);}function w(Y){var AG=this;AG.set("direction",Y);}function x(AH){var AI=this,Y=AI.localCharCodes.length,AG;for(AG=0;AG<Y;AG++){if(AH===AI.localCharCodes[AG]){return true;}}return false;}function B(){var Y=this;if(Y.subview){return([Y.subview]);}}function H(Y){var AH=this,AG=Y.keyCode;AG=AH.keyCodesL10N[AG]||AG;switch(AG){case 220:if(!Y.altKey&&(Y.metaKey||Y.ctrlKey)){AH.set("close",1);return true;}break;case 27:if(AH.composeView){AH.composeView.closeSrc="escKey";}if(!(F.ACWidgetInst.handleEscape&&F.ACWidgetInst.handleEscape())){AH.set("close",1);}return true;}if(F.UA.ie&&AH.subview.onLocalKeyDown){if(!AH.subview.onLocalKeyDown(Y)){return false;}}if(AH.subview&&AH.subview.onKeyDown){return AH.subview.onKeyDown(Y);}else{return null;}}function g(Y){var AG=this;if(AG.subview.onFocus){return AG.subview.onFocus(Y);}else{return null;}}function r(){var Y=this;if(Y.subview.isDirty){return Y.subview.isDirty();}else{return true;}}function G(){return !this.isDirty()&&!this.subview.hasContent();}function C(){var Y=this;if(Y.subview.isSaved){return Y.subview.isSaved();}else{return false;}}function a(Y){var AG=this;if(AG.subview.matchOrigin){return AG.subview.matchOrigin(Y);}else{return false;}}function v(Y){var AG=this;AG.set("contentToolbar",Y);if(Y){AG.toolBarHandler=Y.on("itemSelected",N,AG);}}function N(AG){if(AG.item&&AG.item.ancestor().hasClass("disabled")){return;}var AH=this,Y=AG?AG.dataAction:0;if(F.UA.ie&&F.UA.ie<=9&&AG.item&&AG.item.hasClass("disabled")){return;}switch(Y){case"cancelcompose":AH.closeSrc="cancelBtn";AH.set("close",1);break;case"send":case"savedraft":case"insertsignature":AH.subview.handleComposeAction(Y,AG);break;default:break;}}function X(Y){this.subviews.push(Y);}function u(AH,AG){var AI=this,Y;AH.cdo&&AH.cdo.get("passive")?Y=AH.cdo:Y=F.mail.Controller.Compose.createCDO();if(AG){AI.setDraftOrigin(Y,AH);AI.setDraftFromAddress(Y);}else{AI.setMessageFromAddress(Y);AI.setMessageOrigin(Y,AH);}if(AH&&AH.cbfn){Y.set("prePopulated",true);AH.cbfn(Y,AH);}if((!AH||!AH.action||!AH.fid||!AH.oMsg)&&!(AH.cdo&&AH.cdo.get("passive"))){F.mail.Controller.Compose.insertSignature(Y);}return Y;}function h(AG,Y){var AH=this;AH.cdo=AH.initComposeData(AG,Y);AH.subview=AH.createComposeView(AH.cdo,Y,AG).composeView;AH.subviews.push(AH.subview);if(AG&&AG.postRender){AH.subview.handles.push(AH.subview.on("renderComplete",function(){AG.postRender(AH,AG);}));}if(AG&&AG.oMsg&&AG.oMsg.header){AG.oMsg.header.subject=F.mail.Controller.Compose.seedSubject(AG);}return AH.subview;}function T(Y,AG){if(AG&&AG.action&&AG.fid&&AG.oMsg){Y.set("origin",{action:AG.action,fid:AG.fid,oMsg:AG.oMsg,forwardAsAttachment:AG.forwardAsAttachment,ctxReq:null});}}function V(Y){var AG=Y.get("header");AG.from=F.mail.Controller.Compose.getDefaultFromAddress();Y.set("header",AG);}function Z(Y,AG){if(AG&&AG.action&&AG.fid&&AG.oMsg){Y.set("origin",{action:AG.action,fid:AG.fid,oMsg:AG.oMsg,ctxReq:null});}}function i(Y){var AH=Y.get("header"),AG=Y.get("origin").oMsg;AH.from=AG.from?AG.from:(AG.header||{}).from;Y.set("header",AH);}function M(Y,AH,AI){var AJ=this,AG=null;if(Y){AI.cdo=Y;}A({"m":"start creating ConvComposeView"});AG=new F.mail.ui.ConvComposeView(AI,AH,AJ.get("parentNode"),{keydownHandler:F.bind(AJ.onKeyDown,AJ)},AJ.getEventBindings());
AG.handles=[];AJ.composeView=AG;return AG;}function AB(Y){Y.action=Y.type;this.fire("darlaEvent",Y);}function z(){var Y=this;Y.parent=Y.get("parentNode");Y.composeView.setParent(Y.parent);Y.composeView.bindComposeView();}function f(AG){var AH=this,Y=F.one(AG);AH.set("parentNode",Y);AH.set("rootNode",Y.one("div.compose"));return;}function y(){return;}function L(Y){var AG=this;AG.composeView.composeViewTainer&&this.composeView.composeViewTainer.one(".composeshim")[Y?"removeClass":"addClass"]("hidden");AG.disableToolbar(Y);if(Y){AG.tab&&AG.tab.elTab.addClass("sending");}else{AG.tab&&AG.tab.elTab.removeClass("sending");}}function U(Y){var AH=this,AG=AH.get("contentToolbar").get("content");AG.all(".btn")[Y?"addClass":"removeClass"]("disabled");}function W(){var AG=this,Y=AG.subview.getSubjectInfo();if(Y.subjectVal){AG.updateTabTitle(b(e(Y.subjectVal)));if(Y.subjectDir){AG.updateTabDirection(Y.subjectDir);}}else{AG.updateTabTitle(AG.subview.title);if(Y.subjectDir){AG.updateTabDirection("");}}}function n(){var Y=this;Y.dsMsgChgHandler&&Y.dsMsgChgHandler.detach();Y.msgsRemoveHandler&&Y.msgsRemoveHandler.detach();Y.closeChgHandler&&Y.closeChgHandler.detach();Y.toolBarHandler&&Y.toolBarHandler.detach();l.superclass.ondestroy.call(Y,arguments);}function AE(Y){var AG=this;AG.updateTabTitle(b(e(Y.subject)));if(NeoConfig.bidi){AG.updateTabDirection(F.Intl.detectDirection(Y.subject));}}function Q(Y){var AG=this;return(AG.subview.canClose(Y));}function m(Y){var AG=this;if(Y.forceClose){AG.set("forceClose",1);}AG.set("close",1);}function O(Y){var AG=this;AG.set("focusNode",Y.focusNode);}function s(){if(this.tab!==F.mail.Tabs.getActiveTab()){F.mail.Tabs.switchToTab(this.tab);}}function AD(Y){var AG=this;if(AG.tab!==F.mail.Tabs.getActiveTab()){F.mail.Tabs.switchToTab(AG.tab,Y.sdcbk());}else{Y.sdcbk();}}function E(AH){var AI=this,AG=AI.get("contentToolbar"),Y=AG&&AG.root.one(j);if(AH.action==="showSendBtn"){Y&&Y.removeClass("disabled");}else{Y&&Y.addClass("disabled");}}function t(AH){var AI=this,AG=AI.get("contentToolbar"),Y=AG&&AG.root.one(".savedraft");if(AH.action==="showDraftBtn"){Y&&Y.removeClass("disabled");}else{Y&&Y.addClass("disabled");}}function J(AG){var AI=this,AH,Y=AI.get("contentToolbar");if(Y&&(AH=Y.root.one(".lastsave"))){AH.set("innerHTML",AG.statusText);}}function p(){var AJ=this,Y,AH,AG,AI;if(AJ.isSending){return;}Y=K(AC(o.base,{},AJ.tbFormatters,0,strings,R));AH=AJ.get("contentToolbar");AG=AH&&AH.root.one(j);AI=AG&&!AG.hasClass("disabled");if(AI){Y.one(j).addClass("disabled");}AJ.attachToolbar(new F.mail.ui.Toolbar({root:Y}));}function I(Y){var AG=this;AG.once("activeChange",function(AH){if(AH.newVal){AG.composeView.sendConfirmView.showCaptcha(Y);}});}function S(Y){var AG=this;if(Y.sending){AG.tab&&AG.tab.elTab.addClass("sending");}else{AG.tab&&AG.tab.elTab.removeClass("sending");if(Y.title){AG.updateTabTitle(Y.title);}else{AG.setSubjectAsTitle();}}}function D(){var AG=this,Y={"showSendBtn":F.bind(AG.showSendBtn,AG),"hideSendBtn":F.bind(AG.showSendBtn,AG),"setSaveNotification":F.bind(AG.setSaveNotification,AG),"showDraftBtn":F.bind(AG.showDraftBtn,AG),"hideDraftBtn":F.bind(AG.showDraftBtn,AG),"updateSubject":F.bind(AG.setSubjectAsTitle,AG),"closeAction":F.bind(AG.closeAction,AG),"qrCancel":F.bind(AG.closeAction,AG),"replyheaderLoad":F.bind(AG.replyheaderLoad,AG),"setFocusNode":F.bind(AG.setFocusNode,AG),"showSaveDialog":F.bind(AG.showSaveDialog,AG),"showCompose":F.bind(AG.showCompose,AG),"addSubview":F.bind(function(AH){this.addSubview(AH.subview);},AG),"addChild":F.bind(function(AH){this.addChild(AH.subview);},AG),"removeChild":F.bind(function(AH){this.removeChild(AH.subview);},AG),"showCaptcha":F.bind(function(AH){this.showCaptcha(AH.fault);},AG),"updateTitle":F.bind(AG.updateTitle,AG),"switchToTab":F.bind(AG.switchToTab,AG),"darlaEvent":F.bind(AG.fireDarlaEvent,AG)};return Y;}F.extend(l,F.mail.ui.BaseWidget);F.mix(l.prototype,{NAME:"AuthorView",ondestroy:n,onKeyDown:H,onFocus:g,bindUI:y,render:f,initCompose:h,initComposeData:u,createComposeView:M,bindComposeView:z,isLocalCharCode:x,isDirty:r,isClean:G,isSaved:C,matchOrigin:a,setMessageOrigin:T,setMessageFromAddress:V,setDraftOrigin:Z,setDraftFromAddress:i,attachToolbar:v,updateTabTitle:AA,updateTabDirection:w,handleDSMessageChange:k,handleCloseChange:P,showComposeShim:L,getComposeWidgets:B,disableToolbar:U,setSubjectAsTitle:W,showSendBtn:E,showDraftBtn:t,setSaveNotification:J,setFocusNode:O,showSaveDialog:AD,_canClose:Q,closeAction:m,handleActiveChange:d,updateToolbar:p,replyheaderLoad:AE,getEventBindings:D,addSubview:X,showCaptcha:I,updateTitle:S,switchToTab:s,handleConvRemove:AF,handleMsgRemove:c,fireDarlaEvent:AB},true);F.namespace("mail.ui");F.mail.ui.AuthorViewConv=l;},"1.0.0",{requires:["mail-controller-base","mail-controller-compose","mail-ui-composeview-conv","_shared_module_compose_title","_shared_module_offscreen_bin_notification_notifications","_shared_module_toolbar_compose_fresh"]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("anim-base",function(e,t){var n="running",r="startTime",i="elapsedTime",s="start",o="tween",u="end",a="node",f="paused",l="reverse",c="iterationCount",h=Number,p={},d;e.Anim=function(){e.Anim.superclass.constructor.apply(this,arguments),e.Anim._instances[e.stamp(this)]=this},e.Anim.NAME="anim",e.Anim._instances={},e.Anim.RE_DEFAULT_UNIT=/^width|height|top|right|bottom|left|margin.*|padding.*|border.*$/i,e.Anim.DEFAULT_UNIT="px",e.Anim.DEFAULT_EASING=function(e,t,n,r){return n*e/r+t},e.Anim._intervalTime=20,e.Anim.behaviors={left:{get:function(e,t){return e._getOffset(t)}}},e.Anim.behaviors.top=e.Anim.behaviors.left,e.Anim.DEFAULT_SETTER=function(t,n,r,i,s,o,u,a){var f=t._node,l=f._node,c=u(s,h(r),h(i)-h(r),o);l?"style"in l&&(n in l.style||n in e.DOM.CUSTOM_STYLES)?(a=a||"",f.setStyle(n,c+a)):"attributes"in l&&n in l.attributes?f.setAttribute(n,c):n in l&&(l[n]=c):f.set?f.set(n,c):n in f&&(f[n]=c)},e.Anim.DEFAULT_GETTER=function(t,n){var r=t._node,i=r._node,s="";return i?"style"in i&&(n in i.style||n in e.DOM.CUSTOM_STYLES)?s=r.getComputedStyle(n):"attributes"in i&&n in i.attributes?s=r.getAttribute(n):n in i&&(s=i[n]):r.get?s=r.get(n):n in r&&(s=r[n]),s},e.Anim.ATTRS={node:{setter:function(t){return t&&(typeof t=="string"||t.nodeType)&&(t=e.one(t)),this._node=t,!t,t}},duration:{value:1},easing:{value:e.Anim.DEFAULT_EASING,setter:function(t){if(typeof t=="string"&&e.Easing)return e.Easing[t]}},from:{},to:{},startTime:{value:0,readOnly:!0},elapsedTime:{value:0,readOnly:!0},running:{getter:function(){return!!p[e.stamp(this)]},value:!1,readOnly:!0},iterations:{value:1},iterationCount:{value:0,readOnly:!0},direction:{value:"normal"},paused:{readOnly:!0,value:!1},reverse:{value:!1}},e.Anim.run=function(){var t=e.Anim._instances,n;for(n in t)t[n].run&&t[n].run()},e.Anim.pause=function(){for(var t in p)p[t].pause&&p[t].pause();e.Anim._stopTimer()},e.Anim.stop=function(){for(var t in p)p[t].stop&&p[t].stop();e.Anim._stopTimer()},e.Anim._startTimer=function(){d||(d=setInterval(e.Anim._runFrame,e.Anim._intervalTime))},e.Anim._stopTimer=function(){clearInterval(d),d=0},e.Anim._runFrame=function(){var t=!0,n;for(n in p)p[n]._runFrame&&(t=!1,p[n]._runFrame());t&&e.Anim._stopTimer()},e.Anim.RE_UNITS=/^(-?\d*\.?\d*){1}(em|ex|px|in|cm|mm|pt|pc|%)*$/;var v={run:function(){return this.get(f)?this._resume():this.get(n)||this._start(),this},pause:function(){return this.get(n)&&this._pause(),this},stop:function(e){return(this.get(n)||this.get(f))&&this._end(e),this},_added:!1,_start:function(){this._set(r,new Date-this.get(i)),this._actualFrames=0,this.get(f)||this._initAnimAttr(),p[e.stamp(this)]=this,e.Anim._startTimer(),this.fire(s)},_pause:function(){this._set(r,null),this._set(f,!0),delete p[e.stamp(this)],this.fire("pause")},_resume:function(){this._set(f,!1),p[e.stamp(this)]=this,this._set(r,new Date-this.get(i)),e.Anim._startTimer(),this.fire("resume")},_end:function(t){var n=this.get("duration")*1e3;t&&this._runAttrs(n,n,this.get(l)),this._set(r,null),this._set(i,0),this._set(f,!1),delete p[e.stamp(this)],this.fire(u,{elapsed:this.get(i)})},_runFrame:function(){var e=this._runtimeAttr.duration,t=new Date-this.get(r),n=this.get(l),s=t>=e;this._runAttrs(t,e,n),this._actualFrames+=1,this._set(i,t),this.fire(o),s&&this._lastFrame()},_runAttrs:function(t,n,r){var i=this._runtimeAttr,s=e.Anim.behaviors,o=i.easing,u=n,a=!1,f,l,c;t>=n&&(a=!0),r&&(t=n-t,u=0);for(c in i)i[c].to&&(f=i[c],l=c in s&&"set"in s[c]?s[c].set:e.Anim.DEFAULT_SETTER,a?l(this,c,f.from,f.to,u,n,o,f.unit):l(this,c,f.from,f.to,t,n,o,f.unit))},_lastFrame:function(){var e=this.get("iterations"),t=this.get(c);t+=1,e==="infinite"||t<e?(this.get("direction")==="alternate"&&this.set(l,!this.get(l)),this.fire("iteration")):(t=0,this._end()),this._set(r,new Date),this._set(c,t)},_initAnimAttr:function(){var t=this.get("from")||{},n=this.get("to")||{},r={duration:this.get("duration")*1e3,easing:this.get("easing")},i=e.Anim.behaviors,s=this.get(a),o,u,f;e.each(n,function(n,a){typeof n=="function"&&(n=n.call(this,s)),u=t[a],u===undefined?u=a in i&&"get"in i[a]?i[a].get(this,a):e.Anim.DEFAULT_GETTER(this,a):typeof u=="function"&&(u=u.call(this,s));var l=e.Anim.RE_UNITS.exec(u),c=e.Anim.RE_UNITS.exec(n);u=l?l[1]:u,f=c?c[1]:n,o=c?c[2]:l?l[2]:"",!o&&e.Anim.RE_DEFAULT_UNIT.test(a)&&(o=e.Anim.DEFAULT_UNIT);if(!u||!f){e.error('invalid "from" or "to" for "'+a+'"',"Anim");return}r[a]={from:e.Lang.isObject(u)?e.clone(u):u,to:f,unit:o}},this),this._runtimeAttr=r},_getOffset:function(e){var t=this._node,n=t.getComputedStyle(e),r=e==="left"?"getX":"getY",i=e==="left"?"setX":"setY",s;return n==="auto"&&(s=t.getStyle("position"),s==="absolute"||s==="fixed"?(n=t[r](),t[i](n)):n=0),n},destructor:function(){delete e.Anim._instances[e.stamp(this)]}};e.extend(e.Anim,e.Base,v)},"3.13.0",{requires:["base-base","node-style"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("widget-anim",function(e,t){function b(e){b.superclass.constructor.apply(this,arguments)}var n="boundingBox",r="host",i="node",s="opacity",o="",u="visible",a="destroy",f="hidden",l="rendered",c="start",h="end",p="duration",d="animShow",v="animHide",m="_uiSetVisible",g="animShowChange",y="animHideChange";b.NS="anim",b.NAME="pluginWidgetAnim",b.ANIMATIONS={fadeIn:function(){var t=this.get(r),f=t.get(n),l=new e.Anim({node:f,to:{opacity:1},duration:this.get(p)});return t.get(u)||f.setStyle(s,0),l.on(a,function(){this.get(i).setStyle(s,e.UA.ie?1:o)}),l},fadeOut:function(){return new e.Anim({node:this.get(r).get(n),to:{opacity:0},duration:this.get(p)})}},b.ATTRS={duration:{value:.2},animShow:{valueFn:b.ANIMATIONS.fadeIn},animHide:{valueFn:b.ANIMATIONS.fadeOut}},e.extend(b,e.Plugin.Base,{initializer:function(e){this._bindAnimShow(),this._bindAnimHide(),this.after(g,this._bindAnimShow),this.after(y,this._bindAnimHide),this.beforeHostMethod(m,this._uiAnimSetVisible)},destructor:function(){this.get(d).destroy(),this.get(v).destroy()},_uiAnimSetVisible:function(t){if(this.get(r).get(l))return t?(this.get(v).stop(),this.get(d).run()):(this.get(d).stop(),this.get(v).run()),new e.Do.Prevent},_uiSetVisible:function(e){var t=this.get(r),i=t.getClassName(f);t.get(n).toggleClass(i,!e)},_bindAnimShow:function(){this.get(d).on(c,e.bind(function(){this._uiSetVisible(!0)},this))},_bindAnimHide:function(){this.get(v).after(h,e.bind(function(){this._uiSetVisible(!1)},this))}}),e.namespace("Plugin").WidgetAnim=b},"3.13.0",{requires:["anim-base","plugin","widget"]});
YUI.add("_shared_module_offscreen_bin_tooltip_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_tooltip_fresh={base:"<div class='tooltip-arrow'></div><span class='tooltips-text'>{{tooltip_text}}</span>"};},"1.0.0");YUI.add("mail-ui-workspace-fresh",function(A){A.mix(A.mail.ui.Workspace,{_setupFeedback:function(){A.use("comms-ui-feedback-widget","_shared_module_feedback","feedback_css",function(H){var C=H.comms.ui.Feedback,G="_shared_module_feedback",D={},F="",B=NeoConfig.expBucketId;if(NeoConfig.isCorpmail){F="&keywords=mail-corpuser&isCorpMail=1";}D={internalIP:NeoConfig.isInternalIP,bucketId:B,template:H.ui.Templates[G].base,strings:{yconfidential:"Y! Confidential"},urls:{bug:strings.str_cfg_url_feedback_bug+F,productInfo:strings.str_cfg_url_feedback_product_info,moderator:strings.str_cfg_url_feedback_ymoderator,confidential:strings.str_cfg_url_feedback_confidential}};var E=new C(D);E.render("body");if(NeoConfig.expBucketIdList){H.use("mail-debug",function(I){I.mail._showBuckets();});}});},_setUpFreshToolTips:function(){var B={},D=A.comms.ui.ToolTips,F,E="_shared_module_offscreen_bin_tooltip_fresh",C=strings.str_tog_loadRTLCss?true:false;D.TRIGGER_CLASS="s-tp";D.OFFSET_XY=[C?-5:5,0];D.TEXT="tooltip_text";D.TEMPLATE=A.ui.Templates[E].base;D.ARROW_DIRECTION=C?"right":"left";B={shim:false,zIndex:100,position:C?"left":"right",width:"300px",delay:{show:25,hide:50,auto:6000,offscreen:0},render:true,autoHide:true,trigger:".s-tp"};F=new D(B);F.before("triggerEnter",function(I){var G=I.node,L=G?G.get("id"):"",J=null,K=this,H;A.fire("menu:display-menu-close");if(L==="btn-ml-count"||L==="btn-previous"||L==="btn-next"){H={"btn-previous":0,"btn-ml-count":0,"btn-next":2};J=G.one("span[title]");K.setCustomTriggerAttrs({"correction":[K.getNodeSize(J)[0]*H[L],-5]});K.setTriggerContent(false,J);}});A.on("menu:display-state",function(H){var G;if(H.state==="show"){F&&F.hide();}else{if(H.state==="hide"){G=A.one("#btn-ml-count");G&&G.removeClass("pressed");}}});A.on("mailview:toolbar-action",function(){F&&F.hide();});A.on("ToolTips:hideTooltips",function(){F&&F.hideToolTip();});}},1);},"1.0.0",{requires:["mail-ui-workspace-base","comms-ui-tooltips-widget","widget-anim","_shared_module_offscreen_bin_tooltip_fresh"]});YUI.add("mail-recent-searches",function(B){var E=NeoConfig.recentSearchList?NeoConfig.recentSearchList:[],P=B.mail.persist.MetaData,F="neo.pref.savedSearch",S='<li role="option" data-count=""><span class="ac-label small">{{str_autocomplete_search}}</span><span class="ac-value">{{item-text}}</span></li>';function K(U){var V=yui.Node.create("<div></div>"),T=[];B.Array.each(U,function(W){V.setHTML(W);T.push(V.get("text"));});return T;}function R(V,U){var T;if(!U){return{value:V};}T=V.toLowerCase().indexOf(U.toLowerCase());if(T!==-1){return{value:V,match:{start:T,end:T+U.length}};}return null;}function Q(X){var V=X.value,T=X.match,W,U;if(!T){return V;}if(NeoConfig.bidi){W=V.substring(0,T.start);U=V.substring(T.end);V=W+B.comms.Intl.highlightString(V.substring(T.start,T.end),W,U)+U;}else{V=V.substring(0,T.start)+"<b>"+V.substring(T.start,T.end)+"</b>"+V.substring(T.end);}return V;}function C(Y,U){var W,X,V=E.length,Z,T=[];for(W=0,X=0;W<V&&X<U;W+=1){Z=R(E[W],Y);if(Z){T.push(Z);X+=1;}}return T;}function N(U){var W,V=U.length,T=[];for(W=0;W<V;W+=1){T.push(L(U[W],W));}return T;}function L(W,V){var T=S,U=Q(W);T=T.replace('data-count=""','data-count="'+(V+1)+'"');T=T.replace(/\{\{str_autocomplete_search\}\}/g,V===0?strings.str_autocomplete_search:"&nbsp;");T=T.replace(/\{\{item-text\}\}/g,U);return T;}function J(U,T){var V='<ul id="recent-searches" class="presentation">'+T+"</ul>";U.get("contentBox").append(V);}function A(V,U){var T=V.get("data");if(T.length>0){J(V,U);}else{J(V,U);if(V.get("selectFirst")){V.set("selectedIndex",0);}V.get("contentBox").setStyle("display","block").one("#recent-searches").setStyle("border-top","none");}}function D(W,V){var U,T;U=C(W.get("query"),V);if(U.length===0){return;}T=N(U).join("");if(T){A(W,T);}}function O(V,W){B.fire("mt:click",{action:V?"ml_srch_sugg":"ml_srch",spid:"search_results"});B.fire("fireSearch",W);var U=new B.EventTarget();var T=V?"ucs:mailSearchSugg":"ucs:mailSearch";U.publish(T,{broadcast:2,emitFacade:true});U.fire(T);}function H(){try{P.set(F,0);I();}catch(T){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-searchautocomplete-recent-searches:1",T,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-searchautocomplete-recent-searches:1");}}function I(){try{E=B.JSON.parse(P.get(F));NeoConfig.recentSearchList=E;}catch(T){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-searchautocomplete-recent-searches:2",T,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-searchautocomplete-recent-searches:2");}}function M(T){E=E?E:[];E.unshift(B.common.Utils.escapeHtml(T));E=B.Array.dedupe(E);if(E.length>NeoConfig.maxSearchHistory){E.pop();}P.set(F,B.JSON.stringify(K(E)));NeoConfig.recentSearchList=E;}var G={getACSearchItems:C,getACSearchItemsMarkup:N,addACSearchItems:D,reloadRecentSearchItems:I,clearRecentSearchItems:H,addNewSearchItem:M,handleSelection:O};B.namespace("mail.ui");B.mail.ui.RecentSearches=G;},"1.0.0",{requires:["common-utils","mail-persist-meta-data"]});YUI.add("minty_module_search_advanced_search",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_search_advanced_search={base:'<div class="first row"> <div class="label">{{str_advanced_srch_from}}</div> <div class="as-field"><input id="as-from" type="text"></div></div><div class="row"> <div class="label">{{str_advanced_srch_to}}</div> <div class="as-field"><input id="as-to" type="text"></div></div><div class="row"> <div class="label">{{str_advanced_srch_subject}}</div> <div class="as-field"><input id="as-subject" type="text"></div></div><div class="row"> <div class="label">{{str_advanced_srch_contains}}</div> <div class="as-field"><input id="as-contains" type="text"></div></div><div class="row"> <div class="label">{{str_advanced_srch_date}}</div> <div class="as-field"> <div class="custom-select"> <select id="as-date"> <option selected value="">{{str_advanced_srch_date_all}}</option> <option value="week">{{str_advanced_srch_date_week}}</option> <option value="month">{{str_advanced_srch_date_month}}</option> <option value="custom">{{str_advanced_srch_date_custom}}</option> </select> </div> <div id="as-date-custom-fields" style="display: none"> <div class="as-date-custom"> <input type="text" placeholder="YYYY/MM/DD" class="as-date-custom-field" id="as-date-custom-after"> </div> <span>{{str_advanced_srch_date_to}}</span> <div class="as-date-custom"> <input type="text" placeholder="YYYY/MM/DD" class="as-date-custom-field" id="as-date-custom-before"> </div> </div> </div></div><div class="row"> <div class="label">{{str_advanced_srch_folder}}</div> <div class="as-field"> <div class="custom-select"> <select id="as-in"> <option selected value="">{{str_advanced_srch_folder_all}}</option> <option value="*trash">{{str_advanced_srch_folder_all_except_trash}}</option> </select> </div> </div></div><div class="before-cboxes row"> <div class="label">{{str_advanced_srch_type}}</div> <div class="as-field"> <div class="custom-select"> <select id="as-is"> <option selected value="">{{str_advanced_srch_type_all}}</option> <option value="unread">{{str_advanced_srch_type_unread}}</option> <option value="starred">{{str_advanced_srch_type_starred}}</option> <option value="personal">{{str_advanced_srch_type_people}}</option> <option value="shopping">{{str_advanced_srch_type_shopping}}</option> <option value="travel">{{str_advanced_srch_type_travel}}</option> <option value="social">{{str_advanced_srch_type_social}}</option> <option value="financial">{{str_advanced_srch_type_finance}}</option> </select> </div> </div></div><div class="cboxes row"> <div class="as-field"> <label class="cbox"> <input id="as-has_attachment" type="checkbox" value="attachment"> <span class="icon"></span> <span class="text">{{str_advanced_srch_has_attachment}}</span> </label> <label class="last cbox"> <input id="as-has_image" type="checkbox" value="image"> <span class="icon"></span> <span class="text">{{str_advanced_srch_has_image}}</span> </label> </div></div><div class="row"> <div class="as-field actions"> <button class="btn default as-button">{{str_uh_searchmail}}</button><!-- <span id="as-go-back">{{str_advanced_srch_go_back}}</span> --> </div></div>'};},"1.0.0");/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("datatype-date-parse",function(e,t){e.mix(e.namespace("Date"),{parse:function(t){var n=new Date(+t||t);return e.Lang.isDate(n)?n:null}}),e.namespace("Parsers").date=e.Date.parse,e.namespace("DataType"),e.DataType.Date=e.Date},"3.13.0");
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("datatype-date-math",function(e,t){var n=e.Lang;e.mix(e.namespace("Date"),{isValidDate:function(e){return n.isDate(e)&&isFinite(e)&&e!="Invalid Date"&&!isNaN(e)&&e!=null?!0:!1},areEqual:function(e,t){return this.isValidDate(e)&&this.isValidDate(t)&&e.getTime()==t.getTime()},isGreater:function(e,t){return this.isValidDate(e)&&this.isValidDate(t)&&e.getTime()>t.getTime()},isGreaterOrEqual:function(e,t){return this.isValidDate(e)&&this.isValidDate(t)&&e.getTime()>=t.getTime()},isInRange:function(e,t,n){return this.isGreaterOrEqual(e,t)&&this.isGreaterOrEqual(n,e)},addDays:function(e,t){return new Date(e.getTime()+864e5*t)},addMonths:function(e,t){var n=e.getFullYear(),r=e.getMonth()+t;n=Math.floor(n+r/12),r=(r%12+12)%12;var i=new Date(e.getTime());return i.setFullYear(n),i.setMonth(r),i},addYears:function(e,t){var n=e.getFullYear()+t,r=new Date(e.getTime());return r.setFullYear(n),r},listOfDatesInMonth:function(e){if(!this.isValidDate(e))return[];var t=this.daysInMonth(e),n=e.getFullYear(),r=e.getMonth(),i=[];for(var s=1;s<=t;s++)i.push(new Date(n,r,s,12,0,0));return i},daysInMonth:function(e){if(!this.isValidDate(e))return 0;var t=e.getMonth(),n=[31,28,31,30,31,30,31,31,30,31,30,31];if(t!=1)return n[t];var r=e.getFullYear();return r%400===0?29:r%100===0?28:r%4===0?29:28}}),e.namespace("DataType"),e.DataType.Date=e.Date},"3.13.0",{requires:["yui-base"]});
YUI.add("ac-corp-widget",function(A){var B=A.contacts,G=A.common.Utils.substitute,F="selectedIndex",I="ac",E='<li role="option" class="corpmail"><span class="ac-value"><span>{{name}}</span><em class="email" dir="ltr">({{email}})</em></span></li>',D=A.comms.FilterContactsMarkup,J=D.hlMatch,C=D.buildName;function H(K){var L=this;H.superclass.constructor.apply(L,[K]);L.gabRequest=null;L.gabRequestWait=null;}A.extend(H,B.ui.ACWidget,{bindUI:function(){H.superclass.bindUI.apply(this,arguments);},bind:function(L){var M=this,K=A.stamp(M)+"|";H.superclass.bind.apply(M,arguments);L=L||M.get("ac");M.listeners.push(L.on(K+I+":query",function(N){M.gabRequestWait&&M.gabRequestWait.cancel();M.gabRequest&&M.gabRequest.abort();var P={success:function(R){var Q=R.body.data;M.set("gabData",Q);M.drawGabMarkup(Q);},failure:function(){M.setLoading(false);},responseType:"json",suppressCodes:["*"],suppressWssid:true,timeout:5000},O={q:N.value,corpmail:"1"};M.gabRequestWait=A.later(400,M,function(){M.gabRequest=A.common.net.SessionMgr.request("/neo/gab/gab.php",O,P,"GET",null,true);M.setLoading(true);});}));M.listeners.push(L.on(K+I+":hide",function(){M.gabRequest&&M.gabRequest.abort();}));},setLoading:function(L){var K=this.get("contentBox").one("div.loading"),M=this.get("data");K.setStyle("display",L?"block":"none");if(L){this.get("contentBox").setStyle("display","block");}else{if(M.length<1){this.get("contentBox").setStyle("display","none");}}},getGabItemMarkup:function(L){var K=A.Lang.isArray,M=L.matches;if(M){if(K(M.firstname)&&M.firstname.length>0){L.firstname=J(L.firstname,M.firstname);}if(K(M.middlename)&&M.middlename.length>0){L.middlename=J(L.middlename,M.middlename);}if(K(M.lastname)&&M.lastname.length>0){L.lastname=J(L.lastname,M.lastname);}if(K(M.email)&&M.email.length>0){L.email=J(L.email,M.email);}}L.name=C(L.firstname,L.middlename,L.lastname);return G(E,L);},getGabListMarkup:function(L){var M=this,K=[G('<li class="corpmail label">{{str_corp_contacts}}</li>',null,null,null,strings)];A.Array.each(L,function(N){K.push(M.getGabItemMarkup(N));});return K.join("");},drawGabMarkup:function(M){var L=this.get("data"),K=this.getGabListMarkup(M);this.setLoading(false);if(L.length>0){this.appendMarkup(K);}else{this.appendMarkup(K);if(M.length>0){if(this.get("selectFirst")){this.set(F,0);}this.get("contentBox").setStyle("display","block");}}},appendMarkup:function(K){var L=this.get("contentBox").one("ul");K=L.get("innerHTML")+K;L.set("innerHTML",K);}},{NAME:"ACWidget",ATTRS:{listTpl:{value:G('<ul role="presentation">{list}</ul><div class="loading">{{str_corp_contacts_loading}}</div>',null,null,null,strings)},gabData:{}}});A.namespace("contacts.ui");A.contacts.ui.ACCorpWidget=H;},"1.0.0",{requires:["ac-widget","filter-contacts"]});YUI.add("mail-ui-advanced-search-ac-widget",function(C){var A;C.namespace("mail.ui.AdvancedSearch");A=NeoConfig.isCorpmail?C.contacts.ui.ACCorpWidget:C.contacts.ui.ACWidget;function B(D){if(D){this.acNode=D.acNode;}B.superclass.constructor.apply(this,arguments);}B.NAME="ACWidget";C.mail.ui.AdvancedSearch.ACWidget=C.extend(B,A,{selectItem:function(F){var E=F.type==="mousedown"&&F.which===1,D=(F.type==="keydown"&&F.which===13);if(E||D){this.selected(F,F.type);if(D){F.stopPropagation();}}},bindUI:function(){var E=this,D=E.get("contentBox");B.superclass.bindUI.apply(this,arguments);E.get("ac").once("ac:query",function(){E.set("width",E.acNode.get("offsetWidth"));});E._detachClickListeners();D.delegate("mousedown",E.selectItem,"li",E);E.listeners.push(E.acNode.on("keydown",E.selectItem,E));E.get("ac").on("ac:query",function(J){var G=this.get("badResult"),H=J.value,K=5,F,I;if(G&&E.checkBadResult(G,H)){return;}if(C.contacts.utils.areContactsLoaded()){F=new C.comms.FilterContacts();F.updateFilterItems(H);I=F.fastMatch(true);I.queryStr=H;if(I.length>K){I.length=K;}E.reload.call(E,I);E.get("contentBox").all(".ac-remove-item").remove();}});},_detachClickListeners:function(){var D,E;for(D=0;D<this.listeners.length;D++){E=this.listeners[D];if(E.evt.type==="click"){E.detach();delete this.listeners[D];this.listeners.splice(D--,1);}}},checkBadResult:function(E,F){var D=[];D.queryStr=F;if(F.indexOf(E)>=0){this.get("ac").fire("ac:load",{results:D,query:F});return true;}return false;}});},"1.0.0",{requires:["ac-widget","ac-corp-widget"]});YUI.add("mail-ui-advanced-search-widget",function(D){D.namespace("mail.ui.AdvancedSearch");var A=D.ui.Templates.minty_module_search_advanced_search,C=D.common.Utils;function B(){B.superclass.constructor.apply(this,arguments);this.widgets=[];this.listeners=[];this.searchTriggered=false;this.asButton=null;}D.extend(B,D.Overlay,{getMarkup:function(){return D.common.Utils.substitute(this.get("tmpl").base,strings);},initializer:function(E){this.set("srcAcWidget",E.srcAcWidget);this.set("searchNode",E.searchNode);this.listeners=[];},updateSearchNode:function(){this.get("searchNode").set("value",this.parseFieldNodes());},parseFieldNodes:function(){var E=[];this.fieldNodes.each(function(G){var F=G.getData("as-getSearchNodeStr"),H=F&&F.call(G);if(H){E.push(H);}});return E.join(" ");},renderUI:function(){var F=this,E=F.get("contentBox");this.asButton=this.get("srcAcWidget").get("contentBox").one("#as-button");F.setDimensions();E.setHTML(F.getMarkup()).setStyle("display","block");F._renderFolderDropdown();F.setFieldNodes();F.prepopulateInputs(F.get("searchNode").get("value"));F.renderContactACWidgets.call(F);},setFieldNodes:function(){this.fieldNodes=this.get("contentBox").all("input:not(.as-date-custom-field), select");},prepopulateInputs:function(F){var P=F,N=this.get("contentBox"),G,M,S,U,K,E,T,L,O,Q,J,I,H,R;M=/(?:\s|^)(from|to|subject):('(?:[^'\\]|\\')*'|"(?:[^"\\]|\\")*"|[^\s]*)(?=\s|$)/g;while(J=M.exec(F)){T=J[1];E=J[2];if(E.match(/\s/)){E=E.replace(/(['"])(.*)\1/,"$2").replace(/\\(['"])/g,"$1");}N.one("#as-"+T).set("value",E);P=P.replace(J[0],"");}F=P;G=/(?:\s|^)(after|before):(\d{4}\/\d{1,2}\/\d{1,2})(?=\s|$)/g;while(J=G.exec(F)){T=J[1];E=J[2];if(!isNaN(new Date(E).getTime())){N.one("#as-date").set("value","custom");N.one("#as-date-custom-fields").show();N.one("#as-date-custom-"+T).set("value",E);P=P.replace(J[0],"");}}F=P;K=/(?:\s|^)(has|is|-?in):(\w+|"[^"]+"|'[^']+')(?=\s|$)/g;while(J=K.exec(F)){E=J[2];T=J[1];R;if(T==="has"){R=["attachment","image"];}else{if(T==="is"){R=["unread","starred","personal","shopping","travel","social","financial"];}else{if(T==="in"){R=this.folders;}else{R=["trash"];}}}if(I=E.match(/(["'])(.*)\1/)){E=I[2];}if(D.Array.indexOf(R,E)>=0){if(T==="has"){N.one("#as-has_"+E).simulate("click");}else{if(T==="-in"){N.one("#as-in").set("value","*trash");}else{N.one("#as-"+T).set("value",E);}}P=P.replace(J[0],"");}}F=P;F=D.Lang.trim(F.replace(/\s+/," "));N.one("#as-contains").set("value",F);},renderContactACWidgets:function(){var E=this;if(D.contacts.utils.areContactsLoaded()){E._doRenderContactACWidgets();}else{D.once("contacts:api:loaded",function(){E._doRenderContactACWidgets();});}},_doRenderContactACWidgets:function(){var F=this,E=F.get("contentBox");E.all("#as-from, #as-to").each(function(){var G=this,H=G.get("id")+"-results",I;E.append(D.Node.create('<div id="'+H+'" class="ac-results"></div>'));I=new D.mail.ui.AdvancedSearch.ACWidget({acNode:this,acTarget:this,contentBox:"#"+H,selectFirst:false}).setAlign().render();F.widgets.push(I);G.setData("ac-widget",I);G.on("blur",function(J){I.hide();});G.on("focus",function(){if(I.get("data")&&I.get("data").length){I.show();}});I.get("ac").on("ac:select",function(M){var K,L=M.selectedItem,J;if(!L){return;}J=L.get("text");K=J&&J.replace(/\s\(.*?\)$/,"");G.set("value",K);I.hide();G.ancestor().ancestor().next().one('input[type="text"]').focus();});});},_renderFolderDropdown:function(){var G=this,E=G.get("contentBox"),I=[],F=[{optValue:"inbox",fid:"Inbox",intlName:strings.str_folder_reserved_inbox},{optValue:"drafts",fid:"Draft",intlName:strings.str_folder_reserved_drafts},{optValue:"sent",fid:"Sent",intlName:strings.str_folder_reserved_sent},{optValue:"chats",fid:"%40C%40Chats",intlName:strings.str_folder_reserved_IM},{optValue:"trash",fid:"Trash",intlName:strings.str_folder_reserved_trash},{fid:"%40B%40Bulk"}],H=[];G.folders=[];D.Array.each(F,function(J){if(J.optValue){I.push('<option value="'+J.optValue+'">'+J.intlName+"</options>");G.folders.push(J.optValue);}H.push(J.fid);});D.Array.each(D.mail.model.DataStore.Folders.get(),function(J){var L=J.folderInfo.fid,K=J.folderInfo.name;if(D.Array.indexOf(H,L)===-1){G.folders.push(K);I.push('<option value="'+K+'">'+K+"</options>");}});E.one("#as-in").append(I.join("")).set("value","");},bindUI:function(){var F=this,E=F.get("contentBox"),G=E.one("#as-date-custom-fields");E.all("select, input").on(["keyup","keydown","keypress"],function(H){if(H.ctrlKey||H.metaKey||H.which===40||H.which===38){H.stopPropagation();}});this.bindDestroyEvents();this.bindStartSearchEvents();E.one("#as-date").on("change",function(){if(this.get("value")==="custom"){G.show();}else{G.hide().all("input").set("value","");}});this.bindLivePopulateCbs();},bindDestroyEvents:function(){var F=this,E=this.get("contentBox");this.listeners.push(D.on("as:close-window-click",function(G){if(!(G.target===F.get("searchNode")||E.contains(G.target)||G.target.contains(F.asButton))){F.close();}}));this.listeners.push(D.on("click",function(G){D.fire("as:close-window-click",G);}));this.listeners.push(D.on("keyup",function(G){if(G.keyCode===27){F.close();}}));},bindStartSearchEvents:function(){var F=this,E=this.get("contentBox");E.delegate("keydown",function(G){if(G.keyCode===13){F._startSearch();}},"input[type=text]:not(.as-date-custom-field)");E.one(".actions .as-button").on("click",F._startSearch,F);F.listeners.push(D.one("#yucs-sprop_button").on("click",F._startSearch,F));F.listeners.push(this.get("searchNode").on("keydown",function(G){if(G.keyCode===13){F._postSearch();}}));},_startSearch:function(){if(this.searchTriggered){return;}this.get("searchNode").simulate("keydown",{keyCode:13});this._postSearch();},_postSearch:function(){if(this.searchTriggered){return;}this.instrumentSearch();var E=this.get("searchNode");E.getData("_valuechange").prevVal=E.get("value");this.searchTriggered=true;this.destroy();},bindLivePopulateCbs:function(){var F=this,E=this.get("contentBox"),G;function H(I){return I.get("id").replace(/^as-/,"");}this.fieldNodes.filter("input[type=text], select:not(#as-date)").setData("as-getSearchNodeStr",function(){var I=this.get("value"),J=H(this);
if(D.Lang.trim(I)){if(J==="contains"){return I;}else{if(J==="in"&&I==="*trash"){return"-in:trash";}else{if(/\s/.test(I)){I='"'+I.replace(/"/g,'\\"',I)+'"';}return J+":"+I;}}}});this.fieldNodes.filter("input[type=checkbox]").setData("as-getSearchNodeStr",function(){if(this.get("checked")){return"has:"+this.get("value");}});this.fieldNodes.filter("#as-date").setData("as-getSearchNodeStr",function(){var N={},K,M,J=E.one("#as-date-custom-fields"),I=[],L={format:"%Y/%m/%d"};switch(this.get("value")){case"week":N["after"]=D.Date.addDays(new Date(),-7);break;case"month":N["after"]=D.Date.addDays(new Date(),-30);break;case"custom":K=/^\s*\d{4}\/\d{1,2}\/\d{1,2}\s*$/;J.all("input[type=text]").each(function(){var P,O,Q=this.get("value");if(!D.Lang.trim(Q)){return;}P=this.get("id").replace(/^as-date-custom-/,"");O=new Date(Q);if(K.test(Q)&&!isNaN(O.getTime())){N[P]=O;this.siblings(".error").remove();}else{this.siblings(".error").size()||this.insert('<div class="error"> '+strings.str_advanced_srch_err_invalid_date+"</div>","after");}});if(N.after&&N.before&&N.after>N.before){J.one("#as-date-before-after-error")||J.append('<div id="as-date-before-after-error" class="error"> '+strings.str_advanced_srch_err_before_after_date+"</div>");return;}else{if(M=J.one("#as-before-after-error")){M.remove();}}break;default:return;}D.Object.each(N,function(O,P){I.push(P+":"+D.Date.format(O,L));});return I.join(" ");});E.delegate(["keyup","blur"],F.updateSearchNode,"input[type=text]:not(.as-date-custom-field)",F);E.delegate("click",F.updateSearchNode,"input[type=checkbox]",F);E.all("select").each(function(){this.on("change",F.updateSearchNode,F);});E.delegate("blur",F.updateSearchNode,".as-date-custom-field",F);},instrumentSearch:function(){var E=this.get("contentBox"),F=this.get("searchNode").get("value");if(F!==this.parseFieldNodes()){C.rocketstats.stat("asearch","edited_text");}C.rocketstats.stat("asearch","used");E.all("input, select").each(function(G){if((G.get("type")=="checkbox"&&G.get("checked"))||(G.get("type")!=="checkbox"&&D.Lang.trim(G.get("value")))){C.rocketstats.stat("asearch",G.get("id"));}});},setDimensions:function(){var H=this.get("searchNode"),E=H.get("region"),I=[E.left,E.bottom],G,F;this.set("xy",I);if(E.width<340){G=D.one("#yucs-sprop_button");if(G){F=G.get("region").right-E.left;}}if(!F){F=E.width;}this.set("width",F);return this;},destroy:function(){var F=this.get("srcAcWidget");if(F){F.enable();}for(var E=0;E<this.listeners.length;E++){this.listeners[E]&&this.listeners[E].detach();}this.listeners=[];for(E=0;E<this.widgets.length;E++){this.widgets[E]&&this.widgets[E].destroy();}this.widgets=[];B.superclass.destroy.apply(this,arguments);},close:function(){C.rocketstats.stat("asearch","closed_adv");this.destroy();}},{NAME:"AdvancedSearchWidget",ATTRS:{tmpl:{value:A},criteria:{value:[]},zIndex:{value:13}}});D.mail.ui.AdvancedSearch.widget=B;},"1.0.0",{requires:["ac-widget","common-utils","minty_module_search_advanced_search","datatype-date","mail-ui-advanced-search-ac-widget","node-event-simulate"]});YUI.add("mail-ui-advanced-search",function(D){D.namespace("mail.ui.AdvancedSearch");var B=D.common.Utils;function A(G){var E=G.get("contentBox"),F,H;F=D.Node.create('<li class="as-item"><span role="button" tabindex=0 id="as-button">'+strings.str_advanced_srch+"</span></li>");H=E.one("ul:last-child");if(!H){H=D.Node.create('<ul class="presentation">');E.append(H);}H.append(F);F.setData("selectedCb",function(I){if(I&&I.type==="click"&&I.target.get("id")!=="as-button"){return;}C(G);});}function C(G){var F=D.Node.create('<div id="advanced-search" class="ac-results"></div>'),E=G.get("host");G.hide().disable();D.one("body").append(F);new D.mail.ui.AdvancedSearch.widget({srcAcWidget:G,searchNode:E,contentBox:"#advanced-search"}).render().get("contentBox").one("input[type=text]").focus();B.rocketstats.stat("asearch","opened");}D.mail.ui.AdvancedSearch.addAdvancedSearchItem=A;D.mail.ui.AdvancedSearch.renderAdvancedSearchWidget=C;},"1.0.0",{requires:["common-utils","mail-ui-advanced-search-widget"]});YUI.add("_shared_module_offscreen_bin_modal_onboard_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_modal_onboard_rollup={base:'<div id="onboard-dialog" class="modal modal-settings onboard"> <h2 class="modal-hd"> {{str_modal_onboard_title}} </h2> <p class="description"> {{str_modal_onboard_description}} </p> <div class="modal-bd"> <div role="listbox" aria-describedby="list-instr" class="themes content"> <div class="inner"> {{get_onboard_themes}} </div> </div> <h3 class="section-hd">{{str_modal_onboard_new_features}}</h3> <ul class="section-bd"> <li>{{str_modal_onboard_feature_1}}</li> <li>{{str_modal_onboard_feature_2}}</li> {{att_else}} {{att}} </ul> </div> <div class="modal-ft"> <span id="saveModalOverlay" class="btn left right default"><a href="#" data-action="ok">{{str_btn_gotoinbox}}</a></span> <span id="saveModalOverlay" class="btn left right"><a href="#" data-action="cancel">{{str_btn_notnow}}</a></span> </div></div>',selected:"theme-selected",aria_selected:'aria-selected="true"',themes:'<div role="presentation" id="{{id}}" class="theme {{selected}}"> <div> <a role="option" {{aria_selected}} href="{{href}}" title="{{name}}"> <b {{thumbnail_class}}> {{thumbnail_img}} </b> </a> </div> </div> ',get_onboard_themes:"{{themes}} ",att_else:"<li>{{str_modal_onboard_feature_3}}</li> ",att:"<li>{{str_modal_onboard_feature_att}}</li> "};},"1.0.0");