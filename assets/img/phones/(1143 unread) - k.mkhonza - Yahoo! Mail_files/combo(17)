YUI.add("mail-controller-compose-text",function(A){A.namespace("mail.Controller");var J=A.common.Utils,B=A.common.persist.UserData,P={address:1,blockquote:1,body:1,caption:1,center:1,col:1,colgroup:1,dd:1,dir:1,div:1,dl:1,dt:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,li:1,menu:1,ol:1,p:1,pre:1,table:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,ul:1};function C(S,T){var U=S.cloneNode(true),R=A.Node.getDOMNode(U),Q=F(R);if(T){Q=I(Q,true);}return Q;}function L(S,U){var Q=A.Node.create("<div>"+S+"</div>"),T=A.Node.getDOMNode(Q),R=F(T);if(U){R=I(R);}return R;}function F(R){var Q=A.UA.ie;if(!Q){K(R);}else{R.innerHTML=R.innerHTML.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"<BR/>");}return M(R,false,"").replace(/\n[\s\xA0]+$/,"");}function M(T,X,Y){var a=A.one(T),V,b;if(a.hasClass("compose-ignore")){return"";}else{if(T.nodeType===1||T.nodeType===11){var S=T.tagName;if(A.UA.ie&&T.tagName=="DIV"&&T.getAttribute("class")&&T.getAttribute("class")!=null&&T.getAttribute("class").indexOf("hr")!=-1){S="HR";}switch(S){case"SCRIPT":case"STYLE":case"LINK":case"OBJECT":case"EMBED":return"";case"HR":b=T.previousSibling;return(G(b)?"":"\n")+Y+"________________________________\n"+Y;case"BR":return"\n"+Y;case"BLOCKQUOTE":Y+=">";default:V=[];var Q=T.firstChild;var W=0;if(S==="SPAN"&&A.one(T).hasClass("Apple-tab-span")){return A.one(T).get("text");}while(Q!==null){var Z=M(Q,Q.tagName==="PRE",Y);if(Q.nodeType===1){if(H(Q)==="block"&&V.length>0&&Q.tagName!=="TD"){var U=Z.match(/^[ \t\r\n\v\f]*$/);if(!U||Q.tagName==="LI"){V.push("\n"+Y);}}switch(Q.tagName){case"LI":W++;V.push("\t"+(Q.parentNode.tagName==="OL"?W+".":"*")+" ");break;}}if(Z){V.push(Z);}if(Q.nodeType===1){switch(Q.tagName){case"TD":V.push(" ");break;}}Q=Q.nextSibling;}return V.join("");}}else{if(T.nodeType===3){V=T.nodeValue;if(!X){b=T.previousSibling;var R=b?H(b):null;V=G(b)?V:V.replace(/\n[ \t\r\n\v\f]+/g," ");if(b===null||G(b)){V=V.replace(/^[ \t\r\n\v\f]+/,"");}else{if(R==="block"){V=V.replace(/^[ \t\r\n\v\f]+/,"\n");}else{if(R==="inline"){V=V.replace(/^[ \t\r\n\v\f]+/," ");}}}V=V.replace(/[ \t\r\n\v\f]+$/," ");}return V;}else{return"";}}}}function G(Q){if(Q===null||Q.nodeType!==1){return false;}return Q.tagName==="BR";}function H(Q){if(Q===null||Q.nodeType!==1){return null;}if(Q.style.display){if(Q.style.display==="block"){return"block";}else{if(Q.style.display==="inline"){return"inline";}}}return P[Q.tagName.toLowerCase()]?"block":"inline";}function K(T){if(T.nodeType===1||T.nodeType===11){var R=T.firstChild;while(R!==null){var V=R.nextSibling;K(R);R=V;}}else{if(T.nodeType===3){var S=T.nodeValue;if(S.match(/^[ \t\r\n\v\f]*$/)){var Q=T.previousSibling;var U=Q?H(Q):"inline";if(U==="inline"&&!G(Q)){T.nodeValue=T.nodeValue.replace(/\n.*/," ");}else{T.parentNode.removeChild(T);}}}}}function I(R,Q){R=J.escapeHtml(R);if(Q){R=R.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");R=R.replace(/( ){2}/g,"&nbsp;&nbsp;");}R=R.replace(/\n/ig,"<br />");return R;}function O(R){R=R.replace(/(https?:\/\/[^\s<]+)/ig,"<a target='_blank' href=''>$1</oa>");R=R.replace(/([^\/])(www\.(\w+\.)+[^\s<]+)/ig,"$1<a target='_blank' href='http://'>$2</oa>");R=R.replace(/^(www\.(\w+\.)+[^\s<]+)/ig,"<a target='_blank' href='http://'>$1</oa>");R=R.replace(/((&lt;|&gt;|[^A-Za-z0-9#_\/]){1,10})<\/oa>/g,"</oa>$1");var Q;try{Q=new RegExp("'>([^<]+?)</oa>","g");}catch(S){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-controller-composetext:1",S,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-controller-composetext:1");Q=new RegExp("'>([^<]+)","g");}R=R.replace(Q,"$1'>$1</a>");return R;}function D(U,S,W){var V,R,Y=W&&W.isRich,Q,X=W&&W.text;if(!X){return"";}X=N(X,Y);if(!Y){X=E(X);}else{if(!S){try{Q="<br>";X=X.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,Q);X=X.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,Q);X=X.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,Q);X=X.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,Q);X=X.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,Q);X=X.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,Q);X=X.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"");X=X.replace(/<\/p>/gi,Q);X=X.replace(/(<hr\s*>)/gi,Q+"________________________________"+Q);X=L(X,true);}catch(T){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-controller-composetext:2",T,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-controller-composetext:2");}}}U=U||"";R=U!="";if(X!=""){if(A.UA.ie||A.UA.webkit){if(R){U=U+"<div></div><div>&nbsp;</div>"+X;}else{U="<div></div><div>&nbsp;</div>"+X+U;}}else{if(R){U=U+"<div>&nbsp;</div>"+X;}else{U="<div>&nbsp;</div>"+X+U;}}}return U;}function N(R,Q){if(R!=null){if(!Q){R=R.replace(/<vbr>|\n/gi,"<br />");return"<div>"+R+"</div>";}else{R=R.replace(/<vbr>/gi,"");}}return R||"";}function E(S){var R,Q;S=A.common.Utils.unescapeHtml(S);S=S.replace(/<hr\s*[^>]*>/gi,"<div><hr></div>");S=S.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklineppblanklinepstartptag");S=S.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklinepstartptag");S=S.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,"endptagpblanklinepstartptag");S=S.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"endptagpblanklinepstartptag");S=S.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,"brtag");S=S.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,"brtag");S=S.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");S=S.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");S=S.replace(/<\/p>/gi,"endptag");R=S.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]ltr[\'|\"]\s*[^>]*>/gi,"ltrstartptag");R=R.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]rtl[\'|\"]\s*[^>]*>/gi,"rtlstartptag");R=R.replace(/(<div\s+[^>]*>)|(<div\s*>)/gi,"startptag");S=R.replace(/<\/div>/gi,"endptag");Q=A.common.Utils.escapeHtml(S);Q=Q.replace(/brtag/g,"<br />");Q=Q.replace(/ltrstartptag/g,"<div dir='ltr'>");
Q=Q.replace(/rtlstartptag/g,"<div dir='rtl'>");Q=Q.replace(/startptag/g,"<div>");Q=Q.replace(/endptag/g,"</div>");Q=Q.replace(/pblanklinep/g,"<br/><br/>");return Q;}A.mix(A.mail.Controller.Compose,{convertToPlain:C,convertHTMLToPlain:L,convertGuts:F,injectSignature:D});},"1.0.0",{requires:["common-persist-user-data","mail-controller-compose"]});YUI.add("mail-ui-mailcompose-base-header-conv",function(AB){var r=AB.mail,Ac=AB.Lang.trim,R=AB.Node.create,L=r.Controller.Compose,AY=AB.common.persist.UserData,G=r.persist.MetaData,AJ=AB.common.Utils,v=r.ui.PaneUtils,S=AJ.substitute,AT=AJ.escapeHtml,F=AJ.unescapeHtml,b=strings.str_cfg_tog_unescape_ncr,Ae=AB.ui.Templates,p=Ae._shared_module_compose_message_header_fresh,AA=p&&p.compose_from_address,s=AB.contacts,c=s.utils,An="neo.pref.compose.showBcc",Ad="neo.pref.compose.showCc",AI="hidden",AC="focus",d="compose-field-focus",Ag="offscreen",AK="restore",V="move",J="reply_all",AM="reply_sender",Ah="forward",X={"reply_sender":strings.str_reply,"reply_all":strings.str_reply,"forward":strings.str_forward};var K=function(Y,Ap){var Aq=this;Aq.isLozengeHighlighted=false;Aq.allLozengesSelected=false;Aq.composeView=Ap;Aq.offscreenContent=null;Aq.listeners=[];K.superclass.constructor.apply(Aq,arguments);Aq.neoEvent("updateSubject",{emitFacade:true,broadcast:1});Aq.neoEvent("qrCancel",{emitFacade:true,broadcast:1});};function M(){var Av={},Aw=(AY.get("externalAccounts")||{}).extAccount||[],Ap=(AY.get("aliases")||{}).alias||[],Y=(AY.get("disposableAddresses")||{}).deaName||[],Au=Aw.concat(Ap,Y),As=AY.get("userSendPref"),Aq,Ar,At=Au.length;Av[As.defaultID]=1;Av[As.defaultFromAddress]=1;for(Ar=0;Ar<At;Ar++){if((Aq=Au[Ar].address)){Av[Aq]=1;}}return Av;}function AQ(Y){var Ap=this;if(Ap.composeView.attView){Ap.composeView.attView.reposAttachObj(Y);}}function u(){if(AB.ACWidgetInst){AB.ACWidgetInst.hide();}}function B(Y){Y.removeAttribute("aria-owns");Y.removeAttribute("aria-activedescendant");}function Af(Y){Y.removeAttribute("aria-describedby");}function U(){var Y=AB.ACWidgetInst;Y.get("ac").get("host").set("aria-owns",Y.get("contentBox").generateID());}function Ab(Y){var Ar=Y.ancestor("ul"),Aq=Ar.all(".lozenge-static"),Ap;if(Aq.size()>0){Ap=[];Aq.each(function(As){Ap.push(As.generateID());});}if(Ap){Y.set("aria-describedby",Ap.join(" "));}else{Y.removeAttribute("aria-describedby");}}function o(Aq){var Ap=Aq.get("value"),At=Ap.length,As=parseInt(Aq.ancestor(".ac-input").getStyle("width"),10)-40,Ar=150,Y=17;if(At>Y){Ar+=(At-Y)*10;if(Ar>As){Ar=As;}Aq.setStyle("width",Ar+"px");}else{Aq.setStyle("width","");}}function AV(Au){var Y=false,Aq=null,Ap=null,As=/(<[^<>]+@[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,At,Ar=Au.replace(/\".*\"/g,"");if(!Ac(Ar)||Ar.indexOf("@")<0){return{fail:true,email:Au,name:Au};}if(As.test(Au)){At=Au.match(As);Ap=At[0];Aq=Ac(Au.replace(Ap,""));Ap=Ap.substring(1,Ap.length-1);}else{Ap=Aq=Ac(Au);}if(!AB.comms.Utils.isValidEmail(Ap)){Y=true;}return{fail:Y,email:Ap,name:Aq};}function a(Ap){var Au=0,Ar=0,Aq=Ap.length,Y=[],At=false,Av=false;for(Ar=0;Ar!==Aq;Ar++){var As=Ap.charAt(Ar);switch(As){case'"':At=!At;break;case"&":Av=true;break;case";":if(Av){Av=false;}break;case",":if(!At){Y.push(Ap.slice(Au,Ar));Au=Ar+1;}}}if(Au!==Ar){Y.push(Ap.slice(Au,Ar));}return Y;}function AD(Y){var Aq=Y.ancestor("ul"),Ap=Aq.all(".hLozenge");if(Ap){B(Y);Af(Y);Ap.remove();AB.fire("lozenge:remove");}}function g(){var Ap=this,Y;if(!Ap.isLozengeHighlighted){return;}Y=Ap.composeView.baseNode.all(".hLozenge.focus");Y.removeClass(AC);B(AB.all("#to-field, #cc-field, #bcc-field"));Ap.allLozengesSelected=false;Ap.isLozengeHighlighted=false;}function Al(Ap,Y){var Ar=this;Ar._removeLozengeHighlights();Ap.toggleClass(AC);Ar.isLozengeHighlighted=true;var Aq=Ap.one(".lozenge-static").generateID();Y.setAttrs({"aria-owns":Aq,"aria-activedescendant":Aq});}function w(Y){var Ar=this,Aq=Y.ancestor("ul"),Ap=Aq.all(".hLozenge");if(Ap){Ap.addClass(AC);Ar.isLozengeHighlighted=true;}Ar.allLozengesSelected=true;}function Ak(Y){var As=this,Aq,Ap,Ar;Aq=Y.ancestor();Ap=Ac(Y.get("value"));if(!Ac(Ap)){Y.set("value","");return;}if(Ap&&Ap.indexOf('"')>-1){Ar=a(Ap);}else{if(Ap.lastIndexOf(",")===(Ap.length-1)){Ap=Ap.substring(0,Ap.length-1);}Ar=Ap.split(/[;,]+/);}As._makeLozenges(Ar,Aq);Ab(Y);Y.set("value","");As.checkOtherLozengeBoxes();}function j(){var Ar=this,Aq=Ar.composeView.baseNode,Y,Ap;if(Aq.all("li.hLozenge").size()>100){Ap=new AB.common.ui.Notification({type:"fade",className:"top",parent:"shellcontent",parentType:"id"});Y=Ae._shared_module_offscreen_bin_notification_notifications.addlozenge_exceededmax;Ap.on("clickEvent",function(As){Ap.destroy();});Ap.notify(S(Y,null,null,null,strings),5000);}}function Ai(Au,As){var Av=this,Ap,Y=Au.length,Aq,At,Ar;for(Ap=0;Ap<Y;Ap++){Aq=Au[Ap];Ac(Aq);if(Aq){At=AV(Aq);Ar=Av._createLozenge(At);As.insert(Ar,As);Av.composeView.resizeRTE();Av._checkRecipientCount();Av.composeView._setDirty();}}Av.checkOtherLozengeBoxes();}function AZ(As){var Av,Ar;if(!As){return null;}As.name=As.name||As.email;if(strings.str_cfg_tog_compose_enable_nickname){var Y=c.getContactsByEmail(As.email),Aq;if(Y){Aq=c.getFirstFieldValue(Y[0],"nickname");if(Aq){As.isNN=true;As.name=Aq;}}}if(!Av){Av={email:As.email,firstName:As.name||As.email};}if(As.fail){Ar=strings.str_comp_error_email_lozenge_attr;}else{Ar=As.email;}var Ap,Au={label:F(As.name),hover:F(Ar),state:As.fail?"error":"normal",data:As,menu:null,edit:true,copy:true};Ap=new AB.comms.ui.Lozenge(Au);var At=Ap.getNode();At.set("role","presentation");return At;}function AO(Au){var Av=Au.getData("lozenge");var Ar=Av.data;var At=Av.error;if(strings.str_cfg_tog_compose_enable_nickname){if(Ar.name&&Ar.isNN){var Aq=AB.contacts.utils,Ap=Aq.getContactsByEmail(Ar.email),As,Y;As=Aq.getFirstFieldValue(Ap[0],"name");Y=As?(As.familyName+" "+As.givenName):"";Ar.name=Y;}}if(At){this.currentAddress=Ar.email;this.validAddress=false;}else{this[this.currentField].push(Ar);}}function AG(){var Ax=this,As={to:[],cc:[],bcc:[],validAddress:true,currentAddress:"",currentField:""},Av,Az,A0,Au,A1,Ay,Aq,Y,Ap,Aw,At,Ar;Av=Ax.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge");As.currentField="to";Av.each(AO,As);Az=Ax.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge");As.currentField="cc";Az.each(AO,As);A0=Ax.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge");
As.currentField="bcc";A0.each(AO,As);A1=((AY.get("externalAccounts")||{}).extAccount||[]).length;Ay=((AY.get("aliases")||{}).alias||[]).length;Aq=((AY.get("disposableAddresses")||{}).deaName||[]).length;if((A1>0)||(Ay>0)||(Aq>0)){if(Ax.composeView.type&&Ax.composeView.type==="inlineCompose"){As.from={email:Ax.composeView.cdo.get("header").from.email,name:Ax.composeView.cdo.get("header").from.name};}else{Y=Ax.composeView.baseNode.one(".from-select").get("value");Ap=Y.lastIndexOf("<");Aw=Y.lastIndexOf(">");At=Y.substring(Ap+1,Aw);Ar=Y.substring(0,Ap-1);As.from={email:At,name:Ar};}}else{As.from={email:AY.get("userSendPref.defaultFromAddress"),name:AY.get("userSendPref.defaultFromName")};}Au=Ax.composeView.baseNode.one(".cm-subject-field");if(Au){As.subj=Au.get("value");}else{As.subj=Ax.composeView.cdo.get("header").subject;}return As;}function E(As,A1,Aq){var Au,A0,Ax,Ay,Ap,Aw,Ar,At=AB.mail.ui.PaneUtils,Av=A1.recipients,Az=A1.more_recipients,Y=A1.to_str;if(As){A0=As.to||[];Ax=As.cc||[];Ay=As.bcc||[];Ap=A0.concat(Ax,Ay);Au=Ap.length;Aw=function(A2){var A3={to:At.getConvName(A2),rcpt_id:At.getAddress(A2),rcpt_name:At.getConvName(A2)};return A3;};Ar=At.createRecipientList(Ap,Av,null,Aq,Aw);if(Aq!==""&&Ap.length>Aq){Ar+=S(Az,{num_more_recipients:Ap.length-Aq},0,0,strings);}Ar=S(Y,null,null,null,strings)+Ar;return Ar;}}function Q(Az){var Au=this,As=Au.composeView,Ar,A0,Ax=As.type==="inlineCompose"?As.baseNode.one(".thread-recipients"):null,Av="",Ap=[],At={to:{list:Az.to,node:".cm-to-field"},cc:{list:Az.cc,node:".cm-cc-field"},bcc:{list:Az.bcc,node:".cm-bcc-field"}},Aw=function(A1){var A2={to:v.getConvName(A1),email:v.getAddress(A1)};return A2;};function Aq(A3,A4){var A2=As.baseNode.one(A4),A1=A2.ancestor("li");if(Ax&&A4!==".cm-bcc-field"){Ap=Ap.concat(A3);}AB.Array.each(A3,function(A5){Ar=Au._createLozenge({name:A5.name,email:A5.email});A1.insert(Ar,A1);Au.composeView.resizeRTE();Au._checkRecipientCount();As._setDirty();});Ab(A2);}for(A0 in At){if(At[A0].list){Aq(At[A0].list,At[A0].node);}}if(Ax){Av=v.createRecipientList(Ap,Ae._shared_module_thread_thread_display_rollup.recipients1,null,null,Aw);Ax.setContent(Av);}if(At.cc.list&&At.cc.list.length!==0){Au._bccSwitch(true,false,"cc");}if(At.bcc.list&&At.bcc.list.length!==0){Au._bccSwitch(true,false,"bcc");}if(As.type==="fullCompose"){if(Az.from){Au._setFromMenu(Az.from);}if(Az.subject){As.baseNode.one(".cm-subject-field").set("value",Az.subject);var Ay=AB.UA.ie>0&&AB.UA.ie<10,Y=Ay&&As.baseNode.one(".IEplaceholder");if(Ay&&Y){Y.addClass("hidden");}As._setDirty();}}Au.checkOtherLozengeBoxes();}function C(Ap){var Ar=this,Y=Ar.composeView.baseNode.all("div.ac-input input"),Aq=Ar.composeView.baseNode.all("div.subject input");if(Ap){Y.removeAttribute("readOnly");Aq.removeAttribute("readOnly");}else{Y.setAttribute("readOnly",true);Aq.setAttribute("readOnly",true);}}function f(Aq){var At=this,As,Ap=Aq.name+" "+"<"+Aq.email+">",Y=At.composeView.baseNode.one(".from-select"),Ar=Y.all("option").getDOMNodes();for(As=0;As<Ar.length;As++){if(Ar[As].value===Ap){Y.set("value",Ap);}}}function m(Y,Ay,At,A0){var As=this,Aw,Aq,Ar,Ax=strings.str_tog_loadRTLCss?"rtl":"ltr",A1,Ap=At.fromNameDir||Ax,Az,Au=At.fromName||"",Av=At.address||"";if(!Au&&strings.str_cfg_tog_use_default_fromname){Au=A0;}if(NeoConfig.bidi){Az=(Ap==="rtl"?"\u202B":"\u202A")+Au+"\u202C";A1=(Ax==="rtl"?"\u202B":"\u202A")+"\u200E&lt;"+Av+"&gt;\u200E\u202C";Ar=AT(Az)+" "+A1;}else{Ar=AT(Au,b)+" &lt;"+Av+"&gt;";}if(Av){Aw=S(AA,{isDefault:At.isDefault,address:Ar},As.composeView.formatters,null,strings);Aq=Aw.toLowerCase();Y.push(Aq);Ay[Aq]=Aw;}}function AP(){var A4=this,A6,Aq,BA=[],A7=(AY.get("aliases")||{}).alias||[],Av=A7.length,Au=AY.get("userSendPref"),Ap,BB="",Y,Aw,A5,Az=strings.str_tog_loadRTLCss?"rtl":"ltr",A0=AY.get("externalAccounts")||{},A1=(AY.get("disposableAddresses")||{}).deaName||[],Ar=A1.length,Ax=A0.extAccount||[],A8=Ax.length,A2=A4.composeView.baseNode.one(".from-select"),As={},Ay,At,A9=false;if(Au){BB=Au.defaultFromName||"";}for(A6=0;A6<A8;A6++){Aq=Ax[A6];if(Aq&&Aq.mailFromAllowed){A4._buildFromAccount(BA,As,Aq,BB);if(!A9){A9=Aq.isDefault?true:false;}}}for(A6=0;A6<Av;A6++){Aq=A7[A6];if(Aq){A4._buildFromAccount(BA,As,Aq,BB);if(!A9){A9=Aq.isDefault?true:false;}}}for(A6=0;A6<Ar;A6++){Aq=A1[A6];if(Aq&&(!strings.tog_check_active_compos||Aq.activeComposition)){A4._buildFromAccount(BA,As,Aq,Aq.address);if(!A9){A9=Aq.isDefault?true:false;}}}if(Au){if(NeoConfig.bidi){Aw=Au.defaultFromNameDir||Az;Y=(Aw==="rtl"?"\u202B":"\u202A")+BB+"\u202C";A5=(Az==="rtl"?"\u202B":"\u202A")+"\u200E&lt;"+Au.defaultFromAddress+"&gt;\u200E\u202C";Ap=AT(Y)+" "+A5;}else{Ap=AT(BB,b)+" "+"&lt;"+Au.defaultFromAddress+"&gt;";}Ay=S(AA,{isDefault:(A9)?false:true,address:Ap},A4.composeView.formatters,null,strings);At=Ay.toLowerCase();BA.push(At);As[At]=Ay;}if(BA.length>(Au?1:0)){A4.composeView.baseNode.one("div.account-select").removeClass(AI);}BA=BA.sort(function(BD,BC){if(BD<BC){return -1;}if(BD>BC){return 1;}return 0;});var A3=[];for(A6 in BA){A3.push(As[BA[A6]]);}A2.setContent(A3.join(""));AB.later(10,A4,function(BC){if(BC>-1){A2.set("selectedIndex",BC);}},A2.all("option").indexOf(A2.one(".nsel")));}function AF(){var Aq=this,Ap=p.show_full_header,Y=S(Ap,Aq.cdo,Aq.composeView.formatters,null,strings,Ae);Aq.hdr=Aq.composeView.baseNode.one(".compose-header");Aq.hdr.setContent(Y);Aq._bindUIHeader();Aq._buildFromMenu();}function AS(Aq,Ap){var Ar=this,Y;Ap=Ap||"";Y=(Ap)?1:0;Ar._bccSwitch(Y,false,"cc");}function AL(Aq){var Ap,Y=-1;if(typeof Aq.get("selectionEnd")==="number"){Y=Aq.get("selectionEnd");}else{if(document.selection&&document.selection.createRange){Ap=document.selection.createRange();Ap.moveStart("character",-Aq.get("value").length);Y=Ap.text.length;}}return Y;}function l(Y,As){As=As||"bcc";var Au=this,At=Au.composeView.baseNode,Ar=At.one(".cm-"+As+".ac-input").all(".hLozenge"),Ap=At.one(".cm-"+As+"-field"),Aq=(As==="bcc")?An:Ad;if(Y||(Ar.isEmpty()&&Ap.get("value").length===0)){Au._bccSwitch(Y,true,As);Aq!==An&&G.set(Aq,Y);
}else{Au.composeView.confirm(null,strings["str_comp_conf_"+As],function(){Ar.each(function(Av){Av.remove();Au.composeView._setDirty();});Ap.set("value","");Au._bccSwitch(false,true,As);Aq!==An&&G.set(Aq,false);});}}function AU(Av,At,Aq){Aq=Aq||"bcc";var Ar=this,Ap=Ar.composeView.baseNode.all(".cm-btn-show-"+Aq),Aw=Ar.composeView.baseNode.one(".cm-"+Aq+"-group");if(typeof At==="undefined"){At=true;}if(Av){Aw.removeClass(AI);Ap.addClass(AI);At&&Ar.composeView.setFocus(Aq);}else{Aw.addClass(AI);Ap.removeClass(AI);At&&Ar.composeView.setFocus(Aq);}var Y=Ar.composeView.baseNode.one(".cm-bcc-group"),Au=Ar.composeView.baseNode.one(".cm-cc-group"),As=Ar.composeView.baseNode.one(".btn-bcc-in-cc");if(Y.hasClass(AI)){if(Av){As.removeClass(AI);}else{if(Au.hasClass(AI)){As.addClass(AI);}else{As.removeClass(AI);}}}Ar._reposAttachObj(V);Ar.composeView.resizeRTE();}function Ao(Y){var Ap=this;if(NeoConfig.isCorpmail){AB.use("ac-corp-widget",function(){Ap._initAutoComplete2(Y);});}else{Ap._initAutoComplete2(Y);}}function y(At){var Aq={"to-field":".cm-to","cc-field":".cm-cc","bcc-field":".cm-bcc"},Au=this,Ar=NeoConfig.isCorpmail?s.ui.ACCorpWidget:s.ui.ACWidget,As=At.get("id");if(As&&Aq[As]){At.removeClass("whiteout");var Ap=Au.composeView.baseNode.one(Aq[As]);var Y=function(){Au.listeners.push(AB.ACWidgetInst.get("ac").on("ac:query",function(A0){var Av=this,Ay=A0.value,Az,Ax;if(c.areContactsLoaded()){var Aw=new AB.comms.FilterContacts();Aw.updateFilterItems(Ay);Az=Aw.fastMatch();Az.queryStr=Ay;Ax=AB.bind(Av.reload,Av,Az);Ax(Az);}}));};if(!AB.ACWidgetInst){if(Au.offscreenContent){Au.offscreenContent.remove();}Au.offscreenContent=AB.Node.create(S(Ae._shared_module_offscreen_bin_compose.base,{},null,null,strings,Ae));AB.one(document.body).append(Au.offscreenContent);AB.ACWidgetInst=new Ar({acNode:Ap,acTarget:At,contentBox:"#ac-to-results",selectFirst:true}).setAlign().render();Au._setACWidgetARIAOwns();AB.ACWidgetInst.after("visibleChange",function(Ay){var Ax=this.get("ac").get("host"),Av=AB.ACWidgetInst.get("contentBox").one("li"),Aw=(Ay.newVal&&Av)?true:false;Ax.set("aria-expanded",Aw);if(!Aw){Ax.set("aria-activedescendant","");}});AB.ACWidgetInst.after("selectedIndexChange",function(Aw){var Av="";if(Aw.newVal>-1){Av=this.get("contentBox").one(".yui3-acwidget-selected").generateID();}this.get("ac").get("host").set("aria-activedescendant",Av);});Y();}else{if(AB.ACWidgetInst.get("ac").get("alignNode")!==Ap){AB.ACWidgetInst.get("ac").destructor();AB.ACWidgetInst.refresh({acNode:Ap,acTarget:At,width:Ap.getStyle("width"),selectFirst:true}).setAlign().render();Y();Au._setACWidgetARIAOwns();}}}}function D(){var Ar=this,Ap=Ar.listeners;if(Ap){var Aq=Ap.length,Y;for(Y=0;Y<Aq;Y++){if(Ap[Y]){Ap[Y].detach();}}Ap.length=0;}if(Ar.lozengeDD){Ar.lozengeDD.destroy(true);}if(Ar.hdr){Ar.hdr.detachAll();Ar.hdr.remove();}K.superclass.ondestroy.call(Ar,arguments);}function W(Ap){var Ar=this,Y=Ap.target,Aq=Y.ancestor("div.ac-input",false);if(Aq){Ar.composeView.focusNode=Aq.get("id");Aq.addClass(d);Aq.get("parentNode").addClass("active");}if((Y.hasClass("cm-to-field"))||(Y.hasClass("cm-cc-field"))||(Y.hasClass("cm-bcc-field"))){Ar.composeView._registerFocus(Y);Ar._initAutoComplete(Y);Ar.checkOtherLozengeBoxes();}}function Aa(Y){if(!(AB.one("div.ac-results:hover")||AB.one("div.ac-results li.over")||AB.one("li.yui3-aclist-item-hover"))){u();this._lozengeIt(Y);AB.ACWidgetInst.get("ac").set("queryValue","");}}function q(Aq){var As=this,Ap=Aq.target,Y=As.composeView.cdo;if(Ap.hasClass("cm-to-field")||Ap.hasClass("cm-cc-field")||Ap.hasClass("cm-bcc-field")){Aq.halt();this.handleACBlur(Ap);}else{if(Ap.get("id")==="subject-field"){var Ar=Ap.get("value");if(Ar&&Ar!==""){if(Y.oComposeData&&Y.oComposeData.header&&typeof Y.oComposeData.header.subj!=="undefined"&&Y.oComposeData.header.subj!==Ar){As.composeView._setDirty();}}}}}function A(Au,A1){var As=this,Av=Au.target,A3=Au.keyCode,A2,At,Aq=Av.ancestor("div"),Ay=Aq.one(".hLozenge.focus"),Az=Av.get("value"),Ar,Aw,A0=Av.get("id");if(A0){A2={"to-field":A1.one("#to_add_contacts"),"cc_show_btn_in_to":"to","cc_hide_btn":"cc","cc-field":A1.one("#cc_add_contacts"),"bcc-field":A1.one("#bcc_add_contacts"),"bcc_show_btn_in_cc":A1.one("#cc_hide_btn"),"bcc_hide_btn":"bcc"};At={"to-field":A1.one("#cc_show_btn_in_to"),"to_add_contacts":"to","cc_add_contacts":"cc","cc_hide_btn":A1.one("#bcc_show_btn_in_cc"),"bcc_add_contacts":"bcc","cc_show_btn_in_to":A1.one("#bcc_show_btn_in_to"),"cc-field":A1.one("#cc_hide_btn"),"bcc-field":A1.one("#bcc_hide_btn")};if(A3===39){if(Av.get("nodeName")==="A"||(!Az&&!Ay)||(Az&&AL(Av)===Az.length)){Ar=At[A0];if(Ar){As.composeView.setFocus(Ar);if(Ar==="to"||Ar==="cc"||Ar==="bcc"){var Ap=A1.one("#"+Ar);Aw=Ap.one(".hLozenge");if(Aw){As._selectSingleLozenge(Aw,Ap);Ap.addClass("whiteout");}}return;}}}}if(!Av.get("value")){Au.preventDefault();var Ax;if(Ay){if(A3===37){Ax=Ay.previous();if(!Ax){A2[A0]&&As.composeView.setFocus(A2[A0]);As._removeLozengeHighlights();Av.removeClass("whiteout");}}else{Ax=Ay.next();if(!Ax.hasClass("hLozenge")){Ax=null;As._removeLozengeHighlights();Av.removeClass("whiteout");}}if(Ax){As._removeLozengeHighlights();As._selectSingleLozenge(Ax,Av);}}else{if(A3===37){var Y=Av.ancestor();Ax=Y.previous();if(Ax&&Ax.hasClass("hLozenge")){As._removeLozengeHighlights();As._selectSingleLozenge(Ax,Av);Av.addClass("whiteout");}else{A2[A0]&&As.composeView.setFocus(A2[A0]);}}}}}function t(As){var Ar=this,Ax=As.keyCode,At=As.target;if(!At.get("value")){var Y=At.ancestor(),Aq=At.ancestor("div"),Aw=Aq.all(".hLozenge.focus"),Ap=Aw.size();As.halt();if(Ar.allLozengesSelected){Ar.removeAllLozenges(At);At.removeClass("whiteout");return;}var Av,Au;if(Ap){Ar.removeARIAFocus(At);Ar.removeARIADescription(At);if(Ap===1){Av=Aw.item(0);Au=Av.next();if(Au===Y){Au=Av.previous();}if(Au){Ar._selectSingleLozenge(Au,At);}else{At.removeClass("whiteout");}}else{At.removeClass("whiteout");}Ar.composeView._setDirty();Aw.detachAll();Aw.remove();Aw=null;AB.fire("lozenge:remove");}else{if(Ax===8){Au=Y.previous();
if(Au){Ar._removeLozengeHighlights();Ar._selectSingleLozenge(Au,At);At.addClass("whiteout");}}}Ar.checkOtherLozengeBoxes();Ar.composeView.resizeRTE();}}function n(){var As=this,Aq=As.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge").size(),Y=As.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge").size(),Ar=As.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge").size(),Ap=0;Ap=Aq+Y+Ar;As.totalLozenges=Ap;return Ap;}function AW(){var Ap=this,Y=Ap.lozengeCount();if(Y<=0){Ap.composeView._showSendBtn(false);}else{Ap.composeView._showSendBtn(true);}}function P(){var Y=AB.ACWidgetInst;if(Y.canHandleEnter){return Y.canHandleEnter();}return(Y&&Y.isVisible()&&(Y.get("data").length>0||(NeoConfig.isCorpmail&&Y.get("gabData").length>0)));}function h(Aq,Au){var At=this,Az=AB.ACWidgetInst,Ay=Aq.decodeCategory(Au.get("value")),Ax=function(A6,A5,A3,A4,A2){switch(A5){case"amp":if(A3){return Ax(A6,A3,"",A4+5,A2);}return"&";case"#39":return"'";case"quot":return'"';case"lt":return"<";case"gt":return">";case"#35":return"#";default:return"";}};if(Ay){var A0,Aw=[];for(A0 in Ay){var Av=Ay[A0];if(Av){var Ap="",Ar=Av.firstname&&AT(Av.firstname),A1=Av.middlename&&AT(Av.middlename),As=Av.lastname&&AT(Av.lastname),Y=Av.nickname&&AT(Av.nickname);Ap=Az.buildName(Ar,A1,As,Y);Ap=Ap+"("+Av.email+")";Aw.push(Ap.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,Ax));}}At._makeLozenges(Aw,Au.ancestor());At.addARIADescription(Au);Au.set("value","");}else{At._lozengeIt(Au);}}function i(At){var As=this,Au=At.target,Y=At.ctrlKey,Av=At.metaKey,Ax=AB.ACWidgetInst;if(Au.get("nodeName")==="A"||(Y||Av)){return;}var Ap=new AB.comms.FilterContacts();if(As.canACWidgetInstHandleEnter()){Ax.handleEnter(At,Ax);}else{Ap.updateFilterItems(Au.get("value"));var Ay=Ap.fastMatch();if(Ay&&Ay.length){var Ar=Ay[0],Az=R(Ax.getItemMarkup(Ar));Az.one("span.ac-remove-item").remove();Au.set("value",Az.get("text"));}else{}}At.halt();if(!Au.get("value")){At.preventDefault();var Aq=Au.ancestor("div");var Aw=Aq.one(".hLozenge.focus");if(Aw){Aw.getData("lozenge").startEdit();}return;}As.setACCategory(Ap,Au);}function k(As){var Ar=this,At=As.target,Y=As.ctrlKey,Au=As.metaKey,Ax=AB.ACWidgetInst,Aq,Aw,Ap=(Aq=Ax.get("data"))&&Aq.length,Av=(Aw=Ax.get("gabData"))&&Aw.length;if((Y||Au)||!At.get("value")){return;}if(Ap>=2||Av>=2){return;}else{if(Ap===1||Av===1){As.halt();if(Ax&&Ax.isVisible()){At.simulate("keydown",{keyCode:13});}}else{As.halt();Ar._lozengeIt(At);}}}function T(Ap){var As=this,Y=Ap.target,Ar=Ap.ctrlKey,Aq=Ap.metaKey;if((!Ar&&!Aq)||Y.get("value")){return;}Ap.halt();As._selectAllLozenges(Y);Y.addClass("whiteout");}function e(At){var As=this,Ar,Au=At.target,Ap=At.ctrlKey,Av=At.metaKey,Y=At.altKey,Aw=AB.ACWidgetInst,Aq=(Ar=Aw.get("data"))&&Ar.length;if(!Au.get("value")){if(Aw.hasItemSelected){if(!Aw.hasItemSelected()){return;}}else{if(!Aw.isVisible()){return;}}}if(!Ap&&!Av&&!Y){if(Aq>=1){At.halt();}As.composeView.keepHdrFocus=true;Au.simulate("keydown",{keyCode:13});}}function Z(Aq){var At=this,As=Aq.ctrlKey,Ar=Aq.metaKey,Ap=(AB.UA.os==="macintosh")?Ar:As;function Y(){var Aw=At.hdr,Av=r.ui.MessagePaneUtils,Au="";Aw.all("li.focus").each(function(Ax){Au+=Ax.one("input").get("value");Au+="; ";});if(Au!==""){Au=Au.substring(0,Au.length-1);Av.initializeCopyText();Av.copyToClipboard(Au,null,document.activeElement);}}if(Ap){Aq.stopPropagation();Y();}}function AH(Aq){var At=this,Ap=Aq.target,As=Aq.ctrlKey,Ar=Aq.metaKey,Y=(AB.UA.os==="macintosh")?Ar:As;if(Y){setTimeout(function(){At.updateTextField(Ap);},0);}}function AN(Ar){var Au=this,Aq=Ar.target,Y=Ar.shiftKey,At=Ar.ctrlKey,As=Ar.metaKey,Ap=(AB.UA.os==="macintosh")?As:At;Aq.removeClass("whiteout");if(!(Ap||Y)){Au._removeLozengeHighlights();}}function AR(Ar){var As=this,Aq=Ar.target;if(Aq.hasClass("cm-to-field")||Aq.hasClass("cm-cc-field")||Aq.hasClass("cm-bcc-field")){var Y=As.composeView.baseNode.one(".ac-input.compose-field-focus .recipient-input input"),Ap=As.totalLozenges;if(Y===null&&Ap<=0){As.composeView._showSendBtn(false);}else{if(Y.getDOMNode().value===""&&Ap<=0){As.composeView._showSendBtn(false);}else{As.composeView._showSendBtn(true);}}}}function O(As){var Aq=this,Aw=Aq.hdr,Ay=As.keyCode,Au=As.shiftKey,Ap=As.ctrlKey,At=As.metaKey,Y=As.altKey,Av=(AB.UA.os==="macintosh")?At:Ap,Ax,Ar=As.target,Az=(parseInt(NeoConfig.infinitePane,10)===1);if(Ar.hasClass("cm-from-field")){if(Az&&(As.keyCode===37||As.keyCode===39)){As.stopPropagation();}}if(Ar.hasClass("cm-subject-field")||Ar.hasClass("cm-to-field")||Ar.hasClass("cm-cc-field")||Ar.hasClass("cm-bcc-field")||Ar.get("nodeName")==="A"){if(Az&&(As.keyCode===37||As.keyCode===39)){As.stopPropagation();}if((Ay===83||(Ay===89&&Au)||(Ay===85&&Au))&&(Ap||At)||Ay===27){Aq.composeView.get("keydownHandler")?Aq.composeView.get("keydownHandler")(As):Aq.composeView.onKeyDown(As);return;}else{if(Ar.hasClass("cm-subject-field")){Ax=(Ap||At)&&(!Y&&!Au)||Ay===9;if(!Ax||(Av&&Ay===86)){Aq.composeView._setDirty();}if(Ay===9&&!Au){Ar.blur();Aq.composeView.setFocus("body");As.halt();}return;}else{switch(Ay){case 37:case 39:Aq.handleLeftRightArrow(As,Aw);break;case 8:case 46:Aq.handleDelete(As);break;case 13:Aq.handleEnter(As);break;case 32:Aq.handleSpacebar(As);break;case 65:Aq.handleSelectAll(As);break;case 38:break;case 9:Aq.handleTab(As);break;case 67:Aq.handleCopy(As,Aw);break;case 86:Aq.handlePaste(As);break;default:Aq.handleDefaultKeydown(As);}}}}}function I(){var Aq=this,Ap=Aq.hdr,Y=Aq.listeners;Y.push(Ap.on("blur",Aq.setInputBlur,Aq));Y.push(Ap.on("keydown",Aq.keyHandler,Aq));Y.push(Ap.on("keyup",Aq.sendEnableKeyHandle,Aq));Y.push(Ap.on("change",function(As){var Ar=As.target;if(Ar.hasClass("cm-to-field")||Ar.hasClass("cm-cc-field")||Ar.hasClass("cm-bcc-field")){Aq.composeView._setDirty();}}));}function AX(Ap){var Aq=this,Y=Ap.dataAction;switch(Y){case"edit_recipients":AB.fire("mt:click",{action:"reply_card_menu_"+Y});break;case"reply_all":case"reply_sender":case"forward":Aq.switchReplyMode(Ap.dataAction);AB.fire("mt:click",{action:"reply_card_menu_"+Y});
break;case"edit_subject":Aq.allowSubjectEdit(true);break;}}function N(Ar){var As=this,Y=As.composeView.cdo.oComposeData.origin,Aq=AB.common.ui.MenuHelper,Ap=Ar.target;AB.use("mail-ui-inboxmenu-base","_shared_module_offscreen_bin_menus_reply_modes",function(At){At.mail.ui.InboxMenu.insert("menu-reply-modes",function(){var Au=At.one("#menu-reply-modes");Aq.create(Ap,{menu:Au,flushLeft:false,isContext:false,xy:[Ar.clientX,Ar.clientY]},function(){Au.on("menuSelected",As.onReplyModeSelected,As);Au.after("menu:state",function(Aw){var Av=Aw.state;if(Av==="hide"){Ap.removeClass("pressed");Ap.unplug(At.Plugin.Menu);this.destroy(true);}});});},Y.fid,{origin:Y,isQuickReply:As.composeView.get("isQuickReply")});});}function Am(){var Y=this;Y.listeners.push(Y.hdr.delegate("click",function(Ap){var Aq=AJ.getDataAction(Ap).action;switch(Aq){case"menu":Y.loadReplyModeMenu(Ap);AB.fire("mt:click",{action:"reply_card_"+Aq});break;case"qr-cancel":Y.neoFire("qrCancel");AB.fire("ToolTips:hideTooltips");AB.fire("mt:click",{action:"reply_card_"+Aq});break;case"compose-recpt-more":Y.hdr.one(".recipients").set("innerHTML",Y._getRecptList(Y.composeView.cdo.oComposeData.header,p,""));break;}},".compose-header"));}function AE(){var Ar=this,Aq=Ar.composeView.baseNode,Y=Aq.one("input.cm-subject-field"),As=Aq.one("input.cm-to-field"),At=Aq.one("input.cm-cc-field"),Aw=Aq.one("input.cm-bcc-field"),Av=AB.UA.ie>0&&AB.UA.ie<10,Ap=Av&&Aq.one(".IEplaceholder"),Au=Ar.hdr;if(NeoConfig.bidi){Y.plug(AB.Plugin.BidiTextEntry);}Ar._bindAutoComplete();Ar.listeners.push(AB.on("lozenge:highlight",function(){Ar.isLozengeHighlighted=true;}));if(NeoConfig.useDD&&Ar.composeView.type==="fullCompose"){AB.use("common-ui-lozengeDD",function(Ax){Ax.Lang.later(0,0,function(){Ar.lozengeDD=new Ax.common.ui.lozengeDD({composeView:Ar.composeView,dragSelector:".ac-input"});});});}Ar.listeners.push(Au.on("focus",W,Ar));Ar.listeners.push(Y.after("focus",function(){Ar.composeView._registerFocus(Y);if(Av){Ap.addClass("hidden");}}));Ar.listeners.push(Y.on("change",function(){if(Av){Ap.addClass("hidden");}}));Ar.listeners.push(As.after("blur",function(){As.ancestor("div").removeClass(d);Ar.composeView.resizeRTE();})),Ar.listeners.push(At.after("blur",function(){At.ancestor("div").removeClass(d);Ar.composeView.resizeRTE();})),Ar.listeners.push(Aw.after("blur",function(){Aw.ancestor("div").removeClass(d);Ar.composeView.resizeRTE();})),Ar.listeners.push(Y.after("blur",function(Ax){Ar.neoFire("updateSubject");if(Av&&AB.Lang.trim(Ax.target.get("value"))===""){Ap.removeClass("hidden");}}));Ar.listeners.push(Au.delegate("click",function(Az){Az.halt();Ar._reposAttachObj(Ag);var Ax={"to_add_contacts":".cm-to","cc_add_contacts":".cm-cc","bcc_add_contacts":".cm-bcc"},Ay={wspath:NeoConfig.socdirProxyPath,guid:NeoConfig.neoguid,wssid:NeoConfig.wssid,requestFn:AB.common.net.SessionMgr.requestProxy,selectAll:false,lookForSelect:true,lookForInput:true,onDone:function(A6,A8){var A3,A9,A5,A4=A8.get("id"),A2=Ar.composeView.baseNode.one(Ax[A4]).all("li"),A7=A2.item(A2.size()-1);for(A3 in A6){A9={name:A6[A3].name,email:F(A6[A3].field.value)};A5=Ar._createLozenge(A9);Ar.composeView._setDirty();A7.insert(A5,A7);Ar.composeView.resizeRTE();Ar._checkRecipientCount();}Ar._reposAttachObj(AK);Ar.composeView._restoreFocus();},onCancel:function(){Ar._reposAttachObj(AK);}};AB.use("contacts-ui-choosecontactdialog",function(A2){if(!Ar.composeView.cancelDialogLoad){A2.fire("ccd:create",Ay,Az.currentTarget);}});var A1=Az.currentTarget.get("id"),A0="addbcc";if(A1==="to_add_contacts"){A0="addrec";}else{if(A1==="cc_add_contacts"){A0="addcc";}}AB.fire("mt:click",{action:"cmps_"+A0,append:{t1:"cmpsTb"}});},".choose-contact"));Ar.listeners.push(Au.delegate("click",function(A0){var Az=A0.target,Ay=A0.currentTarget,A2=Ay.getElementsByTagName("INPUT"),Ax=A2.item(A2.size()-1),A1;if(Az.hasClass("lozenge-edit")){return;}A1=Ay.get("scrollTop");Ax.focus();if(Az.hasClass("lozenge-static")||Az.hasClass("lozenge-edit")){Ay.set("scrollTop",A1);Ax.addClass("whiteout");}else{Ax.removeClass("whiteout");Ar._removeLozengeHighlights();Ay.set("scrollTop",Ay.get("scrollHeight"));}},"div.ac-input"));Ar.listeners.push(Au.on("keyup",function(A0){var A1=A0.target,Ay=A1.get("value"),Az=Ay.length,Ax=Ay[Az-1];if(!(A1.hasClass("cm-to-field")||A1.hasClass("cm-cc-field")||A1.hasClass("cm-bcc-field"))){return;}if(Az>0){Ar.composeView._setDirty();}if(Ax===";"||Ax===","){A0.halt();Ay=Ac(Ay);if(Ay.length===1){A1.set("value","");return;}if(!Ay){return;}Ar._lozengeIt(A1);}Ar.updateTextField(A1);Ar._reposAttachObj(V);}));}function H(Y,Ap){var Aq=Y.action===J;if(Aq){Ap.removeClass("ico-thread-reply");Ap.addClass("ico-thread-reply-all");}else{Ap.removeClass("ico-thread-reply-all");Ap.addClass("ico-thread-reply");}}function x(Ar){Ar=Ar||0;var Au=this,Ax=Au.composeView.cdo.oComposeData.origin,Y=Au.composeView.baseNode,As=Y.all(".replyall-toggle-btn a"),Ap,Av,Aq=Y.one(".qr-card-actions");if(!Ar){Ar=Ax.action===AM?J:AM;}Ax.action=Ar;if(Aq){Aq.replace(S(Ae._shared_module_compose_quick_reply_card_actions.base,{reply_type:X[Ar]},null,null,strings));}if(Ar===AM){As.set("text",strings.str_comp_btn_reply_all);AJ.rocketstats.stat("SwitchReplyMode","Reply_To_Sender");!Au.composeView.get("isQuickReply")&&AB.fire("mt:click",{action:"cmps_rplysndr",append:{t1:"cmpsTb"}});}else{if(Ar===J){As.set("text",strings.str_comp_btn_reply_sender);AJ.rocketstats.stat("SwitchReplyMode","Reply_All");!Au.composeView.get("isQuickReply")&&AB.fire("mt:click",{action:"cmps_rplyall",append:{t1:"cmpsTb"}});}else{if(Ar===Ah){AJ.rocketstats.stat("SwitchReplyMode","Forward");!Au.composeView.get("isQuickReply")&&AB.fire("mt:click",{action:"cmps_fwd",append:{t1:"cmpsTb"}});Au.allowSubjectEdit(false);}}}L.updateAttachments(Au.composeView.cdo);if(Au.composeView.type==="inlineCompose"){H(Ax,As);}Av=L.getHeaderContent(Ax);Ap=Y.one(".cm-subject-field");if(Ap){Av.subject=Ap.get("value");}var At=Y.one(".cm-to-field"),Aw=Y.one(".cm-cc-field");Au.removeAllLozenges(At);Au.removeAllLozenges(Aw);
Au.setHeader(Av);Au.composeView._restoreFocus();}function z(){var A1=this,Aq=A1.hdr,A0,A2,Ar=A1.composeView.cdo.oComposeData.origin,A4=Ar&&Ar.oMsg&&Ar.oMsg.header,Ax=Ar&&Ar.oMsg&&Ar.oMsg.body,Av=A4&&((A4.to?A4.to.length:0)+(A4.cc?A4.cc.length:0))||0,A3=Ar.action,Au,At,As,Y=A1.composeView.baseNode,Ay=Y.all(".replyall-toggle-btn"),A5,Ap={},A7,Az,Aw=1,A6;if(Ar.fid==="Sent"&&A3===AM){Ar.action=J;}if((A3!==J&&A3!==AM)||!Ax||!Av){return;}if(A4.replyto){A6=A4.replyto.length;for(A5=0;A5<A6;A5++){Ap[A4.replyto[A5].email]=1;}}A7=A4.to.concat(A4.cc);Au=A1.getAllAccountEmails()||{};A6=A7.length;for(A5=0;A5<A6;A5++){At=A7[A5].email||"";if((Az&&At!==Az)||(A6===1&&!(At in Au||At in Ap))){Aw=0;}Az=At;if((At in Au||At in Ap)&&!As){As=0;}else{As=1;}}if(A3&&As&&!Aw&&Y.one(".replyall-toggle-btn")&&Ar.fid!=="Sent"){Ay.removeClass("hidden");A0=Aq.one("#to");A2=Aq.one(".address-btns");if(A2&&A0.getX()+A0.get("clientWidth")+A2.get("clientWidth")+20>Aq.get("clientWidth")+Aq.getX()){Ay.addClass("hidden");return;}if(A1.composeView.type==="inlineCompose"){H(Ar,Y.all(".replyall-toggle-btn a"));}A1.listeners.push(Y.delegate("click",function(){A1.switchReplyMode();},".address-btns .replyall-toggle-btn a",A1));}}function Aj(Y){var Ap=this.hdr.one(".subject");Ap.removeClass("hidden");if(Y){setTimeout(function(){Ap.one("input").focus();},0);}}AB.extend(K,r.ui.BaseWidget);AB.mix(K.prototype,{NAME:"HeaderBase",render:AF,getHeader:AG,setHeader:Q,enableHeader:C,getAllAccountEmails:M,allowEditing:AS,_bindUIHeader:AE,bind:Am,loadReplyModeMenu:N,setInputFocus:W,setInputBlur:q,keyHandler:O,lozengeCount:n,sendEnableKeyHandle:AR,handleACBlur:Aa,handleLeftRightArrow:A,handleDelete:t,handleEnter:i,handleSpacebar:k,handleTab:e,handleSelectAll:T,handleCopy:Z,handlePaste:AH,handleDefaultKeydown:AN,setACCategory:h,canACWidgetInstHandleEnter:P,checkOtherLozengeBoxes:AW,_bindAutoComplete:I,ondestroy:D,destroy:D,hideACWidget:u,_cmdBccSwitch:l,_reposAttachObj:AQ,_setFromMenu:f,removeAllLozenges:AD,_removeLozengeHighlights:g,_createLozenge:AZ,enableSwitchReplyButton:z,switchReplyMode:x,_lozengeIt:Ak,_checkRecipientCount:j,_makeLozenges:Ai,_selectSingleLozenge:Al,_selectAllLozenges:w,_tokenizeAddresses:a,removeARIAFocus:B,_setACWidgetARIAOwns:U,removeARIADescription:Af,addARIADescription:Ab,updateTextField:o,_buildFromAccount:m,_buildFromMenu:AP,createAddress:AV,_initAutoComplete:Ao,_initAutoComplete2:y,_bccSwitch:AU,_getRecptList:E,getCursorLocation:AL,onReplyModeSelected:AX,allowSubjectEdit:Aj,_ccSwitch:function(){}},true);AB.namespace("mail.compose");r.compose.HeaderBaseConv=K;},"1.0.0",{requires:["comms-ui-lozenge","ac-widget","_shared_module_offscreen_bin_compose","mail-controller-compose","_shared_module_offscreen_bin_notification_notifications","mail-controller-compose-text","contacts-api","_shared_module_compose_message_header","_shared_module_compose_message_header_fresh","mail-ui-basewidget"]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("selector-css3",function(e,t){e.Selector._reNth=/^(?:([\-]?\d*)(n){1}|(odd|even)$)*([\-+]?\d*)$/,e.Selector._getNth=function(t,n,r,i){e.Selector._reNth.test(n);var s=parseInt(RegExp.$1,10),o=RegExp.$2,u=RegExp.$3,a=parseInt(RegExp.$4,10)||0,f=[],l=e.DOM._children(t.parentNode,r),c;u?(s=2,c="+",o="n",a=u==="odd"?1:0):isNaN(s)&&(s=o?1:0);if(s===0)return i&&(a=l.length-a+1),l[a-1]===t?!0:!1;s<0&&(i=!!i,s=Math.abs(s));if(!i){for(var h=a-1,p=l.length;h<p;h+=s)if(h>=0&&l[h]===t)return!0}else for(var h=l.length-a,p=l.length;h>=0;h-=s)if(h<p&&l[h]===t)return!0;return!1},e.mix(e.Selector.pseudos,{root:function(e){return e===e.ownerDocument.documentElement},"nth-child":function(t,n){return e.Selector._getNth(t,n)},"nth-last-child":function(t,n){return e.Selector._getNth(t,n,null,!0)},"nth-of-type":function(t,n){return e.Selector._getNth(t,n,t.tagName)},"nth-last-of-type":function(t,n){return e.Selector._getNth(t,n,t.tagName,!0)},"last-child":function(t){var n=e.DOM._children(t.parentNode);return n[n.length-1]===t},"first-of-type":function(t){return e.DOM._children(t.parentNode,t.tagName)[0]===t},"last-of-type":function(t){var n=e.DOM._children(t.parentNode,t.tagName);return n[n.length-1]===t},"only-child":function(t){var n=e.DOM._children(t.parentNode);return n.length===1&&n[0]===t},"only-of-type":function(t){var n=e.DOM._children(t.parentNode,t.tagName);return n.length===1&&n[0]===t},empty:function(e){return e.childNodes.length===0},not:function(t,n){return!e.Selector.test(t,n)},contains:function(e,t){var n=e.innerText||e.textContent||"";return n.indexOf(t)>-1},checked:function(e){return e.checked===!0||e.selected===!0},enabled:function(e){return e.disabled!==undefined&&!e.disabled},disabled:function(e){return e.disabled}}),e.mix(e.Selector.operators,{"^=":"^{val}","$=":"{val}$","*=":"{val}"}),e.Selector.combinators["~"]={axis:"previousSibling"}},"3.13.0",{requires:["selector-native","selector-css2"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("frame",function(e,t){var n=e.Lang,r="contentready",i="host",s=function(){s.superclass.constructor.apply(this,arguments)};e.extend(s,e.Plugin.Base,{_ready:null,_rendered:null,_iframe:null,_instance:null,_create:function(t){var n,r="",i,o=this.get("src")===s.ATTRS.src.value,u=this.get("extracss")?'<style id="extra_css">'+this.get("extracss")+"</style>":"";this._iframe=e.one(e.config.doc.createElement("iframe")),this._iframe.setAttrs(s.IFRAME_ATTRS),this._iframe.setStyle("visibility","hidden"),this._iframe.set("src",this.get("src")),this.get("container").append(this._iframe),this._iframe.set("height","99%"),o&&(r=e.Lang.sub(s.PAGE_HTML,{DIR:this.get("dir"),LANG:this.get("lang"),TITLE:this.get("title"),META:s.META,LINKED_CSS:this.get("linkedcss"),CONTENT:this.get("content"),BASE_HREF:this.get("basehref"),DEFAULT_CSS:s.DEFAULT_CSS,EXTRA_CSS:u}),e.config.doc.compatMode!=="BackCompat"&&(r=s.getDocType()+"\n"+r)),n=this._resolveWinDoc(),r&&(n.doc.open(),n.doc.write(r),n.doc.close()),n.doc.documentElement?t(n):i=e.later(1,this,function(){n.doc&&n.doc.documentElement&&(t(n),i.cancel())},null,!0)},_resolveWinDoc:function(t){var n=t?t:{};return n.win=e.Node.getDOMNode(this._iframe.get("contentWindow")),n.doc=e.Node.getDOMNode(this._iframe.get("contentWindow.document")),n.doc||(n.doc=e.config.doc),n.win||(n.win=e.config.win),n},_onDomEvent:function(t){var n,r;if(!e.Node.getDOMNode(this._iframe))return;t.frameX=t.frameY=0,(t.pageX>0||t.pageY>0)&&t.type.substring(0,3)!=="key"&&(r=this._instance.one("win"),n=this._iframe.getXY(),t.frameX=n[0]+t.pageX-r.get("scrollLeft"),t.frameY=n[1]+t.pageY-r.get("scrollTop")),t.frameTarget=t.target,t.frameCurrentTarget=t.currentTarget,t.frameEvent=t,this.fire("dom:"+t.type,t)},initializer:function(){var e=this.get(i);e&&(e.frame=this),this.publish("ready",{emitFacade:!0,defaultFn:this._defReadyFn})},destructor:function(){var e=this.getInstance();e.one("doc").detachAll(),e=null,this._iframe.remove()},_DOMPaste:function(e){var t=this.getInstance(),n="",r=t.config.win;e._event.originalTarget&&(n=e._event.originalTarget),e._event.clipboardData&&(n=e._event.clipboardData.getData("Text")),r.clipboardData&&(n=r.clipboardData.getData("Text"),n===""&&(r.clipboardData.setData("Text",n)||(n=null))),e.frameTarget=e.target,e.frameCurrentTarget=e.currentTarget,e.frameEvent=e,n?e.clipboardData={data:n,getData:function(){return n}}:e.clipboardData=null,this.fire("dom:paste",e)},_defReadyFn:function(){var t=this.getInstance();e.each(s.DOM_EVENTS,function(n,r){var i=e.bind(this._onDomEvent,this),o=e.UA.ie&&s.THROTTLE_TIME>0?e.throttle(i,s.THROTTLE_TIME):i;t.Node.DOM_EVENTS[r]||(t.Node.DOM_EVENTS[r]=1),n===1&&r!=="focus"&&r!=="blur"&&r!=="paste"&&(r.substring(0,3)==="key"?t.on(r,o,t.config.doc):t.on(r,i,t.config.doc))},this),t.Node.DOM_EVENTS.paste=1,t.on("paste",e.bind(this._DOMPaste,this),t.one("body")),t.on("focus",e.bind(this._onDomEvent,this),t.config.win),t.on("blur",e.bind(this._onDomEvent,this),t.config.win),t.__use=t.use,t.use=e.bind(this.use,this),this._iframe.setStyles({visibility:"inherit"}),t.one("body").setStyle("display","block")},_fixIECursors:function(){var e=this.getInstance(),t=e.all("table"),n=e.all("br"),r;t.size()&&n.size()&&(r=t.item(0).get("sourceIndex"),n.each(function(t){var n=t.get("parentNode"),i=n.get("children"),s=n.all(">br");n.test("div")&&(i.size()>2?t.replace(e.Node.create("<wbr>")):t.get("sourceIndex")>r?s.size()&&t.replace(e.Node.create("<wbr>")):s.size()>1&&t.replace(e.Node.create("<wbr>")))}))},_onContentReady:function(t){if(!this._ready){this._ready=!0;var n=this.getInstance(),r=e.clone(this.get("use"));this.fire("contentready"),t&&(n.config.doc=e.Node.getDOMNode(t.target)),r.push(e.bind(function(){n.EditorSelection&&(n.EditorSelection.DEFAULT_BLOCK_TAG=this.get("defaultblock")),this.get("designMode")&&(e.UA.ie?(n.config.doc.body.contentEditable="true",this._ieSetBodyHeight(),n.on("keyup",e.bind(this._ieSetBodyHeight,this),n.config.doc)):n.config.doc.designMode="on"),this.fire("ready")},this)),n.use.apply(n,r),n.one("doc").get("documentElement").addClass("yui-js-enabled")}},_ieHeightCounter:null,_ieSetBodyHeight:function(t){this._ieHeightCounter||(this._ieHeightCounter=0),this._ieHeightCounter++;var n=!1,r,i,s;t||(n=!0);if(t){switch(t.keyCode){case 8:case 13:n=!0}if(t.ctrlKey||t.shiftKey)n=!0}if(n)try{r=this.getInstance(),i=this._iframe.get("offsetHeight"),s=r.config.doc.body.scrollHeight,i>s?(i=i-15+"px",r.config.doc.body.style.height=i):r.config.doc.body.style.height="auto"}catch(t){this._ieHeightCounter<100&&e.later(200,this,this._ieSetBodyHeight)}},_resolveBaseHref:function(t){if(!t||t==="")t=e.config.doc.location.href,t.indexOf("?")!==-1&&(t=t.substring(0,t.indexOf("?"))),t=t.substring(0,t.lastIndexOf("/"))+"/";return t},_getHTML:function(e){if(this._ready){var t=this.getInstance();e=t.one("body").get("innerHTML")}return e},_setHTML:function(t){if(this._ready){var n=this.getInstance();n.one("body").set("innerHTML",t)}else this.once(r,e.bind(this._setHTML,this,t));return t},_getLinkedCSS:function(t){e.Lang.isArray(t)||(t=[t]);var n="";return this._ready?n=t:e.each(t,function(e){e!==""&&(n+='<link rel="stylesheet" href="'+e+'" type="text/css">')}),n},_setLinkedCSS:function(e){if(this._ready){var t=this.getInstance();t.Get.css(e)}return e},_setExtraCSS:function(t){if(this._ready){var n=this.getInstance(),i=n.one("#extra_css");i.remove(),n.one("head").append('<style id="extra_css">'+t+"</style>")}else this.once(r,e.bind(this._setExtraCSS,this,t));return t},_instanceLoaded:function(t){this._instance=t,this._onContentReady();var n=this._instance.config.doc;if(this.get("designMode")&&!e.UA.ie)try{n.execCommand("styleWithCSS",!1,!1),n.execCommand("insertbronreturn",!1,!1)}catch(r){}},use:function(){var t=this.getInstance(),n=e.Array(arguments),r=!1;return e.Lang.isFunction(n[n.length-1])&&(r=n.pop()),r&&n.push(function(){r.apply(t,arguments)}),t.__use.apply(t,n)},delegate:function(e,t,n,r){var i=this.getInstance();return i?(r||(r=n,n="body"),i
.delegate(e,t,n,r)):!1},getInstance:function(){return this._instance},render:function(t){return this._rendered?this:(this._rendered=!0,t&&this.set("container",t),this._create(e.bind(function(t){var n,r,s=e.bind(function(e){this._instanceLoaded(e)},this),o=e.clone(this.get("use")),u={debug:!1,win:t.win,doc:t.doc},a=e.bind(function(){u=this._resolveWinDoc(u),n=YUI(u),n.host=this.get(i);try{n.use("node-base",s),r&&clearInterval(r)}catch(e){r=setInterval(function(){a()},350)}},this);o.push(a),e.use.apply(e,o)},this)),this)},_handleFocus:function(){var e=this.getInstance(),t=new e.EditorSelection,n,r,i,s;t.anchorNode&&(n=t.anchorNode,n.test("p")&&n.get("innerHTML")===""&&(n=n.get("parentNode")),r=n.get("childNodes"),r.size()&&(r.item(0).test("br")?t.selectNode(n,!0,!1):r.item(0).test("p")?(n=r.item(0).one("br.yui-cursor"),n&&(n=n.get("parentNode")),n||(n=r.item(0).get("firstChild")),n||(n=r.item(0)),n&&t.selectNode(n,!0,!1)):(i=e.one("br.yui-cursor"),i&&(s=i.get("parentNode"),s&&t.selectNode(s,!0,!1)))))},_validateLinkedCSS:function(e){return n.isString(e)||n.isArray(e)},focus:function(t){if(e.UA.ie&&e.UA.ie<9){try{e.one("win").focus(),this.getInstance()&&this.getInstance().one("win")&&this.getInstance().one("win").focus()}catch(n){}t===!0&&this._handleFocus(),e.Lang.isFunction(t)&&t()}else try{e.one("win").focus(),e.later(100,this,function(){this.getInstance()&&this.getInstance().one("win")&&this.getInstance().one("win").focus(),t===!0&&this._handleFocus(),e.Lang.isFunction(t)&&t()})}catch(r){}return this},show:function(){this._iframe.setStyles({position:"static",left:""});if(e.UA.gecko){try{this.getInstance()&&(this.getInstance().config.doc.designMode="on")}catch(t){}this.focus()}return this},hide:function(){return this._iframe.setStyles({position:"absolute",left:"-999999px"}),this}},{THROTTLE_TIME:100,DOM_EVENTS:{dblclick:1,click:1,paste:1,mouseup:1,mousedown:1,keyup:1,keydown:1,keypress:1,activate:1,deactivate:1,beforedeactivate:1,focusin:1,focusout:1},DEFAULT_CSS:"body { background-color: #fff; font: 13px/1.22 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small; } a, a:visited, a:hover { color: blue !important; text-decoration: underline !important; cursor: text !important; } img { cursor: pointer !important; border: none; }",IFRAME_ATTRS:{border:"0",frameBorder:"0",marginWidth:"0",marginHeight:"0",leftMargin:"0",topMargin:"0",allowTransparency:"true",width:"100%",height:"99%"},PAGE_HTML:'<html dir="{DIR}" lang="{LANG}"><head><title>{TITLE}</title>{META}<base href="{BASE_HREF}"/>{LINKED_CSS}<style id="editor_css">{DEFAULT_CSS}</style>{EXTRA_CSS}</head><body>{CONTENT}</body></html>',getDocType:function(){var t=e.config.doc.doctype,n=s.DOC_TYPE;return t?n="<!DOCTYPE "+t.name+(t.publicId?" "+t.publicId:"")+(t.systemId?" "+t.systemId:"")+">":e.config.doc.all&&(t=e.config.doc.all[0],t.nodeType&&t.nodeType===8&&t.nodeValue&&t.nodeValue.toLowerCase().indexOf("doctype")!==-1&&(n="<!"+t.nodeValue+">")),n},DOC_TYPE:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',META:'<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=7">',NAME:"frame",NS:"frame",ATTRS:{title:{value:"Blank Page"},dir:{value:"ltr"},lang:{value:"en-US"},src:{value:"javascript"+(e.UA.ie?":false":":")+";"},designMode:{writeOnce:!0,value:!1},content:{validator:n.isString,value:"<br>",setter:"_setHTML",getter:"_getHTML"},basehref:{value:!1,getter:"_resolveBaseHref"},use:{writeOnce:!0,value:["node","node-style","selector-css3"]},container:{value:"body",setter:function(t){return e.one(t)}},node:{readOnly:!0,value:null,getter:function(){return this._iframe}},id:{writeOnce:!0,getter:function(t){return t||(t="iframe-"+e.guid()),t}},linkedcss:{validator:"_validateLinkedCSS",getter:"_getLinkedCSS",setter:"_setLinkedCSS"},extracss:{validator:n.isString,setter:"_setExtraCSS"},defaultblock:{value:"p"}}}),e.namespace("Plugin"),e.Plugin.Frame=s,e.Frame=s},"3.13.0",{requires:["base","node","plugin","selector-css3","yui-throttle"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("exec-command",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)},r=function(t,n,r){var i=this.getInstance(),s=i.config.doc,o=s.selection.createRange(),u=s.queryCommandValue(t),a,f,l,c,h,p,d;u&&(a=o.htmlText,f=new RegExp(r,"g"),l=a.match(f),l&&(a=a.replace(r+";","").replace(r,""),o.pasteHTML('<var id="yui-ie-bs">'),c=s.getElementById("yui-ie-bs"),h=s.createElement("div"),p=s.createElement(n),h.innerHTML=a,c.parentNode!==i.config.doc.body&&(c=c.parentNode),d=h.childNodes,c.parentNode.replaceChild(p,c),e.each(d,function(e){p.appendChild(e)}),o.collapse(),o.moveToElementText&&o.moveToElementText(p),o.select())),this._command(t)};e.extend(n,e.Base,{_lastKey:null,_inst:null,command:function(e,t){var r=n.COMMANDS[e];return r?r.call(this,e,t):this._command(e,t)},_command:function(e,t){var n=this.getInstance();try{try{n.config.doc.execCommand("styleWithCSS",null,1)}catch(r){try{n.config.doc.execCommand("useCSS",null,0)}catch(i){}}n.config.doc.execCommand(e,null,t)}catch(s){}},getInstance:function(){return this._inst||(this._inst=this.get("host").getInstance()),this._inst},initializer:function(){e.mix(this.get("host"),{execCommand:function(e,t){return this.exec.command(e,t)},_execCommand:function(e,t){return this.exec._command(e,t)}}),this.get("host").on("dom:keypress",e.bind(function(e){this._lastKey=e.keyCode},this))},_wrapContent:function(e,t){var n=this.getInstance().host.editorPara&&!t?!0:!1;return n?e="<p>"+e+"</p>":e+="<br>",e}},{NAME:"execCommand",NS:"exec",ATTRS:{host:{value:!1}},COMMANDS:{wrap:function(e,t){var n=this.getInstance();return(new n.EditorSelection).wrapContent(t)},inserthtml:function(t,n){var r=this.getInstance();if(r.EditorSelection.hasCursor()||e.UA.ie)return(new r.EditorSelection).insertContent(n);this._command("inserthtml",n)},insertandfocus:function(e,t){var n=this.getInstance(),r,i;return n.EditorSelection.hasCursor()?(t+=n.EditorSelection.CURSOR,r=this.command("inserthtml",t),i=new n.EditorSelection,i.focusCursor(!0,!0)):this.command("inserthtml",t),r},insertbr:function(){var t=this.getInstance(),n=new t.EditorSelection,r="<var>|</var>",i=null,s=t.EditorSelection.ROOT,o=e.UA.webkit?"span.Apple-style-span,var":"var",u=function(e){var n=t.Node.create("<br>");return e.insert(n,"before"),n};n._selection.pasteHTML?n._selection.pasteHTML(r):this._command("inserthtml",r),s.all(o).each(function(t){var n=!0,r;e.UA.webkit&&(n=!1,t.get("innerHTML")==="|"&&(n=!0)),n&&(i=u(t),(!i.previous()||!i.previous().test("br"))&&e.UA.gecko&&(r=i.cloneNode(),i.insert(r,"after"),i=r),t.remove())}),e.UA.webkit&&i&&(u(i),n.selectNode(i))},insertimage:function(e,t){return this.command("inserthtml",'<img src="'+t+'">')},addclass:function(e,t){var n=this.getInstance();return(new n.EditorSelection).getSelected().addClass(t)},removeclass:function(e,t){var n=this.getInstance();return(new n.EditorSelection).getSelected().removeClass(t)},forecolor:function(t,n){var r=this.getInstance(),i=new r.EditorSelection,s;e.UA.ie||this._command("useCSS",!1);if(r.EditorSelection.hasCursor())return i.isCollapsed?(i.anchorNode&&i.anchorNode.get("innerHTML")==="&nbsp;"?(i.anchorNode.setStyle("color",n),s=i.anchorNode):(s=this.command("inserthtml",'<span style="color: '+n+'">'+r.EditorSelection.CURSOR+"</span>"),i.focusCursor(!0,!0)),s):this._command(t,n);this._command(t,n)},backcolor:function(t,n){var r=this.getInstance(),i=new r.EditorSelection,s;if(e.UA.gecko||e.UA.opera)t="hilitecolor";e.UA.ie||this._command("useCSS",!1);if(r.EditorSelection.hasCursor())return i.isCollapsed?(i.anchorNode&&i.anchorNode.get("innerHTML")==="&nbsp;"?(i.anchorNode.setStyle("backgroundColor",n),s=i.anchorNode):(s=this.command("inserthtml",'<span style="background-color: '+n+'">'+r.EditorSelection.CURSOR+"</span>"),i.focusCursor(!0,!0)),s):this._command(t,n);this._command(t,n)},hilitecolor:function(){return n.COMMANDS.backcolor.apply(this,arguments)},fontname2:function(e,t){this._command("fontname",t);var n=this.getInstance(),r=new n.EditorSelection;r.isCollapsed&&this._lastKey!==32&&r.anchorNode.test("font")&&r.anchorNode.set("face",t)},fontsize2:function(t,n){this._command("fontsize",n);var r=this.getInstance(),i=new r.EditorSelection,s;i.isCollapsed&&i.anchorNode&&this._lastKey!==32&&(e.UA.webkit&&i.anchorNode.getStyle("lineHeight")&&i.anchorNode.setStyle("lineHeight",""),i.anchorNode.test("font")?i.anchorNode.set("size",n):e.UA.gecko&&(s=i.anchorNode.ancestor(r.EditorSelection.DEFAULT_BLOCK_TAG),s&&s.setStyle("fontSize","")))},insertunorderedlist:function(){this.command("list","ul")},insertorderedlist:function(){this.command("list","ol")},list:function(t,n){var r=this.getInstance(),i,s=this,o="dir",u="yui3-touched",a,f,l,c,h,p,d,v,m,g,y=r.host.editorPara?!0:!1,b,w,E,S,x=r.EditorSelection.ROOT,T=new r.EditorSelection;t="insert"+(n==="ul"?"un":"")+"orderedlist";if(e.UA.ie&&e.UA.ie<11&&!T.isCollapsed){f=T._selection,i=f.htmlText,l=r.Node.create(i)||x;if(l.test("li")||l.one("li")){this._command(t,null);return}l.test(n)?(c=f.item?f.item(0):f.parentElement(),h=r.one(c),g=h.all("li"),p="<div>",g.each(function(e){p=s._wrapContent(e.get("innerHTML"))}),p+="</div>",d=r.Node.create(p),h.get("parentNode").test("div")&&(h=h.get("parentNode")),h&&h.hasAttribute(o)&&(y?d.all("p").setAttribute(o,h.getAttribute(o)):d.setAttribute(o,h.getAttribute(o))),y?h.replace(d.get("innerHTML")):h.replace(d),f.moveToElementText&&f.moveToElementText(d._node),f.select()):(v=e.one(f.parentElement()),v.test(r.EditorSelection.BLOCKS)||(v=v.ancestor(r.EditorSelection.BLOCKS)),v&&v.hasAttribute(o)&&(a=v.getAttribute(o)),i.indexOf("<br>")>-1?i=i.split(/<br>/i):(b=r.Node.create(i),ps=b?b.all("p"):null,ps&&ps.size()?(i=[],ps.each(function(e){i.push(e.get("innerHTML"))})):i=[i]),m="<"+n+' id="ie-list">',e.each(i,function(e){var t=r.Node.create(e);t&&t.test("p")&&(t.hasAttribute(o)&&(a=t.getAttribute(o)),e=t.get("innerHTML")),m+="<li>"+e+"</li>"}),m+="</"+n+">",f.pasteHTML(m),c=r.config.doc.getElementById("ie-list"),c.id="",a&&c.setAttribute
(o,a),f.moveToElementText&&f.moveToElementText(c),f.select())}else e.UA.ie&&e.UA.ie<11?(v=r.one(T._selection.parentElement()),v.test("p")?(v&&v.hasAttribute(o)&&(a=v.getAttribute(o)),i=e.EditorSelection.getText(v),i===""?(w="",a&&(w=' dir="'+a+'"'),m=r.Node.create(e.Lang.sub("<{tag}{dir}><li></li></{tag}>",{tag:n,dir:w})),v.replace(m),T.selectNode(m.one("li"))):this._command(t,null)):this._command(t,null)):(x.all(n).addClass(u),T.anchorNode.test(r.EditorSelection.BLOCKS)?v=T.anchorNode:v=T.anchorNode.ancestor(r.EditorSelection.BLOCKS),v||(v=T.anchorNode.one(r.EditorSelection.BLOCKS)),v&&v.hasAttribute(o)&&(a=v.getAttribute(o)),v&&v.test(n)?(E=v.ancestor("p"),i=r.Node.create("<div/>"),c=v.all("li"),c.each(function(e){i.append(s._wrapContent(e.get("innerHTML"),E))}),a&&(y?i.all("p").setAttribute(o,a):i.setAttribute(o,a)),y&&(i=r.Node.create(i.get("innerHTML"))),S=i.get("firstChild"),v.replace(i),T.selectNode(S)):this._command(t,null),m=x.all(n),a&&m.size()&&m.each(function(e){e.hasClass(u)||e.setAttribute(o,a)}),m.removeClass(u))},justify:function(t,n){if(e.UA.webkit){var r=this.getInstance(),i=new r.EditorSelection,s=i.anchorNode,o,u=s.getStyle("backgroundColor");this._command(n),i=new r.EditorSelection,i.anchorNode.test("div")&&(o="<span>"+i.anchorNode.get("innerHTML")+"</span>",i.anchorNode.set("innerHTML",o),i.anchorNode.one("span").setStyle("backgroundColor",u),i.selectNode(i.anchorNode.one("span")))}else this._command(n)},justifycenter:function(){this.command("justify","justifycenter")},justifyleft:function(){this.command("justify","justifyleft")},justifyright:function(){this.command("justify","justifyright")},justifyfull:function(){this.command("justify","justifyfull")}}}),e.UA.ie&&e.UA.ie<11&&(n.COMMANDS.bold=function(){r.call(this,"bold","b","FONT-WEIGHT: bold")},n.COMMANDS.italic=function(){r.call(this,"italic","i","FONT-STYLE: italic")},n.COMMANDS.underline=function(){r.call(this,"underline","u","TEXT-DECORATION: underline")}),e.namespace("Plugin"),e.Plugin.ExecCommand=n},"3.13.0",{requires:["frame"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-selection",function(e,t){var n="textContent",r="innerHTML",i="fontFamily";e.UA.ie&&e.UA.ie<11&&(n="nodeValue"),e.EditorSelection=function(t){var n,r,i,s,o,u,a,f=0,l,c,h=e.EditorSelection.ROOT;e.config.win.getSelection&&(!e.UA.ie||e.UA.ie<9||e.UA.ie>10)?n=e.config.win.getSelection():e.config.doc.selection&&(n=e.config.doc.selection.createRange()),this._selection=n;if(!n)return!1;if(n.pasteHTML){this.isCollapsed=n.compareEndPoints("StartToEnd",n)?!1:!0;if(this.isCollapsed){this.anchorNode=this.focusNode=e.one(n.parentElement()),t&&(i=e.config.doc.elementFromPoint(t.clientX,t.clientY)),o=n.duplicate();if(!i){r=n.parentElement(),s=r.childNodes;for(u=0;u<s.length;u++)o.inRange(n)&&(i||(i=s[u]))}this.ieNode=i,i&&(i.nodeType!==3&&(i.firstChild&&(i=i.firstChild),h.compareTo(i)&&i.firstChild&&(i=i.firstChild)),this.anchorNode=this.focusNode=e.EditorSelection.resolve(i),o.moveToElementText(n.parentElement()),a=n.compareEndPoints("StartToStart",o),a&&(f=this.getEditorOffset(h),n.move("character",-f)),this.anchorOffset=this.focusOffset=f,this.anchorTextNode=this.focusTextNode=e.one(i))}else n.htmlText&&n.htmlText!==""&&(l=e.Node.create(n.htmlText),l&&l.get("id")?(c=l.get("id"),this.anchorNode=this.focusNode=e.one("#"+c)):l&&(l=l.get("childNodes"),this.anchorNode=this.focusNode=l.item(0)))}else this.isCollapsed=n.isCollapsed,this.anchorNode=e.EditorSelection.resolve(n.anchorNode),this.focusNode=e.EditorSelection.resolve(n.focusNode),this.anchorOffset=n.anchorOffset,this.focusOffset=n.focusOffset,this.anchorTextNode=e.one(n.anchorNode||this.anchorNode),this.focusTextNode=e.one(n.focusNode||this.focusNode);e.Lang.isString(n.text)?this.text=n.text:n.toString?this.text=n.toString():this.text=""},e.EditorSelection.removeFontFamily=function(t){t.removeAttribute("face");var n=t.getAttribute("style").toLowerCase();(n===""||n==="font-family: ")&&t.removeAttribute("style"),n.match(e.EditorSelection.REG_FONTFAMILY)&&(n=n.replace(e.EditorSelection.REG_FONTFAMILY,""),t.setAttribute("style",n))},e.EditorSelection.filter=function(t){var n=(new Date).getTime(),r=e.EditorSelection,s=r.ROOT,o,u=s.all(r.ALL),a=s.all("strong,em"),f=e.config.doc,l,c={},h="",p,d=(new Date).getTime(),v;u.each(function(t){var n=e.Node.getDOMNode(t);n.style[i]&&(c["."+t._yuid]=n.style[i],t.addClass(t._yuid),r.removeFontFamily(n))}),v=(new Date).getTime(),s.all(".hr").addClass("yui-skip").addClass("yui-non"),e.UA.ie&&(l=e.Node.getDOMNode(s).getElementsByTagName("hr"),e.each(l,function(e){var t=f.createElement("div"),n=t.style;t.className="hr yui-non yui-skip",t.setAttribute("readonly",!0),t.setAttribute("contenteditable",!1),e.parentNode&&e.parentNode.replaceChild(t,e),n.border="1px solid #ccc",n.lineHeight="0",n.height="0",n.fontSize="0",n.marginTop="5px",n.marginBottom="5px",n.marginLeft="0px",n.marginRight="0px",n.padding="0"})),e.each(c,function(e,t){h+=t+" { font-family: "+e.replace(/"/gi,"")+"; }"}),e.StyleSheet(h,"editor"),a.each(function(e,t){var n=e.get("tagName").toLowerCase(),i="i";n==="strong"&&(i="b"),r.prototype._swap(a.item(t),i)}),p=s.all("ol,ul"),p.each(function(e){var t=e.all("li");t.size()||e.remove()}),t&&r.filterBlocks(),o=(new Date).getTime()},e.EditorSelection.filterBlocks=function(){var t=(new Date).getTime(),r,i=e.Node.getDOMNode(e.EditorSelection.ROOT).childNodes,s,o,u=!1,a=!0,f,l,c,h,p,d;if(i){for(s=0;s<i.length;s++)o=e.one(i[s]),o.test(e.EditorSelection.BLOCKS)?u=e.EditorSelection._wrapBlock(u):(a=!0,i[s].nodeType===3&&(h=i[s][n].match(e.EditorSelection.REG_CHAR),p=i[s][n].match(e.EditorSelection.REG_NON),h===null&&p&&(a=!1)),a&&(u||(u=[]),u.push(i[s])));u=e.EditorSelection._wrapBlock(u)}l=e.all(e.EditorSelection.DEFAULT_BLOCK_TAG);if(l.size()===1){c=l.item(0).all("br");if(c.size()===1){c.item(0).test(".yui-cursor")||c.item(0).remove(),d=l.item(0).get("innerHTML");if(d===""||d===" ")l.set("innerHTML",e.EditorSelection.CURSOR),f=new e.EditorSelection,f.focusCursor(!0,!0);c.item(0).test(".yui-cursor")&&e.UA.ie&&c.item(0).remove()}}else l.each(function(e){var t=e.get("innerHTML");t===""&&e.remove()});r=(new Date).getTime()},e.EditorSelection.REG_FONTFAMILY=/font-family:\s*;/,e.EditorSelection.REG_CHAR=/[a-zA-Z-0-9_!@#\$%\^&*\(\)-=_+\[\]\\{}|;':",.\/<>\?]/gi,e.EditorSelection.REG_NON=/[\s|\n|\t]/gi,e.EditorSelection.REG_NOHTML=/<\S[^><]*>/g,e.EditorSelection._wrapBlock=function(t){if(t){var n=e.Node.create("<"+e.EditorSelection.DEFAULT_BLOCK_TAG+"></"+e.EditorSelection.DEFAULT_BLOCK_TAG+">"),r=e.one(t[0]),i;for(i=1;i<t.length;i++)n.append(t[i]);r.replace(n),n.prepend(r)}return!1},e.EditorSelection.unfilter=function(){var t=e.EditorSelection.ROOT,n=t.all("[class]"),r="",s,o,u=t;return n.each(function(e){e.hasClass(e._yuid)&&(e.setStyle(i,e.getStyle(i)),e.removeClass(e._yuid),e.getAttribute("class")===""&&e.removeAttribute("class"))}),s=t.all(".yui-non"),s.each(function(e){!e.hasClass("yui-skip")&&e.get("innerHTML")===""?e.remove():e.removeClass("yui-non").removeClass("yui-skip")}),o=t.all("[id]"),o.each(function(e){e.get("id").indexOf("yui_3_")===0&&(e.removeAttribute("id"),e.removeAttribute("_yuid"))}),u&&(r=u.get("innerHTML")),t.all(".hr").addClass("yui-skip").addClass("yui-non"),r},e.EditorSelection.resolve=function(t){if(!t)return e.EditorSelection.ROOT;if(t&&t.nodeType===3)try{t=t.parentNode}catch(n){t=e.EditorSelection.ROOT}return e.one(t)},e.EditorSelection.getText=function(t){var n=t.get("innerHTML").replace(e.EditorSelection.REG_NOHTML,"");return n=n.replace("<span><br></span>","").replace("<br>",""),n},e.EditorSelection.DEFAULT_BLOCK_TAG="p",e.EditorSelection.ALL="[style],font[face]",e.EditorSelection.BLOCKS="p,div,ul,ol,table,style",e.EditorSelection.TMP="yui-tmp",e.EditorSelection.DEFAULT_TAG="span",e.EditorSelection.CURID="yui-cursor",e.EditorSelection.CUR_WRAPID="yui-cursor-wrapper",e.EditorSelection.CURSOR='<span><br class="yui-cursor"></span>',e.EditorSelection.ROOT=e.one("body"),e.EditorSelection.hasCursor=function(){var t=e.all("#"+e.EditorSelection.CUR_WRAPID);return t.size()},e.EditorSelection
.cleanCursor=function(){var t,n="br.yui-cursor";t=e.all(n),t.size()&&t.each(function(t){var n=t.get("parentNode.parentNode.childNodes"),r;n.size()?t.remove():(r=e.EditorSelection.getText(n.item(0)),r!==""&&t.remove())})},e.EditorSelection.prototype={text:null,isCollapsed:null,anchorNode:null,anchorOffset:null,anchorTextNode:null,focusNode:null,focusOffset:null,focusTextNode:null,_selection:null,_wrap:function(t,n){var i=e.Node.create("<"+n+"></"+n+">");return i.set(r,t.get(r)),t.set(r,""),t.append(i),e.Node.getDOMNode(i)},_swap:function(t,n){var i=e.Node.create("<"+n+"></"+n+">");return i.set(r,t.get(r)),t.replace(i,t),e.Node.getDOMNode(i)},getSelected:function(){var t=e.EditorSelection,n=t.ROOT,r,s=[];return t.filter(),e.config.doc.execCommand("fontname",null,t.TMP),r=n.all(t.ALL),r.each(function(o,u){o.getStyle(i)===t.TMP&&(o.setStyle(i,""),t.removeFontFamily(o),o.compareTo(n)||s.push(e.Node.getDOMNode(r.item(u))))}),e.all(s)},insertContent:function(e){return this.insertAtCursor(e,this.anchorTextNode,this.anchorOffset,!0)},insertAtCursor:function(t,r,i,s){var o=e.Node.create("<"+e.EditorSelection.DEFAULT_TAG+' class="yui-non"></'+e.EditorSelection.DEFAULT_TAG+">"),u,a,f,l,c=this.createRange(),h,p=e.EditorSelection.ROOT;p.compareTo(r)&&(h=e.Node.create("<span></span>"),r.append(h),r=h);if(c.pasteHTML){if(i===0&&r&&!r.previous()&&r.get("nodeType")===3)return r.insert(t,"before"),c.moveToElementText&&c.moveToElementText(e.Node.getDOMNode(r.previous())),c.collapse(!1),c.select(),r.previous();l=e.Node.create(t);try{c.pasteHTML('<span id="rte-insert"></span>')}catch(d){}u=p.one("#rte-insert");if(u)return u.set("id",""),u.replace(l),c.moveToElementText&&c.moveToElementText(e.Node.getDOMNode(l)),c.collapse(!1),c.select(),l;e.on("available",function(){u.set("id",""),u.replace(l),c.moveToElementText&&c.moveToElementText(e.Node.getDOMNode(l)),c.collapse(!1),c.select()},"#rte-insert")}else i>0?(u=r.get(n),a=e.one(e.config.doc.createTextNode(u.substr(0,i))),f=e.one(e.config.doc.createTextNode(u.substr(i))),r.replace(a,r),l=e.Node.create(t),l.get("nodeType")===11&&(h=e.Node.create("<span></span>"),h.append(l),l=h),a.insert(l,"after"),f&&(l.insert(o,"after"),o.insert(f,"after"),this.selectNode(o,s))):(r.get("nodeType")===3&&(r=r.get("parentNode")||p),l=e.Node.create(t),t=r.get("innerHTML").replace(/\n/gi,""),t===""||t==="<br>"?r.append(l):l.get("parentNode")?r.insert(l,"before"):p.prepend(l),r.get("firstChild").test("br")&&r.get("firstChild").remove());return l},wrapContent:function(t){t=t?t:e.EditorSelection.DEFAULT_TAG;if(!this.isCollapsed){var n=this.getSelected(),r=[],i,s,o,u;return n.each(function(e,i){var s=e.get("tagName").toLowerCase();s==="font"?r.push(this._swap(n.item(i),t)):r.push(this._wrap(n.item(i),t))},this),i=this.createRange(),o=r[0],s=r[r.length-1],this._selection.removeAllRanges?(i.setStart(r[0],0),i.setEnd(s,s.childNodes.length),this._selection.removeAllRanges(),this._selection.addRange(i)):(i.moveToElementText&&(i.moveToElementText(e.Node.getDOMNode(o)),u=this.createRange(),u.moveToElementText(e.Node.getDOMNode(s)),i.setEndPoint("EndToEnd",u)),i.select()),r=e.all(r),r}return e.all([])},replace:function(t,r){var i=this.createRange(),s,o,u,a;return i.getBookmark?(u=i.getBookmark(),o=this.anchorNode.get("innerHTML").replace(t,r),this.anchorNode.set("innerHTML",o),i.moveToBookmark(u),a=e.one(i.parentElement())):(s=this.anchorTextNode,o=s.get(n),u=o.indexOf(t),o=o.replace(t,""),s.set(n,o),a=this.insertAtCursor(r,s,u,!0)),a},remove:function(){return this._selection&&this._selection.removeAllRanges&&this._selection.removeAllRanges(),this},createRange:function(){return e.config.doc.selection?e.config.doc.selection.createRange():e.config.doc.createRange()},selectNode:function(t,n,r){if(!t)return;r=r||0,t=e.Node.getDOMNode(t);var i=this.createRange();if(i.selectNode){i.selectNode(t),this._selection.removeAllRanges(),this._selection.addRange(i);if(n)try{this._selection.collapse(t,r)}catch(s){this._selection.collapse(t,0)}}else{t.nodeType===3&&(t=t.parentNode);try{i.moveToElementText(t)}catch(o){}n&&i.collapse(r?!1:!0),i.select()}return this},setCursor:function(){return this.removeCursor(!1),this.insertContent(e.EditorSelection.CURSOR)},getCursor:function(){return e.EditorSelection.ROOT.all("#"+e.EditorSelection.CURID)},removeCursor:function(e){var t=this.getCursor();return t&&(e?(t.removeAttribute("id"),t.set("innerHTML",'<br class="yui-cursor">')):t.remove()),t},focusCursor:function(e,t){e!==!1&&(e=!0),t!==!1&&(t=!0);var n=this.removeCursor(!0);n&&n.each(function(n){this.selectNode(n,e,t)},this)},toString:function(){return"EditorSelection Object"},getEditorOffset:function(t){var n=(t||e.EditorSelection.ROOT).getDOMNode(),r=0,i=e.config.doc,s=e.config.win,o,u,a;return typeof s.getSelection!="undefined"?(u=s.getSelection().getRangeAt(0),a=u.cloneRange(),a.selectNodeContents(n),a.setEnd(u.endContainer,u.endOffset),r=a.toString().length):(o=i.selection,o&&o.type!=="Control"&&(u=o.createRange(),a=i.body.createTextRange(),a.moveToElementText(n),a.setEndPoint("EndToEnd",u),r=a.text.length)),r}},e.Selection=e.EditorSelection},"3.13.0",{requires:["node"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-base",function(e,t){var n=e.Lang,r=function(){r.superclass.constructor.apply(this,arguments)},i=":last-child";e.extend(r,e.Base,{frame:null,initializer:function(){this.publish("nodeChange",{emitFacade:!0,bubbles:!0,defaultFn:this._defNodeChangeFn})},destructor:function(){this.detachAll()},copyStyles:function(t,n){if(t.test("a"))return;var r=["color","fontSize","fontFamily","backgroundColor","fontStyle"],i={};e.each(r,function(e){i[e]=t.getStyle(e)}),t.ancestor("b,strong")&&(i.fontWeight="bold"),t.ancestor("u")&&(i.textDecoration||(i.textDecoration="underline")),n.setStyles(i)},_lastBookmark:null,_resolveChangedNode:function(e){var t=this.getInstance(),n,r,s,o=this._getRoot(),u;e&&e.compareTo(o)&&(u=new t.EditorSelection,u&&u.anchorNode&&(e=u.anchorNode));if(t&&e&&e.test("html")){n=o.one(i);while(!s)n?(r=n.one(i),r?n=r:s=!0):s=!0;n&&(n.test("br")&&(n.previous()?n=n.previous():n=n.get("parentNode")),n&&(e=n))}return e||(e=o),e},_getRoot:function(){return this.getInstance().EditorSelection.ROOT},_defNodeChangeFn:function(t){var n=(new Date).getTime(),i=this.getInstance(),s,o,u,a={},f,l,c=[],h="",p="",d,v=!1,m=this._getRoot();if(e.UA.ie&&e.UA.ie<11)try{s=i.config.doc.selection.createRange(),s.getBookmark&&(this._lastBookmark=s.getBookmark())}catch(g){}t.changedNode=this._resolveChangedNode(t.changedNode);switch(t.changedType){case"tab":!t.changedNode.test("li, li *")&&!t.changedEvent.shiftKey&&(t.changedEvent.frameEvent.preventDefault(),e.UA.webkit?this.execCommand("inserttext","	"):e.UA.gecko?this.frame.exec._command("inserthtml",r.TABKEY):e.UA.ie&&this.execCommand("inserthtml",r.TABKEY));break;case"backspace-up":e.UA.webkit&&t.changedNode&&t.changedNode.set("innerHTML",t.changedNode.get("innerHTML"))}e.UA.webkit&&t.commands&&(t.commands.indent||t.commands.outdent)&&(d=m.all(".webkit-indent-blockquote, blockquote"),d.size()&&d.setStyle("margin","")),o=this.getDomPath(t.changedNode,!1),t.commands&&(a=t.commands),e.each(o,function(t){var n=t.tagName.toLowerCase(),s=r.TAG2CMD[n],o,u,d,m,g;s&&(a[s]=1),o=t.currentStyle||t.style,""+o.fontWeight=="normal"&&(v=!0),""+o.fontWeight=="bold"&&(a.bold=1),e.UA.ie&&o.fontWeight>400&&(a.bold=1),o.fontStyle==="italic"&&(a.italic=1),o.textDecoration.indexOf("underline")>-1&&(a.underline=1),o.textDecoration.indexOf("line-through")>-1&&(a.strikethrough=1),u=i.one(t),u.getStyle("fontFamily")&&(d=u.getStyle("fontFamily").split(",")[0].toLowerCase(),d&&(f=d),f&&(f=f.replace(/'/g,"").replace(/"/g,""))),l=r.NORMALIZE_FONTSIZE(u),m=t.className.split(" "),e.each(m,function(e){e!==""&&e.substr(0,4)!=="yui_"&&c.push(e)}),h=r.FILTER_RGB(u.getStyle("color")),g=r.FILTER_RGB(o.backgroundColor),g!=="transparent"&&g!==""&&(p=g)}),v&&(delete a.bold,delete a.italic),t.dompath=i.all(o),t.classNames=c,t.commands=a,t.fontFamily||(t.fontFamily=f),t.fontSize||(t.fontSize=l),t.fontColor||(t.fontColor=h),t.backgroundColor||(t.backgroundColor=p),u=(new Date).getTime()},getDomPath:function(e,t){var n=[],r,i,s=this._getRoot(),o=this.frame.getInstance();r=o.Node.getDOMNode(e),i=o.Node.getDOMNode(s);while(r!==null){if(r===o.config.doc.documentElement||r===o.config.doc||!r.tagName){r=null;break}if(!o.DOM.inDoc(r)){r=null;break}r.nodeName&&r.nodeType&&r.nodeType===1&&n.push(r);if(r===i){r=null;break}r=r.parentNode}return n.length===0&&(n[0]=o.config.doc.body),t?o.all(n.reverse()):n.reverse()},_afterFrameReady:function(){var t=this.frame.getInstance();this.frame.on("dom:mouseup",e.bind(this._onFrameMouseUp,this)),this.frame.on("dom:mousedown",e.bind(this._onFrameMouseDown,this)),this.frame.on("dom:keydown",e.bind(this._onFrameKeyDown,this)),e.UA.ie&&e.UA.ie<11&&(this.frame.on("dom:activate",e.bind(this._onFrameActivate,this)),this.frame.on("dom:beforedeactivate",e.bind(this._beforeFrameDeactivate,this))),this.frame.on("dom:keyup",e.bind(this._onFrameKeyUp,this)),this.frame.on("dom:keypress",e.bind(this._onFrameKeyPress,this)),this.frame.on("dom:paste",e.bind(this._onPaste,this)),t.EditorSelection.filter(),this.fire("ready")},_beforeFrameDeactivate:function(e){if(e.frameTarget.test("html"))return;var t=this.getInstance(),n=t.config.doc.selection.createRange();n.compareEndPoints&&!n.compareEndPoints("StartToEnd",n)&&n.pasteHTML('<var id="yui-ie-cursor">')},_onFrameActivate:function(e){if(e.frameTarget.test("html"))return;var t=this.getInstance(),n=new t.EditorSelection,r=n.createRange(),i=this._getRoot(),s=i.all("#yui-ie-cursor");s.size()&&s.each(function(e){e.set("id","");if(r.moveToElementText)try{r.moveToElementText(e._node);var t=r.move("character",-1);t===-1&&r.move("character",1),r.select(),r.text=""}catch(n){}e.remove()})},_onPaste:function(e){this.fire("nodeChange",{changedNode:e.frameTarget,changedType:"paste",changedEvent:e.frameEvent})},_onFrameMouseUp:function(e){this.fire("nodeChange",{changedNode:e.frameTarget,changedType:"mouseup",changedEvent:e.frameEvent})},_onFrameMouseDown:function(e){this.fire("nodeChange",{changedNode:e.frameTarget,changedType:"mousedown",changedEvent:e.frameEvent})},_currentSelection:null,_currentSelectionTimer:null,_currentSelectionClear:null,_onFrameKeyDown:function(t){var n,i;this._currentSelection?i=this._currentSelection:(this._currentSelectionTimer&&this._currentSelectionTimer.cancel(),this._currentSelectionTimer=e.later(850,this,function(){this._currentSelectionClear=!0}),n=this.frame.getInstance(),i=new n.EditorSelection(t),this._currentSelection=i),n=this.frame.getInstance(),i=new n.EditorSelection,this._currentSelection=i,i&&i.anchorNode&&(this.fire("nodeChange",{changedNode:i.anchorNode,changedType:"keydown",changedEvent:t.frameEvent}),r.NC_KEYS[t.keyCode]&&(this.fire("nodeChange",{changedNode:i.anchorNode,changedType:r.NC_KEYS[t.keyCode],changedEvent:t.frameEvent}),this.fire("nodeChange",{changedNode:i.anchorNode,changedType:r.NC_KEYS[t.keyCode]+"-down",changedEvent:t.frameEvent})))},_onFrameKeyPress:function(e){var t=this._currentSelection;t&&t.anchorNode&&(this.fire("nodeChange",{changedNode:t.anchorNode,changedType:"keypress"
,changedEvent:e.frameEvent}),r.NC_KEYS[e.keyCode]&&this.fire("nodeChange",{changedNode:t.anchorNode,changedType:r.NC_KEYS[e.keyCode]+"-press",changedEvent:e.frameEvent}))},_onFrameKeyUp:function(e){var t=this.frame.getInstance(),n=new t.EditorSelection(e);n&&n.anchorNode&&(this.fire("nodeChange",{changedNode:n.anchorNode,changedType:"keyup",selection:n,changedEvent:e.frameEvent}),r.NC_KEYS[e.keyCode]&&this.fire("nodeChange",{changedNode:n.anchorNode,changedType:r.NC_KEYS[e.keyCode]+"-up",selection:n,changedEvent:e.frameEvent})),this._currentSelectionClear&&(this._currentSelectionClear=this._currentSelection=null)},_validateLinkedCSS:function(e){return n.isString(e)||n.isArray(e)},execCommand:function(e,t){var n=this.frame.execCommand(e,t),r=this.frame.getInstance(),i=new r.EditorSelection,s={},o={changedNode:i.anchorNode,changedType:"execcommand",nodes:n};switch(e){case"forecolor":o.fontColor=t;break;case"backcolor":o.backgroundColor=t;break;case"fontsize":o.fontSize=t;break;case"fontname":o.fontFamily=t}return s[e]=1,o.commands=s,this.fire("nodeChange",o),n},getInstance:function(){return this.frame.getInstance()},render:function(t){var n=this.frame;return n||(this.plug(e.Plugin.Frame,{designMode:!0,title:r.STRINGS.title,use:r.USE,dir:this.get("dir"),extracss:this.get("extracss"),linkedcss:this.get("linkedcss"),defaultblock:this.get("defaultblock")}),n=this.frame),n.hasPlugin("exec")||n.plug(e.Plugin.ExecCommand),n.after("ready",e.bind(this._afterFrameReady,this)),n.addTarget(this),n.set("content",this.get("content")),n.render(t),this},focus:function(e){return this.frame.focus(e),this},show:function(){return this.frame.show(),this},hide:function(){return this.frame.hide(),this},getContent:function(){var e="",t=this.getInstance();return t&&t.EditorSelection&&(e=t.EditorSelection.unfilter()),e=e.replace(/ _yuid="([^>]*)"/g,""),e}},{NORMALIZE_FONTSIZE:function(e){var t=e.getStyle("fontSize"),n=t;switch(t){case"-webkit-xxx-large":t="48px";break;case"xx-large":t="32px";break;case"x-large":t="24px";break;case"large":t="18px";break;case"medium":t="16px";break;case"small":t="13px";break;case"x-small":t="10px"}return n!==t&&e.setStyle("fontSize",t),t},TABKEY:'<span class="tab">&nbsp;&nbsp;&nbsp;&nbsp;</span>',FILTER_RGB:function(e){if(e.toLowerCase().indexOf("rgb")!==-1){var t=new RegExp("(.*?)rgb\\s*?\\(\\s*?([0-9]+).*?,\\s*?([0-9]+).*?,\\s*?([0-9]+).*?\\)(.*?)","gi"),n=e.replace(t,"$1,$2,$3,$4,$5").split(","),r,i,s;n.length===5&&(r=parseInt(n[1],10).toString(16),i=parseInt(n[2],10).toString(16),s=parseInt(n[3],10).toString(16),r=r.length===1?"0"+r:r,i=i.length===1?"0"+i:i,s=s.length===1?"0"+s:s,e="#"+r+i+s)}return e},TAG2CMD:{b:"bold",strong:"bold",i:"italic",em:"italic",u:"underline",sup:"superscript",sub:"subscript",img:"insertimage",a:"createlink",ul:"insertunorderedlist",ol:"insertorderedlist"},NC_KEYS:{8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},USE:["node","selector-css3","editor-selection","stylesheet"],NAME:"editorBase",STRINGS:{title:"Rich Text Editor"},ATTRS:{content:{validator:n.isString,value:'<br class="yui-cursor">',setter:function(t){return t.substr(0,1)==="\n"&&(t=t.substr(1)),t===""&&(t='<br class="yui-cursor">'),t===" "&&e.UA.gecko&&(t='<br class="yui-cursor">'),this.frame.set("content",t)},getter:function(){return this.frame.get("content")}},dir:{validator:n.isString,writeOnce:!0,value:"ltr"},linkedcss:{validator:"_validateLinkedCSS",value:"",setter:function(e){return this.frame&&this.frame.set("linkedcss",e),e}},extracss:{validator:n.isString,value:"",setter:function(e){return this.frame&&this.frame.set("extracss",e),e}},defaultblock:{validator:n.isString,value:"p"}}}),e.EditorBase=r},"3.13.0",{requires:["base","frame","node","exec-command","editor-selection"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("content-editable",function(e,t){var n=e.Lang,r=e.Node,i="contentready",s="ready",o="p",u="blur",a="container",f="contentEditable",l="",c="focus",h="host",p="innerHTML",d="key",v="parentNode",m="paste",g="Text",y="use",b=function(){b.superclass.constructor.apply(this,arguments)};e.extend(b,e.Plugin.Base,{_rendered:null,_instance:null,initializer:function(){var e=this.get(h);e&&(e.frame=this),this._eventHandles=[],this.publish(s,{emitFacade:!0,defaultFn:this._defReadyFn})},destructor:function(){(new e.EventHandle(this._eventHandles)).detach(),this._container.removeAttribute(f)},_onDomEvent:function(e){var t;e.frameX=e.frameY=0,(e.pageX>0||e.pageY>0)&&e.type.substring(0,3)!==d&&(t=this._container.getXY(),e.frameX=t[0],e.frameY=t[1]),e.frameTarget=e.target,e.frameCurrentTarget=e.currentTarget,e.frameEvent=e,this.fire("dom:"+e.type,e)},_DOMPaste:function(e){var t=this.getInstance(),n=l,r=t.config.win;e._event.originalTarget&&(n=e._event.originalTarget),e._event.clipboardData&&(n=e._event.clipboardData.getData(g)),r.clipboardData&&(n=r.clipboardData.getData(g),n===l&&(r.clipboardData.setData(g,n)||(n=null))),e.frameTarget=e.target,e.frameCurrentTarget=e.currentTarget,e.frameEvent=e,n?e.clipboardData={data:n,getData:function(){return n}}:e.clipboardData=null,this.fire("dom:paste",e)},_defReadyFn:function(){var t=this.getInstance(),n=this.get(a);e.each(b.DOM_EVENTS,function(r,i){var s=e.bind(this._onDomEvent,this),o=e.UA.ie&&b.THROTTLE_TIME>0?e.throttle(s,b.THROTTLE_TIME):s;t.Node.DOM_EVENTS[i]||(t.Node.DOM_EVENTS[i]=1),r===1&&i!==c&&i!==u&&i!==m&&(i.substring(0,3)===d?this._eventHandles.push(n.on(i,o,n)):this._eventHandles.push(n.on(i,s,n)))},this),t.Node.DOM_EVENTS.paste=1,this._eventHandles.push(n.on(m,e.bind(this._DOMPaste,this),n),n.on(c,e.bind(this._onDomEvent,this),n),n.on(u,e.bind(this._onDomEvent,this),n)),t.__use=t.use,t.use=e.bind(this.use,this)},_onContentReady:function(t){if(!this._ready){this._ready=!0;var n=this.getInstance(),o=e.clone(this.get(y));this.fire(i),t&&(n.config.doc=r.getDOMNode(t.target)),o.push(e.bind(function(){n.EditorSelection&&(n.EditorSelection.DEFAULT_BLOCK_TAG=this.get("defaultblock"),n.EditorSelection.ROOT=this.get(a)),this.fire(s)},this)),n.use.apply(n,o)}},_getDefaultBlock:function(){return this._getHostValue("defaultblock")},_getDir:function(){return this._getHostValue("dir")},_getExtraCSS:function(){return this._getHostValue("extracss")},_getHTML:function(){var e,t;return this._ready&&(t=this.get(a),e=t.get(p)),e},_getHostValue:function(e){var t=this.get(h);if(t)return t.get(e)},_setHTML:function(t){if(this._ready){var n=this.get(a);n.set(p,t)}else this.once(i,e.bind(this._setHTML,this,t));return t},_setLinkedCSS:function(t){if(this._ready){var n=this.getInstance();n.Get.css(t)}else this.once(i,e.bind(this._setLinkedCSS,this,t));return t},_setDir:function(t){var n;return this._ready?(n=this.get(a),n.setAttribute("dir",t)):this.once(i,e.bind(this._setDir,this,t)),t},_setExtraCSS:function(t){if(this._ready){if(t){var n=this.getInstance(),s=n.one("head");this._extraCSSNode&&this._extraCSSNode.remove(),this._extraCSSNode=r.create("<style>"+t+"</style>"),s.append(this._extraCSSNode)}}else this.once(i,e.bind(this._setExtraCSS,this,t));return t},_setLang:function(t){var n;return this._ready?(n=this.get(a),n.setAttribute("lang",t)):this.once(i,e.bind(this._setLang,this,t)),t},_instanceLoaded:function(t){this._instance=t,this._onContentReady();var n=this._instance.config.doc;if(!e.UA.ie)try{n.execCommand("styleWithCSS",!1,!1),n.execCommand("insertbronreturn",!1,!1)}catch(r){}},_validateLinkedCSS:function(e){return n.isString(e)||n.isArray(e)},use:function(){var t=this.getInstance(),r=e.Array(arguments),i=!1;return n.isFunction(r[r.length-1])&&(i=r.pop()),i&&r.push(function(){i.apply(t,arguments)}),t.__use.apply(t,r)},delegate:function(e,t,n,r){var i=this.getInstance();return i?(r||(r=n,n=this.get(a)),i.delegate(e,t,n,r)):!1},getInstance:function(){return this._instance},render:function(t){var n,i,s;return this._rendered?this:(t&&this.set(a,t),container=this.get(a),container||(container=r.create(b.HTML),e.one("body").prepend(container),this.set(a,container)),this._rendered=!0,this._container.setAttribute(f,!0),n=e.clone(this.get(y)),s=e.bind(function(){i=YUI(),i.host=this.get(h),i.use("node-base",e.bind(this._instanceLoaded,this))},this),n.push(s),e.use.apply(e,n),this)},focus:function(){return this._container.focus(),this},show:function(){return this._container.show(),this.focus(),this},hide:function(){return this._container.hide(),this}},{THROTTLE_TIME:100,DOM_EVENTS:{click:1,dblclick:1,focusin:1,focusout:1,keydown:1,keypress:1,keyup:1,mousedown:1,mouseup:1,paste:1},HTML:"<div></div>",NAME:"contentEditable",NS:f,ATTRS:{dir:{lazyAdd:!1,validator:n.isString,setter:"_setDir",valueFn:"_getDir"},container:{setter:function(t){return this._container=e.one(t),this._container}},content:{getter:"_getHTML",lazyAdd:!1,setter:"_setHTML",validator:n.isString,value:"<br>"},defaultblock:{validator:n.isString,value:o,valueFn:"_getDefaultBlock"},extracss:{lazyAdd:!1,setter:"_setExtraCSS",validator:n.isString,valueFn:"_getExtraCSS"},id:{writeOnce:!0,getter:function(t){return t||(t="inlineedit-"+e.guid()),t}},lang:{validator:n.isString,setter:"_setLang",lazyAdd:!1,value:"en-US"},linkedcss:{setter:"_setLinkedCSS",validator:"_validateLinkedCSS"},node:{readOnly:!0,value:null,getter:function(){return this._container}},use:{validator:n.isArray,writeOnce:!0,value:["node-base","editor-selection","stylesheet"]}}}),e.namespace("Plugin"),e.Plugin.ContentEditable=b},"3.13.0",{requires:["node-base","editor-selection","stylesheet","plugin"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-inline",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)};e.extend(n,e.EditorBase,{initializer:function(){this.plug(e.Plugin.ContentEditable)}}),e.InlineEditor=n},"3.13.0",{requires:["editor-base","content-editable"]});
YUI.add("mail-common-utils-callbacks",function(D){var C={};var B=/\S+/g;function A(F){var E=C[F]={};D.Array.each(F.match(B)||[],function(G,H){E[G]=true;});return E;}D.Callbacks=function(O){O=typeof O==="string"?(C[O]||A(O)):D.mix({},O);var H,E,I,G,J,K,L=[],M=!O.once&&[],F=function(P){H=O.memory&&P;E=true;K=G||0;G=0;J=L.length;I=true;for(;L&&K<J;K++){if(L[K].apply(P[0],P[1])===false&&O.stopOnFalse){H=false;break;}}I=false;if(L){if(M){if(M.length){F(M.shift());}}else{if(H){L=[];}else{N.disable();}}}},N={add:function(){if(L){var Q=L.length;(function P(R){D.Array.each(R,function(S,T){var U=D.Lang.type(S);if(U==="function"){if(!O.unique||!N.has(S)){L.push(S);}}else{if(S&&S.length&&U!=="string"){P(S);}}});})(arguments);if(I){J=L.length;}else{if(H){G=Q;F(H);}}}return this;},remove:function(){if(L){D.Array.each(arguments,function(P,R){var Q;while((Q=D.Array.indexOf(L,P,Q))>-1){L.splice(Q,1);if(I){if(Q<=J){J--;}if(Q<=K){K--;}}}});}return this;},has:function(P){return P?D.Array.indexOf(L,P)>-1:!!(L&&L.length);},empty:function(){L=[];J=0;return this;},disable:function(){L=M=H=undefined;return this;},disabled:function(){return !L;},lock:function(){M=undefined;if(!H){N.disable();}return this;},locked:function(){return !M;},fireWith:function(Q,P){if(L&&(!E||M)){P=P||[];P=[Q,P.slice?P.slice():P];if(I){M.push(P);}else{F(P);}}return this;},fire:function(){N.fireWith(this,arguments);return this;},fired:function(){return !!E;}};return N;};},"1.0.0",{requires:[]});YUI.add("mail-common-utils-deferred",function(D){var C=Array.prototype.slice;var B=function(G){var F=[["resolve","done",D.Callbacks("once memory"),"resolved"],["reject","fail",D.Callbacks("once memory"),"rejected"],["notify","progress",D.Callbacks("memory")]],H="pending",I={state:function(){return H;},always:function(){E.done(arguments).fail(arguments);return this;},then:function(){var J=arguments;return B(function(K){D.Array.each(F,function(L,M){var N=D.Lang.isFunction(J[M])&&J[M];E[L[1]](function(){var O=N&&N.apply(this,arguments);if(O&&D.Lang.isFunction(O.promise)){O.promise().done(K.resolve).fail(K.reject).progress(K.notify);}else{K[L[0]+"With"](this===I?K.promise():this,N?[O]:arguments);}});});J=null;}).promise();},promise:function(J){var K=J!=null?D.mix(J,I):I;return K;}},E={};I.pipe=I.then;D.Array.each(F,function(J,K){var M=J[2],L=J[3];I[J[1]]=M.add;if(L){M.add(function(){H=L;},F[K^1][2].disable,F[2][2].lock);}E[J[0]]=function(){if(J[0]==="resolve"){}E[J[0]+"With"](this===E?I:this,arguments);return this;};E[J[0]+"With"]=M.fireWith;});I.promise(E);if(G){G.call(E,E);}return E;};var A=function(I){var G=0,K=D.Array.map(arguments,function(O){return O;}),E=K.length,F=E!==1||(I&&D.Lang.isFunction(I.promise))?E:0,N=F===1?I:B(),H=function(P,Q,O){return function(R){Q[P]=this;O[P]=arguments.length>1?C.call(arguments):R;if(O===M){N.notifyWith(Q,O);}else{if(!(--F)){N.resolveWith(Q,O);}}};},M,J,L;if(E>1){M=new Array(E);J=new Array(E);L=new Array(E);for(;G<E;G++){if(K[G]&&D.Lang.isFunction(K[G].promise)){K[G].promise().done(H(G,L,K)).fail(N.reject).progress(H(G,J,M));}else{--F;}}}if(!F){N.resolveWith(L,K);}return N.promise();};D.when=A;D.Deferred=B;},"1.0.0",{requires:["mail-common-utils-callbacks","array-extras"]});YUI.add("mail-services-message-service",function(B){function A(){var D=arguments[0]||{},C=D.stopwatch||null,F=D.cacheKey||"Prime",E=D.truncateAt||null;return{get:function(H,G){var I=B.Deferred();if(C){C.CMGStart=new Date();}B.mail.Controller.Messages.get({fid:G,msg:{mid:H},cachekey:F,ovparams:{truncateAt:E}},{success:function(K,J){if(C){C.CMGEnd=new Date();C.wasCached=J.respProps.wasCached;}if(!K||!K.mid){I.reject();}I.resolve(K);},failure:function(){I.reject();}});return I.promise();}};}B.namespace("mail.Services").MessageService=A;},"1.0.0",{requires:["mail-controller-messages","mail-common-utils-deferred"]});YUI.add("mail-ui-mailcompose",function(F){var W=F.common.Utils.substitute,e=F.mail.Controller.Compose,G=F.common.Utils,M=G.rocketstats.stat,R=F.mail.model.DataStore,d=G.log,L=F.ui.Templates,Z={"reply_sender":strings.str_reply,"reply_all":strings.str_reply,"edit":strings.str_reply,"forward":strings.str_forward},H=L._shared_module_compose_message_header_fresh;var a=function(Y,h,f,i){var k=this,j=i&&i.showSubject;k.header=new F.mail.compose.HeaderBaseConv(Y,k);k.cdo=Y;k.isDraft=h;k.title=strings.str_comp_nosubject;k.parent=null;k.baseNode=null;k.compArea=null;k.loadingArea=null;k.type="compose";k.dirty=false;k.focusNode=null;k.container=f;k.attachmentsLoading=[];k.attView=null;k.loadingTimer=null;k.allowEdit=false;k.allowSend=true;k.richFontInfo={fontFamily:null,fontSize:null};k.draftMID=null;k.saveTimer=null;k.hasHardDraft=false;k.blockAutoSave=false;k.lastSave=null;k.lastSaveType=null;k.isSending=false;k.isSaving=false;R.Sessions.reset();var g={m:"mailcompose init"};if(k.cdo.oComposeData.origin.action==null){g.action="new";}else{g.action=k.cdo.oComposeData.origin.action;}d(g);k.cancelDialogLoad=false;k.contentLoaded=false;k.stopwatch=i?i.stopwatch:null;k.origMsgFID=i?i.fid:null;k.suppressDialog=false;k.formatTmpl=L._shared_module_rte_well_content_format_fresh;k.handles=[];k.autoSaveTime=(NeoConfig.autoSaveInSec||120)*1000;k.formatters={page_well_email:function(){return W(L._shared_module_rte_well_tabs_compose.base,{},k.wellTabFormatters,null,strings,L);},page_well_format:function(){return W(k.formatTmpl.base,{},k.formatters,null,strings,L);},page_well_format_fresh:function(){return W(k.formatTmpl.base,{},k.formatters,null,strings,L);},page_well_emoticons:function(){return W(L._shared_module_rte_well_content_emoticons.base,{},k.formatters,null,strings,L);},page_well_attachments:function(){return W(L._shared_module_rte_well_content_attachments.base,{},k.formatters,null,strings,L);},quick_reply_card_actions:function(){return W(H.quick_reply_card_actions,{},k.formatters,0,strings,L);},quickCompose:function(){if(k.get("isQuickReply")){return W(H.quickCompose,{},0,0,strings,L);}},make_reply_all:function(){if(k.get("isQuickReply")){return;}var n=k.cdo.oComposeData.origin,l=n.action,m={title:(l==="reply_all"||n.fid==="Sent")?strings.str_comp_btn_reply_sender:strings.str_comp_btn_reply_all};return((l!=="reply_all"&&l!=="reply_sender")?"":W(H.make_reply_all,m,0,0,strings));},make_reply_all_qr:function(){var n=k.cdo.oComposeData.origin,l=n.action,m={title:(l==="reply_all"||n.fid==="Sent")?strings.str_comp_btn_reply_sender:strings.str_comp_btn_reply_all};return((l!=="reply_all"&&l!=="reply_sender")?"":W(H.make_reply_all_qr,m,0,0,strings));},spellCheckEnabled:function(){if(strings.str_tog_spellcheckEnabled){return W(k.formatTmpl.spellCheckEnabled,{HiddenClassName:""},k.formatters,null,strings,L);}else{return W(k.formatTmpl.spellCheckEnabled,{HiddenClassName:" hidden"},k.formatters,null,strings,L);}},is_rtl:function(){var l;if(NeoConfig.bidi){l=strings.str_tog_loadRTLCss?k.formatTmpl.is_rtl:k.formatTmpl.is_rtl_else;return W(l,{},k.formatters,null,strings,L);}else{return"";}},bidi:function(){if(NeoConfig.bidi){return W(k.formatTmpl.bidi,{},k.formatters,null,strings,L);}else{return"";}},page_compose_conversation:function(){return"";},compose_from_address:function(){return W(H.compose_from_address,{},k.formatters,null,strings,L);},timestamp_id:function(){return(new Date()).getTime();},fromSelected:function(l){return(l.isDefault?' selected="selected" class="nsel"':"");},fromAddress:function(l){if(typeof l==="string"){return l;}else{if(typeof l==="object"&&typeof l.address==="string"){return l.address;}}return"";},global_path_img:function(){return NeoConfig.globalPathImg+"/u/assets/img";},display_av_logo:function(){return NeoConfig.avLogoUrl?W(L._shared_module_rte_well_content_file_count.display_av_logo,{},k.formatters,null,strings,L):"";},antivirus_logo_path_img:function(){return NeoConfig.avLogoUrl;},page_compose_email_else:function(){return"hidden";},reply_type:function(){var m=k.cdo.oComposeData.origin,l=m.action;return l?Z[l]:strings.str_reply;},intl_fonts:function(){function m(q,o){var p=L._shared_module_rte_well_content_fontnamesize_fresh;return W(p.intl_fonts,{},{font_value:function(){return q;},font_name:function(){return o;}},null,strings,L);}var l="";if(strings.str_cfg_intl_fonts){var n=F.JSON.parse(strings.str_cfg_intl_fonts);F.Array.each(n,function(o){l+=m(o.value,o.name);});}return l;},show_formatter_well:function(){return W(L._shared_module_rte_well_fresh_conv.show_formatter_well,{},k.formatters,null,strings,L);},show_attachment_icon:function(){if(NeoConfig.useAttComposerTT){return W(L._shared_module_rte_well_fresh_conv.show_attachment_icon,{},k.formatters,null,strings,L);}else{return"";}},bottomToolbar:function(){return W(L._shared_module_compose_fresh.bottomToolbar,{},k.formatters,null,strings,L);},subject_hidden:function(){return k.get("isQuickReply")&&!j?H.subject_hidden:"";},less_than_IE10:function(){var l=F.UA.ie>0&&F.UA.ie<10;return l?W(H.less_than_IE10,{},k.formatters,null,strings,L):"";},is_underline:function(){if(NeoConfig.enableUnderline){return W(k.formatTmpl.is_underline,{},k.formatters,null,strings,L);}else{return"";}},has_quote:function(){var m=k.cdo.oComposeData.origin,l=m.action;if(NeoConfig.hasConv&&(l==="reply_sender"||l==="reply_all"||l==="edit")){return W(L._shared_module_compose_message_body.has_quote,{},k.formatters,null,strings,L);}}};a.superclass.constructor.call(k);k.addChild(k.header);k.header.on("HeaderBase:updateSubject",function(){k.neoFire("composeEvent",{action:"updateSubject"});});k.header.on("HeaderBase:qrCancel",function(){k.neoFire("composeEvent",{action:"qrCancel"});});k.cdo.after("saveactionChange",function(m){var l=m.newVal;if(l&&k.cdo){if(l.state===1){k.saveProgress(l);}else{if(l.state===0||l.state===-2){k.saveSuccess(l);}else{k.saveFailure(l);}}}});};function X(){var Y=this;a.superclass.ondestroy.call(Y,arguments);}function N(){var Y=this;return Y.dirty;
}function C(){var Y=this;return Y.draftMID===null?false:true;}function K(j,i,h,g,Y){var k=this,f=j?j:strings.str_comp_dialogheader;if(k.suppressDialog===true){h();return;}F.use("common-ui-dialog-helper",function(m){var l={hd:f,bd:i,suppressRestoreFocus:true};m.common.ui.DialogHelper.confirm(l,{ok:{text:Y,handler:h},cancel:{handler:function(){k._restoreFocus();if(g){g();}}}});});if(k.hiliteCP){k.hiliteCP.hide();}if(k.textCP){k.textCP.hide();}}function V(){var h=this,f=h.attachmentsLoading,Y,g;if(NeoConfig.useAttComposerTT&&h.cdo){return !h.cdo.attachments.areAllUploadsDone();}if(!f){return 0;}Y=f.length;for(g=0;g<Y;g++){if((f[g]*1)){return 1;}}return 0;}function U(Y){var f=this;f.focusNode=Y;f.neoFire("composeEvent",{action:"setFocusNode",focusNode:Y});}function Q(){var Y=this;Y.setFocus(Y.focusNode);}function c(){var Y=this;if(!Y.isSending&&!Y.isSaving){Y.fire("compose:dirty");Y.dirty=true;Y.resetSaveTimer();}}function B(){var Y=this;if(Y.saveTimer){Y.saveTimer.cancel();}if(!NeoConfig.isAMT){d("#SS resetSaveTimer ");Y.saveTimer=F.later(Y.autoSaveTime,Y,function(){Y._invokeSaveDraft({auto:true,silent:true});d("#SS invokeDraftSave inside timer:saving: "+((Y.isSaving)?"true":"false"));Y.saveTimer.cancel();},[],false);}}function P(){var Y=this;if(Y.saveTimer){Y.saveTimer.cancel();Y.saveTimer=null;}}function D(g,f){var h=this,Y=g?g:strings.str_comp_dialogheader;if(h.allowSend){F.use("common-ui-dialog-helper",function(k){h.allowSend=false;var j={hd:Y,bd:f,suppressRestoreFocus:true};var i=function(){h.allowSend=true;h._restoreFocus();};k.common.ui.DialogHelper.alert(j,{ok:{handler:i},cancel:{handler:i}});});}else{h._restoreFocus();}}function S(f){var j=this,g,i={},Y,h;if(j.isSaving||j.isSending){return true;}else{if(!j.contentLoaded){return false;}else{if(typeof f==="undefined"&&!j.dirty){if(j.lastSave){j.saveProgress(true);setTimeout(function(){j.updateSaveText();},500);}return false;}}}f=f||{};if(!f.forceSave){if(f.auto&&(j.blockAutoSave||!j.dirty)){j.resetSaveTimer();return false;}}j.isSaving=true;d("#SS: _invokeSaveDraft, isSave:1");if(!f.retry){j.lastSaveType=null;}g=j.assembleSendBody(true);Y={header:j._getHeader(true),textcontent:g.text,content:g.html};j.cdo.updateData(Y);f.auto?i.auto=true:"";h=j.draftMID&&j.cdo&&j.cdo.attachments.getAll().length;if(f.silent){i.silent=true;}else{if(f.retry){i.silent=false;}else{i.silent=h;}}i.isRetryable=h;i.cdo=j.cdo;i.author=j.container;i.mid=j.draftMID;e.save(i);return true;}function E(){var Y=this;if(Y.cdo===null){return;}Y.updateSaveText(true);}function J(g){if(this.cdo===null){return;}var l=this,i,k,h,Y;l.draftMID=g.mid;g=g||{};if(NeoConfig.useAttComposerTT){i=l.cdo.attachments;}if(l.dirty!=="ForceClose"&&!l.areAttachmentsPending()){l.dirty=false;}if(i&&i.getAll().length&&l.origMsgFID&&l.origMsgFID!=="Draft"&&!l.lastSave){Y=F.later(10000,l,function(){l.isSaving=false;});var f="Draft",m=new F.mail.Services.MessageService({cacheKey:"SaveMessage"}),j=m.get(g.mid,f);j.then(function(n){Y.cancel();l.isSaving=false;return n;}).done(function(n){if(!n.part){M("MailCompose","GDMFail:SaveSuccess");}l.fire("compose:getDisplayMessageResponse",n);}).fail(function(n){M("MailCompose","GDMFail:SaveSuccess");});}else{l.isSaving=false;if(NeoConfig.useAttComposerTT){F.Array.each(i.getAll(),function(n){k=n.original;if(k&&k.fid==="Draft"){k.mid=g.mid;}});}if(l.cdo.get("isRichText")){NeoConfig.hasConv?h=l.baseNode:h=l.getRTEDocNode();h.all("img").each(function(n){var o=n.get("src");if(o.indexOf("ya/download")!==-1&&o.indexOf("fid=Draft")!==-1){o=o.replace(/mid=.*?([&'">])/,"mid="+encodeURIComponent(g.mid)+"$1");n.set("src",o);}});}}if(l.lastSaveType===-1){M("MailCompose","SaveRetrySuccess");}l.lastSaveType=g.auto?1:0;l.lastSave=G.dateFormatter(new Date(),strings.str_tog_dateformat_rsstime_l10n);l.updateSaveText();l.resetSaveTimer();if(!g.auto){l.hasHardDraft=true;}l.fire("compose:saveSuccess",g);}function O(g){var k=this,l=g.mid||k.draftMID,m=k.lastSaveType,j,Y=false,h=false,f;g=g||{};k.lastSaveType=-1;if(k.cdo){j=k.cdo.attachments.getAll();Y=(j.length>0);if(Y){h=!F.Array.every(j,function(n){if(n.referencedInline===true||n.disposition==="inline"){return false;}return true;});}}if(m!==-1){if(l&&Y){f=F.later(10000,k,function(){k.isSaving=false;});F.mail.Controller.Messages.get({fid:"Draft",msg:{mid:l},cachekey:"SaveMessage",noCache:true},function(n){f.cancel();k.isSaving=false;if(!n||!n.mid||!n.part){M("MailCompose","SaveRetryFailedGDM");h&&M("MailCompose","SaveRetryFailedGDM:inlineAttachment");}else{M("MailCompose","SaveRetryAttempted");k.fire("compose:getDisplayMessageResponse",n);k._invokeSaveDraft({auto:g.auto,silent:g.auto?true:false,retry:true});}});return;}}else{M("MailCompose","SaveRetryFailed");}M("MailCompose","SaveFailure");Y&&M("MailCompose","SaveFailure:attachment");h&&M("MailCompose","SaveFailure:inlineAttachment");k.updateSaveText();k.neoFire("composeEvent",{action:"saveComplete",saveSuccess:false});if(!g.auto){var i=k.allowSend;k.allowSend=true;k._alertProblem(strings.str_comp_title_saveasdraftfail,strings.str_comp_saveasdraftfail);k.allowSend=i;}k.isSaving=false;k.fire("compose:saveFail");}function T(){var h=this,Y=h.richFontInfo,g=Y.fontFamily,f=Y.fontSize;if(!g){g=e.getStyleFontFamily(false);}if(!f){f=e.getStyleFontSize(false);}return{fontFamily:g,fontSize:f,foreColor:Y.foreColor,backColor:Y.backColor};}function b(){var g=this,Y=g.areAttachmentsPending(),f='<span id="{{btnID}}ModalOverlay" class="btn left right {{default}}" data-action="{{btnID}}"><a href="#">{{btnLabel}}</a></span>';F.use("common-ui-dialog-helper",function(h){var p=W(f,{btnID:"SaveDraft","default":"default",btnLabel:strings.str_comp_savetodrafts_fresh}),k=W(f,{btnID:"DontSave",btnLabel:(Y?strings.str_comp_closewithoutsaving:strings.str_comp_abandon)}),i=W(f,{btnID:"Continue","default":(Y?"default":""),btnLabel:(Y?strings.str_comp_returntomessage:strings.str_comp_keepwriting)}),n=Y?(i+k):(p+k+i),o=(Y?strings.str_comp_close_attachmentprocessing:strings.str_comp_close_confirm),j={modal_classes:"lg",hd:strings.str_comp_close,bd:o,ft:n,suppressRestoreFocus:true},l={SaveDraft:{handler:function(){g._invokeSaveDraft();
if(g.header){g.header.hideACWidget();}g.dirty="ForceClose";g._closeAfterWarning(true);}},DontSave:{handler:function(){if(g.header){g.header.hideACWidget();}g.dirty="ForceClose";if(!g.hasHardDraft&&g.draftMID){h.use("mail-ui-proxyevents",function(){h.mail.ui.MailEventsProxy.handleUI({action:"delete"},"Draft",null,[{fid:"Draft",mid:g.draftMID,force:true}]);});}g._closeAfterWarning(false);}},Continue:{handler:function(){g.blockAutoSave=false;g.cancelDialogLoad=false;g._restoreFocus();}}},m=function(q){g.blockAutoSave=true;if(q){g.setFocus("to");}h.common.ui.DialogHelper.createCommon(j,l,function(r){r.set&&r.set("adAction","disableRetriggerOnOk");});};g.neoFire("composeEvent",{action:"showSaveDialog",sdcbk:h.bind(m,g),sdinline:(g.type==="inlineCompose")});});}function I(g){var i=this,f=i.areAttachmentsPending(),h='<span id="{{btnID}}ModalOverlay" class="btn left right {{default}}"><a href="#" data-action="{{btnID}}">{{btnLabel}}</a></span>';function Y(){if(i.draftMID){F.use("mail-ui-proxyevents",function(){F.mail.ui.MailEventsProxy.handleUI({action:"delete"},"Draft",null,[{fid:"Draft",mid:i.draftMID,force:true}]);});}}if(!g){Y();return;}F.use("common-ui-dialog-helper",function(p){var q=W(h,{btnID:"Discard","default":"default",btnLabel:strings.str_comp_discard}),j=W(h,{btnID:"Continue","default":(f?"default":""),btnLabel:strings.str_comp_keepwriting}),m=f?(j+q):(q+j),n=(f?strings.str_comp_discard_attachmentprocessing:strings.str_comp_discard_confirm),l={modal_classes:"lg",hd:strings.str_comp_deletedraft,bd:n,ft:m,suppressRestoreFocus:true},k={Discard:{handler:function(){if(i.header){i.header.hideACWidget();}i.dirty="ForceClose";Y();i._closeAfterWarning(false);}},Continue:{handler:function(){i.blockAutoSave=false;i.cancelDialogLoad=false;i._restoreFocus();}}},o=function(){i.blockAutoSave=true;p.common.ui.DialogHelper.createCommon(l,k,function(r){r.set&&r.set("adAction","disableRetriggerOnOk");});};i.neoFire("composeEvent",{action:"showDeleteDraftDialog",sdcbk:p.bind(o,i)});});}function A(Y){var i=this,h=i.baseNode.one(".attachment-button-attach");i.cancelDialogLoad=true;if(i.hiliteCP){i.hiliteCP.hide();}if(i.textCP){i.textCP.hide();}if(i.dirty==="ForceClose"){return true;}var g=i.isDirty()||(i.draftMID&&!i.hasHardDraft&&!Y),f=i.areAttachmentsPending();if(f){g=i.dirty=1;}if(i.get("isQuickReply")){i.doDiscardDraft(g);}else{if(g){i.showSaveDraftDialog();}else{h&&h.fire("compose:close");}}return !g;}F.extend(a,F.mail.ui.BaseWidget);F.mix(a.prototype,{NAME:"MailCompose",isDirty:N,_setDirty:c,_getHeader:function(){return this.header.getHeader();},_setHeader:function(Y){this.header.setHeader(Y);},isSaved:C,areAttachmentsPending:V,resetSaveTimer:B,canClose:A,showSaveDraftDialog:b,doDiscardDraft:I,getRichFontInfo:T,saveSuccess:J,saveFailure:O,saveProgress:E,_alertProblem:D,_invokeSaveDraft:S,_cancelSaveTimer:P,_closeAfterWarning:function(){},_registerFocus:U,_restoreFocus:Q,confirm:K,ondestroy:X},true);F.namespace("mail.ui");F.mail.ui.MailComposeConv=a;},"1.0.0",{requires:["autocomplete_css","common-persist-user-data","mail-persist-meta-data","mail-controller-messages","mail-model-datastore","_shared_module_compose_message_header","mail-controller-compose","_shared_module_compose_message_header_fresh","mail-ui-mailcompose-base-header-conv","rocket-stats","comms-utils","mail-ui-basewidget","editor-inline","mail-services-message-service"]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-para-base",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)},r="host",i="> p",s="p",o="<br>";e.extend(n,e.Base,{_getRoot:function(){return this.get(r).getInstance().EditorSelection.ROOT},_fixFirstPara:function(){var e=this.get(r),t=e.getInstance(),n,u,a=this._getRoot(),f=a.getHTML(),l=f.length?!0:!1;f===o&&(f="",l=!1),a.setHTML("<"+s+">"+f+t.EditorSelection.CURSOR+"</"+s+">"),u=a.one(i),n=new t.EditorSelection,n.selectNode(u,!0,l)},_afterEditorReady:function(){var e=this.get(r),t=e.getInstance(),n;t&&(t.EditorSelection.filterBlocks(),n=t.EditorSelection.DEFAULT_BLOCK_TAG,i="> "+n,s=n)},_afterContentChange:function(){var e=this.get(r),t=e.getInstance();t&&t.EditorSelection&&t.EditorSelection.filterBlocks()},_afterPaste:function(){var t=this.get(r),n=t.getInstance();e.later(50,t,function(){n.EditorSelection.filterBlocks()})},initializer:function(){var t=this.get(r);if(t.editorBR){e.error("Can not plug EditorPara and EditorBR at the same time.");return}t.after("ready",e.bind(this._afterEditorReady,this)),t.after("contentChange",e.bind(this._afterContentChange,this)),e.Env.webkit&&t.after("dom:paste",e.bind(this._afterPaste,this))}},{NAME:"editorParaBase",NS:"editorParaBase",ATTRS:{host:{value:!1}}}),e.namespace("Plugin"),e.Plugin.EditorParaBase=n},"3.13.0",{requires:["editor-base"]});
/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-para",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)},r="host",i="nodeChange",s="parentNode",o="> p",u="p",a="<br>",f="firstChild",l="li";e.extend(n,e.Plugin.EditorParaBase,{_getRoot:function(){return this.get(r).getInstance().EditorSelection.ROOT},_onNodeChange:function(t){var n=this.get(r),i=n.getInstance(),c,h,p,d,v,m=i.EditorSelection.DEFAULT_BLOCK_TAG,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D=":last-child",H,B,j,F,I,q=!1,R=this._getRoot(),U;switch(t.changedType){case"enter-up":H=this._lastPara?this._lastPara:t.changedNode,B=H.one("br.yui-cursor"),this._lastPara&&delete this._lastPara,B&&(B.previous()||B.next())&&B.ancestor(u)&&B.remove(),H.test(m)||(N=H.ancestor(m),N&&(H=N,N=null));if(H.test(m)){C=H.previous();if(C){F=C.one(D);while(!q)F?(I=F.one(D),I?F=I:q=!0):q=!0;F&&n.copyStyles(F,H)}}break;case"enter":e.UA.webkit&&t.changedEvent.shiftKey&&(n.execCommand("insertbr"),t.changedEvent.preventDefault()),t.changedNode.test("li")&&!e.UA.ie&&(c=i.EditorSelection.getText(t.changedNode),c===""&&(p=t.changedNode.ancestor("ol,ul"),j=p.getAttribute("dir"),j!==""&&(j=' dir = "'+j+'"'),p=t.changedNode.ancestor(i.EditorSelection.BLOCKS),d=i.Node.create("<p"+j+">"+i.EditorSelection.CURSOR+"</p>"),p.insert(d,"after"),t.changedNode.remove(),t.changedEvent.halt(),v=new i.EditorSelection,v.selectNode(d,!0,!1)));if(e.UA.gecko&&n.get("defaultblock")!=="p"){p=t.changedNode;if(!p.test(l)&&!p.ancestor(l)){p.test(m)||(p=p.ancestor(m)),d=i.Node.create("<"+m+"></"+m+">"),p.insert(d,"after"),v=new i.EditorSelection;if(v.anchorOffset){g=v.anchorNode.get("textContent"),h=i.one(i.config.doc.createTextNode(g.substr(0,v.anchorOffset))),y=i.one(i.config.doc.createTextNode(g.substr(v.anchorOffset))),w=v.anchorNode,w.setContent(""),E=w.cloneNode(),E.append(y),S=!1,T=w;while(!S)T=T.get(s),T&&!T.test(m)?(x=T.cloneNode(),x.set("innerHTML",""),x.append(E),b=T.get("childNodes"),U=!1,b.each(function(e){U&&x.append(e),e===w&&(U=!0)}),w=T,E=x):S=!0;y=E,v.anchorNode.append(h),y&&d.append(y)}d.get(f)&&(d=d.get(f)),d.prepend(i.EditorSelection.CURSOR),v.focusCursor(!0,!0),c=i.EditorSelection.getText(d),c!==""&&i.EditorSelection.cleanCursor(),t.changedEvent.preventDefault()}}break;case"keyup":e.UA.gecko&&R&&R.getHTML().length<20&&(R.one(o)||this._fixFirstPara());break;case"backspace-up":case"backspace-down":case"delete-up":e.UA.ie||(k=R.all(o),A=R,k.item(0)&&(A=k.item(0)),L=A.one("br"),L&&(L.removeAttribute("id"),L.removeAttribute("class")),h=i.EditorSelection.getText(A),h=h.replace(/ /g,"").replace(/\n/g,""),M=A.all("img"),h.length===0&&!M.size()&&(A.test(u)||this._fixFirstPara(),O=null,t.changedNode&&t.changedNode.test(u)&&(O=t.changedNode),!O&&n._lastPara&&n._lastPara.inDoc()&&(O=n._lastPara),O&&!O.test(u)&&(O=O.ancestor(u)),O&&!O.previous()&&O.get(s)&&O.get(s).compareTo(R)&&(t.changedEvent.frameEvent.halt(),t.preventDefault())),e.UA.webkit&&t.changedNode&&(t.preventDefault(),A=t.changedNode,A.test("li")&&!A.previous()&&!A.next()&&(c=A.get("innerHTML").replace(a,""),c===""&&A.get(s)&&(A.get(s).replace(i.Node.create(a)),t.changedEvent.frameEvent.halt(),i.EditorSelection.filterBlocks())))),e.UA.gecko&&this._fixGeckoOnBackspace(i)}e.UA.gecko&&t.changedNode&&!t.changedNode.test(m)&&(O=t.changedNode.ancestor(m),O&&(this._lastPara=O))},_fixGeckoOnBackspace:function(e){var t=new e.EditorSelection,n,r,i;if(!t.isCollapsed||!t.anchorNode.get("tagName")==="P"||t.anchorOffset===0)return;i=t.anchorNode.get("childNodes"),r=t.anchorNode.get("lastChild");if(t.anchorOffset!==i.size()||r.get("tagName")!=="BR")return;if(t.anchorOffset===1){t.selectNode(t.anchorNode,!0);return}r=r.get("previousSibling");if(r.get("nodeType")!==Node.TEXT_NODE)return;n=r.get("length"),t.getEditorOffset()===n&&t.selectNode(r,!0,n)},initializer:function(){var t=this.get(r);if(t.editorBR){e.error("Can not plug EditorPara and EditorBR at the same time.");return}t.on(i,e.bind(this._onNodeChange,this))}},{NAME:"editorPara",NS:"editorPara",ATTRS:{host:{value:!1}}}),e.namespace("Plugin"),e.Plugin.EditorPara=n},"3.13.0",{requires:["editor-para-base"]});
YUI.add("comms-ui-dialog-base",function(H){var E=H.Node,C=E.one,G,D,F="dlg-show";function A(I){var J=I.get("id");if(!J){J=H.stamp(I);I.set("id",J);}return J;}function B(R){R=R||{};R.visible=R.visible||0;R.zIndex=R.zIndex||15500;var Q=this,U=R.contentBox||null,V=R.template||null,K=R.cssPrefix||null,I=R.focusedNode||null,M=R.clearMask||false,T=R.hideMask||false,S=R.restoreFocusNode,J=R.suppressRestoreFocus||false,L=R.suppressActive,O=R.maskId||null,N=R.noScroll||false,P=R.disableEsc||false;this._evt=[];if(!U&&V){Q.CONTENT_TEMPLATE=V;}B.superclass.constructor.apply(this,arguments);if(!D&&L){if(G){D=G;G.set("visible",false);}else{L=false;}}Q.addAttrs({cssPrefix:{value:K,readOnly:true},focusedNode:{value:I},clearMask:{value:M},hideMask:{value:T},restoreFocusNode:{valueFn:function(){var W=S;if(!((W instanceof H.Node)||H.Lang.isNull(W))){W=document.activeElement;}return W;}},suppressRestoreFocus:{value:J},suppressActive:{value:L,readOnly:true},maskId:{value:O},noScroll:{value:N},disableEsc:{value:P}});}B.NAME="dialog";B.CSS_PREFIX="yui3-overlay";B.ATTRS={role:{value:"dialog"}};H.extend(B,H.Overlay,{maskEl:null,prevMaskElId:null,centerEl:null,_haltShow:false,initializer:function(){this.set("visible",false);this.on("render",this.onBeforeRender);},destructor:function(){H.one("html").removeClass(F);var J,K=this.get("restoreFocusNode"),M=this.get("suppressRestoreFocus"),I=this.get("contentBox").get("id");this.get("boundingBox").purge(true);if(this.get("centered")){this.centerEl&&this.centerEl.remove(true);}else{this.get("boundingBox").remove(true);}for(J in this._evt){H.detach(this._evt[J]);}if(!this._haltShow){if(D&&this.get("suppressActive")){D.set("visible",true);D=null;this.prevMaskElId&&this.maskEl&&this.maskEl.set("id",this.prevMaskElId);this.prevMaskElId=null;}else{if(this.get("maskId")){this.maskEl.remove(true);}else{this.maskEl&&this.maskEl.setStyle("display","none");}G=null;if(!M){try{if(!(H.Lang.isNull(K)||K.tagName=="IFRAME")){K.focus();}}catch(L){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-comms-shared-src-ui-dialog-js-dialog:1",L,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-comms-shared-src-ui-dialog-js-dialog:1");}}H.fire("dialog:hide",I);}}else{this._haltShow=false;}},renderUI:function(){var P=this.get("cssPrefix"),K=this.get("contentBox"),O=this.get("role"),I,N,M,J,L;K.set("role",O);if(P){I=["#"+K.get("id")," .",P].join("");M=H.one(I+"-hd");J=H.one(I+"-bd");L=H.one(I+"-ft");if(M){K.set("aria-labelledby",A(M));if((N=M.one(".close"))){N.set("role","presentation");}if(!M.hasClass("yui3-widget-hd")){M.addClass("yui3-widget-hd");}}if(J){if(O==="alertdialog"||O==="dialog"){K.set("aria-describedby",A(J));}if(!J.hasClass("yui3-widget-bd")){J.addClass("yui3-widget-bd");}}if(L){if(!L.hasClass("yui3-widget-ft")){L.addClass("yui3-widget-ft");}}}K.setStyle("display","block");K.set("tabIndex",0);K.all(".btn a").each(function(R,Q){R.set("role","button");});},show:function(){if(!G){B.superclass.show.call(this);!this.get("suppressActive")&&H.fire("dialog:show",this);this.get("contentBox").setStyle("opacity",1);}else{this._haltShow=true;this.destroy();}},bindUI:function(){var J=H.one("html"),O=J.all(".yui3-overlay-content .btn a"),I=O.size()-1,M=J.one(".yui3-overlay-content"),P=this.get("focusedNode"),L;if(this.get("centered")){this.after("renderedChange",this.center);}this._evt.push(this.after("visibleChange",function(){var R={display:"none"},Q=this.get("contentBox");if(this.get("visible")){Q&&Q.setStyle("display","block");R.display=this.get("hideMask")?"none":"block";G=this;if(!this.get("clearMask")){J.addClass(F);}}else{Q&&Q.setStyle("display","none");G=null;if(!this.get("clearMask")){J.removeClass(F);}}this.maskEl&&this.maskEl.setStyles(R);if(G){N(true);}H.fire("ToolTips:hideTooltips");}));function N(R){if(!G){return;}if(!(P instanceof H.Node)){R&&H.UA.gecko&&M.focus();P=M.one(P);}try{if(P){P.focus();}else{M.focus();}}catch(Q){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-comms-shared-src-ui-dialog-js-dialog:2",Q,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-comms-shared-src-ui-dialog-js-dialog:2");}}this._evt.push(M.on("blur",function(){L=true;}));this._evt.push(M.on("focus",function(R){var Q="#"+M.get("id");if(L&&!R.target.ancestor(Q,true)){N();}L=false;}));function K(S){var Q,R=S.target;switch(S.keyCode){case 8:case 46:return;case 9:if(I>-1){if(S.shiftKey){if(M==R){S.halt();O.item(I).focus();}}else{if(O.item(I)==R){S.halt();M.focus();}}}break;case 27:if(!this.get("disableEsc")){this.fire("dialog:action",{dataAction:"cancel"});S.preventDefault();}break;case 32:if(R.getAttribute("role")=="button"){S.preventDefault();H.use("node-event-simulate",function(){R.simulate("click");});}break;case 37:case 39:if((I>0)&&(Q=O.indexOf(R))>-1){if(S.keyCode==37){O.item((Q==0)?I:Q-1).focus();}else{O.item((Q==I)?0:Q+1).focus();}}break;}S.stopPropagation();}M.on("keydown",K,this);},onBeforeRender:function(O){var P=this.get("zIndex"),I=this.get("hideMask"),L=this.get("clearMask"),Q=this.getClassName((L?"clearmask":"mask")),J="position:fixed;top:50%;left:50%;height:1px;",K,M=this.get("maskId"),N,R;if(M){this.maskEl=C("#"+M);}if(!this.maskEl){if(!M){M=H.guid();}if(!(this.maskEl=H.one("."+Q))&&!I){N=['<DIV id="',M,'" class="',Q,'" style="z-index:',(P-2),'"></DIV>'].join(""),C("body").prepend(N);this.maskEl=C("#"+M);}else{if(this.maskEl){this.prevMaskElId=this.maskEl.get("id");this.maskEl.set("id",M);this.maskEl.setStyle("zIndex",P-2);}}}if(this.get("centered")){K=H.guid();R=['<DIV id="',K,'" style="',J,"z-index:",(P-1),'"></DIV>'].join("");C("body").prepend(R);this.centerEl=H.one("#"+K);O.parentNode=this.centerEl;this.get("boundingBox").setStyle("position","relative");}},center:function(){var J,K,I=this.get("boundingBox");J=-(I.get("offsetWidth")/2)+"px";K=-(I.get("offsetHeight")/2)+"px";I.setStyles({"marginLeft":J,"top":K,"left":0});}});H.namespace("comms.ui");H.comms.ui.Dialog=B;
},"0.0.1",{requires:["overlay"]});YUI.add("_shared_module_offscreen_bin_modal_close_icon",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_modal_close_icon={base:'<span class="icon close" data-action="cancel" title="{{str_btn_close}}"></span>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_modal",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_modal={base:'<div id="modalOverlay" class="modal {{modal_classes}}"> <h2 class="modal-hd"> {{modal_header}} {{_shared_module_offscreen_bin_modal_close_icon}} </h2> <div class="frontpanel"> <div class="modal-bd">{{modal_body}}</div> <div class="modal-ft">{{modal_ft}}</div> </div> {{modal_back_panel}}</div>',modal_back_panel:'<div class="backpanel back hidden"> <div class="modal-bd">{{modal_body_back}}</div> <div class="modal-ft">{{modal_ft_back}}</div> </div> '};},"1.0.0",{requires:["_shared_module_offscreen_bin_modal_close_icon"]});YUI.add("_shared_module_offscreen_bin_modal_btn_ok",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_modal_btn_ok={base:'<span id="okayModalOverlay" class="btn left right default" data-action="ok"><a href="#">{{str_ok}}</a></span> '};},"1.0.0");YUI.add("common-ui-dialog-helper",function(C){var A=C.common.Utils.substitute,B=C.ui.Templates,E="alertdialog",D;D=function(){var H={modal_header:function(M){return M.hd;},modal_body:function(M){return M.bd;},modal_ft:function(M){return A(M.ft,0,0,0,strings);},_shared_module_offscreen_bin_modal_btn_ok:function(M){return M.ok;},_shared_module_offscreen_bin_modal_btn_cancel:function(M){return M.cancel;},_shared_module_offscreen_bin_modal_close_icon:function(M){return(M.hideClose)?"":A(B._shared_module_offscreen_bin_modal_close_icon.base,0,0,0,strings);},global_path_img:function(){return NeoConfig.globalPathImg+"/u/assets/img";},antivirus_logo_path_img:function(){return NeoConfig.avLogoUrl;}};function L(N,O,M){N.ft=B._shared_module_offscreen_bin_modal_btn_ok.base||"";N.role=E;if(O&&O.ok&&O.ok.text){N.ft=A(N.ft,0,0,0,{str_ok:O.ok.text});}F(N,O,M);}function K(N,O,M){C.use("_shared_module_offscreen_bin_modal_btn_cancel",function(){var P={cancel:B._shared_module_offscreen_bin_modal_btn_cancel.base};N.ft=A(B._shared_module_offscreen_bin_modal_btn_cancel.base,P,H,0,strings);N.focusedNode='.modal-ft [data-action="cancel"]';N.role=E;F(N,O,M);});}function G(N,O,M){C.use("_shared_module_offscreen_bin_modal_btns_ok_cancel",function(){var P={ok:B._shared_module_offscreen_bin_modal_btn_ok.base,cancel:B._shared_module_offscreen_bin_modal_btn_cancel.base};if(O&&O.ok&&O.ok.text){P.ok=A(P.ok,0,0,0,{str_ok:O.ok.text});}N.ft=A(B._shared_module_offscreen_bin_modal_btns_ok_cancel.base,P,H,0,strings);N.role=E;F(N,O,M);});}function J(N,O,M){N.ft=A(N.ft,0,H,0,strings);F(N,O,M);}function F(N,O,M){N=N||{};if(!N.template){var Q=N.rawTemplate||B._shared_module_offscreen_bin_modal.base;N.template=A(Q,N,H,0,strings);}N.centered=true;N.cssPrefix="modal";N.focusedNode=N.focusedNode||".yui3-widget-ft span.default a";function P(R){R.get("contentBox").set("aria-live","polite");R.show();if(M){M(R);}}I(N,O,P);}function I(N,P,M){var O=new C.comms.ui.Dialog(N);P=P||{};O.render();O.get("contentBox").on("click",function(S){var T=C.common.Utils.getDataAction(S),R=T.action,Q=T.node;if(R){if(!N.allowDefault){S.preventDefault();}O.fire("dialog:action",{dataAction:R,item:Q});}});O.after("dialog:action",function(T){var R=T.dataAction,Q;if(R){Q=P[R];try{if(!Q||!Q.stopDestroy){O.destroy();}Q&&Q.handler&&Q.handler.call(this,T,O);}catch(S){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-common-ui-dialoghelper-dialoghelper:1",S,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-common-ui-dialoghelper-dialoghelper:1");}}});if(M){M(O);}}C.mix(this,{alert:L,cancelDialog:K,confirm:G,create:I,custom:J,createCommon:F});};C.namespace("common.ui");C.common.ui.DialogHelper=new D();},"1.0.0",{requires:["common-utils","modal_css","comms-ui-dialog-base","_shared_module_offscreen_bin_modal","_shared_module_offscreen_bin_modal_btn_ok"]});YUI.add("_shared_module_compose_link_editor",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_link_editor={base:'<div class="label-left-fl"> <div class="link-editor-description"> <div>{{str_comp_createlink_display_text}}</div> <input id="newDescription" type="text" class="field-xl" value="{{defaultDescription}}"/> </div> <div class="link-editor-link"> <div>{{str_comp_createlink_edit_link}}</div> <input id="newURL" type="text" class="field-xl" placeholder="http://www.yahoo.com" value="{{defaultHREF}}" dir="ltr"/> </div> <a id="followLink" role="button" title="{{str_comp_createlink_follow_link}}" href="#">{{str_comp_createlink_follow_link}}</a></div>'};},"1.0.0");YUI.add("mail-ui-rte-linkeditor",function(G){var A=G.common.Utils.substitute;function D(){var I;if(window.getSelection){I=window.getSelection();if(I.getRangeAt&&I.rangeCount){return I.getRangeAt(0);}}else{if(document.selection&&document.selection.createRange){return document.selection.createRange();}else{if(document.body.createTextRange){return document.body.createTextRange();}}}return null;}function F(I){var J;if(I){if(window.getSelection){J=window.getSelection();J.removeAllRanges();J.addRange(I);}else{if(document.selection&&I.select){I.select();}}}}function C(J){var I=D();if(!I){return;}if(I.setStartAfter){I.setStartAfter(G.Node.getDOMNode(J));}else{I.moveToElementText(J);}I.collapse(true);window.getSelection().removeAllRanges();window.getSelection().addRange(I);}function H(I){I=G.Lang.trim(I);if(!I||I===""||/^javascript/.test(I)){return"";}if(0===I.indexOf("//")){I="http:"+I;}else{if(-1===I.indexOf(":")){I="http://"+I;}}I=I.replace(/"/g,"%22").replace(/'/g,"%27");return I?I:"";}function E(I){I.replace(I.get("text"));}G.Plugin.ExecCommand.COMMANDS.createlink=function(){var I=this.get("host");I.get("container").focus();I.get("host").linkEditor.createOrEditLinkInSelection();};var B=function(){B.superclass.constructor.apply(this,arguments);};G.extend(B,G.Plugin.Base,{initializer:function(){var K=this,J=this.get("host"),I;function M(O){var N=function(P){return P===I;};if(!O.target.ancestor("[contenteditable=false]",true,N)){O.preventDefault();K.editExistingLink(this);}}function L(){I=K._editor.frame.get("container");I.delegate("click",M,"a");}this._editor=J;this.listeners=[];if(J.get("isReady")){L();return;}K.listeners.push(J.after("ready",L));},destructor:function(){G.each(this.listeners,function(I){I.detach();});this.listeners=[];}},{NAME:"linkEditor",NS:"linkEditor",ATTRS:{host:{value:false}}});G.mix(B.prototype,{_getSelection:function(){var I=this._editor.frame.getInstance();return new I.EditorSelection();},_execCommand:function(K,I,J){J=J||{};if(J.bypassOverrides){return this._editor.frame._execCommand(K,I);}else{return this._editor.frame.execCommand(K,I);}},_selectLink:function(){var L=this._getSelection(),I,K,J;if(!L.isCollapsed){I=L.getSelected();if(!I.size()){return null;}K=I.item(0);J=K.get("tagName");if(J==="A"){return K;}else{if(J==="FONT"&&K.get("parentNode").get("tagName")==="A"){return K.get("parentNode");}}return I.item(0).one("a");}if(L.anchorNode.get("tagName")==="A"){K=L.anchorNode;L.selectNode(K);}return K;},_showEditDialog:function(N,R,K){var P,S,L,O,J,Q;function M(Y){var X=G.one("input#newURL"),U=G.one("input#newDescription"),T=G.one("a#followLink"),W;Y.get("contentBox").addClass("link-editor-dialog");function V(Z){if(Z.keyCode===G.Node.DOM_EVENTS.key.eventDef.KEY_MAP.enter){Z.preventDefault();Y.fire("dialog:action",{dataAction:"ok"});}if(Z.keyCode===G.Node.DOM_EVENTS.key.eventDef.KEY_MAP.esc){Y.fire("dialog:action",{dataAction:"cancel"});}}L=X.on("keydown",V);T.on("click",function(a){var Z=X.get("value");Z=H(Z);a.preventDefault();if(!G.Lang.isString(Z)){return;}window.open(Z);});if(NeoConfig.bidi){W=G.Intl.bidiDirection(U.get("value"));U.set("dir",W);U.plug(G.Plugin.BidiTextEntry);}P=Y;X.focus();X.select();}function I(){if(P){P.destroy();P=null;}F(Q);if(J){J.remove(true);G.all("span.yui-non").remove(true);}if(L){L.detach();}}S=this._getSelection();O=S.getSelected();Q=D();if(S.isCollapsed){}N=H(N);G.common.ui.DialogHelper.confirm({hd:strings.str_comp_createlink_link_options,bd:A(G.ui.Templates._shared_module_compose_link_editor.base,{defaultHREF:N,defaultDescription:R},null,null,strings),focusedNode:"input#newURL"},{ok:{handler:function(){var W=G.one("input#newURL"),V=W.get("value"),T=G.one("input#newDescription"),U=T.get("value")||V;if(!G.Lang.isString(V)){return;}I();K(H(V),U);},stopDestroy:true},cancel:{handler:function(){I();}}},M);},_fireLinkEvent:function(I){this.get("host").fire("link",{node:I,linkSource:"link-editor"});},_findAnchor:function(J){var L=J.one("a"),I=J.ancestor(),K=function(M){return M.get("tagName").toUpperCase()==="A"?true:false;};J=K(J)?J:null;I=K(I)?I:null;return J||L||I;},_createLink:function(K,N,M){var L,O,I,J;this._execCommand("createlink",K,{bypassOverrides:true});L=this._getSelection();O=L.getSelected();if(L.isCollapsed||!O.size()){this._execCommand("insertandfocus",'<a id="link-editor-new-anchor" href="'+K+'">'+N+"</a>");I=G.one("#link-editor-new-anchor");I.removeAttribute("id");if(I&&K.indexOf("http")===0){this._fireLinkEvent(I);}return;}J=this._findAnchor(O.item(0));if(J&&M&&K.indexOf("http")===0){J.set("text",N);this._fireLinkEvent(J);}I=O.item(0).one("a");if(I){O.item(0).replace(I);J=I;}C(J);},editExistingLink:function(I){function J(K,L){if(!K){E(I);return;}I.set("href",K);I.set("text",L);}this._showEditDialog(I.get("href"),I.get("text"),J);},createOrEditLinkInSelection:function(){var L=this,K="",M,I=L._selectLink();if(I&&I.get("href")){K=I.get("href");M=I.get("text");}else{M=L._getSelection().text;}function J(P,O){var N;if(!I&&!P){return;}if(!P){E(I);return;}if(I&&G.UA.gecko){N=L._getSelection();E(I);L._execCommand("inserthtml",'<a href="'+P+'">'+N.text.trim()+"</a>");return;}L._createLink(P,O,I?false:true);}L._showEditDialog(K,M,J);}});G.namespace("mail.rte").LinkEditor=B;},"1.0.0",{requires:["plugin","common-ui-dialog-helper","_shared_module_compose_link_editor"]});YUI.add("mail-ui-rte-smartscroll",function(C){var G="offsetTop",B="offsetParent",J="height",H="clientHeight",K="clientWidth",F="scrollTop",A="smartFixed",D=150;function M(R,P){var Q,S;if(!R){return 0;}Q=R.get(G);S=R.get(B);while(S!==P){if(!S){return Q;}Q+=S.get(G);S=S.get(B);}return Q;}function N(R){var Q=document.createRange(),P;Q.selectNodeContents(R);P=Q.getClientRects();return P.length>0?P[0]:null;}function L(){var P=document&&document.documentElement;if(!P){return false;}if(P.scrollHeight>P.clientHeight+10){return true;}return false;}function E(S){var T,P,R,U,Q;T=window.getSelection();P=T.getRangeAt(0);R=P.getClientRects();if(R[0]&&R[0].height<S){U=R[0].top;Q=R[0].height;}else{R=T.focusNode.getBoundingClientRect&&T.focusNode.getBoundingClientRect();if(R&&R.height){R=I(T.focusNode,T.focusOffset);U=R[0];Q=R[1];}else{return null;}}return[U,Q];}function I(P,U){var S,Q=0,W=0,R=P.childNodes,V,T;for(S=U-1;S>=0;S--){V=R.item(S);if(V.nodeType===3){T=N(V);Q=T.top;W=T.height;break;}if(V.nodeName!=="BR"){T=V.getBoundingClientRect();Q=T.top;W=T.height;break;}}if(W>0){Q=Q+(U-S-1)*W;}else{T=P.getBoundingClientRect();W=T.height/P.children.length;Q=T.top+U*W;}return[Q,W];}function O(a){var c=this,f=a.rte,h=f.getContainer(),e=h.ancestor(".compose"),T=e&&e.ancestor(a.topOverlaySelector),u,q,n,V,p,b,o,X,k,j,S,r,Q,Z=false,m=false,W=false,d,i,s;c.detach=function(){if(j){j.detach();}if(S){S.detach();}if(r){r.detach();}};if(!T){return;}Q=T.ancestor(".threadpane").one(".message-header");u=e.one(".compose-header");q=u.ancestor("tr");n=e.one(".bottomToolbar");V=n.ancestor("tr");function v(){var w=q.getComputedStyle(J);u.addClass(A);u.setStyles({"top":b+"px","width":o,"left":X});q.setStyle(J,w);Z=true;}function l(){u.removeClass(A);u.setStyles({"top":"","width":"","left":""});q.setStyle(J,"");Z=false;}function t(){var w=V.getComputedStyle(J);n.addClass(A);n.setStyles({"width":k,"left":X});if(T.get("scrollWidth")>T.get("clientWidth")){if(C.UA.webkit){n.setStyle("bottom","10px");}if(C.UA.ie){n.setStyle("bottom","17px");}if(C.UA.gecko&&C.UA.os!=="macintosh"){n.setStyle("bottom","17px");}}V.setStyle(J,w);m=true;}function g(){n.removeClass(A);n.setStyles({"width":"","left":"","bottom":""});m=false;V.setStyle(J,"");}function Y(){var y=T.get(F),w=M(e,T),z=T.get(H),x=w+e.get(H);if(!m){if(!Z){if(w<y){T.set(F,w);return;}}if(x>y+z){T.set(F,x-z);return;}}}function U(){o=e.getComputedStyle("width");X=e.getX();k=(parseInt(o,10)-56)+"px";d=e.get(K);b=Q.get(H)+Q.getY();p=e.one(".inner");p.setStyle("minHeight","180px");Y();W=true;}function R(){if(!W){U();return;}if(L()){if(Z){l();}if(m){g();}return;}var y=T.get(F),w=M(e,T),x=e.get(H),AA=T.get(H),z=T.get("scrollLeft");if(z>0&&(Z||m)){T.set("scrollLeft",0);}if(e.get(K)!==d){o=e.getComputedStyle("width");k=(parseInt(o,10)-56)+"px";d=e.get(K);b=Q.get(H)+Q.getY();X=e.getX();if(Z){u.setStyles({"width":o,"top":b,"left":X});}if(m){n.setStyle({"width":k,"left":X});}}if(y<w){if(Z){l();}}else{if(y<w+x-D){if(!Z){v();}}else{if(Z){l();}}}if(y+AA<w+D){if(m){g();}}else{if(y+AA<w+x){if(!m){t();}}else{if(m){g();}}}if((!Z&&m)||(Z&&!m)){if(u.getY()+u.get(H)+30>n.getY()){if(m){g();}if(Z){l();}}}}function P(AE){var AA,AF,AH,y,AC,x,AG,AD,AB,z,w;if(!W){U();}if(L()){if(Z){l();}if(m){g();}return;}if(AE){AA=AE.changedType;if(!AA){AA=AE.type;}if(AA==="mousedown"||AA==="keydown"||AA==="keypress"){return;}if(AA==="keyup"){if(AE.changedType){AF=AE.changedEvent;}else{AF=AE;}AH=AF.keyCode;if(AF.ctrlKey||AF.metaKey){return;}if(AH>111&&AH<124){return;}switch(AH){case 16:case 17:case 18:case 19:case 20:case 27:case 44:case 91:case 93:case 144:case 145:case 224:return;}}}R();if(i){s=true;return;}i=true;setTimeout(function(){i=false;if(s){s=false;P();}},100);if(!m){Y();}if(!m&&!Z){return;}y=T.get(F);AD=u.get(H);z=T.get(H)-AD-n.get(H)-60;w=E(z);if(!w){return;}AC=Math.round(w[0]);x=Math.round(w[1]);if(Z){AG=Math.round(u.getY());if(AC<AG+AD){T.set(F,y-AG-AD+AC-20);return;}}if(m){AB=Math.round(n.getY());if(AC+x>AB-20){T.set(F,y-AB+40+AC+x);}}}U();j=T.on("scroll",R);S=f.rte.on("nodeChange",P);if(C.UA.ie>=11){r=f.rte.frame.on(["dom:keyup","dom:focus","focus"],P);}}C.namespace("mail.rte");C.mail.rte.smartScroll=O;},"1.0.0",{requires:["editor-base"]});YUI.add("mail-ui-rteview",function(E){E.EditorSelection.prototype.getCursor=function(){return E.EditorSelection.ROOT.all("."+E.EditorSelection.CURID);};var Z="hidden",S,C,G=E.common.Utils,K;function I(Y){var h=this;I.superclass.constructor.call(h,Y);S=Y.bidi;C=Y.isFullSSL;K=Y.isRTL;h.rte=null;h.contentInitialized=null;h.focusNode=false;h.baseNode=null;h.rteReady=false;h.rteArea=null;h.evt=[];h.set("isRich",Y.isRich);h.getDefaultFontInfo=Y.getDefaultFontInfo;h.convertToPlain=Y.convertToPlain;h.richFontInfo=h.getDefaultFontInfo(!Y.isRich);h.smartscroll=Y.smartscroll;var g={isRich:{setter:function(i){h.isRich=i;h.switchEditMode();}},content:{setter:function(i){h.content=i;h.rte.getInstance().Selection.cleanCursor();if(h.baseNode){h.baseNode.fire("switchToPlain");}},getter:function(){return h.content?h.content:"";}}};h.addAttrs(g,Y||{});}function e(Y){var g=this;g.baseNode=Y;g.rteArea=Y.one("div.cm-rtetext");E.Frame.DEFAULT_CSS="";g.rte=new E.EditorBase({defaultblock:"p",dir:S&&strings.str_tog_loadRTLCss?"rtl":"ltr",plugins:[{fn:E.Plugin.ContentEditable,cfg:{use:E.EditorBase.USE}}]});E.Plugin.ExecCommand.COMMANDS.fontsize=null;g.rte.plug(E.Plugin.EditorPara);g.rte.plug(E.mail.rte.LinkEditor);if(S){g.rte.plug(E.Plugin.EditorBidi);g.rte.plug(E.Plugin.EditorAutoBidi);}g.bindUI();g.renderUI();}function a(){var g=this,Y=g.evt;Y.push(g.rte.after("nodeChange",function(i){var h=i.changedType;if(h==="keypress"||(!E.UA.ie&&h==="keydown")){return;}if(h==="right"||h==="left"||h==="space"){return;}if(h==="mouseup"||(E.UA.ie&&h.indexOf("up")!==-1&&i.changedNode.get("tagName")!=="SPAN")){return;}if(h==="mousedown"&&i.changedEvent&&i.changedEvent.which>1){return;}if(i.changedType&&i.changedType.toLowerCase()!=="execcommand"){g.fire("nodeChange",i);}}));Y.push(g.rte.frame.after("ready",function(){g.rteReady=true;g.rte.set("isReady",true);Y.push(g.getContainer().on("focus",function(){g.fire("focus",{editor:g.rte});}));Y.push(g.getContainer().on("blur",function(){g.fire("blur",{editor:g.rte});}));Y.push(g.getContainer().on("keydown",function(i){i.stopPropagation();}));Y.push(g.getContainer().on("keypress",function(i){i.stopPropagation();}));if(g.smartscroll){Y.push(new E.mail.rte.smartScroll({"rte":g,"topOverlaySelector":".thread-item-list"}));}Y.push(g.rte.frame.on("dom:keydown",function(l){var k,j=l.keyCode,i=(l.ctrlKey||l.metaKey)&&(!l.altKey&&!l.shiftKey);l.frameEvent.stopPropagation();if(E.UA.gecko&&(l.ctrlKey||l.metaKey)&&l.shiftKey&&j===88){if(S&&l.metaKey){k="bidi";i=true;}else{l.frameEvent.halt();return;}}if(i||(S&&l.ctrlKey)){switch(j){case 66:k="bold";break;case 73:k="italic";break;case 85:k="underline";break;case 16:if(S){k="bidi";}break;default:break;}if(k){l.frameEvent.halt();g.execute(k,"");return;}}g.fire("keyDown",l);}));Y.push(g.rte.frame.on("dom:mousedown",function(i){g.fire("mousedown",i);}));Y.push(g.getContainer().on("drop",function(i){g.fire("drop",i);}));g.rteArea._node.onpaste=function(i){g.fire("paste");g.sanitizeContent(i,this);};if(g.contentInitialized){g.setContent(g.contentInitialized,false);}g.set("ready",true);g.fire("ready");g.getContainer().addClass(C?"fullSSL":"nonSSL");g.getContainer().setStyles(g.getComposeStyle(g.isRich));if(g.isRich){g.getContainer().setStyles({"fontSize":g.richFontInfo.fontSize,"fontFamily":g.richFontInfo.fontFamily});}else{g.getContainer().addClass("plaintextMsg");}var h=g.getContainer();if(h){h.set("aria-label",strings.str_comp_messagebody);if(S&&K){h.set("dir","rtl");}}}));}function D(){var g=this,Y;g.rteArea=g.baseNode.one("div.cm-rtetext");g.rte.render(g.rteArea).on("ready",function(){Y=g.rte.getInstance();Y.EditorSelection.prototype.getCursor=E.EditorSelection.prototype.getCursor;Y.UA.ie=E.UA.ie;});if(S){g.rte.fire("turnautobidioff",{status:!g.isRich});}}function N(){var Y=this;if(E.UA.ie){Y.rteArea.setStyle("display","block");}Y.rteArea.setStyle("visibility","");}function X(){var Y=this;if(E.UA.ie){Y.rteArea.setStyle("display","none");}Y.rteArea.setStyle("visibility",Z);}function O(Y,i){var j=this,h,g;if(j.rte){if(Y==="bidi"){j.rte.fire("disableautobidi");}j.rte.execCommand(Y,i);if(E.UA.webkit){if(Y==="createlink"){h=j.rte.getInstance();g=new h.Selection();if(g&&g._selection){g._selection.collapseToEnd();}return;}j.rte.focus();}}}function P(g,m){var k=this,Y,i,j="",o=E.Selection.CURSOR,n=(!E.Lang.isUndefined(m))?m:true;o=(E.UA.ie===9)?"&nbsp;":E.Selection.CURSOR;if(n){j="<p>"+o+"</p>";}else{j="";}j+=g;if(k.rteReady){k.rte.set("content",j);i=k.rte.getInstance();i.Selection.filter();if(E.UA.ie&&k.rte.frame._fixIECursors){k.rte.frame._fixIECursors();}try{Y=new i.Selection();Y.focusCursor(true,true);}catch(l){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailcompose-rte-rteview:1",l,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailcompose-rte-rteview:1");}if(E.UA.ie&&E.UA.ie>=10){var h=k.getDoc().one("p .yui-cursor");if(h){h.remove(true);}}}else{k.contentInitialized=j;}}function d(){return this.rte.getContent();}function T(){return this.rte.get("content");}function V(){return this.rte;}function R(){return this.getContainer();}function Q(){return this.getContainer();}function A(Y){if(this.rte){this.rte.focus(Y);}}function c(){var Y=this;E.each(Y.evt,function(g){g.detach();});delete Y.evt;Y.rte.destroy(true);delete Y.rte;I.superclass.ondestroy.call(this,arguments);}function L(){var h=this,Y,g;if(h.rte){g=h.isRich;Y=h.getDefaultFontInfo(!g);h.getContainer().setStyles(h.getComposeStyle(g));if(h.isRich){h.getContainer().removeClass("plaintextMsg");h.getContainer().setStyles({"fontSize":Y.fontSize,"fontFamily":Y.fontFamily});}else{h.getContainer().addClass("plaintextMsg");}if(S){h.rte.fire("turnautobidioff",{status:!g});}}}function b(){var h=this,Y=h.getContainer();if(Y){var g=h.convertToPlain(Y,false);if(g){if(E.UA.ie){g=g.replace(/\xA0/gi," ");}return E.Lang.trim(g)!=="";}else{return false;}}return true;}function M(){var Y=this,g=this.getContainer();if(!g){return"";}return Y.convertToPlain(g,true);
}function U(Y){var h=this,g=h.getDefaultFontInfo(!Y);if(Y){h.richFontInfo.fontFamily=g.fontFamily;h.richFontInfo.fontSize=g.fontSize;h.richFontInfo.foreColor="#000";h.richFontInfo.backColor="#fff";}return{"color":this.richFontInfo.foreColor,"background-color":h.richFontInfo.backColor};}function B(g,Y){if(this.rte){this.rte.plug(g,Y);}}function W(){return this.rte.frame.get("container");}function H(Y,g){var h=this;h.execute(Y,g);}function J(g){var i=this,Y,h;if(g){if((g.get&&g.get("className")==="yahoo_quoted")||g.className==="yahoo_quoted"){return;}if(g.set){g.set("className","");}if(g.className){g.className="";}if(g.getDOMNode&&g.getDOMNode().childNodes){h=g.getDOMNode().childNodes;}else{if(g.childNodes){h=g.childNodes;}}if(h){for(Y=0;Y<h.length;Y++){i.clearClassNames(h[Y]);}}}}function f(m){var l=this,i,j,g,k;if(!l.isRich){try{if(window.clipboardData){j=window.clipboardData.getData("Text");}else{if(m.clipboardData){j=(m.originalEvent||m).clipboardData.getData("text/plain");}}if(document.selection&&document.selection.type!=="Control"){document.selection.createRange().pasteHTML(j);}else{g=window.getSelection();if(g.getRangeAt&&g.rangeCount){k=g.getRangeAt(0);k.deleteContents();var h=document.createElement("div");h.innerHTML=j;var o=document.createDocumentFragment(),Y;while((i=h.firstChild)){Y=o.appendChild(i);}k.insertNode(o);if(Y){k=k.cloneRange();k.setStartAfter(Y);k.collapse(true);g.removeAllRanges();g.addRange(k);}}}}catch(n){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailcompose-rte-rteview:2",n,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailcompose-rte-rteview:2");F.call(l,m);}if(m&&m.preventDefault){m.preventDefault();}else{window.event.returnValue=false;}}else{F.call(l,m);}}function F(k){var l=this,h,j,g,Y=l.baseNode.one("#pastebuffer").getDOMNode();if(k&&k.clipboardData&&k.clipboardData.getData){if(k.clipboardData.types.item){h=k.clipboardData.types.item(0);}else{h=k.clipboardData.types;}if(/text\/html/.test(h)){Y.innerHTML=G.escapeHtml(G.unescapeHtml(k.clipboardData.getData("text/html")));}else{if(/text\/plain/.test(h)){Y.innerHTML=G.escapeHtml(G.unescapeHtml(k.clipboardData.getData("text/plain")));}else{Y.innerHTML="";}}}else{if(window.clipboardData&&window.clipboardData.getData){Y.innerHTML=G.escapeHtml(G.unescapeHtml(window.clipboardData.getData("Text")));}}setTimeout(function(){function i(m){l.clearClassNames(m);}if(Y.childNodes&&Y.childNodes.length>0){for(g=0;g<Y.childNodes.length;g++){if(Y.childNodes[g].className){j=l.rteArea.all("."+Y.childNodes[g].className);j.each(i);}}}else{if(l.rteArea.getDOMNode&&l.rteArea.getDOMNode().childNodes){for(g=0;g<l.rteArea.getDOMNode().childNodes.length;g++){if(l.rteArea.getDOMNode().childNodes[g]){l.clearClassNames(l.rteArea.getDOMNode().childNodes[g]);}}}}},0);}E.namespace("mail");E.extend(I,E.mail.ui.BaseWidget);E.mail.RTEView=I;E.mix(E.mail.RTEView.prototype,{NAME:"RTE",render:e,renderUI:D,bindUI:a,execute:O,getRTE:V,getDoc:R,getDocRoot:Q,getContent:d,getContentOnSave:T,getComposeStyle:U,getContentAsPlainText:M,getContainer:W,setFocus:A,setContent:P,sanitizeContent:f,clearClassNames:J,switchEditMode:L,hasContent:b,plug:B,hideArea:X,showArea:N,ondestroy:c,invokeCommand:H},true);},"1.0.0",{requires:["attribute-base","editor-base","editor-inline","editor-para","event-base","node-base","node-event-delegate","common-utils","mail-ui-basewidget","mail-ui-rte-linkeditor","mail-ui-rte-smartscroll"]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("swfdetect",function(e,t){function c(e){return parseInt(e,10)}function h(e){i.isNumber(c(e[0]))&&(r.flashMajor=e[0]),i.isNumber(c(e[1]))&&(r.flashMinor=e[1]),i.isNumber(c(e[2]))&&(r.flashRev=e[2])}var n=0,r=e.UA,i=e.Lang,s="ShockwaveFlash",o,u,a,f,l;if(r.gecko||r.webkit||r.opera){if(o=navigator.mimeTypes["application/x-shockwave-flash"])if(u=o.enabledPlugin)a=u.description.replace(/\s[rd]/g,".").replace(/[A-Za-z\s]+/g,"").split("."),h(a)}else if(r.ie){try{f=new ActiveXObject(s+"."+s+".6"),f.AllowScriptAccess="always"}catch(p){f!==null&&(n=6)}if(n===0)try{l=new ActiveXObject(s+"."+s),a=l.GetVariable("$version").replace(/[A-Za-z\s]+/g,"").split(","),h(a)}catch(d){}}e.SWFDetect={getFlashVersion:function(){return String(r.flashMajor)+"."+String(r.flashMinor)+"."+String(r.flashRev)},isFlashVersionAtLeast:function(e,t,n){var i=c(r.flashMajor),s=c(r.flashMinor),o=c(r.flashRev);return e=c(e||0),t=c(t||0),n=c(n||0),e===i?t===s?n<=o:t<s:e<i}}},"3.13.0",{requires:["yui-base"]});
YUI.add("mail-service-uploader-utils",function(B){var A=B.common.Utils.rocketstats.intlStat;B.namespace("Y.mail.UploaderUtils");B.mail.UploaderUtils={getUploadCredential:function(D){var E=NeoConfig.launch_protocol+document.location.host+"/ya/upload_get_cred",C=B.mail.UploaderService,F={success:function(G){var H;if(G&&G.responseText){H=B.JSON.parse(G.responseText).Response.cred;}C.UPLOAD_CREDENTIAL=H||"failed";A("UploaderService","CredentialSet"+(H?"Successful":"FailedCallback"));if(!H){}D&&D();},failure:function(){C.UPLOAD_CREDENTIAL="failed";A("UploaderService","CredentialSetFailed");},suppressCodes:"*"};B.common.net.SessionMgr.request(E,null,F,"GET",null,true);},checkLimits:function(K){var L=K.files||[],P=K.cdo,I=K.uploader,D=B.common.persist.UserData,F=D.get("userFeaturePref.attachTotalSize"),C=D.get("userFeaturePref.attachFiles"),E,G,J,N=P&&P._getAttachmentsSize(),O=P&&P._getAttachmentsCount(),H,M=0;if(!L||!P||!I){return true;}for(H in L){E=L[H];G=E.get&&E.get("size")||E.size;J=E.get&&E.get("id")||E.id+"-"+E.name;if(((G>F)||(N+G>F))&&(!I.processedFiles[J]&&!I.removedFiles[J])){I.removedFiles[J]=1;M=1;delete L[H];}else{if(!I.processedFiles[J]&&!I.removedFiles[J]){N+=G;O++;}}}B.mail.UploaderService.logIt("checkLimits found totalSize = "+N+", totalCount="+O);if(O>C){for(H in L){if(O<=C){break;}E=L[H];J=E.get&&E.get("id")||E.id+"-"+E.name;if(!I.processedFiles[J]&&!I.removedFiles[J]){I.removedFiles[J]=1;delete L[H];O--;}}P.fire("CDO_ATTACHMENT_COUNT_VIOLATION");return false;}if((N>F)||M){P.fire("CDO_ATTACHMENT_SIZE_VIOLATION");return false;}return true;},handlePostRedirectResponse:function(C){var G=this,F=B.common.Utils.parseQueryString(C),E=B.mail.UploaderService.uploadersCreated[F.uploaderID],D=G.parseFormResponse(F,E);E.handlePostRedirectResponse(D);},parseFormResponse:function(E,H){var D=[],F,J,M=parseInt(E.cdoidx,10),I=(E.filename+"").split(","),L=(E.mimetype+"").split(","),K=(E.filesize+"").split(","),C=(E.diskfilename+"").split(","),G=(E.errorcode+"").split(",");for(J=0;J<G.length;J++){F={cdoIndex:M+J,filename:I[J],mimetype:L[J],size:{original:parseInt(K[J],10)},serverID:C[J],thumbData:null};this.setAttachmentState({item:F,state:G[J],uploader:H});D.push(F);}return D;},setAttachmentState:function(C){var G=C.item,E=C.state||G.attachCode,I=C.uploader,H=I.type||I.uploaderType,D={attachcode:E,resampled:false,cancelled:false,rotated:false,uploaded:false,scanned:false,failed:false},F=0;switch(E){case"uploadAVNoVirus":case"uploadAVCleaned":D.scanned=true;D.uploaded=true;A("UploaderService",H+"Attachment_UploadSuccess");break;case"uploadAVInternalError":case"uploadAVError":case"uploadAVNotScannable":case"uploadAVServerDown":D.uploaded=true;D.failed=false;D.failCause="averror";break;case"uploadFileSizeError":case"uploadNoFileError":D.failed=true;if(E==="uploadFileSizeError"){D.failCause="size";A("UploaderService",H+"Attachment_UploadFail");}else{D.failCause="nofile";A("UploaderService",H+"Attachment_NoFileError");}F=1;break;case"uploadAVCannotClean":case"uploadAVHasVirus":D.scanned=true;D.uploaded=true;D.failed=true;D.failCause="virus";A("UploaderService",H+"Attachment_UploadFailVirus");F=1;break;case"uploaderFormUploadNoResponse":D.failed=true;D.failCause="form_upload_no_response";A("UploaderService",H+"Attachment_UploadNoResponse");F=1;break;case"uploaderFormUploadUnexpectedResponse":D.failed=true;D.failCause="form_upload_unexpected_response";A("UploaderService",H+"Attachment_UploadUnexpectedResponse");F=1;break;case"uploaderFormUploadTimeout":D.failed=true;D.failCause="form_upload_timeout";A("UploaderService",H+"Attachment_UploadTimeout");F=1;break;case"uploaderFormUserCancelled":D.cancelled=true;D.failCause="form_upload_cancelled";A("UploaderService",H+"Attachment_UploadCancelled");break;case"uploaderYUIUploadError":case"uploaderHTML5UploadError":D.failed=true;D.failCause=H+"_upload_error";A("UploaderService",H+"Attachment_UploadError");F=1;break;case"uploaderYUIResponseTimeout":case"uploaderHTML5ResponseTimeout":D.failed=true;D.failCause=H+"_response_timeout";A("UploaderService",H+"Attachment_UploadResponseTimeout");F=1;break;case"uploaderYUIUploadStartTimeout":case"uploaderHTML5UploadStartTimeout":D.failed=true;D.failCause=H+"_uploadstart_timeout";A("UploaderService",H+"Attachment_UploadStartTimeout");F=1;break;case"uploaderYUIProgressTimeout":case"uploaderHTML5ProgressTimeout":D.failed=true;D.failCause=H+"_progress_timeout";A("UploaderService",H+"Attachment_UploadProgressTimeout");F=1;break;case"uploaderYUIUploadCompleteTimeout":case"uploaderHTML5UploadCompleteTimeout":D.failed=true;D.failCause=H+"_uploadcomplete_timeout";A("UploaderService",H+"Attachment_UploadUploadCompleteTimeout");F=1;break;case"uploaderYUIUserCancelled":case"uploaderHTML5UserCancelled":D.cancelled=true;D.failCause=H+"_upload_cancelled";A("UploaderService",H+"Attachment_UploadCancelled");break;case"uploaderYUIAutoRetryAll":case"uploaderHTML5AutoRetryAll":D.failed=true;D.failCause=H+"_upload_error_retry";A("UploaderService",H+"Attachment_UploadErrorRetry");break;case"uploaderYUIAutoRetry2038":case"uploaderHTML5AutoRetry2038":D.failed=true;D.failCause=H+"_upload_error2038";A("UploaderService",H+"Attachment_UploadError2038");break;case"uploaderYUIError2049":case"uploaderHTML5Error2049":D.failed=true;D.failCause=H+"_upload_error2049";A("UploaderService",H+"Attachment_UploadError2049");F=1;break;case"uploaderYUICredExpired":case"uploaderHTML5CredExpired":D.failed=true;D.failCause=H+"_upload_302";A("UploaderService",H+"Attachment_UploadError302");break;case"uploadInternalError":D.failed=true;D.failCause="internal_server_error";A("UploaderService",H+"Attachment_InternalServerError");F=1;break;case"uploadMailboxError":D.failed=true;D.failCause="mailbox_error";A("UploaderService",H+"Attachment_MailboxError");F=1;break;case"uploadPartialFileError":D.failed=true;D.failCause="partial_file_error";A("UploaderService",H+"Attachment_PartialFileError");F=1;break;case"uploadAuthError":D.failed=true;D.failCause="upload_auth_error";A("UploaderService",H+"Attachment_UploadAuthError");
F=1;break;default:D.failed=true;D.failCause="generic_"+E;A("UploaderService",H+"Attachment_UploadFail");F=1;}A("UploaderService",H+"AttachmentStatus_"+E);if(D.failed){B.use("common-utils-error",function(J){J.common.Utils.error.report(E+":"+D.failCause,"ATTACH_UPLOAD_ERR",1,0,1);});}if(F){A("UploaderService",H+"UploaderFail_"+I.INITIAL_UPLOADER);}G.state=D;},createMenuNode:function(J){var C=parseInt(NeoConfig.switchAttachModeEnabled,10),F=J.node,I=J.uploader,K=J.cdo,D=J.attView,G=F.one("span.attach-btn-menu"),E=F.one(".attachment-button-html5")||F.one(".attachment-button-attach");if(C!==1){return;}I.handles.push(E.on("click",function(){G&&G.menu&&G.menu.hide&&G.menu.hide();K.fire("compose:restoreFocus");},I));var H="#attachment-button-input";B.one(H).on("click",function(){B.fire("mt:click",{action:"cmps_attfl",append:{t1:"cmpsTb"}});});G.on("click",this.createAttachOptionMenu,I,K,D);E&&E.removeClass("right");G&&G.removeClass("hidden");},selectDefaultMenuType:function(){var C=B.one("#menu-attach-options"),D=C?C.one(".active"):0;if(D&&D.get("id")==="switch-form"){A("UploaderServiceMenu","FormOptionDefaulted");B.fire("compose:toggleUploaderType",{form:1,node:C,destroy:0});}},createAttachOptionMenu:function(E,D,H){var I=this,G=E.currentTarget,C=B.mail.UploaderService,F="hidden";B.fire("mt:click",{action:"cmps_attflmnu",append:{t1:"cmpsTb"}});E.preventDefault();if(!G.menu){B.use("common-ui-menu-helper","_shared_module_offscreen_bin_menus_compose_attach",function(M){var K=M.ui.Templates._shared_module_offscreen_bin_menus_compose_attach,L={html5_active:(H.type===C.UPLOADER_TYPE_HTML5?"active":""),flash_active:(H.type===C.UPLOADER_TYPE_FLASH?"active":""),form_active:(H.type===C.UPLOADER_TYPE_FORM?"active":"")},J=M.one("#menu-attach-options");if(!J){J=M.one("body").appendChild(M.common.Utils.substitute(K.base,L,0,0,strings));J.appendChild(I.attView.attachLargeBtn);}if(H.type===C.UPLOADER_TYPE_HTML5){J.one("#switch-flash").addClass(F);J.one("#switch-html5").removeClass(F);}M.common.ui.MenuHelper.create(G,{menu:J,blur:true},function(){G.menu.getMenuNode().on("menuSelected",function(N){switch(N.dataAction){case"switch-html5":A("UploaderServiceMenu","HTML5OptionSelected");M.fire("compose:toggleUploaderType",{html5:1,node:J});break;case"switch-flash":A("UploaderServiceMenu","FlashOptionSelected");M.fire("compose:toggleUploaderType",{flash:1,node:J});break;case"switch-form":A("UploaderServiceMenu","FormOptionSelected");M.fire("compose:toggleUploaderType",{form:1,node:J,destroy:0});break;}D.fire("compose:restoreFocus");});});});}},verifyCrossDomainAccess:function(F){F=F||NeoConfig.attachmentServer;var E=B.mail.UploaderService,C=NeoConfig.launch_protocol+F+"/crossdomain.xml",D={success:function(){if(NeoConfig.attachmentServer!==F){NeoConfig.attachmentServer=F;E.UPLOAD_URL_BASE=NeoConfig.launch_protocol+(NeoConfig.attachmentServer?NeoConfig.attachmentServer+"/":"")+((NeoConfig.isSSL&&!NeoConfig.isAttachSSL)?window.location.host:(strings.str_cfg_base_intl+"."+NeoConfig.farm+".mail.yahoo.com"))+"/ya/upload";E.rs.intlStat("UploaderService","UsingBackupServer");}E.CROSS_DOMAIN_VERIFIED=true;},failure:function(){E.rs.intlStat("UploaderService","CrossDomainAccessFailed_"+(F===NeoConfig.attachmentServer?"primary":"backup"));if(F!==NeoConfig.attachmentServerBackup&&NeoConfig.attachmentServerBackup){B.mail.UploaderUtils.verifyCrossDomainAccess(NeoConfig.attachmentServerBackup);}else{E.DEFAULT_UPLOADER=E.UPLOADER_TYPE_FORM;B.fire("compose:toggleUploaderType",{form:1,destroy:1});}},suppressCodes:"*"};B.common.net.SessionMgr.request(C,null,D,"GET",null,true);}};},"1.0.0",{requires:["common-utils-stats","common-net-sessionmgr"]});YUI.add("mail-ui-composeview-attach",function(C){C.namespace("mail");var L={"application/pdf":"pdf","application/mspowerpoint":"ppt","application/vnd.ms-powerpoint":"ppt","application/excel":"xls","application/vnd.ms-excel":"xls","application/msword":"doc","application/vnd.ms-msword":"doc","application/x-trof-msvideo":"video","video/mpeg":"video","video/x-ms-wmv":"video","video/mov":"video","video/movie":"video","video/quicktime":"video","audio/wav":"music","audio/x-wav":"music","audio/mpeg":"music","audio/mp3":"music","audio/mid":"music","audio/realaudio":"music","audio/x-pn-realaudio":"music","image/bmp":"img","image/gif":"img","image/jpe":"img","image/jpeg":"img","image/jpg":"img","image/png":"img","image/tiff":"img","application/x-compressed":"zip","application/x-stuffit":"zip","application/x-tar":"zip","application/x-gzip":"zip"},H={"LOZENGE":0,"ICON":1},A=C.ui.Templates,b=C.common.Utils,G=C.mail.UploaderUtils,m=b.substitute,W=b.escapeHtml,V=window.strings||{},n=C.common.persist.UserData,f=n.get("userFeaturePref.attachTotalSize"),Q=n.get("userFeaturePref.attachFiles"),P=Math.round(f/1048576),i="hidden",T="attachmentVisible",X,D=(parseInt(NeoConfig.uploaderVersion,10)===2);function d(o,Y){Y=Y||"str_rte_attachments_";return V[Y+o]||"";}C.mail.AttachmentView=function(w,s,o){var p=this,x,z,q,u,v,r,y;X=C.mail.UploaderService;p.cdo=w;if(!p.handles){p.handles=[];}y=p.handles;p.tab=s;p.tagPane=o&&o.tagPane?o.tagPane:".attachments-pane";p.tagWell=o&&o.tagWell?o.tagWell:".attachments-well";p.uiAttBar=s.one(p.tagPane);if(p.uiAttBar){p.uiAttRemoveAll=s.one(".attachment-button-removeall");p.uiAttCount=x=s.one(".attachments-count");p.uiAttSize=z=s.one(".attachments-size");p.uiAttAVLogo=s.one(".file-count img");p.uiAttMessage=s.one(".error");p.uiAttBtnForm=p.uiAttBar.one(".attachment-button-form")||null;p.uiAttBtnDisabled=p.uiAttBar.one(".attachment-button-disabled");}p.uiAttPane=s.one(p.tagWell);var t=p.uiAttPane;if(t){}if(p.uiAttPane){p.uiAttList=q=p.uiAttPane.one(".file-attach");p.uiAttWelcome=p.uiAttPane.one(".attachments-welcome");}if(q&&x&&z){var Y=s.one("div.rte li.active a");q.setAttrs({"aria-labelledby":(Y?Y.generateID():""),"aria-describedby":(x.generateID()+" "+z.generateID())});}p.errorFlags={tooMany:false,tooBig:false};p.attachPaneHidden=false;p.attachXY=null;p.uploaderConfig={"attView":p,"tab":s,"cdo":w,"attForm":p.uiAttBtnForm,"attInput":p.tab.one(".attachment-button-file")};p.toggleUploaderHandle=C.on("compose:toggleUploaderType",k,p);if(D){r=X.getDefaultUploaderType();switch(r){case X.UPLOADER_TYPE_HTML5:u="mail-uploader-html5";break;case X.UPLOADER_TYPE_FLASH:u="uploader-flash";break;default:u="mail-service-uploader-form";r=X.UPLOADER_TYPE_FORM;}p.type=r;}v=function(AA){p.uploader=AA;AA.updateUI&&AA.updateUI();p.updateSizeAndCount();if(AA.uploaderType!==C.mail.UploaderService.UPLOADER_TYPE_FORM&&parseInt(NeoConfig.switchAttachModeEnabled,10)===1){G.createMenuNode({uploader:AA,node:p.tab,cdo:p.cdo,attView:p});G.selectDefaultMenuType();}};C.use(u,function(){X.create(p.uploaderConfig,v,o?o.type:null);});y.push(p.cdo.on("CDO_ATTACHMENT_ADDED",function(AB,AA){p.addNewAttachment(AA);}));y.push(p.cdo.on("CDO_ATTACHMENT_DELETED",function(AB,AA){p.removeAttachment(AA);p.updateSizeAndCount();}));y.push(p.cdo.on("CDO_ATTACHMENT_PROCESSED",function(AC,AA){p.enableAttachment(AA);p.updateSizeAndCount();function AB(AD){var AE=AD.state;return(AE&&!AE.processed&&!AE.uploaded&&!AE.cancelled);}if(!p.cdo._getAttachmentsCount(AB)){p.checkOverLimit();}}));y.push(p.cdo.on("CDO_ATTACHMENT_SIZE_VIOLATION",function(){p.attachError("size");}));y.push(p.cdo.on("CDO_ATTACHMENT_COUNT_VIOLATION",function(){p.attachError("count");}));y.push(p.cdo.on("CDO_ATTACHMENT_UPLOAD_PROGRESS",function(AC,AB,AA){p.updateAttachmentProgress(AB,AA);}));y.push(p.cdo.on("CDO_THUMBNAIL_GENERATED",function(AD,AA,AC){var AB=p.uiAttList.all(".file-container").item(AA),AE=AB.one("div");if(!AE){AB.insert(C.Node.create("<div></div>"),0);AE=AB.one("div");}AE.setStyle("background","url('"+AC.src+"') no-repeat 0px "+((63-AC.height)/2)+"px");AB.ancestor("li").addClass("image");}));y.push(p.cdo.on("CDO_UPLOADER_CLEANUP",function(){var AA=p.cdo.get("attachments"),AC,AB;for(AC=0;AA&&AC<AA.length;AC++){AB=AA[AC];if(AB&&AB.timeout){clearTimeout(AB.timeout);AB.timeout=null;}if(AB&&AB.state&&!AB.processed&&!AB.state.cancelled){AB.processed=true;AB.state.failed=1;p.enableAttachment(AC);}}p.updateSizeAndCount();}));if(p.uiAttRemoveAll){y.push(p.uiAttRemoveAll.on("click",function(AA){p.cdo._removeAllAttachments();AA.preventDefault();}));}if(p.uiAttBtnDisabled){y.push(p.uiAttBtnDisabled.on("click",function(){p.checkOverLimit(1);}));}if(p.uiAttAVLogo){y.push(p.uiAttAVLogo.on("click",function(){window.open(NeoConfig.avTargetUrl);}));}};function O(Y){var o=this;if(Y==="icon"){o.iconType=H.ICON;o.uiAttList.addClass("icons");o.uiAttList.removeClass("lozenges");}else{o.iconType=H.LOZENGE;o.uiAttList.removeClass("icons");o.uiAttList.addClass("lozenges");}}function a(q,o){var t=this,s=C.mail.AttachmentView.attachErrorSize,p=o?C.all(".file-attach li").item(o):null,Y={"count":m(d("num_files_exceeded","str_comp_attach_"),{},{max_allowed:function(){return Q;}}),"size":m(d("size_exceeded","str_comp_attach_"),{},{max_size_MB:function(){return P;}}),"averror":d("noAVScanWarning")+(p?p.get("title"):""),"virus":d("alert_virus")},r=Y[q];if(p){p.set("title",r||"");}t.updateSizeAndCount();if(q==="size"&&s&&s(t.cdo)){}else{if(r){C.use("common-ui-dialog-helper",function(u){u.common.ui.DialogHelper.alert({hd:(q==="virus")?d("alert_virus_title"):d("error","str_comp_attach_"),bd:r,restoreFocusNode:t.uiAttBar});});}}b.rocketstats.intlStat("ATTACH_ERROR",q);}function J(Y){var o=this;o.addAttachment(Y);o.updateSizeAndCount();}function e(){var r=this,q=r.cdo._getAttachmentsCount(),Y=(q===1)?d("file_single"):m(d("num_files"),{},{file_attach_num_files:function(){return q;}}),v=r.cdo._getAttachmentsSize(),x=0,u=0,y,p,t,s,o,w=(q===1)?V.str_comp_remove:V.str_comp_removeall;if(q){if(r.uiAttWelcome){r.uiAttWelcome.addClass(i);
}r.uiAttList.removeClass(i);if(r.uiAttRemoveAll){r.uiAttRemoveAll.removeClass(i).one("a").setContent(w).set("title",w);}r.uiAttPane.removeClass(i);if(r.uiAttCount){r.uiAttCount.removeClass(i);}if(r.uiAttSize){r.uiAttSize.removeClass(i);}}else{r.uiAttList.addClass(i);if(r.uiAttRemoveAll){r.uiAttRemoveAll.addClass(i);}if(r.uiAttMessage){r.uiAttMessage.addClass(i);}r.uiAttPane.addClass(i);if(r.uiAttCount){r.uiAttCount.setContent("");}if(r.uiAttSize){r.uiAttSize.setContent("");}r.toggleOverLimit(0);if(r.uiAttWelcome){r.uiAttWelcome.removeClass(i);}return;}if(r.uiAttCount){r.uiAttCount.setContent(Y);}if(r.uiAttSize){var z="sizes_fresh";r.uiAttSize.setContent(m(d(z),{},{transferred_size:function(){return h(v);},total_size:function(){return P+" "+V.str_rte_attachments_megabyte;}}));}r.errorFlags.tooMany=q>Q;r.errorFlags.tooBig=v>f;if(v>f){r.toggleOverLimit(2);}else{if(q>=Q||v===f){r.toggleOverLimit(1);}else{r.toggleOverLimit(0);}}y=r.uiAttPane.all(".file-attach .transfer-error")._nodes;for(p=0,o=y.length;p<o;p++){t=C.one(y[p]);s=t.hasClass("lozenge")?t.get("parentNode"):t;if(!s.hasClass(i)){x++;if(t.hasClass("transfer-virus")){u++;}}}if(r.uiAttMessage){if(u){r.uiAttMessage.setContent((u===1)?d("virus_single"):m(d("virus_mult"),{},{num_virus_files:function(){return u;}}));r.uiAttMessage.removeClass(i);}else{if(x){r.uiAttMessage.setContent((x===1)?d("error_single"):m(d("error_mult"),{},{num_error_files:function(){return x;}}));r.uiAttMessage.removeClass(i);}else{r.uiAttMessage.addClass(i);}}}}function I(Y){var o=this;if(o.errorFlags.tooBig){o.attachError("size");}else{if(o.errorFlags.tooMany||Y){o.attachError("count");}else{return false;}}return true;}function R(v,x){var u=this,w=u.uiAttList||u.tab.one(".file-attach"),s=u.cdo.get("attachments")[v],Y=s.state||{},r=s.size||{},o,t,z,p,y,q=C.mail.UploaderService;r=Y.resampled?r.sampled:r.original;r=h(r);if(u.cdo.get("passive")){s.original=s.size.original;}if(s.original&&Y.uploaded){s.processed=true;}if(NeoConfig.bidi){C.use("comms-intl-bidi",function(AA){o=AA.Intl.detectDirection(unescape(s.filename));});}x=x||(u.uploader&&u.uploader.uploaderType)||q.DEFAULT_UPLOADER;t="_shared_module_rte_well_content_attach_item";z=A[t].browser_plus_attach_else;p=C.Node.create(m(z,s,{filename:function(AA){return W(AA.filename.split("\\").pop());},in_progress1:function(){return s.original?"":A[t].in_progress1;},transfer_error1:function(){return Y.failed?A[t].transfer_error1:"";},transfer_warn1:function(){return Y.failCause?A[t].transfer_warn1:"";},retry:function(){return m(A[t].retry,0,0,0,V);}},null,V));if((C.UA.ie>0)&&(C.UA.ie<8)){p.removeClass(i);p.setStyle("float","left");u.uiAttPane.setStyle("paddingBottom","6px");}p.one("a").set("title",(s.filename.split("\\").pop()||"")+" ("+r+")");u.handles.push(p.one(".lozengeremove").on("click",function(){var AA=v;if(p.hasClass("downloading")&&u.uploader.cancelUpload){if(D){AA=u.cdo.get("attachments")[v].uploaderInternalID;}u.uploader.cancelUpload(AA);}u.cdo._removeAttachment(v);}));y=p.one(".lozengeretry");if(y){if(!C.UA.webkit&&x===q.UPLOADER_TYPE_FORM){y.addClass("hidden");}else{u.handles.push(y.on("click",function(){var AA=y.getAttribute("retries")||0;y.setAttribute("retries",++AA);u.retryOrSwitchAttachmentMode(v,AA);}));}}if(o){p.one(".btn").setAttribute("dir",o).addClass(o);}u.handles.push(p.on("click",function(){if(!p.hasClass("downloading")){u.downloadAttachment(v);}}));w.append(p);if(q.debug){u.handles.push(p.on("click",function(AA){if(AA.altKey){q.logIt(u.cdo.get("attachments")[v]);}}));}u.dirty=true;}function E(Y){var p=this,o;o=p.uiAttList.all("li")&&p.uiAttList.all("li").item(Y);if(o){o.addClass(i);o.removeClass(T);}p.uploader&&p.uploader.removeAttachment&&p.uploader.removeAttachment(Y);}function M(o,Y){var s=this,r,q,p;r=s.uiAttList.all("li")&&s.uiAttList.all("li").item(o);if(r){q=!!r.one(".lozenge");p=q?".lozengeProgress":".progress";r.one(p).setStyle("width",Y+"%");r.one(p).set("aria-valuenow",Y);}}function j(o){var x=this,z="",v="",s="",t=x.uiAttList.all("li")&&x.uiAttList.all("li").item(o),y,AB,r,u,AE,q,w,Y="",AD,AA,p=C.mail.UploaderService;if(!t){return;}y=!!t.one(".lozenge");if(y){t=t.one(".lozenge").get("parentNode");}else{t.one(".file-container").removeClass("processing");t.one(".prog-indicator").addClass(i);}AB=x.cdo.get("attachments")[o];u=AB.state||{};AE=u.failCause;if(u.failed){t.addClass("transfer-error");if(y){t.all(".lozenge").addClass("lozengeerror");}if(AE==="virus"){t.addClass("transfer-virus");z=d("virusWarning");}else{if(AE==="size"){t.removeClass("downloading");t.one(".lozenge a").set("title",d("alert_size"));}else{if(!y){t.one(".retry").removeClass(i);}z=d("attachFailedWarning");}}if((C.UA.webkit||p.type!==p.UPLOADER_TYPE_FORM)&&AE!=="virus"&&(AA=t.one(".lozengeretry"))){AA.removeClass(i);}x.attachError(AE,o);}else{if(AE){if(y){r=t.one("a");r.addClass("lozengewarn");z=d("noAVScanWarning");}else{t.addClass("transfer-warning");if(p.DEFAULT_UPLOADER!==p.UPLOADER_TYPE_FORM||C.UA.webkit){t.one(".lozengeretry").removeClass(i);}x.attachError(AB.state.failCause,o);}}else{if(y){if(t.hasClass("transfer-error")){t.removeClass("transfer-error");}if((AD=t.all(".lozenge"))&&AD.hasClass("lozengeerror")){AD.removeClass("lozengeerror");AA=t.one(".lozengeretry");if(AA){AA.addClass("hidden");}if(u.retry){t.addClass("downloading");}}}}}if(y){q=AB.size;w=AB.filename;if(!u.retry){t.removeClass("downloading");}q=u.resampled?q.sampled:q.original;q=h(q);try{Y=decodeURIComponent(w||"");}catch(AC){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-composeview-compose-attach:1",AC,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-composeview-compose-attach:1");Y=decodeURIComponent(escape(w)||"")||"";}if(AE==="yui_progress_timeout"){v=" YUI Upload Progress Timeout.";}if(NeoConfig.bidi&&V.str_tog_loadRTLCss){s=z+" "+Y+" \u202b("+q+")\u202c.";}else{s=z+" "+Y+" ("+q+").";}AD=t.one(".lozenge");AD&&AD.one("a").set("title",s);}else{C.use("event-mouseenter",function(){x.handles.push(t.on("mouseenter",function(){t.addClass("over");
}));x.handles.push(t.on("mouseleave",function(){t.removeClass("over");}));});}if(t.hasClass(i)){x.cdo._removeAttachment(o);}}function g(p,Y,q){var s=this,r,o=!(C.UA.webkit);if(s.uploader.uploaderType!==C.mail.UploaderService.UPLOADER_TYPE_FORM&&Y>1){C.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_ok",function(t){t.common.ui.DialogHelper.custom({hd:V.str_comp_attach_reattach_title,bd:V.str_comp_attach_reattach_body,ft:m(A._shared_module_offscreen_bin_modal_btn_ok.base,0,0,0,V,A)},{"ok":{handler:function(){t.fire("compose:toggleUploaderType",{form:1,destroy:q});r=s.uiAttList.all(".lozengeretry");if(r&&o){r.addClass("hidden");}}}});});}else{if(Y>3){C.use("common-ui-dialog-helper",function(t){t.common.ui.DialogHelper.alert({hd:V.str_comp_attach_reattach_failure_title,bd:V.str_comp_attach_reattach_failure_body},{"ok":{handler:function(){s.cdo._removeAttachment(p);}}});});}else{s.uploader.retryAttachment&&s.uploader.retryAttachment(p);}}}function c(v){var t=this,o=t.tab.one("#upload_file_selection"),p=D&&o&&o.one(".attachment-button-html5")||D&&o&&o.one(".attachment-button-attach")||t.tab.one(".attachment-button-attach"),q=C.mail.UploaderService,w,u=t.uploaderConfig,r=v.flashCrash||0,x=v.destroy||0,y=v.callback||0,s=v.skipDefault||0,Y;if(s){u.skipDefault=s;}if(r){q.rs.intlStat("UploaderService","Uploader"+t.uploader.uploaderType+"_FlashCrash");}if(x){p.fire("yuiuploader:destroy");}else{if(!s){t.reposAttachObj("offscreen");}}if(y){w=y;}else{w=function(z){q.rs.intlStat("UploaderService","UploaderInstanceSwitchedTo_"+z.uploaderType);t.uploader=z;z.updateUI&&z.updateUI();};}if(t.prevUploader&&t.prevUploader.uploaderType===q.UPLOADER_TYPE_FORM){Y=t.uploader;t.uploader=t.prevUploader;t.prevUploader=Y;q.type=q.UPLOADER_TYPE_FORM;w(t.uploader);q.logIt("compose-attach: Switch to "+q.type+" uploader (found existing)");}else{t.prevUploader=t.uploader;u.forceForm=1;u.previousType=t.prevUploader&&t.prevUploader.uploaderType;C.use("mail-service-uploader-form",function(){q.create(u,w,q.UPLOADER_TYPE_FORM);});q.type=q.UPLOADER_TYPE_FORM;q.logIt("compose-attach: Switch to "+q.type+" uploader, creating new uploader");}t.prevUploader&&t.prevUploader.detachEvents&&t.prevUploader.detachEvents();}function B(o){var r=this,p=C.mail.UploaderService,Y,q=0;o=o||p.UPLOADER_TYPE_FLASH;p.rs.intlStat("UploaderService","SwitchTo"+o+"Uploader");if(r.prevUploader&&r.prevUploader.uploaderType===o){Y=r.uploader;r.uploader=r.prevUploader;r.prevUploader=Y;p.rs.intlStat("UploaderService","UploaderInstanceSwitchedTo_"+o);p.logIt("compose-attach: Switch to "+o+" uploader");p.type=o;r.uploader.bindEvents&&r.uploader.bindEvents();q=1;}else{p.logIt("compose-attach: switch to "+o+", ERROR - existing uploader not found!!");p.rs.intlStat("UploaderService","Existing"+o+"UploaderNotFound");}return q;}function K(p,Y,o){p.addClass("active");Y&&Y.hasClass("active")&&Y.removeClass("active");o&&o.hasClass("active")&&o.removeClass("active");}function S(){var q=this,p=C.mail.UploaderService,o=q.type,Y=q.tab;p.logIt("updateAttachButtonUI");if(o===p.UPLOADER_TYPE_FLASH&&Y.getStyle("visibility")==="visible"){q.reposAttachObj("restore");}else{q.reposAttachObj("offscreen");}if(D){p.toggleUploaderUI({type:o,tab:Y,attView:q});}}function k(u){var t=this,p=C.mail.UploaderService,q="#switch-form",Y="#switch-flash",x="#switch-html5",v,o=u.node||C.one("#menu-attach-options"),s=u.flashCrash||0,w=u.destroy||0,r,y,z;p.logIt("toggleUploaderType: form="+u.form+", flash="+u.flash+",html5="+u.html5);if(u.form&&t.type!==p.UPLOADER_TYPE_FORM){p.rs.intlStat("UploaderService","ToggleFormActivated");t.type=p.UPLOADER_TYPE_FORM;t.switchToFormUploader({flashCrash:s,destroy:w});t.updateAttachButtonUI({text:V.str_comp_attach_singular});if(!C.UA.webkit){v=t.tab.all(".lozengeretry");v&&v.addClass("hidden");}o&&K(o.one(q),o.one(Y),o.one(x));}else{if((u.flash&&t.type!==p.UPLOADER_TYPE_FLASH)||(u.html5&&t.type!==p.UPLOADER_TYPE_HTML5)){if(u.flash){r=Y;y=x;z=p.UPLOADER_TYPE_FLASH;}else{r=x;y=Y;z=p.UPLOADER_TYPE_HTML5;}p.rs.intlStat("UploaderService","Toggle"+z+"Activated");o&&K(o.one(r),o.one(q),o.one(y));t.type=z;if(t.switchToUploader(z)){t.updateAttachButtonUI({text:V.str_comp_attach});}else{o&&K(o.one(q),o.one(Y),o.one(x));t.type=p.UPLOADER_TYPE_FORM;}}}}function h(o){var Y=V.str_rte_attachments_bytes;if(o>1048575){o/=1048576;Y=V.str_rte_attachments_megabyte;}else{if(o>1023){o/=1024;Y=V.str_rte_attachments_kilobyte;}}if(isNaN(o)){o=0;}return Math.round(o)+" "+Y;}function N(Y){var q=this,o=q.cdo.get("attachments")[Y],p=o&&o.state||0;if(p.uploaded&&!p.failed&&!p.cancelled){q.cdo.fire("compose:downloadAttachment",Y);}}function l(t){var s=this,q=s.saveUiBtnStyle,p=t===2?"addClass":"removeClass",r=t>0?"addClass":"removeClass",Y=t>0?"removeClass":"addClass",o=C.one(".yuiUploadBox")||null;if(!s.uploader){return;}if(s.uiAttBtnDisabled&&s.uploader.uploaderType===C.mail.UploaderService.UPLOADER_TYPE_FLASH){s.uiAttBtnDisabled[Y](i);}if(s.uiAttSize){s.uiAttSize[p]("overlimit");}if(s.uiAttBtnForm){s.uiAttBtnForm[r](i);}if(o){if(t>0){if(!q){s.saveUiBtnStyle=o.getAttribute("style");}o.setAttribute("style","position:absolute;top:0;left:0;width:1px;height:1px;");}else{if(typeof q!=="undefined"){o.setAttribute("style",q);}}}}function Z(p){var o=p&&p.state||{},q=p.mimetype||"",Y="";q=unescape(q);if(o.failed){Y="transfer-error ";if(o.failCause==="virus"){Y+="virus ";}}if(q){if(L[q]){Y+=L[q];}else{Y+="no-type";}}else{Y+="no-type";}return Y;}function F(r,u){var v=this,q=C.mail.UploaderService,w=v.uploader&&v.uploader.uploaderType,p=q&&q.UPLOADER_TYPE_FLASH,t="offscreen",Y="restore",o,s=v.uiAttBar.one("#upload_file_selection");if(q&&w===p&&v.uiAttBar){o=v.uiAttBar.one("span.attachment-button-attach");if(o.hasClass(i)){o=s;}u=u||o.getXY();if(r===t||v.attachPaneHidden){if(!v.attachXY||v.attachXY[0]!==0||v.attachXY[1]!==0){v.attachXY=[0,0];o.fire("compose:reposAttachObj",{x:0,y:0,resize:true,width:"1px",height:"1px"});D&&o.setStyle("position","absolute");}}else{if((!v.attachXY||u[0]!==v.attachXY[0]||u[1]!==v.attachXY[1])&&(v.type===p||!v.type)){if(D){s.setStyle("position","relative").setStyle("top","auto").setStyle("left","auto");
return;}v.attachXY=[u[0],u[1]];if(r===Y){o.fire("compose:reposAttachObj",{x:u[0],y:u[1],resize:true,height:o.getStyle("height"),width:o.getStyle("width")});}else{o.fire("compose:reposAttachObj",{x:u[0],y:u[1],resize:false});}}}}}function U(){var o=this,Y=o.uploader;C.each(o.handles,function(p){p.detach&&p.detach();});o.handles=[];if(Y&&Y.handles){C.each(Y.handles,function(p){p.detach&&p.detach();});Y.handles=[];Y.attView=null;Y.tab.uploader=null;Y.tab=null;delete X.uploadersCreated[Y.id];}if(Y&&Y.checkFlashTimeout){clearTimeout(Y.checkFlashTimeout);}o.toggleUploaderHandle&&o.toggleUploaderHandle.detach();o.toggleUploaderHandle=null;o.uploader=null;o.uiAttForm=null;o.tab=null;o.uiAttBar=null;o.uiRemoveAll=null;o.uiAttCount=null;o.uiAttSize=null;o.uiAttAVLogo=null;o.uiAttMessage=null;o.uiAttBtnForm=null;o.uiAttBtnDisabled=null;o.uiAttPane=null;o.uiAttList=null;o.uiAttWelcome=null;o.uploaderConfig=null;if(o.attachLargeBtn){o.attachLargeBtn.remove().destroy(true);o.attachLargeBtn=null;}}C.mail.AttachmentView.prototype={setAttachmentStyle:O,addAttachment:R,addNewAttachment:J,removeAttachment:E,enableAttachment:j,downloadAttachment:N,toggleOverLimit:l,updateAttachmentProgress:M,updateSizeAndCount:e,getIconClass:Z,attachError:a,checkOverLimit:I,retryOrSwitchAttachmentMode:g,switchToFormUploader:c,switchToUploader:B,toggleUploaderType:k,updateAttachButtonUI:S,reposAttachObj:F,cleanUp:U};},"1.0.0",{requires:["rocket-stats","swfdetect","mail-service-uploader-utils"]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-br",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)},r="host",i="li";e.extend(n,e.Base,{_onKeyDown:function(t){if(t.stopped){t.halt();return}if(t.keyCode===13){var n=this.get(r),s=n.getInstance(),o=new s.EditorSelection;o&&(e.UA.ie&&(!o.anchorNode||!o.anchorNode.test(i)&&!o.anchorNode.ancestor(i))&&(n.execCommand("inserthtml",s.EditorSelection.CURSOR),t.halt()),e.UA.webkit&&(!o.anchorNode||!o.anchorNode.test(i)&&!o.anchorNode.ancestor(i))&&(n.frame._execCommand("insertlinebreak",null),t.halt()))}},_afterEditorReady:function(){var t=this.get(r).getInstance(),n;try{t.config.doc.execCommand("insertbronreturn",null,!0)}catch(i){}if(e.UA.ie||e.UA.webkit)n=t.EditorSelection.ROOT,n.test("body")&&(n=t.config.doc),t.on("keydown",e.bind(this._onKeyDown,this),n)},_onNodeChange:function(e){switch(e.changedType){case"backspace-up":case"backspace-down":case"delete-up":var t=this.get(r).getInstance(),n=e.changedNode,i=t.config.doc.createTextNode(" ");n.appendChild(i),n.removeChild(i)}},initializer:function(){var t=this.get(r);if(t.editorPara){e.error("Can not plug EditorBR and EditorPara at the same time.");return}t.after("ready",e.bind(this._afterEditorReady,this)),e.UA.gecko&&t.on("nodeChange",e.bind(this._onNodeChange,this))}},{NAME:"editorBR",NS:"editorBR",ATTRS:{host:{value:!1}}}),e.namespace("Plugin"),e.Plugin.EditorBR=n},"3.13.0",{requires:["editor-base"]});
YUI.add("comms-editor-autobidi",function(D){var B=function(){B.superclass.constructor.apply(this,arguments);},A="host",C="text";D.extend(B,D.Base,{autoBidiOff:false,watchForAction:true,redetectDirection:false,disableAutoBidi:false,throttledFindEmptyParas:null,findEmptyParas:function(){var F=this.get(A).getInstance();if(F){var E=F.Selection.DEFAULT_BLOCK_TAG;if(F.all(E).size()===0){E=B.PARAGRAPHS;}F.all(E).each(function(H){var G=H.get(C);if(G===""||G===" "||G==="\u00A0"){H.setData(B.AUTO_BIDI,true);}});}},_onKeyDown:function(E){if(this.watchForAction&&!(E.crtlKey||E.metaKey)){this.throttledFindEmptyParas();this.watchForAction=false;}},autoBidi:function(J){var I,H,G,F,E;if(((J&&J.keyCode&&!B.NODETECT_KEYS[J.keyCode])||(J&&J.type&&J.type==="paste"))&&!this.autoBidiOff&&!this.disableAutoBidi){I=this.get(A).getInstance();E=I.Selection.DEFAULT_BLOCK_TAG;H=new I.Selection();G=H.anchorNode;if(G&&!(G.test(B.PARAGRAPHS))){G=G.ancestor(B.PARAGRAPHS);}if((G&&G.getData(B.AUTO_BIDI))||(G&&this.redetectDirection)){F=D.Intl.detectDirection(G.get(C));if(F){G.setAttribute("dir",F);G.setData(B.AUTO_BIDI,false);this.redetectDirection=false;}}}},_afterNodeChange:function(E){if(E.changedType==="mouseup"||(E.changedType==="keydown"&&(E.changedEvent.crtlKey||E.changedEvent.metaKey))){this.watchForAction=true;this.redetectDirection=true;}if(B.AFFECTING_EVENTS[E.changedType]){this.watchForAction=true;this.disableAutoBidi=false;}else{if(B.REDIRECTING_EVENTS[E.changedType]&&!this.disableAutoBidi){this.redetectDirection=true;}else{if(E.changedType!=="keydown"&&E.changedType!=="keyup"){D.later(50,this,this.autoBidi,E.changedEvent);}}}},_disableAutoBidi:function(){this.watchForAction=false;this.disableAutoBidi=true;},_turnAutoBidiOff:function(E){this.autoBidiOff=E.status;},initializer:function(){var E=this.get(A);E.after("nodeChange",D.bind(this._afterNodeChange,this));E.frame.on("dom:keydown",D.bind(this._onKeyDown,this));E.on("disableautobidi",D.bind(this._disableAutoBidi,this));E.on("turnautobidioff",D.bind(this._turnAutoBidiOff,this));this.throttledFindEmptyParas=D.throttle(D.bind(this.findEmptyParas,this),150);}},{PARAGRAPHS:"P, DIV, UL, OL",AUTO_BIDI:"autobidi",AFFECTING_EVENTS:{"enter":true,"backspace":true,"delete":true},REDIRECTING_EVENTS:{"home":true,"left":true,"right":true},NODETECT_KEYS:{8:"backspace",9:"tab",13:"enter",16:"shift",18:"alt",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},NAME:"editorAutoBidi",NS:"editorAutoBidi",ATTRS:{host:{value:false}}});D.namespace("Plugin");D.Plugin.EditorAutoBidi=B;},"1.0.0",{requires:["editor-base","comms-intl-bidi"]});/*
YUI 3.13.0 (build 3.13.0-ym3)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-bidi",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)},r="host",i="dir",s="nodeChange",o="bidiContextChange",u="style";e.extend(n,e.Base,{lastDirection:null,firstEvent:null,_checkForChange:function(){var e=this.get(r),t=e.getInstance(),i=new t.EditorSelection,s,u;i.isCollapsed?(s=n.blockParent(i.focusNode,!1,t.EditorSelection.ROOT),s&&(u=s.getStyle("direction"),u!==this.lastDirection&&(e.fire(o,{changedTo:u}),this.lastDirection=u))):(e.fire(o,{changedTo:"select"}),this.lastDirection=null)},_afterNodeChange:function(e){if(this.firstEvent||n.EVENTS[e.changedType])this._checkForChange(),this.firstEvent=!1},_afterMouseUp:function(){this._checkForChange(),this.firstEvent=!1},initializer:function(){var t=this.get(r);this.firstEvent=!0,t.after(s,e.bind(this._afterNodeChange,this)),t.after("dom:mouseup",e.bind(this._afterMouseUp,this))}},{EVENTS:{"backspace-up":!0,"pageup-up":!0,"pagedown-down":!0,"end-up":!0,"home-up":!0,"left-up":!0,"up-up":!0,"right-up":!0,"down-up":!0,"delete-up":!0},BLOCKS:e.EditorSelection.BLOCKS,DIV_WRAPPER:"<DIV></DIV>",blockParent:function(t,r,i){var s=t,o,u;return i=i||e.EditorSelection.ROOT,s||(s=i),s.test(n.BLOCKS)||(s=s.ancestor(n.BLOCKS)),r&&s.compareTo(i)&&(o=e.Node.create(n.DIV_WRAPPER),s.get("children").each(function(e,t){t===0?u=e:o.append(e)}),u.replace(o),o.prepend(u),s=o),s},_NODE_SELECTED:"bidiSelected",addParents:function(t,r){var i,s,o;tester=function(e){if(!e.getData(n._NODE_SELECTED))return o=!1,!0},r=r||e.EditorSelection.ROOT;for(i=0;i<t.length;i+=1)t[i].setData(n._NODE_SELECTED,!0);for(i=0;i<t.length;i+=1)s=t[i].get("parentNode"),!r.compareTo(s)&&!s.getData(n._NODE_SELECTED)&&(o=!0,s.get("children").some(tester),o&&(t.push(s),s.setData(n._NODE_SELECTED,!0)));for(i=0;i<t.length;i+=1)t[i].clearData(n._NODE_SELECTED);return t},NAME:"editorBidi",NS:"editorBidi",ATTRS:{host:{value:!1}},RE_TEXT_ALIGN:/text-align:\s*\w*\s*;/,removeTextAlign:function(e){return e&&(e.getAttribute(u).match(n.RE_TEXT_ALIGN)&&e.setAttribute(u,e.getAttribute(u).replace(n.RE_TEXT_ALIGN,"")),e.hasAttribute("align")&&e.removeAttribute("align")),e}}),e.namespace("Plugin"),e.Plugin.EditorBidi=n,e.Plugin.ExecCommand.COMMANDS.bidi=function(t,s){var o=this.getInstance(),u=new o.EditorSelection,a=this.get(r).get(r).editorBidi,f,l,c,h=o.EditorSelection.ROOT,p,d,v;if(!a){e.error("bidi execCommand is not available without the EditorBiDi plugin.");return}return o.EditorSelection.filterBlocks(),u.isCollapsed?(l=n.blockParent(u.anchorNode,!1,h),l||(l=h.one(o.EditorSelection.BLOCKS)),l=n.removeTextAlign(l),s||(v=l.getAttribute(i),!v||v==="ltr"?s="rtl":s="ltr"),l.setAttribute(i,s),e.UA.ie&&(c=l.all("br.yui-cursor"),c.size()===1&&l.get("childNodes").size()===1&&c.remove()),f=l):(p=u.getSelected(),d=[],p.each(function(e){d.push(n.blockParent(e,!1,h))}),d=o.all(n.addParents(d,h)),d.each(function(e){var t=s;e=n.removeTextAlign(e),t||(v=e.getAttribute(i),!v||v==="ltr"?t="rtl":t="ltr"),e.setAttribute(i,t)}),f=d),a._checkForChange(),f}},"3.13.0",{requires:["editor-base"]});
YUI.add("_shared_module_message_loading_error",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_message_loading_error={base:'<div id="loadingpane" class="msg-loadingpane"> {{loading_error}} {{diff_folder_error}} {{loading_error_else}}</div>',msg_deleted_error:'<div class="message"> {{str_msg_deleted_error}} </div> ',is_perm:"{{str_comp_loading_error_perm}} ",multi_retry:"{{str_comp_multi_retry}} ",multi_retry_else:"{{str_comp_loading_error}} ",is_perm_else:"{{multi_retry}} {{multi_retry_else}} ",can_retry:"<div class='message'> <span class='retry' data-action=\"retry-msg-load\">{{str_try_again}}</span> </div> ",show_tae:'<div class="message error_code">{{str_error_code}} {{tae_code}}</div>',msg_deleted_error_else:"<div class='message'> {{is_perm}} {{is_perm_else}} </div> {{can_retry}} {{show_tae}} ",loading_error:"{{msg_deleted_error}} {{msg_deleted_error_else}} ",diff_folder_error:"<div class='message'>{{str_error_msg_diff_folder_switch}}</div> ",loading_slow_else:'<div class="msg-loading s-loader"></div> ',loading_slow:"<div class='message'> {{str_comp_slow_loading}} </div> <div class='message'> <span class='retry' data-action=\"retry-msg-load\">{{str_try_again}}</span> </div> ",loading_error_else:"{{loading_slow_else}} {{loading_slow}} "};},"1.0.0");YUI.add("_shared_module_compose_message_body",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_message_body={base:'<div class="inner"> <label for="msg" class="offscreen">{{str_comp_messagebody}}</label> <div id="plaintext" class="cm-plaintext"> {{conversation_body_else}} </div> {{_shared_module_message_loading_error}} <div id="rtetext" class="cm-rtetext undoreset" style="visibility:hidden;"> {{conversation_body}} </div> {{has_quote}} <div id="pastebuffer" style="display:none" contenteditable="false"></div> </div>',conversation_body_else:'<textarea id="msg"></textarea>',conversation_body:'<div class="msg"> {{conversation_body}} </div> ',has_quote:'<div class="compose-quoted-text unselectable" contenteditable="false" onselectstart="return false;" title="{{str_qtd_expand}}" role="button"> <span class="icon icon-chevron-right qtd-expansion-icon unselectable" data-action="quoted-text"></span><span class="qtd-expansion-text unselectable" data-action="quoted-text">{{str_qtd_expand}}</span> </div> '};},"1.0.0",{requires:["_shared_module_message_loading_error"]});YUI.add("_shared_module_rte_well_content_attach_item",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_content_attach_item={base:"{{browser_plus_attach}}{{browser_plus_attach_else}}",transfer_error:"transfer-error",waiting:"in-queue ",image:'<div style="background-image:url({{thumbnailurl}});"></div> ',in_progress:'<div class="prog-indicator"> <div class="progress" style="width:{{progress}}%"></div> </div> ',browser_plus_attach:'<li role="presentation" class="attachmentVisible {{transfer_error}} {{waiting}} {{type}}"> <div class="file-container"> {{image}} <b/></b> </div> <span class="fname">{{filename}}</span> {{in_progress}}</li>',waiting1:"in-queue ",in_progress1:"downloading ",transfer_error1:"lozengeerror",transfer_warn:"lozengewarn",retry:'<span role="presentation" class="btn lozenge lozengeretry small hidden"><a role="presentation" tabindex="-1" title="{{str_btn_retry_file_attr}}">&nbsp;<b></b></a></span>',transfer_error2:"lozengeerror-remove",browser_plus_attach_else:'<li role="presentation" class="attachmentVisible {{waiting1}} {{in_progress1}} {{type}}"><div tabindex="-1" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="lozengeProgress"></div> <span role="presentation" class="btn lozenge {{transfer_error1}} left small"><a role="option" title="{{filesize}}" tabindex="-1" class="{{transfer_warn}}">{{filename}}</a></span>{{retry}}<span role="presentation" class="btn lozenge lozengeremove {{transfer_error2}} right small"><a role="presentation" tabindex="-1" title="{{str_btn_remove_file_attr}}">&nbsp;<b></b></a></span></li>'};},"1.0.0");YUI.add("_shared_module_message_norton_logo",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_message_norton_logo={base:'<img src="https://s.yimg.com/ok/u/assets/img/norton-horizlogo.png" data-action="av_sponsor" class="avLogo" title="{{str_comp_av_norton_attr}}" alt="{{str_comp_av_norton_attr}}"/>'};},"1.0.0");YUI.add("_shared_module_rte_well_content_file_count",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_content_file_count={base:'<div class="file-count"> <span class="attachments-count hidden">{{str_rte_attachments_num_files}}</span> <span class="attachments-size hidden">{{str_rte_attachments_sizes}}</span> {{display_av_logo}}</div>',display_av_logo:"{{_shared_module_message_norton_logo}}"};},"1.0.0",{requires:["_shared_module_message_norton_logo"]});YUI.add("_shared_module_rte_well_content_attachments_well_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_content_attachments_well_fresh={base:'<div class="attachments-well {{page_compose_email_else}} {{browser_plus_attach_else}}"> <div class="attachments-welcome"> {{browser_plus_attach}} </div> <ul role="listbox" aria-live="polite" class="file-attach hidden"> {{file_attach_files}} </ul> <span class="btn left right attachment-button-removeall hidden"> <a role="button" href="#" title="{{str_comp_attach_removeall}}">{{str_comp_attach_removeall}}</a> </span> {{_shared_module_rte_well_content_file_count}} <div role="alert" class="error transfer-error hidden"> <span class="attachmenterror"> {{attachments_error}} </span> </div> </div>',page_compose_email_else:"hidden",attached_files_else:"hidden",browser_plus_attach_else:"simple-upload {{attached_files_else}} ",browser_plus_attach:"<h2>{{str_rte_attachments_attach_files}}</h2> <h3>{{str_rte_attachments_drag_files}}</h3> ",file_attach_files:"{{_shared_module_rte_well_content_attach_item}} ",multiple_files_failed:"{{str_rte_attachments_error_mult}}",multiple_files_failed_else:"{{str_rte_attachments_error_single}}",attachments_error:"{{multiple_files_failed}} {{multiple_files_failed_else}} "};},"1.0.0",{requires:["_shared_module_rte_well_content_attach_item","_shared_module_rte_well_content_file_count"]});